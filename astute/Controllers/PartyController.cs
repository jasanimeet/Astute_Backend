using astute.CoreModel;
using astute.CoreServices;
using astute.Hubs;
using astute.Models;
using astute.Repository;
using Google.Apis.Auth.OAuth2;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.SignalR;
using Microsoft.Data.SqlClient;
using Microsoft.Extensions.Configuration;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using NPOI.HSSF.UserModel;
using NPOI.SS.UserModel;
using OfficeOpenXml;
using Oracle.ManagedDataAccess.Client;
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Reflection;
using System.Text;
using System.Text.Json;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using System.Web;

namespace astute.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public partial class PartyController : ControllerBase
    {
        #region Fields
        private readonly IPartyService _partyService;
        private readonly IConfiguration _configuration;
        private readonly ICommonService _commonService;
        private readonly IHttpContextAccessor _httpContextAccessor;
        private readonly ISupplierService _supplierService;
        private readonly ICartService _cartService;
        private readonly IEmailSender _emailSender;
        private readonly IJWTAuthentication _jWTAuthentication;
        private readonly IEmployeeService _employeeService;
        private readonly ILabUserService _labUserService;
        private readonly ILab_User_Login_Activity_Services _lab_User_Login_Activity_Services;
        private readonly IOracleService _oracleService;
        private readonly ICategoryService _categoryService;
        private readonly ICompanyService _companyService;
        private readonly ITermsAndConditionService _termsAndConditionService;
        private IHubContext<PrintHub, IPrintHub> _printHub;
        #endregion

        #region Ctor
        public PartyController(IPartyService partyService,
            IConfiguration configuration,
            ICommonService commonService,
            IHttpContextAccessor httpContextAccessor,
            ISupplierService supplierService,
            ICartService cartService,
            IEmailSender emailSender,
            IJWTAuthentication jWTAuthentication,
            IEmployeeService employeeService,
            ILabUserService labUserService,
            ILab_User_Login_Activity_Services lab_User_Login_Activity_Services,
            IOracleService oracleService,
            ICategoryService categoryService,
            ICompanyService companyService,
            ITermsAndConditionService termsAndConditionService,
            IHubContext<PrintHub, IPrintHub> printHub
            )
        {
            _partyService = partyService;
            _configuration = configuration;
            _commonService = commonService;
            _httpContextAccessor = httpContextAccessor;
            _supplierService = supplierService;
            _cartService = cartService;
            _emailSender = emailSender;
            _jWTAuthentication = jWTAuthentication;
            _employeeService = employeeService;
            _labUserService = labUserService;
            _lab_User_Login_Activity_Services = lab_User_Login_Activity_Services;
            _oracleService = oracleService;
            _categoryService = categoryService;
            _companyService = companyService;
            _termsAndConditionService = termsAndConditionService;
            _printHub = printHub;
        }
        #endregion

        #region Utilities
        private async Task<DataTable> Set_Column_In_Datatable(int? supplier_Id, DataTable dt_stock_data, IList<Stock_Data> stock_Datas)
        {
            var party_master = await _partyService.Get_Party_Details(supplier_Id ?? 0);
            dt_stock_data.Columns.Add("SUPPLIER_NO", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_NO", typeof(string));
            dt_stock_data.Columns.Add("LAB", typeof(string));
            dt_stock_data.Columns.Add("SHAPE", typeof(string));
            dt_stock_data.Columns.Add("CTS", typeof(string));
            dt_stock_data.Columns.Add("BASE_DISC", typeof(string));
            dt_stock_data.Columns.Add("BASE_RATE", typeof(string));
            dt_stock_data.Columns.Add("BASE_AMOUNT", typeof(string));
            dt_stock_data.Columns.Add("COLOR", typeof(string));
            dt_stock_data.Columns.Add("CLARITY", typeof(string));
            dt_stock_data.Columns.Add("CUT", typeof(string));
            dt_stock_data.Columns.Add("POLISH", typeof(string));
            dt_stock_data.Columns.Add("SYMM", typeof(string));
            dt_stock_data.Columns.Add("FLS_COLOR", typeof(string));
            dt_stock_data.Columns.Add("FLS_INTENSITY", typeof(string));
            dt_stock_data.Columns.Add("LENGTH", typeof(string));
            dt_stock_data.Columns.Add("WIDTH", typeof(string));
            dt_stock_data.Columns.Add("DEPTH", typeof(string));
            dt_stock_data.Columns.Add("MEASUREMENT", typeof(string));
            dt_stock_data.Columns.Add("DEPTH_PER", typeof(string));
            dt_stock_data.Columns.Add("TABLE_PER", typeof(string));
            dt_stock_data.Columns.Add("CULET", typeof(string));
            dt_stock_data.Columns.Add("SHADE", typeof(string));
            dt_stock_data.Columns.Add("LUSTER", typeof(string));
            dt_stock_data.Columns.Add("MILKY", typeof(string));
            dt_stock_data.Columns.Add("BGM", typeof(string));
            dt_stock_data.Columns.Add("LOCATION", typeof(string));
            dt_stock_data.Columns.Add("STATUS", typeof(string));
            dt_stock_data.Columns.Add("TABLE_BLACK", typeof(string));
            dt_stock_data.Columns.Add("SIDE_BLACK", typeof(string));
            dt_stock_data.Columns.Add("TABLE_WHITE", typeof(string));
            dt_stock_data.Columns.Add("SIDE_WHITE", typeof(string));
            dt_stock_data.Columns.Add("TABLE_OPEN", typeof(string));
            dt_stock_data.Columns.Add("CROWN_OPEN", typeof(string));
            dt_stock_data.Columns.Add("PAVILION_OPEN", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_OPEN", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_FROM", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_TO", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_CONDITION", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_TYPE", typeof(string));
            dt_stock_data.Columns.Add("LASER_INSCRIPTION", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_DATE", typeof(string));
            dt_stock_data.Columns.Add("CROWN_ANGLE", typeof(string));
            dt_stock_data.Columns.Add("CROWN_HEIGHT", typeof(string));
            dt_stock_data.Columns.Add("PAVILION_ANGLE", typeof(string));
            dt_stock_data.Columns.Add("PAVILION_HEIGHT", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_PER", typeof(string));
            dt_stock_data.Columns.Add("LR_HALF", typeof(string));
            dt_stock_data.Columns.Add("STAR_LN", typeof(string));
            dt_stock_data.Columns.Add("CERT_TYPE", typeof(string));
            dt_stock_data.Columns.Add("FANCY_COLOR", typeof(string));
            dt_stock_data.Columns.Add("FANCY_INTENSITY", typeof(string));
            dt_stock_data.Columns.Add("FANCY_OVERTONE", typeof(string));
            dt_stock_data.Columns.Add("IMAGE_LINK", typeof(string));
            dt_stock_data.Columns.Add("Image2", typeof(string));
            dt_stock_data.Columns.Add("VIDEO_LINK", typeof(string));
            dt_stock_data.Columns.Add("Video2", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_LINK", typeof(string));
            dt_stock_data.Columns.Add("DNA", typeof(string));
            dt_stock_data.Columns.Add("IMAGE_HEART_LINK", typeof(string));
            dt_stock_data.Columns.Add("IMAGE_ARROW_LINK", typeof(string));
            dt_stock_data.Columns.Add("H_A_LINK", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_TYPE_LINK", typeof(string));
            dt_stock_data.Columns.Add("KEY_TO_SYMBOL", typeof(string));
            dt_stock_data.Columns.Add("LAB_COMMENTS", typeof(string));
            dt_stock_data.Columns.Add("SUPPLIER_COMMENTS", typeof(string));
            dt_stock_data.Columns.Add("ORIGIN", typeof(string));
            dt_stock_data.Columns.Add("BOW_TIE", typeof(string));
            dt_stock_data.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
            dt_stock_data.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
            dt_stock_data.Columns.Add("EXTRA_FACET_PAVILION", typeof(string));
            dt_stock_data.Columns.Add("INTERNAL_GRAINING", typeof(string));
            dt_stock_data.Columns.Add("H_A", typeof(string));
            dt_stock_data.Columns.Add("SUPPLIER_DISC", typeof(string));
            dt_stock_data.Columns.Add("SUPPLIER_AMOUNT", typeof(string));
            dt_stock_data.Columns.Add("OFFER_DISC", typeof(string));
            dt_stock_data.Columns.Add("OFFER_VALUE", typeof(string));
            dt_stock_data.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
            dt_stock_data.Columns.Add("MAX_SLAB_BASE_VALUE", typeof(string));
            dt_stock_data.Columns.Add("EYE_CLEAN", typeof(string));
            dt_stock_data.Columns.Add("GOOD_TYPE", typeof(string));
            dt_stock_data.Columns.Add("Short_Code", typeof(string));
            dt_stock_data.Columns.Add("IS_NATURAL", typeof(string));

            if (stock_Datas != null && stock_Datas.Count > 0)
            {
                var lakhi_Party_Code = _configuration["Lakhi_Party_Code"];
                foreach (var item in stock_Datas)
                {
                    var table_white = string.Empty;
                    var table_Black = string.Empty;
                    var side_White = string.Empty;
                    var side_Black = string.Empty;
                    if (party_master != null && party_master.Party_Code == lakhi_Party_Code)
                    {
                        (table_white, _) = CoreService.Table_And_Side_White(item.TABLE_WHITE);
                        (_, side_White) = CoreService.Table_And_Side_White(item.SIDE_WHITE);

                        (table_Black, _) = CoreService.Table_And_Side_Black(item.TABLE_BLACK);
                        (_, side_Black) = CoreService.Table_And_Side_Black(item.SIDE_BLACK);
                    }
                    else
                    {
                        table_white = item.TABLE_WHITE;
                        table_Black = item.TABLE_BLACK;
                        side_White = item.SIDE_WHITE;
                        side_Black = item.SIDE_BLACK;
                    }
                    dt_stock_data.Rows.Add(
                        item.SUPPLIER_NO ?? null,
                        item.CERTIFICATE_NO ?? null,
                        item.LAB ?? null,
                        item.SHAPE ?? null,
                        item.CTS ?? null,
                        item.BASE_DISC != item.BASE_DISC && !string.IsNullOrEmpty(item.BASE_DISC) ? item.BASE_DISC.Replace("$", "") : null,
                        item.BASE_RATE != item.BASE_RATE && !string.IsNullOrEmpty(item.BASE_RATE) ? item.BASE_RATE.Replace("$", "") : null,
                        item.BASE_AMOUNT != item.BASE_AMOUNT && !string.IsNullOrEmpty(item.BASE_AMOUNT) ? item.BASE_AMOUNT.Replace("$", "") : null,
                        item.COLOR ?? null,
                        item.CLARITY ?? null,
                        item.CUT ?? null,
                        item.POLISH ?? null,
                        item.SYMM ?? null,
                        item.FLS_COLOR ?? null,
                        item.FLS_INTENSITY ?? null,
                        item.LENGTH != null && !string.IsNullOrEmpty(item.LENGTH.ToString()) ? Convert.ToString(item.LENGTH) : item.MEASUREMENT != null ? Split_Supplier_Stock_Measurement(Convert.ToString(item.MEASUREMENT), "length") : DBNull.Value,
                        item.WIDTH != null && !string.IsNullOrEmpty(item.WIDTH.ToString()) ? Convert.ToString(item.WIDTH) : item.MEASUREMENT != null ? Split_Supplier_Stock_Measurement(Convert.ToString(item.MEASUREMENT), "width") : DBNull.Value,
                        item.DEPTH != null && !string.IsNullOrEmpty(item.DEPTH.ToString()) ? Convert.ToString(item.DEPTH) : item.MEASUREMENT != null ? Split_Supplier_Stock_Measurement(Convert.ToString(item.MEASUREMENT), "depth") : DBNull.Value,
                        item.MEASUREMENT ?? null,
                        item.DEPTH_PER != item.DEPTH_PER && !string.IsNullOrEmpty(item.DEPTH_PER) ? item.DEPTH_PER.Replace("%", "") : null,
                        item.TABLE_PER != item.TABLE_PER && !string.IsNullOrEmpty(item.TABLE_PER) ? item.TABLE_PER.Replace("%", "") : null,
                        item.CULET ?? null,
                        item.SHADE ?? null,
                        item.LUSTER ?? null,
                        item.MILKY ?? null,
                        item.BGM ?? null,
                        item.LOCATION ?? null,
                        item.STATUS ?? null,
                        table_Black,
                        side_Black,
                        table_white,
                        side_White,
                        item.TABLE_OPEN ?? null,
                        item.CROWN_OPEN ?? null,
                        item.PAVILION_OPEN ?? null,
                        item.GIRDLE_OPEN ?? null,
                        !string.IsNullOrEmpty(item.GIRDLE_FROM) ? (item.GIRDLE_FROM.Contains("-") ? (item.GIRDLE_FROM.Split(" - ").Length == 1 ? item.GIRDLE_FROM.Split(" - ")[0] : item.GIRDLE_FROM) : (item.GIRDLE_FROM.ToUpper().Contains(" TO ") ? (item.GIRDLE_FROM.ToUpper().Split(" TO ").Length == 1 ? item.GIRDLE_FROM.ToUpper().Split(" TO ")[0] : item.GIRDLE_FROM) : item.GIRDLE_FROM)) : null,
                        !string.IsNullOrEmpty(item.GIRDLE_TO) ? (item.GIRDLE_TO.Contains("-") ? (item.GIRDLE_TO.Split(" - ").Length == 2 ? item.GIRDLE_TO.Split(" - ")[0] : item.GIRDLE_TO) : (item.GIRDLE_TO.ToUpper().Contains(" TO ") ? (item.GIRDLE_TO.ToUpper().Split(" TO ").Length == 2 ? item.GIRDLE_TO.ToUpper().Split(" TO ")[0] : item.GIRDLE_TO) : item.GIRDLE_TO)) : null,
                        item.GIRDLE_CONDITION ?? null,
                        item.GIRDLE_TYPE ?? null,
                        item.LASER_INSCRIPTION ?? null,
                        item.CERTIFICATE_DATE ?? null,
                        item.CROWN_ANGLE != item.CROWN_ANGLE && !string.IsNullOrEmpty(item.CROWN_ANGLE) ? item.CROWN_ANGLE.Replace("%", "") : null,
                        item.CROWN_HEIGHT != item.CROWN_HEIGHT && !string.IsNullOrEmpty(item.CROWN_HEIGHT) ? item.CROWN_HEIGHT.Replace("%", "") : null,
                        item.PAVILION_ANGLE != item.PAVILION_ANGLE && !string.IsNullOrEmpty(item.PAVILION_ANGLE) ? item.PAVILION_ANGLE.Replace("%", "") : null,
                        item.PAVILION_HEIGHT != item.PAVILION_HEIGHT && !string.IsNullOrEmpty(item.PAVILION_HEIGHT) ? item.PAVILION_HEIGHT.Replace("%", "") : null,
                        item.GIRDLE_PER != item.GIRDLE_PER && !string.IsNullOrEmpty(item.GIRDLE_PER) ? item.GIRDLE_PER.Replace("%", "") : null,
                        item.LR_HALF != item.LR_HALF && !string.IsNullOrEmpty(item.LR_HALF) ? item.LR_HALF.Replace("%", "") : null,
                        item.STAR_LN != item.STAR_LN && !string.IsNullOrEmpty(item.STAR_LN) ? item.STAR_LN.Replace("%", "") : null,
                        item.CERT_TYPE ?? null,
                        item.FANCY_COLOR ?? null,
                        item.FANCY_INTENSITY ?? null,
                        item.FANCY_OVERTONE ?? null,
                        item.IMAGE_LINK ?? null,
                        item.Image2 ?? null,
                        item.VIDEO_LINK ?? null,
                        item.Video2 ?? null,
                        item.CERTIFICATE_LINK ?? null,
                        item.DNA ?? null,
                        item.IMAGE_HEART_LINK ?? null,
                        item.IMAGE_ARROW_LINK ?? null,
                        item.H_A_LINK ?? null,
                        item.CERTIFICATE_TYPE_LINK ?? null,
                        item.KEY_TO_SYMBOL ?? null,
                        item.LAB_COMMENTS ?? null,
                        item.SUPPLIER_COMMENTS ?? null,
                        item.ORIGIN ?? null,
                        item.BOW_TIE ?? null,
                        item.EXTRA_FACET_TABLE ?? null,
                        item.EXTRA_FACET_CROWN ?? null,
                        item.EXTRA_FACET_PAVILION ?? null,
                        item.INTERNAL_GRAINING ?? null,
                        item.H_A ?? null,
                        item.SUPPLIER_DISC ?? null,
                        item.SUPPLIER_AMOUNT ?? null,
                        item.OFFER_DISC ?? null,
                        item.OFFER_VALUE ?? null,
                        item.MAX_SLAB_BASE_DISC ?? null,
                        item.MAX_SLAB_BASE_VALUE ?? null,
                        item.EYE_CLEAN ?? null,
                        item.GOOD_TYPE ?? null,
                        item.Short_Code ?? null,
                        item.Is_Natural ?? null);
                }
            }
            return dt_stock_data;
        }
        private async Task<DataTable> Set_Column_In_Datatable_Scheduler(DataTable dt_stock_data, IList<Stock_Data_Schedular> stock_Datas, int supplier_Id)
        {
            var party_master = await _partyService.Get_Party_Details(supplier_Id);
            dt_stock_data.Columns.Add("SUPPLIER_NO", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_NO", typeof(string));
            dt_stock_data.Columns.Add("LAB", typeof(string));
            dt_stock_data.Columns.Add("SHAPE", typeof(string));
            dt_stock_data.Columns.Add("CTS", typeof(string));
            dt_stock_data.Columns.Add("BASE_DISC", typeof(string));
            dt_stock_data.Columns.Add("BASE_RATE", typeof(string));
            dt_stock_data.Columns.Add("BASE_AMOUNT", typeof(string));
            dt_stock_data.Columns.Add("COLOR", typeof(string));
            dt_stock_data.Columns.Add("CLARITY", typeof(string));
            dt_stock_data.Columns.Add("CUT", typeof(string));
            dt_stock_data.Columns.Add("POLISH", typeof(string));
            dt_stock_data.Columns.Add("SYMM", typeof(string));
            dt_stock_data.Columns.Add("FLS_COLOR", typeof(string));
            dt_stock_data.Columns.Add("FLS_INTENSITY", typeof(string));
            dt_stock_data.Columns.Add("LENGTH", typeof(string));
            dt_stock_data.Columns.Add("WIDTH", typeof(string));
            dt_stock_data.Columns.Add("DEPTH", typeof(string));
            dt_stock_data.Columns.Add("MEASUREMENT", typeof(string));
            dt_stock_data.Columns.Add("DEPTH_PER", typeof(string));
            dt_stock_data.Columns.Add("TABLE_PER", typeof(string));
            dt_stock_data.Columns.Add("CULET", typeof(string));
            dt_stock_data.Columns.Add("SHADE", typeof(string));
            dt_stock_data.Columns.Add("LUSTER", typeof(string));
            dt_stock_data.Columns.Add("MILKY", typeof(string));
            dt_stock_data.Columns.Add("BGM", typeof(string));
            dt_stock_data.Columns.Add("LOCATION", typeof(string));
            dt_stock_data.Columns.Add("STATUS", typeof(string));
            dt_stock_data.Columns.Add("TABLE_BLACK", typeof(string));
            dt_stock_data.Columns.Add("SIDE_BLACK", typeof(string));
            dt_stock_data.Columns.Add("TABLE_WHITE", typeof(string));
            dt_stock_data.Columns.Add("SIDE_WHITE", typeof(string));
            dt_stock_data.Columns.Add("TABLE_OPEN", typeof(string));
            dt_stock_data.Columns.Add("CROWN_OPEN", typeof(string));
            dt_stock_data.Columns.Add("PAVILION_OPEN", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_OPEN", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_FROM", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_TO", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_CONDITION", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_TYPE", typeof(string));
            dt_stock_data.Columns.Add("LASER_INSCRIPTION", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_DATE", typeof(string));
            dt_stock_data.Columns.Add("CROWN_ANGLE", typeof(string));
            dt_stock_data.Columns.Add("CROWN_HEIGHT", typeof(string));
            dt_stock_data.Columns.Add("PAVILION_ANGLE", typeof(string));
            dt_stock_data.Columns.Add("PAVILION_HEIGHT", typeof(string));
            dt_stock_data.Columns.Add("GIRDLE_PER", typeof(string));
            dt_stock_data.Columns.Add("LR_HALF", typeof(string));
            dt_stock_data.Columns.Add("STAR_LN", typeof(string));
            dt_stock_data.Columns.Add("CERT_TYPE", typeof(string));
            dt_stock_data.Columns.Add("FANCY_COLOR", typeof(string));
            dt_stock_data.Columns.Add("FANCY_INTENSITY", typeof(string));
            dt_stock_data.Columns.Add("FANCY_OVERTONE", typeof(string));
            dt_stock_data.Columns.Add("IMAGE_LINK", typeof(string));
            dt_stock_data.Columns.Add("Image2", typeof(string));
            dt_stock_data.Columns.Add("VIDEO_LINK", typeof(string));
            dt_stock_data.Columns.Add("Video2", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_LINK", typeof(string));
            dt_stock_data.Columns.Add("DNA", typeof(string));
            dt_stock_data.Columns.Add("IMAGE_HEART_LINK", typeof(string));
            dt_stock_data.Columns.Add("IMAGE_ARROW_LINK", typeof(string));
            dt_stock_data.Columns.Add("H_A_LINK", typeof(string));
            dt_stock_data.Columns.Add("CERTIFICATE_TYPE_LINK", typeof(string));
            dt_stock_data.Columns.Add("KEY_TO_SYMBOL", typeof(string));
            dt_stock_data.Columns.Add("LAB_COMMENTS", typeof(string));
            dt_stock_data.Columns.Add("SUPPLIER_COMMENTS", typeof(string));
            dt_stock_data.Columns.Add("ORIGIN", typeof(string));
            dt_stock_data.Columns.Add("BOW_TIE", typeof(string));
            dt_stock_data.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
            dt_stock_data.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
            dt_stock_data.Columns.Add("EXTRA_FACET_PAVILION", typeof(string));
            dt_stock_data.Columns.Add("INTERNAL_GRAINING", typeof(string));
            dt_stock_data.Columns.Add("H_A", typeof(string));
            dt_stock_data.Columns.Add("SUPPLIER_DISC", typeof(string));
            dt_stock_data.Columns.Add("SUPPLIER_AMOUNT", typeof(string));
            dt_stock_data.Columns.Add("OFFER_DISC", typeof(string));
            dt_stock_data.Columns.Add("OFFER_VALUE", typeof(string));
            dt_stock_data.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
            dt_stock_data.Columns.Add("MAX_SLAB_BASE_VALUE", typeof(string));
            dt_stock_data.Columns.Add("EYE_CLEAN", typeof(string));
            dt_stock_data.Columns.Add("GOOD_TYPE", typeof(string));
            dt_stock_data.Columns.Add("Short_Code", typeof(string));
            dt_stock_data.Columns.Add("IS_NATURAL", typeof(string));

            if (stock_Datas != null && stock_Datas.Count > 0)
            {
                var lakhi_Party_Code = _configuration["Lakhi_Party_Code"];
                foreach (var item in stock_Datas)
                {
                    var table_white = string.Empty;
                    var table_Black = string.Empty;
                    var side_White = string.Empty;
                    var side_Black = string.Empty;
                    if (party_master != null && party_master.Party_Code == lakhi_Party_Code)
                    {
                        (table_white, _) = CoreService.Table_And_Side_White(Convert.ToString(item.TABLE_WHITE));
                        (_, side_White) = CoreService.Table_And_Side_White(Convert.ToString(item.SIDE_WHITE));

                        (table_Black, _) = CoreService.Table_And_Side_White(Convert.ToString(item.TABLE_BLACK));
                        (_, side_Black) = CoreService.Table_And_Side_White(Convert.ToString(item.SIDE_BLACK));
                    }
                    else
                    {
                        table_white = Convert.ToString(item.TABLE_WHITE);
                        table_Black = Convert.ToString(item.TABLE_BLACK);
                        side_White = Convert.ToString(item.SIDE_WHITE);
                        side_Black = Convert.ToString(item.SIDE_BLACK);
                    }
                    dt_stock_data.Rows.Add(item.SUPPLIER_NO != null ? Convert.ToString(item.SUPPLIER_NO) : DBNull.Value,
                        item.CERTIFICATE_NO != null ? Convert.ToString(item.CERTIFICATE_NO) : DBNull.Value,
                        item.LAB != null ? Convert.ToString(item.LAB) : DBNull.Value,
                        item.SHAPE != null ? Convert.ToString(item.SHAPE) : DBNull.Value,
                        item.CTS != null ? Convert.ToString(item.CTS) : DBNull.Value,
                        item.BASE_DISC != null ? Convert.ToString(item.BASE_DISC).Replace("$", "") : DBNull.Value,
                        item.BASE_RATE != null ? Convert.ToString(item.BASE_RATE).Replace("$", "") : DBNull.Value,
                        item.BASE_AMOUNT != null ? Convert.ToString(item.BASE_AMOUNT).Replace("$", "") : DBNull.Value,
                        item.COLOR != null ? Convert.ToString(item.COLOR) : DBNull.Value,
                        item.CLARITY != null ? Convert.ToString(item.CLARITY) : DBNull.Value,
                        item.CUT != null ? Convert.ToString(item.CUT) : DBNull.Value,
                        item.POLISH != null ? Convert.ToString(item.POLISH) : DBNull.Value,
                        item.SYMM != null ? Convert.ToString(item.SYMM) : DBNull.Value,
                        item.FLS_COLOR != null ? Convert.ToString(item.FLS_COLOR) : DBNull.Value,
                        item.FLS_INTENSITY != null ? Convert.ToString(item.FLS_INTENSITY) : DBNull.Value,
                        item.LENGTH != null && !string.IsNullOrEmpty(item.LENGTH.ToString()) ? Convert.ToString(item.LENGTH) : item.MEASUREMENT != null ? Split_Supplier_Stock_Measurement(Convert.ToString(item.MEASUREMENT), "length") : DBNull.Value,
                        item.WIDTH != null && !string.IsNullOrEmpty(item.WIDTH.ToString()) ? Convert.ToString(item.WIDTH) : item.MEASUREMENT != null ? Split_Supplier_Stock_Measurement(Convert.ToString(item.MEASUREMENT), "width") : DBNull.Value,
                        item.DEPTH != null && !string.IsNullOrEmpty(item.DEPTH.ToString()) ? Convert.ToString(item.DEPTH) : item.MEASUREMENT != null ? Split_Supplier_Stock_Measurement(Convert.ToString(item.MEASUREMENT), "depth") : DBNull.Value,
                        item.MEASUREMENT != null ? Convert.ToString(item.MEASUREMENT) : DBNull.Value,
                        item.DEPTH_PER != null ? Convert.ToString(item.DEPTH_PER).Replace("%", "") : DBNull.Value,
                        item.TABLE_PER != null ? Convert.ToString(item.TABLE_PER).Replace("%", "") : DBNull.Value,
                        item.CULET != null ? Convert.ToString(item.CULET) : DBNull.Value,
                        item.SHADE != null ? Convert.ToString(item.SHADE) : DBNull.Value,
                        item.LUSTER != null ? Convert.ToString(item.LUSTER) : DBNull.Value,
                        item.MILKY != null ? Convert.ToString(item.MILKY) : DBNull.Value,
                        item.BGM != null ? Convert.ToString(item.BGM) : DBNull.Value,
                        item.LOCATION != null ? Convert.ToString(item.LOCATION) : DBNull.Value,
                        item.STATUS != null ? Convert.ToString(item.STATUS) : DBNull.Value,
                        table_Black,
                        side_Black,
                        table_white,
                        side_White,
                        item.TABLE_OPEN != null ? Convert.ToString(item.TABLE_OPEN) : DBNull.Value,
                        item.CROWN_OPEN != null ? Convert.ToString(item.CROWN_OPEN) : DBNull.Value,
                        item.PAVILION_OPEN != null ? Convert.ToString(item.PAVILION_OPEN) : DBNull.Value,
                        item.GIRDLE_OPEN != null ? Convert.ToString(item.GIRDLE_OPEN) : DBNull.Value,
                        item.GIRDLE_FROM != null ? !string.IsNullOrEmpty(Convert.ToString(item.GIRDLE_FROM)) ? (Convert.ToString(item.GIRDLE_FROM).Contains("-") ? (Convert.ToString(item.GIRDLE_FROM).Split(" - ").Length == 1 ? Convert.ToString(item.GIRDLE_FROM).Split(" - ")[0] : item.GIRDLE_FROM) : (Convert.ToString(item.GIRDLE_FROM).ToUpper().Contains(" TO ") ? (Convert.ToString(item.GIRDLE_FROM).Split(" TO ").Length == 1 ? Convert.ToString(item.GIRDLE_FROM).Split(" TO ")[0] : item.GIRDLE_FROM) : Convert.ToString(item.GIRDLE_FROM))) : null : DBNull.Value,
                        item.GIRDLE_TO != null ? !string.IsNullOrEmpty(Convert.ToString(item.GIRDLE_TO)) ? (Convert.ToString(item.GIRDLE_TO).Contains("-") ? (Convert.ToString(item.GIRDLE_TO).Split(" - ").Length == 2 ? Convert.ToString(item.GIRDLE_TO).Split(" - ")[1] : item.GIRDLE_TO) : (Convert.ToString(item.GIRDLE_TO).ToUpper().Contains(" TO ") ? (Convert.ToString(item.GIRDLE_TO).Split(" TO ").Length == 2 ? Convert.ToString(item.GIRDLE_TO).Split(" TO ")[1] : item.GIRDLE_TO) : Convert.ToString(item.GIRDLE_TO))) : null : DBNull.Value,
                        item.GIRDLE_CONDITION != null ? Convert.ToString(item.GIRDLE_CONDITION) : DBNull.Value,
                        item.GIRDLE_TYPE != null ? Convert.ToString(item.GIRDLE_TYPE) : DBNull.Value,
                        item.LASER_INSCRIPTION != null ? Convert.ToString(item.LASER_INSCRIPTION) : DBNull.Value,
                        item.CERTIFICATE_DATE != null ? Convert.ToString(item.CERTIFICATE_DATE) : DBNull.Value,
                        item.CROWN_ANGLE != null ? Convert.ToString(item.CROWN_ANGLE).Replace("%", "") : DBNull.Value,
                        item.CROWN_HEIGHT != null ? Convert.ToString(item.CROWN_HEIGHT).Replace("%", "") : DBNull.Value,
                        item.PAVILION_ANGLE != null ? Convert.ToString(item.PAVILION_ANGLE).Replace("%", "") : DBNull.Value,
                        item.PAVILION_HEIGHT != null ? Convert.ToString(item.PAVILION_HEIGHT).Replace("%", "") : DBNull.Value,
                        item.GIRDLE_PER != null ? Convert.ToString(item.GIRDLE_PER).Replace("%", "") : DBNull.Value,
                        item.LR_HALF != null ? Convert.ToString(item.LR_HALF).Replace("%", "") : DBNull.Value,
                        item.STAR_LN != null ? Convert.ToString(item.STAR_LN).Replace("%", "") : DBNull.Value,
                        item.CERT_TYPE != null ? Convert.ToString(item.CERT_TYPE) : DBNull.Value,
                        item.FANCY_COLOR != null ? Convert.ToString(item.FANCY_COLOR) : DBNull.Value,
                        item.FANCY_INTENSITY != null ? Convert.ToString(item.FANCY_INTENSITY) : DBNull.Value,
                        item.FANCY_OVERTONE != null ? Convert.ToString(item.FANCY_OVERTONE) : DBNull.Value,
                        item.IMAGE_LINK != null ? Convert.ToString(item.IMAGE_LINK).Length >= 20 ? Convert.ToString(item.IMAGE_LINK).Contains(",") ? Convert.ToString(item.IMAGE_LINK).Split(",")[0] : Convert.ToString(item.IMAGE_LINK) : DBNull.Value : DBNull.Value,
                        item.Image2 != null ? Convert.ToString(item.Image2) : DBNull.Value,
                        item.VIDEO_LINK != null ? Convert.ToString(item.VIDEO_LINK).Length >= 20 ? Convert.ToString(item.VIDEO_LINK) : DBNull.Value : DBNull.Value,
                        item.Video2 != null ? Convert.ToString(item.Video2) : DBNull.Value,
                        item.CERTIFICATE_LINK != null ? Convert.ToString(item.CERTIFICATE_LINK).Length >= 20 ? Convert.ToString(item.CERTIFICATE_LINK) : DBNull.Value : DBNull.Value,
                        item.DNA != null ? Convert.ToString(item.DNA) : DBNull.Value,
                        item.IMAGE_HEART_LINK != null ? Convert.ToString(item.IMAGE_HEART_LINK) : DBNull.Value,
                        item.IMAGE_ARROW_LINK != null ? Convert.ToString(item.IMAGE_ARROW_LINK) : DBNull.Value,
                        item.H_A_LINK != null ? Convert.ToString(item.H_A_LINK) : DBNull.Value,
                        item.CERTIFICATE_TYPE_LINK != null ? Convert.ToString(item.CERTIFICATE_TYPE_LINK) : DBNull.Value,
                        item.KEY_TO_SYMBOL != null ? Convert.ToString(item.KEY_TO_SYMBOL) : DBNull.Value,
                        item.LAB_COMMENTS != null ? Convert.ToString(item.LAB_COMMENTS) : DBNull.Value,
                        item.SUPPLIER_COMMENTS != null ? Convert.ToString(item.SUPPLIER_COMMENTS) : DBNull.Value,
                        item.ORIGIN != null ? Convert.ToString(item.ORIGIN) : DBNull.Value,
                        item.BOW_TIE != null ? Convert.ToString(item.BOW_TIE) : DBNull.Value,
                        item.EXTRA_FACET_TABLE != null ? Convert.ToString(item.EXTRA_FACET_TABLE) : DBNull.Value,
                        item.EXTRA_FACET_CROWN != null ? Convert.ToString(item.EXTRA_FACET_CROWN) : DBNull.Value,
                        item.EXTRA_FACET_PAVILION != null ? Convert.ToString(item.EXTRA_FACET_PAVILION) : DBNull.Value,
                        item.INTERNAL_GRAINING != null ? Convert.ToString(item.INTERNAL_GRAINING) : DBNull.Value,
                        item.H_A != null ? Convert.ToString(item.H_A) : DBNull.Value,
                        item.SUPPLIER_DISC != null ? Convert.ToString(item.SUPPLIER_DISC) : DBNull.Value,
                        item.SUPPLIER_AMOUNT != null ? Convert.ToString(item.SUPPLIER_AMOUNT) : DBNull.Value,
                        item.OFFER_DISC != null ? Convert.ToString(item.OFFER_DISC) : DBNull.Value,
                        item.OFFER_VALUE != null ? Convert.ToString(item.OFFER_VALUE) : DBNull.Value,
                        item.MAX_SLAB_BASE_DISC != null ? Convert.ToString(item.MAX_SLAB_BASE_DISC) : DBNull.Value,
                        item.MAX_SLAB_BASE_VALUE != null ? Convert.ToString(item.MAX_SLAB_BASE_VALUE) : DBNull.Value,
                        item.EYE_CLEAN != null ? Convert.ToString(item.EYE_CLEAN) : DBNull.Value,
                        item.GOOD_TYPE != null ? Convert.ToString(item.GOOD_TYPE) : DBNull.Value,
                        item.Short_Code != null ? Convert.ToString(item.Short_Code) : DBNull.Value,
                        item.IS_NATURAL != null ? Convert.ToString(item.IS_NATURAL) : DBNull.Value);
                }
            }
            return dt_stock_data;
        }
        private DataTable Set_Supp_Stock_Column_In_Datatable(DataTable dt_stock_data, IList<Stock_Data> stock_Datas)
        {
            dt_stock_data.Columns.Add("Supplier_Ref_No", typeof(string));
            dt_stock_data.Columns.Add("Cert_No", typeof(string));
            dt_stock_data.Columns.Add("Lab", typeof(string));
            dt_stock_data.Columns.Add("Shape", typeof(string));
            dt_stock_data.Columns.Add("Cts", typeof(string));
            dt_stock_data.Columns.Add("Base_Disc", typeof(string));
            dt_stock_data.Columns.Add("Base_Rate", typeof(string));
            dt_stock_data.Columns.Add("Base_Amt", typeof(string));
            dt_stock_data.Columns.Add("Color", typeof(string));
            dt_stock_data.Columns.Add("Clarity", typeof(string));
            dt_stock_data.Columns.Add("Cut", typeof(string));
            dt_stock_data.Columns.Add("Polish", typeof(string));
            dt_stock_data.Columns.Add("Symm", typeof(string));
            dt_stock_data.Columns.Add("Flour", typeof(string));
            dt_stock_data.Columns.Add("Flour_Intensity", typeof(string));
            dt_stock_data.Columns.Add("Length", typeof(string));
            dt_stock_data.Columns.Add("Width", typeof(string));
            dt_stock_data.Columns.Add("Depth", typeof(string));
            dt_stock_data.Columns.Add("Measurement", typeof(string));
            dt_stock_data.Columns.Add("Depth_Per", typeof(string));
            dt_stock_data.Columns.Add("Table_Per", typeof(string));
            dt_stock_data.Columns.Add("Culet", typeof(string));
            dt_stock_data.Columns.Add("Shade", typeof(string));
            dt_stock_data.Columns.Add("Luster", typeof(string));
            dt_stock_data.Columns.Add("Milky", typeof(string));
            dt_stock_data.Columns.Add("BGM", typeof(string));
            dt_stock_data.Columns.Add("Location", typeof(string));
            dt_stock_data.Columns.Add("Status", typeof(string));
            dt_stock_data.Columns.Add("Table_Black", typeof(string));
            dt_stock_data.Columns.Add("Crown_Black", typeof(string));
            dt_stock_data.Columns.Add("Table_White", typeof(string));
            dt_stock_data.Columns.Add("Crown_White", typeof(string));
            dt_stock_data.Columns.Add("Table_Open", typeof(string));
            dt_stock_data.Columns.Add("Crown_Open", typeof(string));
            dt_stock_data.Columns.Add("Pav_Open", typeof(string));
            dt_stock_data.Columns.Add("Girdle_Open", typeof(string));
            dt_stock_data.Columns.Add("Girdle_From", typeof(string));
            dt_stock_data.Columns.Add("Girdle_To", typeof(string));
            dt_stock_data.Columns.Add("Girdle_Condition", typeof(string));
            dt_stock_data.Columns.Add("Girdle_Type", typeof(string));
            dt_stock_data.Columns.Add("Laser_Insc", typeof(string));
            dt_stock_data.Columns.Add("Cert_Date", typeof(string));
            dt_stock_data.Columns.Add("Crown_Angle", typeof(string));
            dt_stock_data.Columns.Add("Crown_Height", typeof(string));
            dt_stock_data.Columns.Add("Pavillion_Angle", typeof(string));
            dt_stock_data.Columns.Add("Pavillion_Height", typeof(string));
            dt_stock_data.Columns.Add("Girdle_Per", typeof(string));
            dt_stock_data.Columns.Add("LR_Half", typeof(string));
            dt_stock_data.Columns.Add("Str_Ln", typeof(string));
            dt_stock_data.Columns.Add("Cert_Type", typeof(string));
            dt_stock_data.Columns.Add("Fancy_Color", typeof(string));
            dt_stock_data.Columns.Add("Fancy_Intensity", typeof(string));
            dt_stock_data.Columns.Add("Fancy_Overtone", typeof(string));
            dt_stock_data.Columns.Add("Image", typeof(string));
            dt_stock_data.Columns.Add("Image2", typeof(string));
            dt_stock_data.Columns.Add("Video", typeof(string));
            dt_stock_data.Columns.Add("Video2", typeof(string));
            dt_stock_data.Columns.Add("Cert_Link", typeof(string));
            dt_stock_data.Columns.Add("DNA", typeof(string));
            dt_stock_data.Columns.Add("Heart_Link", typeof(string));
            dt_stock_data.Columns.Add("Arrow_Link", typeof(string));
            dt_stock_data.Columns.Add("H_A_Link", typeof(string));
            dt_stock_data.Columns.Add("Cert_Type_Link", typeof(string));
            dt_stock_data.Columns.Add("Key_to_Symbol", typeof(string));
            dt_stock_data.Columns.Add("Additional_Comment", typeof(string));
            dt_stock_data.Columns.Add("Supplier_Comment", typeof(string));
            dt_stock_data.Columns.Add("Rough_Origin", typeof(string));
            dt_stock_data.Columns.Add("Bow_Tie", typeof(string));
            dt_stock_data.Columns.Add("Extra_Facet_Table", typeof(string));
            dt_stock_data.Columns.Add("Extra_Facet_Crown", typeof(string));
            dt_stock_data.Columns.Add("Extra_Facet_Pav", typeof(string));
            dt_stock_data.Columns.Add("Internal_Graining", typeof(string));
            dt_stock_data.Columns.Add("H_A", typeof(string));
            dt_stock_data.Columns.Add("Cost_Disc", typeof(string));
            dt_stock_data.Columns.Add("Cost_Amt", typeof(string));
            dt_stock_data.Columns.Add("Offer_Disc", typeof(string));
            dt_stock_data.Columns.Add("Offer_Amt", typeof(string));
            dt_stock_data.Columns.Add("Max_Slab_Disc", typeof(string));
            dt_stock_data.Columns.Add("Max_Slab_Amt", typeof(string));
            dt_stock_data.Columns.Add("Eye_Clean", typeof(string));
            dt_stock_data.Columns.Add("Supp_Short_Name", typeof(string));
            dt_stock_data.Columns.Add("Is_Natural", typeof(string));

            foreach (var item in stock_Datas)
            {
                dt_stock_data.Rows.Add(item.SUPPLIER_NO, item.CERTIFICATE_NO, item.LAB, item.SHAPE, item.CTS, item.BASE_DISC, item.BASE_RATE, item.BASE_AMOUNT, item.COLOR,
                    item.CLARITY, item.CUT, item.POLISH, item.SYMM, item.FLS_COLOR, item.FLS_INTENSITY, item.LENGTH, item.WIDTH, item.DEPTH, item.MEASUREMENT, item.DEPTH_PER,
                    item.TABLE_PER, item.CULET, item.SHADE, item.LUSTER, item.MILKY, item.BGM, item.LOCATION, item.STATUS, item.TABLE_BLACK, item.SIDE_BLACK, item.TABLE_BLACK,
                    item.SIDE_WHITE, item.TABLE_OPEN, item.CROWN_OPEN, item.PAVILION_OPEN, item.GIRDLE_OPEN, item.GIRDLE_FROM, item.GIRDLE_TO, item.GIRDLE_CONDITION, item.GIRDLE_TYPE,
                    item.LASER_INSCRIPTION, item.CERTIFICATE_DATE, item.CROWN_ANGLE, item.CROWN_HEIGHT, item.PAVILION_ANGLE, item.PAVILION_HEIGHT, item.GIRDLE_PER, item.LR_HALF,
                    item.STAR_LN, item.CERT_TYPE, item.FANCY_COLOR, item.FANCY_INTENSITY, item.FANCY_OVERTONE, item.Image2, item.Image2, item.Video2, item.Video2, item.CERTIFICATE_LINK,
                    item.DNA, item.IMAGE_HEART_LINK, item.IMAGE_ARROW_LINK, item.H_A_LINK, item.CERTIFICATE_TYPE_LINK, item.KEY_TO_SYMBOL, item.LAB_COMMENTS, item.SUPPLIER_COMMENTS,
                    item.ORIGIN, item.BOW_TIE, item.EXTRA_FACET_TABLE, item.EXTRA_FACET_CROWN, item.EXTRA_FACET_PAVILION, item.INTERNAL_GRAINING, item.H_A, item.SUPPLIER_DISC, item.SUPPLIER_AMOUNT,
                    item.OFFER_DISC, item.OFFER_VALUE, item.MAX_SLAB_BASE_DISC, item.MAX_SLAB_BASE_VALUE, item.EYE_CLEAN, item.Short_Code, item.Is_Natural);
            }
            return dt_stock_data;
        }
        private DataTable Set_Column_And_Rows_In_DataTable<T>(IList<T> items)
        {
            DataTable dt = new DataTable();

            if (items != null && items.Any())
            {
                var properties = typeof(T).GetProperties();

                foreach (var prop in properties)
                {
                    dt.Columns.Add(prop.Name, Nullable.GetUnderlyingType(prop.PropertyType) ?? prop.PropertyType);
                }

                foreach (var item in items)
                {
                    DataRow row = dt.NewRow();
                    foreach (var prop in properties)
                    {
                        row[prop.Name] = prop.GetValue(item) ?? DBNull.Value;
                    }
                    dt.Rows.Add(row);
                }
            }

            return dt;
        }
        public string Split_Supplier_Stock_Measurement(string expression, string dimension)
        {
            try
            {

                expression = expression.Replace("-", "*");
                // Define a regular expression pattern to capture numeric values
                string pattern = @"[-+]?\d*\.\d+|[-+]?\d+";

                // Use Regex.Matches to find all matches
                MatchCollection matches = Regex.Matches(expression, pattern);

                // Extract numeric values and store them in an array
                double[] values = matches.Cast<System.Text.RegularExpressions.Match>().Select(match => Convert.ToDouble(match.Value)).ToArray();

                // Check if any numeric values were found
                if (values.Length > 0)
                {
                    // Sort the values in descending order
                    System.Array.Sort(values, (a, b) => b.CompareTo(a));

                    // Determine the dimension to return
                    switch (dimension.ToLower())
                    {
                        case "length":
                            return values[0].ToString();
                        case "width":
                            return values.Length > 1 ? values[1].ToString() : "0"; // Consider 0 if no width value
                        case "depth":
                            return values.Length > 2 ? values[2].ToString() : "0"; // Consider 0 if no depth value
                        default:
                            throw new ArgumentException("Invalid dimension specified.");
                    }
                }
            }
            catch (Exception)
            {
                // Handle the exception or log it if needed
                throw;
            }

            // Return 0 if no numeric values were found
            return "0";
        }
        private DataTable Set_GIA_Lab_Parameter_Column_In_Datatable(DataTable dataTable, IList<GIA_Lab_Parameter> gIA_Lab_Parameters)
        {
            dataTable.Columns.Add("Report_No", typeof(string));
            dataTable.Columns.Add("Report_Date", typeof(string));
            dataTable.Columns.Add("Length", typeof(float));
            dataTable.Columns.Add("Width", typeof(float));
            dataTable.Columns.Add("Depth", typeof(float));
            dataTable.Columns.Add("Color_Grade", typeof(string));
            dataTable.Columns.Add("Clarity_Grade", typeof(string));
            dataTable.Columns.Add("Cut_Grade", typeof(string));
            dataTable.Columns.Add("Polish_Grade", typeof(string));
            dataTable.Columns.Add("Symmetry_Grade", typeof(string));
            dataTable.Columns.Add("Fluorescence", typeof(string));
            dataTable.Columns.Add("Inscriptions", typeof(string));
            dataTable.Columns.Add("Key_To_Symbols", typeof(string));
            dataTable.Columns.Add("Report_Comments", typeof(string));
            dataTable.Columns.Add("Table_Pct", typeof(float));
            dataTable.Columns.Add("Depth_Pct", typeof(float));
            dataTable.Columns.Add("Crown_Angle", typeof(float));
            dataTable.Columns.Add("Crown_Height", typeof(float));
            dataTable.Columns.Add("Pavilion_Angle", typeof(float));
            dataTable.Columns.Add("Pavilion_Depth", typeof(float));
            dataTable.Columns.Add("Star_Length", typeof(float));
            dataTable.Columns.Add("Lower_Half", typeof(float));
            dataTable.Columns.Add("Shape_Code", typeof(string));
            dataTable.Columns.Add("Shape_Group", typeof(string));
            dataTable.Columns.Add("Carats", typeof(float));
            dataTable.Columns.Add("Clarity", typeof(string));
            dataTable.Columns.Add("Cut", typeof(string));
            dataTable.Columns.Add("Polish", typeof(string));
            dataTable.Columns.Add("Symmetry", typeof(string));
            dataTable.Columns.Add("Fluorescence_Intensity", typeof(string));
            dataTable.Columns.Add("Fluorescence_Color");
            dataTable.Columns.Add("Girdle_Condition", typeof(string));
            dataTable.Columns.Add("Girdle_Condition_Code", typeof(string));
            dataTable.Columns.Add("Girdle_Pct", typeof(float));
            dataTable.Columns.Add("Girdle_Size", typeof(string));
            dataTable.Columns.Add("Girdle_Size_Code", typeof(string));
            dataTable.Columns.Add("Culet_Code", typeof(string));
            dataTable.Columns.Add("Certificate_PDF", typeof(string));
            dataTable.Columns.Add("Plotting_Diagram", typeof(string));
            dataTable.Columns.Add("Proportions_Diagram", typeof(string));
            dataTable.Columns.Add("Digital_Card", typeof(string));

            if (gIA_Lab_Parameters != null && gIA_Lab_Parameters.Count > 0)
            {
                foreach (var item in gIA_Lab_Parameters)
                {
                    dataTable.Rows.Add(item.Report_No, item.Report_Date, item.Length, item.Width, item.Depth, item.Color_Grade, item.Clarity_Grade, item.Cut_Grade, item.Polish_Grade
                                        , item.Symmetry_Grade, item.Fluorescence, item.Inscriptions, item.Key_To_Symbols, item.Report_Comments, item.Table_Pct, item.Depth_Pct, item.Crown_Angle
                                        , item.Crown_Height, item.Pavilion_Angle, item.Pavilion_Depth, item.Star_Length, item.Lower_Half, item.Shape_Code, item.Shape_Group, item.Carats
                                        , item.Clarity, item.Cut, item.Polish, item.Symmetry, item.Fluorescence_Intensity, item.Fluorescence_Color, item.Girdle_Condition, item.Girdle_Condition_Code
                                        , item.Girdle_Pct, item.Girdle_Size, item.Girdle_Size_Code, item.Culet_Code, item.Certificate_PDF, item.Plotting_Diagram, item.Proportions_Diagram
                                        , item.Digital_Card);
                }
            }

            return dataTable;
        }

        #endregion

        #region Methods
        #region Party Master
        [HttpGet]
        [Route("getparty")]
        [Authorize]
        public async Task<IActionResult> GetParty(int party_Id, string party_Type)
        {
            try
            {
                var result = await _partyService.GetParty(party_Id, party_Type);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "GetParty", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_raplicate")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Raplicate(int party_Id, string party_Type, int company_Code)
        {
            try
            {
                var result = await _partyService.GetParty_Raplicate(party_Id, party_Type, company_Code);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "GetParty_Raplicate", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_raplicate_08052024")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Raplicate_08052024(int party_Id, string party_Type, int page_Size, int Page_No)
        {
            try
            {
                var result = await _partyService.GetPartyReplicateFromCache(party_Id, party_Type, page_Size, Page_No);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Raplicate_08052024", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("getpartycustomer")]
        [Authorize]
        public async Task<IActionResult> GetPartyCustomer(int party_Id, string party_Type)
        {
            try
            {
                var result = await _partyService.GetPartyCustomer(party_Id, party_Type);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "GetPartyCustomer", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }

        }

        [HttpDelete]
        [Route("deleteparty")]
        [Authorize]
        public async Task<IActionResult> DeleteParty(int party_Id)
        {
            try
            {
                var (message, result) = await _partyService.DeleteParty(party_Id);
                if (message == "success" && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.PartyMasterDeleted
                    });
                }
                else if (message == "_reference_found" && result == (int)HttpStatusCode.Conflict)
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = "Reference found in the Party Api/ Party File/ Party FTP, you can not delete this record."
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = "parameter mismatched."
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "DeleteParty", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("change_status_party_master")]
        [Authorize]
        public async Task<IActionResult> Change_Status_Party_Master(int party_Id, bool status)
        {
            try
            {
                var result = await _partyService.Party_Master_Change_Status(party_Id, status);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StatusChangedSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Change_Status_Party_Master", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_search_result")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Search_Result(string common_Search)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _partyService.Get_Party_Search_Select(common_Search, user_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Search_Result", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Party Bank
        [HttpPut]
        [Route("changestatuspartybank")]
        [Authorize]
        public async Task<IActionResult> ChangeStatusPartyBank(int account_Id, bool status)
        {
            try
            {
                var result = await _partyService.PartyBankChangeStatus(account_Id, status);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StatusChangedSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "ChangeStatusPartyBank", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Party Shipping
        [HttpPut]
        [Route("changestatuspartyshipping")]
        [Authorize]
        public async Task<IActionResult> ChangeStatusPartyShipping(int shipId, bool status)
        {
            try
            {
                var result = await _partyService.PartyShippingChangeStatus(shipId, status);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StatusChangedSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "ChangeStatusPartyShipping", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion
        #endregion

        #region Party Details
        [HttpGet]
        [Route("get_party_details")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Details(int party_Id)
        {
            try
            {
                var result = await _partyService.Get_Party_Details(party_Id);
                if (result != null)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Details", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_party_detils")]
        [Authorize]
        public async Task<IActionResult> Create_Party_Detils([FromForm] Party_Master party_Master)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var ip_Address = await CoreService.GetIP_Address(_httpContextAccessor);
                    var (message, party_Id) = await _partyService.Add_Update_Party(party_Master);
                    if (message == "success" && party_Id > 0)
                    {
                        // Party Contact Detail
                        if (party_Master.Party_Contact_List != null && party_Master.Party_Contact_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Contact_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Prefix", typeof(string));
                            dataTable.Columns.Add("First_Name", typeof(string));
                            dataTable.Columns.Add("Last_Name", typeof(string));
                            dataTable.Columns.Add("Designation_Id", typeof(int));
                            dataTable.Columns.Add("Phone_No", typeof(string));
                            dataTable.Columns.Add("Phone_No_Country_Code", typeof(string));
                            dataTable.Columns.Add("Mobile_No", typeof(string));
                            dataTable.Columns.Add("Mobile_No_Country_Code", typeof(string));
                            dataTable.Columns.Add("Email", typeof(string));
                            dataTable.Columns.Add("QueryFlag", typeof(string));

                            DataTable dataTable1 = new DataTable();
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    dataTable1.Columns.Add("Employee_Id", typeof(int));
                            //    dataTable1.Columns.Add("IP_Address", typeof(string));
                            //    dataTable1.Columns.Add("Trace_Date", typeof(DateTime));
                            //    dataTable1.Columns.Add("Trace_Time", typeof(TimeSpan));
                            //    dataTable1.Columns.Add("Record_Type", typeof(string));
                            //    dataTable1.Columns.Add("Party_Id", typeof(int));
                            //    dataTable1.Columns.Add("Contact_Name", typeof(string));
                            //    dataTable1.Columns.Add("Sex", typeof(string));
                            //    dataTable1.Columns.Add("Designation_Id", typeof(int));
                            //    dataTable1.Columns.Add("Mobile_No", typeof(string));
                            //    dataTable1.Columns.Add("Email", typeof(string));
                            //    dataTable1.Columns.Add("Birth_Date", typeof(string));
                            //}

                            foreach (var item in party_Master.Party_Contact_List)
                            {
                                dataTable.Rows.Add(item.Contact_Id, party_Id, item.Prefix, item.First_Name, item.Last_Name, item.Designation_Id, item.Phone_No, item.Phone_No_Country_Code, item.Mobile_No, item.Mobile_No_Country_Code, item.Email, item.QueryFlag);
                                //if (CoreService.Enable_Trace_Records(_configuration))
                                //{
                                //    dataTable1.Rows.Add(16, ip_Address, DateTime.Now, DateTime.Now.TimeOfDay, item.QueryFlag, party_Id, item.Contact_Name, item.Sex, item.Designation_Id, item.Mobile_No, item.Email, item.Birth_Date, false);
                                //}
                            }
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    await _partyService.Insert_Party_Contact_Trace(dataTable1);
                            //}
                            await _partyService.AddUpdatePartyContact(dataTable);
                        }
                        // Party Assist
                        if (party_Master.Party_Assist_List != null && party_Master.Party_Assist_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Assist_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Diamond_Type", typeof(int));
                            dataTable.Columns.Add("Assist_1", typeof(int));
                            dataTable.Columns.Add("Per_1", typeof(float));
                            dataTable.Columns.Add("Assist_2", typeof(int));
                            dataTable.Columns.Add("Per_2", typeof(float));
                            dataTable.Columns.Add("Viewing_Rights_To", typeof(string));
                            dataTable.Columns.Add("QueryFlag", typeof(string));
                            dataTable.Columns.Add("Date", typeof(string));

                            DataTable dataTable1 = new DataTable();
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    dataTable1.Columns.Add("Employee_Id", typeof(int));
                            //    dataTable1.Columns.Add("IP_Address", typeof(string));
                            //    dataTable1.Columns.Add("Trace_Date", typeof(DateTime));
                            //    dataTable1.Columns.Add("Trace_Time", typeof(TimeSpan));
                            //    dataTable1.Columns.Add("Record_Type", typeof(string));
                            //    dataTable1.Columns.Add("Party_Id", typeof(int));
                            //    dataTable1.Columns.Add("Diamond_Type", typeof(int));
                            //    dataTable1.Columns.Add("Assist_1", typeof(int));
                            //    dataTable1.Columns.Add("Per_1", typeof(decimal));
                            //    dataTable1.Columns.Add("Assist_2", typeof(int));
                            //    dataTable1.Columns.Add("Per_2", typeof(decimal));
                            //    dataTable1.Columns.Add("Assist_3", typeof(int));
                            //}
                            foreach (var item in party_Master.Party_Assist_List)
                            {
                                var tot_per = (item.Per_1 + item.Per_2);
                                if (tot_per > 100)
                                {
                                    return Conflict(new
                                    {
                                        statusCode = HttpStatusCode.Conflict,
                                        message = "Less then or equal to 100% allow."
                                    });
                                }
                                else
                                {
                                    dataTable.Rows.Add(item.Assist_Id, party_Id, item.Diamond_Type, item.Assist_1, item.Per_1, item.Assist_2, item.Per_2, item.Viewing_Rights_To, item.QueryFlag, item.Date);
                                }
                                //if (CoreService.Enable_Trace_Records(_configuration))
                                //{
                                //    dataTable1.Rows.Add(16, ip_Address, DateTime.Now, DateTime.Now.TimeOfDay, item.QueryFlag, party_Id, item.Diamond_Type, item.Assist_1, item.Per_1, item.Assist_2, item.Per_2, item.Viewing_Rights_To);
                                //}
                            }
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    await _partyService.Insert_Party_Assist_Trace(dataTable1);
                            //}
                            await _partyService.AddUpdatePartyAssist(dataTable);
                        }
                        // Party Bank Detail
                        if (party_Master.Party_Bank_List != null && party_Master.Party_Bank_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Account_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Bank_Id", typeof(int));
                            dataTable.Columns.Add("Account_No", typeof(string));
                            dataTable.Columns.Add("Status", typeof(bool));
                            dataTable.Columns.Add("Account_Type", typeof(int));
                            dataTable.Columns.Add("Default_Bank", typeof(bool));
                            dataTable.Columns.Add("QueryFlag", typeof(string));

                            DataTable dataTable1 = new DataTable();
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    dataTable1.Columns.Add("Employee_Id", typeof(int));
                            //    dataTable1.Columns.Add("IP_Address", typeof(string));
                            //    dataTable1.Columns.Add("Trace_Date", typeof(DateTime));
                            //    dataTable1.Columns.Add("Trace_Time", typeof(TimeSpan));
                            //    dataTable1.Columns.Add("Record_Type", typeof(string));
                            //    dataTable1.Columns.Add("Party_Id", typeof(int));
                            //    dataTable1.Columns.Add("Bank_Id", typeof(int));
                            //    dataTable1.Columns.Add("Account_No", typeof(int));
                            //    dataTable1.Columns.Add("Status", typeof(bool));
                            //    dataTable1.Columns.Add("Account_Type", typeof(int));
                            //}

                            foreach (var item in party_Master.Party_Bank_List)
                            {
                                dataTable.Rows.Add(item.Account_Id, party_Id, item.Bank_Id, item.Account_No, item.Status, item.Account_Type, item.Default_Bank, item.QueryFlag);
                                //if (CoreService.Enable_Trace_Records(_configuration))
                                //{
                                //    dataTable1.Rows.Add(16, ip_Address, DateTime.Now, DateTime.Now.TimeOfDay, item.QueryFlag, party_Id, item.Bank_Id, item.Account_No, item.Status, item.Account_Type);
                                //}
                            }
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    await _partyService.Insert_Party_Bank_Trace(dataTable1);
                            //}
                            await _partyService.AddUpdatePartyBank(dataTable);
                        }
                        // Party KYC Document
                        if (party_Master.Party_Document_List != null && party_Master.Party_Document_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Document_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Document_Type", typeof(int));
                            dataTable.Columns.Add("Document_No", typeof(string));
                            dataTable.Columns.Add("Upload_Path", typeof(string));
                            dataTable.Columns.Add("Valid_From", typeof(string));
                            dataTable.Columns.Add("Valid_To", typeof(string));
                            dataTable.Columns.Add("Kyc_Grade", typeof(int));
                            dataTable.Columns.Add("QueryFlag", typeof(string));

                            DataTable dataTable1 = new DataTable();
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    dataTable1.Columns.Add("Employee_Id", typeof(int));
                            //    dataTable1.Columns.Add("IP_Address", typeof(string));
                            //    dataTable1.Columns.Add("Trace_Date", typeof(DateTime));
                            //    dataTable1.Columns.Add("Trace_Time", typeof(TimeSpan));
                            //    dataTable1.Columns.Add("Record_Type", typeof(string));
                            //    dataTable1.Columns.Add("Party_Id", typeof(int));
                            //    dataTable1.Columns.Add("Document_Type", typeof(int));
                            //    dataTable1.Columns.Add("Document_No", typeof(string));
                            //    dataTable1.Columns.Add("Upload_Path", typeof(int));
                            //    dataTable1.Columns.Add("Valid_From", typeof(DateTime));
                            //    dataTable1.Columns.Add("Valid_To", typeof(DateTime));
                            //    dataTable1.Columns.Add("Kyc_Grade", typeof(int));
                            //}

                            foreach (var item in party_Master.Party_Document_List)
                            {
                                if (item.Upload_Path_Name != null && item.Upload_Path_Name.Length > 0)
                                {
                                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/PartyDocuments");
                                    if (!(Directory.Exists(filePath)))
                                    {
                                        Directory.CreateDirectory(filePath);
                                    }
                                    string fileName = Path.GetFileNameWithoutExtension(item.Upload_Path_Name.FileName);
                                    string fileExt = Path.GetExtension(item.Upload_Path_Name.FileName);

                                    string strFile = fileName + "_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + fileExt;
                                    using (var fileStream = new FileStream(Path.Combine(filePath, strFile), FileMode.Create))
                                    {
                                        await item.Upload_Path_Name.CopyToAsync(fileStream);
                                    }
                                    item.Upload_Path = strFile;
                                }
                                dataTable.Rows.Add(item.Document_Id, party_Id, item.Document_Type, item.Document_No, item.Upload_Path, item.Valid_From, item.Valid_To, item.Kyc_Grade, item.QueryFlag);

                                //if (CoreService.Enable_Trace_Records(_configuration))
                                //{
                                //    dataTable1.Rows.Add(16, ip_Address, DateTime.Now, DateTime.Now.TimeOfDay, item.QueryFlag, party_Id, item.Document_Type, item.Document_No, item.Upload_Path, item.Valid_From, item.Valid_To, item.Kyc_Grade);
                                //}
                            }
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    await _partyService.Insert_Party_Document_Trace(dataTable1);
                            //}
                            await _partyService.AddUpdatePartyDocument(dataTable);
                        }
                        //Party Media
                        if (party_Master.Party_Media_List != null && party_Master.Party_Media_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Party_Media_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Cat_val_Id", typeof(int));
                            dataTable.Columns.Add("ID", typeof(string));
                            dataTable.Columns.Add("QueryFlag", typeof(string));

                            #region Party Media Log
                            DataTable dataTable1 = new DataTable();
                            dataTable1.Columns.Add("Employee_Id", typeof(int));
                            dataTable1.Columns.Add("IP_Address", typeof(string));
                            dataTable1.Columns.Add("Trace_Date", typeof(DateTime));
                            dataTable1.Columns.Add("Trace_Time", typeof(TimeSpan));
                            dataTable1.Columns.Add("Record_Type", typeof(string));
                            dataTable1.Columns.Add("Party_Id", typeof(int));
                            dataTable1.Columns.Add("Cat_val_Id", typeof(int));
                            dataTable1.Columns.Add("ID", typeof(string));
                            #endregion

                            foreach (var item in party_Master.Party_Media_List)
                            {
                                dataTable.Rows.Add(item.Party_Media_Id, party_Id, item.Cat_val_Id, item.ID, item.QueryFlag);
                                //if (CoreService.Enable_Trace_Records(_configuration))
                                //{
                                //    dataTable1.Rows.Add(16, ip_Address, DateTime.Now, DateTime.Now.TimeOfDay, item.QueryFlag, party_Id, item.Cat_val_Id, item.ID);
                                //}
                            }
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    await _partyService.Insert_Party_Media_Trace(dataTable1);
                            //}
                            await _partyService.AddUpdatePartyMedia(dataTable);
                        }
                        // Party Shipping Detail
                        if (party_Master.Party_Shipping_List != null && party_Master.Party_Shipping_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Ship_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Company_Name", typeof(string));
                            dataTable.Columns.Add("Address_1", typeof(string));
                            dataTable.Columns.Add("Address_2", typeof(string));
                            dataTable.Columns.Add("Address_3", typeof(string));
                            dataTable.Columns.Add("City_Id", typeof(int));
                            dataTable.Columns.Add("Mobile_No", typeof(string));
                            dataTable.Columns.Add("Mobile_No_Country_Code", typeof(string));
                            dataTable.Columns.Add("Phone_No", typeof(string));
                            dataTable.Columns.Add("Phone_No_Country_Code", typeof(string));
                            dataTable.Columns.Add("Contact_Person", typeof(string));
                            dataTable.Columns.Add("TIN_No", typeof(string));
                            dataTable.Columns.Add("Default_Address", typeof(bool));
                            dataTable.Columns.Add("Status", typeof(bool));
                            dataTable.Columns.Add("Is_Editable", typeof(bool));
                            dataTable.Columns.Add("QueryFlag", typeof(string));

                            DataTable dataTable1 = new DataTable();
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    dataTable1.Columns.Add("Employee_Id", typeof(int));
                            //    dataTable1.Columns.Add("IP_Address", typeof(string));
                            //    dataTable1.Columns.Add("Trace_Date", typeof(DateTime));
                            //    dataTable1.Columns.Add("Trace_Time", typeof(TimeSpan));
                            //    dataTable1.Columns.Add("Record_Type", typeof(string));
                            //    dataTable1.Columns.Add("Party_Id", typeof(int));
                            //    dataTable1.Columns.Add("Company_Name", typeof(string));
                            //    dataTable1.Columns.Add("Address_1", typeof(string));
                            //    dataTable1.Columns.Add("Address_2", typeof(string));
                            //    dataTable1.Columns.Add("Address_3", typeof(string));
                            //    dataTable1.Columns.Add("City_Id", typeof(int));
                            //    dataTable1.Columns.Add("Mobile_No", typeof(string));
                            //    dataTable1.Columns.Add("Phone_No", typeof(string));
                            //    dataTable1.Columns.Add("Contact_Person", typeof(string));
                            //    dataTable1.Columns.Add("Contact_Email", typeof(string));
                            //    dataTable1.Columns.Add("Default_Address", typeof(bool));
                            //    dataTable1.Columns.Add("Status", typeof(bool));
                            //}

                            foreach (var item in party_Master.Party_Shipping_List)
                            {
                                dataTable.Rows.Add(item.Ship_Id, party_Id, item.Company_Name, item.Address_1, item.Address_2, item.Address_3, item.City_Id, item.Mobile_No, item.Mobile_No_Country_Code, item.Phone_No, item.Phone_No_Country_Code, item.Contact_Person, item.TIN_No, item.Default_Address, item.Status, item.Is_Editable, item.QueryFlag);
                                //if (CoreService.Enable_Trace_Records(_configuration))
                                //{
                                //    dataTable1.Rows.Add(16, ip_Address, DateTime.Now, DateTime.Now.TimeOfDay, item.QueryFlag, party_Id, item.Company_Name, item.Address_1, item.Address_2, item.Address_3, item.City_Id, item.Mobile_No, item.Phone_No, item.Contact_Person, item.TIN_No, item.Default_Address, item.Status);
                                //}
                            }
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    await _partyService.Insert_Party_Shipping_Trace(dataTable1);
                            //}
                            await _partyService.AddUpdatePartyShipping(dataTable);
                        }
                        //Party Print Process
                        if (party_Master.Party_Print_Process_List != null && party_Master.Party_Print_Process_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Print_Process_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Start_Date", typeof(string));
                            dataTable.Columns.Add("Process_Type", typeof(string));
                            dataTable.Columns.Add("Default_Printing_Type", typeof(int));
                            dataTable.Columns.Add("Default_Currency", typeof(int));
                            dataTable.Columns.Add("Default_Bank", typeof(int));
                            dataTable.Columns.Add("Default_Payment_Terms", typeof(int));
                            dataTable.Columns.Add("Default_Remarks", typeof(int));
                            dataTable.Columns.Add("QueryFlag", typeof(string));

                            #region Party Print Process
                            //DataTable dataTable1 = new DataTable();
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    dataTable1.Columns.Add("Employee_Id", typeof(int));
                            //    dataTable1.Columns.Add("IP_Address", typeof(string));
                            //    dataTable1.Columns.Add("Trace_Date", typeof(DateTime));
                            //    dataTable1.Columns.Add("Trace_Time", typeof(TimeSpan));
                            //    dataTable1.Columns.Add("Record_Type", typeof(string));
                            //    dataTable1.Columns.Add("Party_Id", typeof(int));
                            //    dataTable1.Columns.Add("Start_Date", typeof(string));
                            //    dataTable1.Columns.Add("Process_Type", typeof(string));
                            //    dataTable1.Columns.Add("Default_Printing_Type", typeof(int));
                            //    dataTable1.Columns.Add("Default_Currency", typeof(int));
                            //    dataTable1.Columns.Add("Default_Bank", typeof(int));
                            //    dataTable1.Columns.Add("Default_Payment_Terms", typeof(int));
                            //    dataTable1.Columns.Add("Default_Remarks", typeof(int));
                            //}
                            #endregion

                            foreach (var item in party_Master.Party_Print_Process_List)
                            {
                                dataTable.Rows.Add(item.Print_Process_Id, party_Id, item.Start_Date, item.Process_Type, item.Default_Printing_Type, item.Default_Currency, item.Default_Bank, item.Default_Payment_Terms, item.Default_Remarks, item.QueryFlag);
                                //if (CoreService.Enable_Trace_Records(_configuration))
                                //{
                                //    dataTable1.Rows.Add(16, ip_Address, DateTime.Now, DateTime.Now.TimeOfDay, item.QueryFlag, party_Id, item.Start_Date, item.Process_Type, item.Default_Printing_Type, item.Default_Currency, item.Default_Bank, item.Default_Payment_Terms, item.Default_Remarks);
                                //}
                            }
                            await _partyService.Add_Update_Party_Print_Process(dataTable);
                            //if (CoreService.Enable_Trace_Records(_configuration))
                            //{
                            //    await _partyService.Insert_Party_Print_Trace(dataTable1);
                            //}
                        }
                        //Party Qc Criteria
                        if (party_Master.Party_QcCriteria_List != null && party_Master.Party_QcCriteria_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("QcCriteria_Id", typeof(int));
                            dataTable.Columns.Add("Party_Id", typeof(int));
                            dataTable.Columns.Add("Purchase", typeof(string));
                            dataTable.Columns.Add("FromCts", typeof(decimal));
                            dataTable.Columns.Add("ToCts", typeof(decimal));
                            dataTable.Columns.Add("Presold", typeof(string));
                            dataTable.Columns.Add("Status", typeof(bool));
                            dataTable.Columns.Add("Contract", typeof(string));
                            dataTable.Columns.Add("QueryFlag", typeof(string));

                            foreach (var item in party_Master.Party_QcCriteria_List)
                            {
                                dataTable.Rows.Add(item.QcCriteria_Id, party_Id, item.Purchase, item.FromCts, item.ToCts, item.Presold, item.Status, item.Contract, item.QueryFlag);
                            }
                            await _partyService.Add_Update_Party_QcCriteria(dataTable);
                        }

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = party_Master.Party_Id > 0 ? CoreCommonMessage.PartyMasterUpdated : CoreCommonMessage.PartyMasterCreated
                        });
                    }
                    else if (message == "_party_exists" && party_Id == 0)
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.PartyAlreadyExist
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Party_Detils", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_code")]
        public async Task<IActionResult> Get_Party_Code()
        {
            try
            {
                var result = await _partyService.Get_Party_Code();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Code", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_user_name")]
        public async Task<IActionResult> Get_User_Name(int party_Id)
        {
            try
            {
                var result = await _partyService.Get_User_Name_From_Party_Contact(party_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_User_Name", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Supplier Details
        [HttpPost]
        [Route("create_update_supplier_detail")]
        [Authorize]
        public virtual async Task<IActionResult> Create_Update_Supplier_Detail([FromForm] Supplier_Details supplier_Details, IFormFile File_Location)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    bool success = false;
                    if (supplier_Details.Party_Api != null)
                    {
                        supplier_Details.Party_Api.Party_Id = supplier_Details.Party_Id;
                        var party_Api = await _partyService.Add_Update_Party_API(supplier_Details.Party_Api, supplier_Details.User_Id ?? 0);
                        if (party_Api > 0)
                        {
                            success = true;
                        }
                    }
                    if (supplier_Details.Party_FTP != null)
                    {
                        supplier_Details.Party_FTP.Party_Id = supplier_Details.Party_Id;
                        var party_ftp = await _partyService.Add_Update_Party_FTP(supplier_Details.Party_FTP, supplier_Details.User_Id ?? 0);
                        if (party_ftp > 0)
                        {
                            success = true;
                        }
                    }
                    if (supplier_Details.Party_File != null)
                    {
                        if (File_Location != null && File_Location.Length > 0)
                        {
                            var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/SupplierDetailFile");
                            if (!(Directory.Exists(filePath)))
                            {
                                Directory.CreateDirectory(filePath);
                            }
                            string fileName = Path.GetFileNameWithoutExtension(File_Location.FileName);
                            string fileExt = Path.GetExtension(File_Location.FileName);

                            string strFile = fileName + "_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + fileExt;
                            using (var fileStream = new FileStream(Path.Combine(filePath, strFile), FileMode.Create))
                            {
                                await File_Location.CopyToAsync(fileStream);
                            }
                            supplier_Details.Party_File.File_Location = strFile;
                        }
                        supplier_Details.Party_File.Party_Id = supplier_Details.Party_Id;
                        var party_file = await _partyService.Add_Update_Party_File(supplier_Details.Party_File, supplier_Details.User_Id ?? 0);
                        if (party_file > 0)
                        {
                            success = true;
                        }
                    }
                    if (supplier_Details.Supplier_Column_Mapping_List != null && supplier_Details.Supplier_Column_Mapping_List.Count > 0)
                    {
                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Supp_Col_Id", typeof(int));
                        dataTable.Columns.Add("Supp_Id", typeof(int));
                        dataTable.Columns.Add("Col_Id", typeof(int));
                        dataTable.Columns.Add("Supp_Col_Name", typeof(string));
                        dataTable.Columns.Add("Column_Type", typeof(string));
                        dataTable.Columns.Add("Column_Synonym", typeof(string));
                        dataTable.Columns.Add("Is_Split", typeof(bool));
                        dataTable.Columns.Add("Separator", typeof(string));
                        dataTable.Columns.Add("Is_Sequence", typeof(bool));
                        dataTable.Columns.Add("Sequence", typeof(int));

                        foreach (var item in supplier_Details.Supplier_Column_Mapping_List)
                        {
                            dataTable.Rows.Add(item.Supp_Col_Id, supplier_Details.Party_Id, item.Col_Id, item.Supp_Col_Name, item.Column_Type, item.Column_Synonym, item.Is_Split, item.Separator, item.Is_Sequence, item.Sequence);
                        }
                        var result = await _supplierService.Add_Update_Supplier_Column_Mapping(dataTable);
                        if (result > 0)
                        {
                            success = true;
                        }
                    }
                    if (supplier_Details.Supplier_Value_Mapping_List != null && supplier_Details.Supplier_Value_Mapping_List.Count > 0)
                    {
                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Sup_Id", typeof(int));
                        dataTable.Columns.Add("Supp_Cat_Name", typeof(string));
                        dataTable.Columns.Add("Cat_val_Id", typeof(int));
                        dataTable.Columns.Add("Col_Id", typeof(int));
                        dataTable.Columns.Add("Status", typeof(bool));

                        foreach (var item in supplier_Details.Supplier_Value_Mapping_List)
                        {
                            dataTable.Rows.Add(supplier_Details.Party_Id, item.Supp_Cat_Name, item.Cat_val_Id, item.Col_Id, item.Status);
                        }
                        var result = await _supplierService.Insert_Update_Supplier_Value_Mapping(dataTable);
                        if (result > 0)
                        {
                            //var supplier_Id = supplier_Details.Supplier_Value_Mapping_List.Select(x => x.Sup_Id).FirstOrDefault();
                            //var stock_Data = await _supplierService.Get_Not_Uploaded_Stock_Data(supplier_Id ?? 0);
                            //DataTable dataTable1 = new DataTable();
                            //dataTable1 = Set_Supp_Stock_Column_In_Datatable(new DataTable(), stock_Data);
                            //await _supplierService.Supplier_Stock_Insert_Update(dataTable1, supplier_Id ?? 0);
                            success = true;
                        }
                    }
                    if (success)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.SupplierDetailSavedSuccessfully
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Supplier_Detail", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_detail")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Detail(int party_Id, string map_Flag, string column_Type)
        {
            try
            {
                var supplier_detail = new Supplier_Details();
                supplier_detail.Party_Id = party_Id;
                var Party_Name = await _partyService.GetPartyName(party_Id);
                supplier_detail.Party_Name = Party_Name[0]["Party_Name"]?.ToString();
                supplier_detail.Party_Api = await _partyService.Get_Party_API(0, party_Id);
                supplier_detail.Party_FTP = await _partyService.Get_Party_FTP(0, party_Id);
                supplier_detail.Party_File = await _partyService.Get_Party_File(0, party_Id);
                supplier_detail.Supplier_Column_Mapping_List = await _supplierService.Get_Supplier_Column_Mapping(party_Id, map_Flag, column_Type);
                if (supplier_detail.Party_File != null)
                {
                    supplier_detail.Party_File.File_Location = !string.IsNullOrEmpty(supplier_detail.Party_File.File_Location) ? _configuration["BaseUrl"] + CoreCommonFilePath.SupplierFilePath + supplier_detail.Party_File.File_Location : null;
                }
                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    data = supplier_detail
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Detail", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_detail_list")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Detail_List(int party_Id)
        {
            try
            {
                var result = await _partyService.Get_Supplier_Detail_List(party_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Detail_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_supplier")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Supplier()
        {
            try
            {
                var result = await _partyService.Get_Party_Suplier();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Supplier", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_all_party_supplier")]
        [Authorize]
        public async Task<IActionResult> Get_All_Party_Supplier()
        {
            try
            {
                var result = await _partyService.Get_All_Party_Supplier();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_All_Party_Supplier", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_url_format_supplier")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Url_Format_Supplier()
        {
            try
            {
                var result = await _partyService.Get_Party_Url_Format_Supplier();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Url_Format_Supplier", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_type_courier")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Type_Courier()
        {
            try
            {
                var result = await _partyService.Get_Party_Type_Courier();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Type_Courier", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_type_customer")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Type_Customer()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _partyService.Get_Party_Type_Customer(user_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Type_Customer", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_column_mapping")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Column_Mapping(int party_Id, string map_Flag, string column_Type)
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Column_Mapping(party_Id, map_Flag, column_Type);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Column_Mapping", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_api_with_column_mapping")]
        public async Task<IActionResult> Get_Party_API_With_Column_Mapping()
        {
            try
            {
                var result = await _partyService.Get_Party_API_With_Column_Mapping();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_API_With_Column_Mapping", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_api_ftp_file")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_API_FTP_File(int? id, string? upload_Type, int? party_Id)
        {
            try
            {
                Party_API_With_Column_Mapping supplier_API_FTP_File_Details = new Party_API_With_Column_Mapping();
                if (party_Id > 0)
                {
                    var result_api = await _partyService.Get_Party_API(0, party_Id ?? 0);
                    if (result_api != null && result_api.API_Status == true)
                    {
                        supplier_API_FTP_File_Details.API_Id = result_api.API_Id;
                        supplier_API_FTP_File_Details.Party_Id = result_api.Party_Id;
                        supplier_API_FTP_File_Details.Party_Name = result_api.Party_Name;
                        supplier_API_FTP_File_Details.Upload_Type = "API";
                        supplier_API_FTP_File_Details.API_URL = result_api.API_URL;
                        supplier_API_FTP_File_Details.API_User = result_api.API_User;
                        supplier_API_FTP_File_Details.API_Password = result_api.API_Password;
                        supplier_API_FTP_File_Details.API_Method = result_api.API_Method;
                        supplier_API_FTP_File_Details.API_Response = result_api.API_Response;
                        supplier_API_FTP_File_Details.API_Status = result_api.API_Status;
                        supplier_API_FTP_File_Details.Disc_Inverse = result_api.Disc_Inverse;
                        supplier_API_FTP_File_Details.Auto_Ref_No = result_api.Auto_Ref_No;
                        supplier_API_FTP_File_Details.RepeateveryType = result_api.RepeateveryType;
                        supplier_API_FTP_File_Details.Repeatevery = result_api.Repeatevery;
                        supplier_API_FTP_File_Details.Lab = result_api.Lab;
                        supplier_API_FTP_File_Details.Overseas = result_api.Overseas;
                        supplier_API_FTP_File_Details.Stock_Url = result_api.Stock_Url;
                        supplier_API_FTP_File_Details.User_Id = result_api.User_Id;
                        supplier_API_FTP_File_Details.User_Caption = result_api.User_Caption;
                        supplier_API_FTP_File_Details.Password_Caption = result_api.Password_Caption;
                        supplier_API_FTP_File_Details.Action_Caption = result_api.Action_Caption;
                        supplier_API_FTP_File_Details.Action_Value = result_api.Action_Value;
                        supplier_API_FTP_File_Details.Action_Caption_1 = result_api.Action_Caption_1;
                        supplier_API_FTP_File_Details.Action_Value_1 = result_api.Action_Value_1;
                        supplier_API_FTP_File_Details.Action_Caption_2 = result_api.Action_Caption_2;
                        supplier_API_FTP_File_Details.Action_Value_2 = result_api.Action_Value_2;
                        supplier_API_FTP_File_Details.Short_Code = result_api.Short_Code;
                        supplier_API_FTP_File_Details.Stock_Api_Method = result_api.Stock_Api_Method;
                        supplier_API_FTP_File_Details.Method_Type = result_api.Method_Type;
                        supplier_API_FTP_File_Details.Price_Lock = result_api.Price_Lock;
                        supplier_API_FTP_File_Details.Supplier_Column_Mapping_List = await _partyService.Common_Funtion_To_Get_Supp_Col_Map(supplier_API_FTP_File_Details.Party_Id ?? 0, "API");
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = supplier_API_FTP_File_Details
                        });
                    }

                    var result_ftp = await _partyService.Get_Party_FTP(0, party_Id ?? 0);
                    if (result_ftp != null && result_ftp.Ftp_Status == true)
                    {
                        supplier_API_FTP_File_Details.FTP_Id = result_ftp.FTP_Id;
                        supplier_API_FTP_File_Details.Party_Id = result_ftp.Party_Id;
                        supplier_API_FTP_File_Details.Party_Name = result_ftp.Party_Name;
                        supplier_API_FTP_File_Details.Upload_Type = "FTP";
                        supplier_API_FTP_File_Details.Disc_Inverse = result_ftp.Disc_Inverse;
                        supplier_API_FTP_File_Details.Auto_Ref_No = result_ftp.Auto_Ref_No;
                        supplier_API_FTP_File_Details.RepeateveryType = result_ftp.RepeateveryType;
                        supplier_API_FTP_File_Details.Repeatevery = result_ftp.Repeatevery;
                        supplier_API_FTP_File_Details.Lab = result_ftp.Lab;
                        supplier_API_FTP_File_Details.Overseas = result_ftp.Overseas;
                        supplier_API_FTP_File_Details.Short_Code = result_ftp.Short_Code;
                        supplier_API_FTP_File_Details.Host = result_ftp.Host;
                        supplier_API_FTP_File_Details.Ftp_Port = result_ftp.Ftp_Port;
                        supplier_API_FTP_File_Details.Ftp_User = result_ftp.Ftp_User;
                        supplier_API_FTP_File_Details.Ftp_Password = result_ftp.Ftp_Password;
                        supplier_API_FTP_File_Details.Ftp_File_Name = result_ftp.Ftp_File_Name;
                        supplier_API_FTP_File_Details.Ftp_File_Type = result_ftp.Ftp_File_Type;
                        supplier_API_FTP_File_Details.Secure_Ftp = result_ftp.Secure_Ftp;
                        supplier_API_FTP_File_Details.Price_Lock = result_ftp.Price_Lock;
                        supplier_API_FTP_File_Details.Supplier_Column_Mapping_List = await _partyService.Common_Funtion_To_Get_Supp_Col_Map(supplier_API_FTP_File_Details.Party_Id ?? 0, "FTP");
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = supplier_API_FTP_File_Details
                        });
                    }
                }
                else
                {
                    if (!string.IsNullOrEmpty(upload_Type) && upload_Type == "API")
                    {
                        var result = await _partyService.Get_Party_API(id ?? 0, 0);
                        if (result != null)
                        {
                            supplier_API_FTP_File_Details.API_Id = result.API_Id;
                            supplier_API_FTP_File_Details.Party_Id = result.Party_Id;
                            supplier_API_FTP_File_Details.Party_Name = result.Party_Name;
                            supplier_API_FTP_File_Details.Upload_Type = upload_Type;
                            supplier_API_FTP_File_Details.API_URL = result.API_URL;
                            supplier_API_FTP_File_Details.API_User = result.API_User;
                            supplier_API_FTP_File_Details.API_Password = result.API_Password;
                            supplier_API_FTP_File_Details.API_Method = result.API_Method;
                            supplier_API_FTP_File_Details.API_Response = result.API_Response;
                            supplier_API_FTP_File_Details.API_Status = result.API_Status;
                            supplier_API_FTP_File_Details.Disc_Inverse = result.Disc_Inverse;
                            supplier_API_FTP_File_Details.Auto_Ref_No = result.Auto_Ref_No;
                            supplier_API_FTP_File_Details.RepeateveryType = result.RepeateveryType;
                            supplier_API_FTP_File_Details.Repeatevery = result.Repeatevery;
                            supplier_API_FTP_File_Details.Lab = result.Lab;
                            supplier_API_FTP_File_Details.Overseas = result.Overseas;
                            supplier_API_FTP_File_Details.Stock_Url = result.Stock_Url;
                            supplier_API_FTP_File_Details.User_Id = result.User_Id;
                            supplier_API_FTP_File_Details.User_Caption = result.User_Caption;
                            supplier_API_FTP_File_Details.Password_Caption = result.Password_Caption;
                            supplier_API_FTP_File_Details.Action_Caption = result.Action_Caption;
                            supplier_API_FTP_File_Details.Action_Value = result.Action_Value;
                            supplier_API_FTP_File_Details.Action_Caption_1 = result.Action_Caption_1;
                            supplier_API_FTP_File_Details.Action_Value_1 = result.Action_Value_1;
                            supplier_API_FTP_File_Details.Action_Caption_2 = result.Action_Caption_2;
                            supplier_API_FTP_File_Details.Action_Value_2 = result.Action_Value_2;
                            supplier_API_FTP_File_Details.Short_Code = result.Short_Code;
                            supplier_API_FTP_File_Details.Stock_Api_Method = result.Stock_Api_Method;
                            supplier_API_FTP_File_Details.Method_Type = result.Method_Type;
                            supplier_API_FTP_File_Details.Price_Lock = result.Price_Lock;
                            supplier_API_FTP_File_Details.Supplier_Column_Mapping_List = await _partyService.Common_Funtion_To_Get_Supp_Col_Map(supplier_API_FTP_File_Details.Party_Id ?? 0, "API");
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                data = supplier_API_FTP_File_Details
                            });
                        }
                    }
                    else if (!string.IsNullOrEmpty(upload_Type) && upload_Type == "FTP")
                    {
                        var result = await _partyService.Get_Party_FTP(id ?? 0, 0);
                        if (result != null)
                        {
                            supplier_API_FTP_File_Details.FTP_Id = result.FTP_Id;
                            supplier_API_FTP_File_Details.Party_Id = result.Party_Id;
                            supplier_API_FTP_File_Details.Party_Name = result.Party_Name;
                            supplier_API_FTP_File_Details.Upload_Type = upload_Type;
                            supplier_API_FTP_File_Details.Disc_Inverse = result.Disc_Inverse;
                            supplier_API_FTP_File_Details.Auto_Ref_No = result.Auto_Ref_No;
                            supplier_API_FTP_File_Details.RepeateveryType = result.RepeateveryType;
                            supplier_API_FTP_File_Details.Repeatevery = result.Repeatevery;
                            supplier_API_FTP_File_Details.Lab = result.Lab;
                            supplier_API_FTP_File_Details.Overseas = result.Overseas;
                            supplier_API_FTP_File_Details.Short_Code = result.Short_Code;
                            supplier_API_FTP_File_Details.Host = result.Host;
                            supplier_API_FTP_File_Details.Ftp_Port = result.Ftp_Port;
                            supplier_API_FTP_File_Details.Ftp_User = result.Ftp_User;
                            supplier_API_FTP_File_Details.Ftp_Password = result.Ftp_Password;
                            supplier_API_FTP_File_Details.Ftp_File_Name = result.Ftp_File_Name;
                            supplier_API_FTP_File_Details.Ftp_File_Type = result.Ftp_File_Type;
                            supplier_API_FTP_File_Details.Secure_Ftp = result.Secure_Ftp;
                            supplier_API_FTP_File_Details.Price_Lock = result.Price_Lock;
                            supplier_API_FTP_File_Details.Supplier_Column_Mapping_List = await _partyService.Common_Funtion_To_Get_Supp_Col_Map(supplier_API_FTP_File_Details.Party_Id ?? 0, "FTP");
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                data = supplier_API_FTP_File_Details
                            });
                        }
                    }
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_API_FTP_File", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_type_supplier")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Type_Supplier()
        {
            try
            {
                var result = await _partyService.Get_Party_Type_Suplier();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Type_Supplier", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_price_list")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Price_List()
        {
            try
            {
                var result = await _partyService.Get_Supplier_Price_List();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Price_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_supplier_price_list")]
        [Authorize]
        public async Task<IActionResult> Update_Supplier_Price_List(IList<Supplier_Price_List> supplier_Price_Lists)
        {
            if (supplier_Price_Lists == null || supplier_Price_Lists.Count == 0)
            {
                return NoContent();
            }

            try
            {
                var dataTable = new DataTable();
                dataTable.Columns.Add("Party_Id", typeof(int));
                dataTable.Columns.Add("Disc_0", typeof(bool));
                dataTable.Columns.Add("No_Stock", typeof(bool));

                foreach (var item in supplier_Price_Lists)
                {
                    dataTable.Rows.Add(item.Party_Id, item.Disc_0, item.No_Stock);
                }

                var result = await _partyService.Update_Supplier_Price_List(dataTable);

                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.SupplierPriceUpdate,
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Supplier_Price_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Value Config
        [HttpGet]
        [Route("get_value_config")]
        [Authorize]
        public async Task<IActionResult> Get_Value_Config(int valueMap_ID)
        {
            try
            {
                var result = await _supplierService.Get_Value_Config(valueMap_ID);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Value_Config", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_value_config")]
        [Authorize]
        public async Task<IActionResult> Create_Value_Config(Value_Config value_Config)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var result = await _supplierService.Add_Update_Value_Config(value_Config);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.ValueConfigCreated
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Value_Config", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("update_value_config")]
        [Authorize]
        public async Task<IActionResult> Update_Value_Config(Value_Config value_Config)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var result = await _supplierService.Add_Update_Value_Config(value_Config);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.ValueConfigUpdated
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Value_Config", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_value_config")]
        [Authorize]
        public async Task<IActionResult> Delete_Value_Config(int valueMap_ID)
        {
            try
            {
                var result = await _supplierService.Delete_Value_Config(valueMap_ID);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.ValueConfigDeleted
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Value_Config", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Supplier Pricing
        [HttpGet]
        [Route("get_supplier_pricing_list")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Pricing_List()
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Pricing_List();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Pricing_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_sunrise_pricing_list")]
        [Authorize]
        public async Task<IActionResult> Get_Sunrise_Pricing_List()
        {
            try
            {
                var result = await _supplierService.Get_Sunrise_Pricing_List();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Sunrise_Pricing_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_customer_pricing_list")]
        [Authorize]
        public async Task<IActionResult> Get_Customer_Pricing_List()
        {
            try
            {
                var result = await _supplierService.Get_Customer_Pricing_List();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Customer_Pricing_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_pricing")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Pricing(int supplier_Pricing_Id, int supplier_Id, string supplier_Filter_Type, string map_Flag, int sunrise_pricing_Id, int customer_pricing_Id, string? user_pricing_Id)
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Pricing(supplier_Pricing_Id, supplier_Id, supplier_Filter_Type, map_Flag, sunrise_pricing_Id, customer_pricing_Id, user_pricing_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Pricing", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_supplier_pricing")]
        [Authorize]
        public async Task<IActionResult> Create_Supplier_Pricing(IList<Supplier_Pricing> supplier_Pricings)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    int supplier_Id = 0, sunrise_Pricing_Id = 0, customer_Pricing_Id = 0;
                    int sun_price_Id = 0; int supplier_Pricing_Id = 0;
                    var map_flag = string.Empty;
                    var selected_sun_price_Id = supplier_Pricings.Where(x => x.Sunrise_Pricing_Id > 0).Select(x => x.Sunrise_Pricing_Id).FirstOrDefault() ?? 0;
                    map_flag = supplier_Pricings.Select(x => x.Map_Flag).FirstOrDefault();
                    if (selected_sun_price_Id > 0)
                    {
                        sun_price_Id = selected_sun_price_Id;
                    }
                    else
                    {
                        var data = await _supplierService.Get_Max_Sunrice_Pricing_Id();
                        sun_price_Id = data.Id + 1;
                    }
                    if (supplier_Pricings != null && supplier_Pricings.Count > 0)
                    {
                        bool success = false;
                        if (supplier_Pricings != null && supplier_Pricings.Count > 0)
                        {
                            foreach (var item in supplier_Pricings)
                            {
                                supplier_Id = item.Supplier_Id ?? 0;
                                customer_Pricing_Id = item.Customer_Pricing_Id ?? 0;
                                if (item.Query_Flag == "D")
                                {
                                    var result_Supplier_Pricing_Key_To_Symbol = await _supplierService.Delete_Supplier_Pricing_Key_To_Symbol(item.Supplier_Pricing_Id, null);

                                    var result = await _supplierService.Delete_Supplier_Pricing(item.Supplier_Pricing_Id, 0);
                                    if (result > 0)
                                    {
                                        success = true;
                                    }
                                }
                                else
                                {
                                    if (item.Map_Flag == "SPLP" || item.Map_Flag == "SPLS" || item.Map_Flag == "SPOP" || item.Map_Flag == "SPOS")
                                    {
                                        item.Sunrise_Pricing_Id = sun_price_Id;
                                        sunrise_Pricing_Id = item.Sunrise_Pricing_Id ?? 0;
                                    }
                                    var (message, supplier_pricing_Id) = await _supplierService.Add_Update_Supplier_Pricing(item);
                                    if (message == "success" && supplier_pricing_Id > 0)
                                    {
                                        success = true;
                                        supplier_Pricing_Id = supplier_pricing_Id;
                                        if (item.Key_To_Symbol != null && item.Key_To_Symbol.Count > 0)
                                        {
                                            DataTable dataTable = new DataTable();
                                            dataTable.Columns.Add("Supplier_Pricing_Id", typeof(int));
                                            dataTable.Columns.Add("Cat_Val_Id", typeof(int));
                                            dataTable.Columns.Add("Symbol_Status", typeof(bool));
                                            dataTable.Columns.Add("Filter_Type", typeof(string));
                                            foreach (var obj in item.Key_To_Symbol)
                                            {
                                                dataTable.Rows.Add(supplier_pricing_Id, obj.Cat_Val_Id, obj.Symbol_Status, obj.Filter_Type);
                                            }
                                            await _supplierService.Add_Update_Supplier_Pricing_Key_To_Symbol(dataTable);
                                        }
                                        else
                                        {
                                            await _supplierService.Delete_Supplier_Pricing_Key_To_Symbol(supplier_pricing_Id, "S");
                                        }
                                        if (item.Lab_Comments != null && item.Lab_Comments.Count > 0)
                                        {
                                            DataTable dataTable = new DataTable();
                                            dataTable.Columns.Add("Supplier_Pricing_Id", typeof(int));
                                            dataTable.Columns.Add("Cat_Val_Id", typeof(int));
                                            dataTable.Columns.Add("Symbol_Status", typeof(bool));
                                            dataTable.Columns.Add("Filter_Type", typeof(string));
                                            foreach (var obj in item.Lab_Comments)
                                            {
                                                dataTable.Rows.Add(supplier_pricing_Id, obj.Cat_Val_Id, obj.Symbol_Status, obj.Filter_Type);
                                            }
                                            await _supplierService.Add_Update_Supplier_Pricing_Key_To_Symbol(dataTable);
                                        }
                                        else
                                        {
                                            await _supplierService.Delete_Supplier_Pricing_Key_To_Symbol(supplier_pricing_Id, "C");
                                        }
                                    }
                                }
                            }
                        }
                        if (success)
                        {
                            string resurn_message = string.Empty;
                            if (map_flag == "P")
                            {
                                resurn_message = CoreCommonMessage.SupplierPricingCreated;
                            }
                            else if (map_flag == "S")
                            {
                                resurn_message = CoreCommonMessage.SupplierStockCreated;
                            }
                            else if (map_flag == "SPLP" || map_flag == "SPLS" || map_flag == "SPOP" || map_flag == "SPOS")
                            {
                                resurn_message = CoreCommonMessage.SunrisePricingCreated;
                            }
                            else if (map_flag == "CPL" || map_flag == "CPO" || map_flag == "CSL" || map_flag == "CSO")
                            {
                                resurn_message = CoreCommonMessage.CustomerPricingCreated;
                            }
                            else if (map_flag == "ES")
                            {
                                resurn_message = CoreCommonMessage.EmployeeStockCreated;
                            }
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = resurn_message,
                                supplier_Id = supplier_Id,
                                sunrise_Pricing_Id = sunrise_Pricing_Id,
                                customer_Pricing_Id = customer_Pricing_Id,
                                supplier_pricing_Id = supplier_Pricing_Id
                            });
                        }
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Supplier_Pricing", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_supplier_pricing")]
        [Authorize]
        public async Task<IActionResult> Delete_Supplier_Pricing(int supplier_Id)
        {
            try
            {
                var result = await _supplierService.Delete_Supplier_Pricing_By_Supplier(supplier_Id);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.SupplierPricingDeleted,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Supplier_Pricing", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_sunrise_pricing")]
        [Authorize]
        public async Task<IActionResult> Delete_Sunrise_Pricing(int sunrise_Pricing_Id)
        {
            try
            {
                var result = await _supplierService.Delete_Sunrise_Pricing(sunrise_Pricing_Id);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.SunrisePricingDeleted,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Sunrise_Pricing", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_customer_pricing")]
        [Authorize]
        public async Task<IActionResult> Delete_Customer_Pricing(int user_Pricing_Id)
        {
            try
            {
                var result = await _supplierService.Delete_Customer_Pricing(user_Pricing_Id);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.CustomerPricingDeleted,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Customer_Pricing", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Supplier Value Mapping
        [HttpGet]
        [Route("get_supplier_value_mapping")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Value_Mapping(int sup_Id, int col_Id)
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Value_Mapping(sup_Id, col_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Value_Mapping", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_supplier_value_mapping")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Supplier_Value_Mapping([FromForm] IList<Supplier_Value_Mapping> supplier_Value_Mappings)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    if (supplier_Value_Mappings != null && supplier_Value_Mappings.Count > 0)
                    {
                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Sup_Id", typeof(int));
                        dataTable.Columns.Add("Supp_Cat_Name", typeof(string));
                        dataTable.Columns.Add("Cat_val_Id", typeof(int));
                        dataTable.Columns.Add("Status", typeof(bool));

                        foreach (var item in supplier_Value_Mappings)
                        {
                            dataTable.Rows.Add(item.Sup_Id, item.Supp_Cat_Name, item.Cat_val_Id, item.Status);
                        }
                        var result = await _supplierService.Insert_Update_Supplier_Value_Mapping(dataTable);
                        if (result > 0)
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = "Supplier value mapped successfully."
                            });
                        }
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Supplier_Value_Mapping", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_supplier_value_mapping")]
        [Authorize]
        public async Task<IActionResult> Delete_Supplier_Value_Mapping(int sup_Id)
        {
            try
            {
                var result = await _supplierService.DeleteSupplierValueMapping(sup_Id);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.SupplierValueDeleted
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Supplier_Value_Mapping", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Supplier Stock
        [HttpPost]
        [Route("create_update_supplier_stock")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Supplier_Stock()
        {
            try
            {
                int supplier_Id = 16;
                var stock_data_master = new Stock_Data_Master()
                {
                    Stock_Data_Id = 0,
                    Supplier_Id = supplier_Id,
                    Upload_Method = "API",
                };

                var (message, stock_Data_Id) = await _supplierService.Stock_Data_Insert_Update(stock_data_master);

                if (message == "success" && stock_Data_Id > 0)
                {
                    using (HttpClient client = new HttpClient())
                    {
                        var request = new HttpRequestMessage(HttpMethod.Post, "http://krinalgems.diamx.net/API/StockSearch?APIToken=e161dd39-44ed-4b67-8a48-8406da883892");

                        var response = await client.SendAsync(request);

                        if (response.IsSuccessStatusCode)
                        {
                            response.EnsureSuccessStatusCode();

                            var json = await response.Content.ReadAsStringAsync();

                            dynamic data = JsonConvert.DeserializeObject<dynamic>(json);
                            JArray list = data.StoneList;

                            // Create a DataTable
                            DataTable dt_our_stock_data = new DataTable();

                            List<Supplier_Column_Mapping> Supplier_Column_Mapping_List = (List<Supplier_Column_Mapping>)await _supplierService.Get_Supplier_Column_Mapping(supplier_Id, "C", "API");

                            if (Supplier_Column_Mapping_List != null && Supplier_Column_Mapping_List.Count > 0)
                            {
                                // Use LINQ to filter and map CSV columns based on matching column names
                                Supplier_Column_Mapping_List = Supplier_Column_Mapping_List.Where(x => !string.IsNullOrEmpty(x.Supp_Col_Name)).ToList();
                                Supplier_Column_Mapping_List
                                .Select(mapping => new DataColumn
                                {
                                    ColumnName = mapping.Display_Name,
                                    DataType = typeof(string)

                                }).ToList();

                                var columnsToAdd = new List<string>
                                     {
                                        "SUPPLIER_NO","CERTIFICATE_NO","LAB","SHAPE","CTS","BASE_DISC","BASE_RATE","BASE_AMOUNT","COLOR","CLARITY","CUT","POLISH","SYMM","FLS_COLOR","FLS_INTENSITY","LENGTH","WIDTH","DEPTH","MEASUREMENT","DEPTH_PER","TABLE_PER","CULET","SHADE","LUSTER","MILKY","BGM","LOCATION","STATUS","TABLE_BLACK","SIDE_BLACK","TABLE_WHITE","SIDE_WHITE","TABLE_OPEN","CROWN_OPEN","PAVILION_OPEN","GIRDLE_OPEN","GIRDLE_FROM","GIRDLE_TO","GIRDLE_CONDITION","GIRDLE_TYPE","LASER_INSCRIPTION","CERTIFICATE_DATE","CROWN_ANGLE","CROWN_HEIGHT","PAVILION_ANGLE","PAVILION_HEIGHT","GIRDLE_PER","LR_HALF","STAR_LN","CERT_TYPE","FANCY_COLOR","FANCY_INTENSITY","FANCY_OVERTONE","IMAGE_LINK","Image2","VIDEO_LINK","Video2","CERTIFICATE_LINK","DNA","IMAGE_HEART_LINK","IMAGE_ARROW_LINK","H_A_LINK","CERTIFICATE_TYPE_LINK","KEY_TO_SYMBOL","LAB_COMMENTS","SUPPLIER_COMMENTS","ORIGIN","BOW_TIE","EXTRA_FACET_TABLE","EXTRA_FACET_CROWN","EXTRA_FACET_PAVILION","INTERNAL_GRAINING","H_A","SUPPLIER_DISC","SUPPLIER_AMOUNT","OFFER_DISC","OFFER_VALUE","MAX_SLAB_BASE_DISC","MAX_SLAB_BASE_VALUE","EYE_CLEAN","Supp_Short_Name"
                                     };

                                var newColumns = columnsToAdd
                                    .Select(columnName => new DataColumn
                                    {
                                        ColumnName = columnName,
                                        DataType = typeof(string)
                                    }).ToList();

                                // Add the new columns to the DataTable
                                dt_our_stock_data.Columns.AddRange(newColumns.ToArray());

                                // Project the dynamic objects into a sequence of DataRow objects
                                var rowsToAdd = list.Select(dynamicObject =>
                                {
                                    DataRow row = dt_our_stock_data.NewRow();

                                    Supplier_Column_Mapping_List.ForEach(mapping =>
                                    {
                                        var columnNames = mapping.Supp_Col_Name.Split(',').Select(col => col.Trim()).ToArray();

                                        var propertyValues = columnNames
                                            .Select(columnName =>
                                            {
                                                var property = ((JObject)dynamicObject).Properties().FirstOrDefault(p => p.Name == columnName);
                                                return property != null ? property.Value.ToString() : string.Empty;
                                            }).Where(value => !string.IsNullOrEmpty(value));

                                        var column = dt_our_stock_data.Columns[mapping.Display_Name];

                                        if (column != null)
                                        {
                                            row[column] = string.Join(", ", propertyValues);
                                        }

                                    });

                                    return row;

                                });

                                // Add the rows to the DataTable using DataTable.Merge
                                dt_our_stock_data.Merge(rowsToAdd.CopyToDataTable(), false, MissingSchemaAction.Ignore);

                                var result = await _supplierService.Stock_Data_Detail_Insert_Update(dt_our_stock_data, stock_Data_Id);
                                if (result > 0)
                                {
                                    return Ok(new
                                    {
                                        statusCode = HttpStatusCode.OK,
                                        message = CoreCommonMessage.AddedSuccessfully
                                    });
                                }
                            }
                            else
                            {
                                return Conflict(new
                                {
                                    statusCode = HttpStatusCode.Conflict,
                                    message = "Supplier column not found on supplier column mapping"
                                });
                            }
                        }
                        else
                        {
                            return BadRequest(new
                            {
                                statusCode = HttpStatusCode.InternalServerError,
                                message = "Failed to retrieve data from the API"
                            });
                        }
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = "Failed to insert/update stock data"
                });
            }
            catch (HttpRequestException ex)
            {
                Console.WriteLine($"HTTP request error: {ex.Message}");
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = "HTTP request error"
                });
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error: {ex.Message}");
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = "An error occurred"
                });
            }
        }

        [HttpPost]
        [Route("create_update_supplier_data")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Supplier_Data(Stock_Data_Master stock_Data_Master)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var (message, stock_Data_Id) = await _supplierService.Stock_Data_Insert_Update(stock_Data_Master);
                    if (message == "success" && stock_Data_Id > 0)
                    {
                        if (stock_Data_Master.Stock_Data_List != null && stock_Data_Master.Stock_Data_List.Count > 0)
                        {
                            DataTable dt_our_stock_data = new DataTable();
                            dt_our_stock_data = await Set_Column_In_Datatable(stock_Data_Master.Supplier_Id ?? 0, new DataTable(), stock_Data_Master.Stock_Data_List);
                            var result = await _supplierService.Stock_Data_Detail_Insert_Update(dt_our_stock_data, stock_Data_Id);
                        }
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.StockUploadedSuccessfully
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Supplier_Data", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_supplier_stock_by_scheduler")]
        public async Task<IActionResult> Create_Update_Supplier_Stock_By_Scheduler(Stock_Data_Master_Schedular stock_Data_Master)
        {
            var party_List = await _partyService.GetParty_Raplicate(stock_Data_Master.Supplier_Id ?? 0, null, 0);
            var party = party_List.FirstOrDefault();
            try
            {
                if (ModelState.IsValid)
                {
                    var (message, stock_Data_Id) = await _supplierService.Stock_Data_Custom_Insert_Update(stock_Data_Master);
                    if (message == "success" && stock_Data_Id > 0)
                    {

                        if (stock_Data_Master.Stock_Data_List != null && stock_Data_Master.Stock_Data_List.Count > 0)
                        {
                            DataTable dt_our_stock_data = new DataTable();
                            dt_our_stock_data = await Set_Column_In_Datatable_Scheduler(new DataTable(), stock_Data_Master.Stock_Data_List, stock_Data_Master.Supplier_Id ?? 0);
                            var result = await _supplierService.Stock_Data_Shedular_Insert_Update(dt_our_stock_data, stock_Data_Id);
                            if (result > 0)
                            {
                                if (stock_Data_Master.Upload_Type == "O" && stock_Data_Master.Stock_Type == "L")
                                {
                                    await _supplierService.Supplier_Stock_Insert_Update((int)stock_Data_Master.Supplier_Id, stock_Data_Id);
                                    /*
                                    string count_message = await _supplierService.Stock_Data_Supplier_Count_Select((int)stock_Data_Master.Supplier_Id);
                                    if (!string.IsNullOrEmpty(count_message) && count_message.Contains("Duplicate"))
                                    {
                                        _emailSender.SendEmail(toEmail: "farhan@sunrisediam.com, list@sunrisediam.com", externalLink: "", subject: count_message, strBody: count_message);
                                    }
                                    */
                                }
                                else if (stock_Data_Master.Upload_Type == "O" && stock_Data_Master.Stock_Type == "O")
                                {
                                    await _supplierService.Supplier_Overseas_Stock_Insert_Update((int)stock_Data_Master.Supplier_Id, stock_Data_Id);
                                }
                            }
                        }
                        else
                        {
                            await _commonService.InsertErrorLog(stock_Data_Master.Error_Message + ":- " + party.Party_Name, "Create_Update_Supplier_Stock_By_Scheduler", null);
                        }
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.StockUploadedSuccessfully,
                            data = new
                            {
                                Supplier_Id = (int)stock_Data_Master.Supplier_Id,
                                Stock_Data_Id = stock_Data_Id
                            }
                        });
                    }
                    else
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            Supplier_Id = party.Party_Id,
                            Party_Name = party.Party_Name,
                            message = CoreCommonMessage.SupplierPriceUpdateCheck
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message + ":- " + party.Party_Name, "Create_Update_Supplier_Stock_By_Scheduler", ex.StackTrace);
                return Conflict(new
                {
                    statusCode = HttpStatusCode.Conflict,
                    Supplier_Id = party.Party_Id,
                    Party_Name = party.Party_Name,
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_stock_data_distinct_column_values")]
        [Authorize]
        public async Task<IActionResult> Get_Stock_Data_Distinct_Column_Values(string column_Name, int supplier_Id)
        {
            try
            {
                var result = await _supplierService.Get_Stock_Data_Distinct_Column_Values(column_Name, supplier_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Stock_Data_Distinct_Column_Values", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("suplier_stock_start_end_time_update")]
        public async Task<IActionResult> Supplier_Stock_Start_End_Time_Update(Supplier_Stock_Update supplier_Stock_Update)
        {
            try
            {
                if (supplier_Stock_Update.Stock_Data_Id > 0)
                {
                    if (!TimeSpan.TryParse(supplier_Stock_Update.Start_Time, out TimeSpan startTime))
                    {
                        return BadRequest(new { message = "Invalid format for Start_Time." });
                    }

                    if (!TimeSpan.TryParse(supplier_Stock_Update.Supplier_Response_Time, out TimeSpan supplierEndTime))
                    {
                        return BadRequest(new { message = "Invalid format for Supplier_Response_Time." });
                    }

                    if (!TimeSpan.TryParse(supplier_Stock_Update.End_Time, out TimeSpan endTime))
                    {
                        return BadRequest(new { message = "Invalid format for End_Time." });
                    }

                    if (startTime > endTime)
                    {
                        return BadRequest(new { message = "Time not valid: Start_Time cannot be greater than End_Time." });
                    }
                }
                else
                {
                    if (!TimeSpan.TryParse(supplier_Stock_Update.Start_Time, out TimeSpan startTime))
                    {
                        return BadRequest(new { message = "Invalid format for Start_Time." });
                    }

                    if (!TimeSpan.TryParse(supplier_Stock_Update.Supplier_Response_Time, out TimeSpan supplierEndTime))
                    {
                        return BadRequest(new { message = "Invalid format for Supplier_Response_Time." });
                    }

                    if (startTime > supplierEndTime)
                    {
                        return BadRequest(new { message = "Time not valid: Start_Time cannot be greater than Supplier_Response_Time." });
                    }
                }

                var result = await _supplierService.Supplier_Stock_Start_End_Time_Update(supplier_Stock_Update);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StkUpdate

                    });
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "suplier_stock_start_end_time_update", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }

        }

        /*
         * Date: 2025/04/21 By Jashmin Patel
         * Aded for To Get Stock List For Rapnet Price Update by Inrease/Decrease Type
         */
        [HttpGet]
        [Route("get_stock_data_by_rapaport_increase_decrease")]
        [Authorize]
        public async Task<IActionResult> Get_Stock_Data_By_Rapaport_Increase_Decrease(string rap_increase, string rap_decrease)
        {
            try
            {
                if (string.IsNullOrEmpty(rap_increase) || string.IsNullOrEmpty(rap_increase))
                {
                    return BadRequest(new { message = "Invalid data provided." });
                }
                var result = await _supplierService.Get_Stock_Data_By_Rapaport_Increase_Decrease(rap_increase, rap_decrease);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Stock_Data_By_Rapaport_Increase_Decrease", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        /*
        * Date: 2025/04/21 By Jashmin Patel
        * Aded for To Update Supplier Stock List For Rapnet Price Update by Inrease/Decrease Type
        */
        [HttpPut]
        [Route("update_stock_data_by_rapaport_increase_decrease")]
        [Authorize]
        public async Task<IActionResult> Update_Stock_Data_By_Rapaport_Increase_Decrease(string rap_increase, string rap_decrease)
        {
            try
            {
                if (string.IsNullOrEmpty(rap_increase) || string.IsNullOrEmpty(rap_decrease))
                {
                    return BadRequest(new { message = "Invalid data provided." });
                }
                var result = await _supplierService.Update_Stock_Data_By_Rapaport_Increase_Decrease(rap_increase, rap_decrease);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StkUpdate
                    });
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Stock_Data_By_Rapaport_Increase_Decrease", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Stock Number Generate
        [HttpGet]
        [Route("get_stock_number_generation")]
        [Authorize]
        public async Task<IActionResult> Get_Stock_Number_Generation(int Id)
        {
            try
            {
                var result = await _supplierService.Get_Stock_Number_Generation(Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Number_Generation", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_stock_number_generation")]
        [Authorize]
        public async Task<IActionResult> Create_Stock_Number_Generation(Stock_Number_Generation_List stock_Number_Generation_List)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    int id = stock_Number_Generation_List.stock_Number_Generations.Select(x => x.Id).FirstOrDefault();
                    if (stock_Number_Generation_List.stock_Number_Generations != null && stock_Number_Generation_List.stock_Number_Generations.Count > 0)
                    {

                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Id", typeof(int));
                        dataTable.Columns.Add("Exc_Party_Id", typeof(string));
                        dataTable.Columns.Add("Pointer_Id", typeof(string));
                        dataTable.Columns.Add("Shape", typeof(string));
                        dataTable.Columns.Add("Stock_Type", typeof(string));
                        dataTable.Columns.Add("Front_Prefix", typeof(string));
                        dataTable.Columns.Add("Back_Prefix", typeof(string));
                        dataTable.Columns.Add("Front_Prefix_Alloted", typeof(string));
                        dataTable.Columns.Add("Start_Format", typeof(string));
                        dataTable.Columns.Add("Start_Number", typeof(string));
                        dataTable.Columns.Add("End_Number", typeof(string));
                        dataTable.Columns.Add("Supplier_Id", typeof(int));
                        dataTable.Columns.Add("Query_Flag", typeof(string));
                        dataTable.Columns.Add("User_Id", typeof(int));
                        string ids = string.Empty;
                        foreach (var item in stock_Number_Generation_List.stock_Number_Generations)
                        {
                            dataTable.Rows.Add(item.Id, item.Exc_Party_Id, item.Pointer_Id, item.Shape, item.Stock_Type, item.Front_Prefix, item.Back_Prefix, item.Front_Prefix_Alloted, item.Start_Format, item.Start_Number, item.End_Number, item.Supplier_Id, item.Id > 0 ? 'U' : 'I', stock_Number_Generation_List.User_Id);

                            if (item.Id > 0)
                                ids += (ids.Length > 0 ? "," : "") + item.Id;
                        }

                        //DataTable dataTableSinglePointer = new DataTable();
                        //dataTableSinglePointer.Columns.Add("Id", typeof(int));
                        //dataTableSinglePointer.Columns.Add("Exc_Party_Id", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Pointer_Id", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Shape", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Stock_Type", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Front_Prefix", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Back_Prefix", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Front_Prefix_Alloted", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Start_Format", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Start_Number", typeof(string));
                        //dataTableSinglePointer.Columns.Add("End_Number", typeof(string));
                        //dataTableSinglePointer.Columns.Add("Supplier_Id", typeof(int));
                        //dataTableSinglePointer.Columns.Add("Query_Flag", typeof(string));
                        //dataTableSinglePointer.Columns.Add("User_Id", typeof(int));
                        //string ids = string.Empty;
                        //foreach (var item in stock_Number_Generation_List.stock_Number_Generations)
                        //{
                        //    if (item.Id > 0)
                        //        ids += (ids.Length > 0 ? "," : "") + item.Id;

                        //    string[] arrPointer = item.Pointer_Id.Split(",");
                        //    string[] arrFrontPrifixAlloted = item.Front_Prefix_Alloted.Split(",");

                        //    foreach (string pointer in arrPointer)
                        //    {
                        //        foreach (string fromPrifixAlloted in arrFrontPrifixAlloted)
                        //        {
                        //            dataTableSinglePointer.Rows.Add(item.Id, item.Exc_Party_Id, pointer, item.Shape, item.Stock_Type, item.Front_Prefix, item.Back_Prefix, fromPrifixAlloted, item.Start_Format, item.Start_Number, item.End_Number, item.Supplier_Id, item.Id > 0 ? 'U' : 'I', stock_Number_Generation_List.User_Id);
                        //        }
                        //        if (item.Front_Prefix.Length > 0)
                        //        {
                        //            dataTableSinglePointer.Rows.Add(item.Id, item.Exc_Party_Id, pointer, item.Shape, item.Stock_Type, item.Front_Prefix, item.Back_Prefix, item.Front_Prefix, item.Start_Format, item.Start_Number, item.End_Number, item.Supplier_Id, item.Id > 0 ? 'U' : 'I', stock_Number_Generation_List.User_Id);
                        //        }
                        //    }
                        //}

                        var result = await _supplierService.Add_Update_Stock_Number_Generation(dataTable);
                        await _supplierService.Add_Update_Stock_Number_Generation_Raplicate(ids);
                        if (result == 5 || result == 6 || result == 7)
                        {
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = result == 5 ? CoreCommonMessage.StockNumberAlreadyExistLab : (result == 6 ? CoreCommonMessage.StockNumberAlreadyExistOverses : (result == 7 ? CoreCommonMessage.StockNumberAlreadyExistSunrise : "")),
                            });
                        }
                        else
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = id > 0 ? CoreCommonMessage.StockNumberUpdated : CoreCommonMessage.StockNumberCreated,
                            });
                        }
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Stock_Number_Generation", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_stock_number_generation")]
        [Authorize]
        public async Task<IActionResult> Delete_Stock_Number_Generation(int Id)
        {
            try
            {
                var result = await _supplierService.Delete_Stock_Number_Generation(Id);
                if (result == 409)
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ReferenceFoundError
                    });
                }
                else
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StockNumberDeleted
                    });
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Stock_Number_Generation", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        /*
         * Date: 2025/04/24 By Jashmin Patel
         * Aded for create stock number generation overseas get list if id null then return all record.
         */
        [HttpGet]
        [Route("get_stock_number_generation_overseas")]
        [Authorize]
        public async Task<IActionResult> Get_Stock_Number_Generation_Overseas(int Id)
        {
            try
            {
                var result = await _supplierService.Get_Stock_Number_Generation_Overseas(Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Stock_Number_Generation_Overseas", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/04/24 By Jashmin Patel
         * Aded for create stock number generation overseas add/edit 
         */
        [HttpPost]
        [Route("create_stock_number_generation_overseas")]
        [Authorize]
        public async Task<IActionResult> Create_Stock_Number_Generation_Overseas(Stock_Number_Generation_Overseas_List stock_Number_Generation_List)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    int id = stock_Number_Generation_List.stock_Number_Generations.Select(x => x.Id).FirstOrDefault();
                    if (stock_Number_Generation_List.stock_Number_Generations != null && stock_Number_Generation_List.stock_Number_Generations.Count > 0)
                    {

                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Id", typeof(int));
                        dataTable.Columns.Add("Party_Id", typeof(int));
                        dataTable.Columns.Add("Shape", typeof(string));
                        dataTable.Columns.Add("From_Cts", typeof(decimal));
                        dataTable.Columns.Add("To_Cts", typeof(decimal));
                        dataTable.Columns.Add("Front_Prefix", typeof(string));
                        dataTable.Columns.Add("Back_Prefix", typeof(string));
                        dataTable.Columns.Add("Front_Prefix_Alloted", typeof(string));
                        dataTable.Columns.Add("Start_Format", typeof(string));
                        dataTable.Columns.Add("Start_Number", typeof(string));
                        dataTable.Columns.Add("End_Number", typeof(string));
                        dataTable.Columns.Add("Query_Flag", typeof(string));
                        dataTable.Columns.Add("User_Id", typeof(int));
                        string ids = string.Empty;
                        foreach (var item in stock_Number_Generation_List.stock_Number_Generations)
                        {
                            dataTable.Rows.Add(item.Id, item.Party_Id, item.Shape, item.From_Cts, item.To_Cts, item.Front_Prefix, item.Back_Prefix, item.Front_Prefix_Alloted, item.Start_Format, item.Start_Number, item.End_Number, item.Id > 0 ? 'U' : 'I', stock_Number_Generation_List.User_Id);

                            if (item.Id > 0)
                                ids += (ids.Length > 0 ? "," : "") + item.Id;
                        }

                        var result = await _supplierService.Add_Update_Stock_Number_Generation_Overseas(dataTable);

                        await _supplierService.Add_Update_Stock_Number_Generation_Overseas_Raplicate(ids);

                        if (result == -1)
                        {
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = CoreCommonMessage.StockNumberAlreadyExistOversesBackPrefix,
                            });
                        }
                        else
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = id > 0 ? CoreCommonMessage.StockNumberUpdated : CoreCommonMessage.StockNumberCreated,
                            });
                        }
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Stock_Number_Generation_Overseas", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        /*
         * Date: 2025/04/24 By Jashmin Patel
         * Aded for create stock number generation overseas delete 
         */
        [HttpDelete]
        [Route("delete_stock_number_generation_overseas")]
        [Authorize]
        public async Task<IActionResult> Delete_Stock_Number_Generation_Overseas(int Id)
        {
            try
            {
                var result = await _supplierService.Delete_Stock_Number_Generation_Overseas(Id);
                if (result == 409)
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ReferenceFoundError
                    });
                }
                else
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StockNumberDeleted
                    });
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Stock_Number_Generation_Overseas", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        /*
         * Date: 2025/05/22 By Jashmin Patel
         * Aded for sending mail while stock number going to expired or no more prefix exists.
         */
        [HttpGet]
        [Route("stock_number_generation_replicate_availability_mail")]
        public async Task<IActionResult> Stock_Number_Generation_Replicate_Availability_Mail()
        {
            try
            {
                var result = await _supplierService.Stock_Number_Generation_Replicate_Availability();

                if (result != null && result.Count > 0)
                {
                    List<string> to_Emails = new List<string>() { "samit@sunrisediam.com" };
                    List<string> cc_Emails = new List<string>() { "list@sunrisediam.com" };
                    List<string> bcc_Emails = new List<string>() { "tejash@brainwaves.co.in" };

                    string subject = "Alert - Stock No is going to expire";

                    StringBuilder sb = new StringBuilder();

                    sb.AppendLine(@"Hi," + "<br/>");
                    sb.AppendLine(@"Below stock no is going to expire kindly add another one asap." + "<br/>" + "<br/>");
                    sb.AppendLine(@"<table border='1' cellspacing='2' cellpadding='3'>");
                    sb.AppendLine(@"<thead><tr><td>Prefix</td><td>Current No</td></tr></thead>");
                    sb.AppendLine(@"<tbody>");

                    foreach (var item in result)
                    {
                        sb.AppendLine($"<tr><td>{item["Prefix"]}</td><td>{item["Current_No"]}</td></tr>");
                    }
                    sb.AppendLine(@"</tbody>");
                    sb.AppendLine(@"</table>");

                    _emailSender.SendEmail(toEmails: to_Emails, subject: subject, body: sb.ToString(), ccEmails: cc_Emails, bccEmails: bcc_Emails);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Stock_Number_Generation_Replicate_Availability_Mail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/07/08 By Jashmin Patel
         * Aded for sending mail while Same Stones for First and Last API/Ftp for same day.
         */
        [HttpGet]
        [Route("supplier_stock_count_mail")]
        public async Task<IActionResult> Supplier_Stock_Count_Mail()
        {
            try
            {
                DataTable result = await _supplierService.Get_Supplier_Stock_Count_For_Mail();

                if (result != null && result.Rows.Count > 0)
                {
                    List<string> to_Emails = new List<string>() { "list@sunrisediam.com" };
                    List<string> cc_Emails = new List<string>() { "jignesh@sunrisediam.com" };

                    string subject = "Same Stones for First and Last API/FTP";

                    StringBuilder sb = new StringBuilder();

                    sb.AppendLine(@"Hi," + "<br/>");
                    sb.AppendLine(@"Please find below supplier details in which Total stones count remains same for First APi/Ftp and last API/Ftp for the date. So Kindly reconfirm with supplier for the same" + "<br/>" + "<br/>");
                    sb.AppendLine(@"<table border='1' cellspacing='2' cellpadding='3'>");
                    sb.AppendLine(@"<thead><tr>");
                    foreach (DataColumn column in result.Columns)
                    {
                        sb.AppendLine(@"<td>" + HttpUtility.HtmlEncode(column.ColumnName) + "</td>");
                    }
                    sb.AppendLine(@"</tr></thead>");
                    sb.AppendLine(@"<tbody>");

                    foreach (DataRow row in result.Rows)
                    {
                        sb.AppendLine("<tr>");
                        foreach (DataColumn column in result.Columns)
                        {
                            sb.AppendFormat("<td>{0}</td>", HttpUtility.HtmlEncode(row[column].ToString()));
                        }
                        sb.AppendLine("</tr>");
                    }
                    sb.AppendLine(@"</tbody>");
                    sb.AppendLine(@"</table>");

                    _emailSender.SendEmail(toEmails: to_Emails, subject: subject, body: sb.ToString(), ccEmails: cc_Emails, bccEmails: null);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Supplier_Stock_Count_Mail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Api/FTP/File Party Name
        [HttpGet]
        [Route("get_api_ftp_file_party_select")]
        [Authorize]
        public async Task<IActionResult> Get_Api_Ftp_File_Party_Select(int party_Id, bool lab, bool overseas, bool is_Stock_Gen)
        {
            try
            {
                var result = await _supplierService.Get_Api_Ftp_File_Party_Select(party_Id, lab, overseas, is_Stock_Gen);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Api_Ftp_File_Party_Select", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/04/18 By Jashmin Patel
         * Aded for Price_Lock -> PARTY With API/FTP/File whose's Status=1 those all data will updated as Price Lock
         */
        [HttpGet]
        [Route("party_api_ftp_file_price_lock")]
        [Authorize]
        public async Task<IActionResult> Party_Api_Ftp_File_Price_Lock()
        {
            try
            {
                var result = await _partyService.Party_Api_Ftp_File_Price_Lock();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.UpdatedSuccessfully,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Party_Api_Ftp_File_Price_Lock", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        /*
        * Date: 2025/04/18 By Jashmin Patel
        * Aded for Price_Locked List -> PARTY With API/FTP/File whose's Parice_Lock = 1 to update.
        */
        [HttpGet]
        [Route("party_api_ftp_file_price_lock_list")]
        [Authorize]
        public async Task<IActionResult> Party_Api_Ftp_File_Price_Lock_List()
        {
            try
            {
                var result = await _partyService.Party_Api_Ftp_File_Price_Lock_List();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Party_Api_Ftp_File_Price_Lock_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        /*
        * Date: 2025/04/18 By Jashmin Patel
        * Aded for Price_Locked List -> PARTY With API/FTP/File whose's Parice_Lock = 1 to update.
        */
        [HttpPost]
        [Route("update_supplier_pricelock_list")]
        [Authorize]
        public async Task<IActionResult> Update_Supplier_PriceLock_List(IList<Supplier_PriceLock_List> supplier_PriceLock_Lists)
        {
            if (supplier_PriceLock_Lists == null || supplier_PriceLock_Lists.Count == 0)
            {
                return NoContent();
            }

            try
            {
                var dataTable = new DataTable();
                dataTable.Columns.Add("Party_Id", typeof(int));
                dataTable.Columns.Add("Price_Lock", typeof(bool));
                dataTable.Columns.Add("Stage", typeof(string));

                foreach (var item in supplier_PriceLock_Lists)
                {
                    dataTable.Rows.Add(item.Party_Id, item.Price_Lock, item.Stage);
                }

                var result = await _partyService.Update_Supplier_Price_Lock_List(dataTable);

                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.SupplierPriceLockUpdate,
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Supplier_PriceLock_List", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Supplier FTP
        [HttpGet]
        [Route("get_supplier_ftp_file")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Ftp_File(int supp_Id)
        {
            try
            {
                var supplier = await _partyService.Get_Party_FTP(0, supp_Id);
                if (supplier != null)
                {
                    string ftpfileName = "/stock-" + Guid.NewGuid().ToString() + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + ".csv";
                    string ftpUrl = _configuration["BaseUrl"] + CoreCommonFilePath.FtpFilesPath + ftpfileName;
                    string localDirectoryPath = Path.Combine(Directory.GetCurrentDirectory(), "Files/FTPFile");

                    if (!Directory.Exists(localDirectoryPath))
                    {
                        Directory.CreateDirectory(localDirectoryPath);
                    }
                    string localDirectory = localDirectoryPath + ftpfileName;
                    CoreService.Ftp_File_Download(supplier.Host, supplier.Ftp_User, supplier.Ftp_Password, (int)supplier.Ftp_Port, supplier.Ftp_File_Name, localDirectory);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.FileDownloadSuccessfully,
                        data = new { url = ftpUrl }
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Ftp_File", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_ftp_file_scheduler")]
        public async Task<IActionResult> Get_Supplier_Ftp_File_Scheduler(int supp_Id)
        {
            try
            {
                var supplier = await _partyService.Get_Party_FTP(0, supp_Id);
                if (supplier != null)
                {
                    string ftpfileName = "/stock-" + Guid.NewGuid().ToString() + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + ".csv";
                    string ftpUrl = _configuration["BaseUrl"] + CoreCommonFilePath.FtpFilesPath + ftpfileName;
                    string localDirectoryPath = Path.Combine(Directory.GetCurrentDirectory(), "Files/FTPFile");

                    if (!Directory.Exists(localDirectoryPath))
                    {
                        Directory.CreateDirectory(localDirectoryPath);
                    }
                    string localDirectory = localDirectoryPath + ftpfileName;
                    CoreService.Ftp_File_Download(supplier.Host, supplier.Ftp_User, supplier.Ftp_Password, (int)supplier.Ftp_Port, supplier.Ftp_File_Name, localDirectory);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.FileDownloadSuccessfully,
                        data = new { url = ftpUrl }
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Ftp_File_Scheduler", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Manual Upload
        [HttpGet]
        [Route("get_party_supplier_for_manual_file")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Supplier_For_Manual_File()
        {
            try
            {
                var result = await _partyService.Get_Party_Suplier_For_Manual_File();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Supplier_For_Manual_File", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        /*
        [HttpPost]
        [Route("create_update_manual_upload")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Manual_Upload([FromForm] Party_File party_File, IFormFile File_Location)
        {
            string startTime = DateTime.Now.TimeOfDay.ToString(@"hh\:mm\:ss");

            string party_name = string.Empty;
            try
            {
                if (ModelState.IsValid)
                {
                    //var party_Api = await _partyService.Get_Party_API(0,party_File.Party_Id ?? 0);
                    //var party_FTP = await _partyService.Get_Party_FTP(0, party_File.Party_Id ?? 0);
                    //if (!party_File.is_Continue && party_Api != null && party_Api.API_Status == true && party_Api.Lab == true)
                    //{
                    //    return Conflict(new
                    //    {
                    //        statusCode = HttpStatusCode.Conflict,
                    //        api_Active = true,
                    //        message = "API is active for this supplier, Do you want to continue ?"
                    //    });
                    //}
                    //else if (!party_File.is_Continue && party_FTP != null && party_FTP.Ftp_Status == true && party_FTP.Lab == true)
                    //{
                    //    return Conflict(new
                    //    {
                    //        statusCode = HttpStatusCode.Conflict,
                    //        api_Active = true,
                    //        message = "FTP is active for this supplier, Do you want to continue ?"
                    //    });
                    //}
                    //else
                    //{
                    var supp_col_Map = await _supplierService.Get_Supplier_Column_Mapping(party_File.Party_Id ?? 0, "C", "FILE");
                    int? col_Map_sup_Id = supp_col_Map.Select(x => x.Supp_Id).FirstOrDefault();
                    if (col_Map_sup_Id > 0)
                    {
                        #region Update Party File
                        var party_file_obj = await _partyService.Get_Party_File(0, party_File.Party_Id ?? 0);
                        var parties = await _partyService.GetParty_Raplicate(party_File.Party_Id ?? 0, null, 0);
                        party_name = parties.Select(x => x.Party_Name).FirstOrDefault();
                        if (party_file_obj != null)
                        {
                            if (party_file_obj.Lab == false && party_file_obj.Overseas == false)
                            {
                                return Conflict(new
                                {
                                    statusCode = HttpStatusCode.Conflict,
                                    Supplier_Id = party_File.Party_Id,
                                    Party_Name = party_name,
                                    message = "Kindly check status on supplier api."
                                });
                            }

                            party_file_obj.Sheet_Name = party_File.Sheet_Name;
                            party_file_obj.Validity_Days = party_File.Validity_Days;
                            party_file_obj.API_Flag = party_File.API_Flag;
                            party_file_obj.Exclude = party_File.Exclude;
                            party_file_obj.Overseas_Same_Id = party_File.Overseas_Same_Id;

                            var result = await _partyService.Add_Update_Party_File(party_file_obj, 0);

                            if (result > 0)
                            {
                                var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/ManualUploadFiles");
                                if (!(Directory.Exists(filePath)))
                                {
                                    Directory.CreateDirectory(filePath);
                                }
                                string fileName = Path.GetFileNameWithoutExtension(File_Location.FileName);
                                string fileExt = Path.GetExtension(File_Location.FileName);
                                string strFile = fileName + "_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + fileExt;

                                using (var fileStream = new FileStream(Path.Combine(filePath, strFile), FileMode.Create))
                                {
                                    await File_Location.CopyToAsync(fileStream);
                                }
                                party_File.File_Location = strFile;

                                DataTable excel_dataTable = new DataTable();
                                DataTable supplier_column_Mapping = await _supplierService.Get_Supplier_Column_Mapping_In_Datatable(party_File.Party_Id ?? 0, "C", "FILE");

                                var sheet_list = party_File.Sheet_Name.Split(",").ToList();
                                var fileLocation = Path.Combine(filePath, strFile);
                                if (fileExt == ".xls")
                                {
                                    if (sheet_list != null && sheet_list.Count > 0)
                                    {
                                        foreach (var sheet_name in sheet_list)
                                        {
                                            using (FileStream file = new FileStream(fileLocation, FileMode.Open, FileAccess.Read))
                                            {
                                                HSSFWorkbook workbook = new HSSFWorkbook(file);
                                                HSSFSheet sheet = (HSSFSheet)workbook.GetSheet(sheet_name);
                                                #region Start Remove above unused rows and columns
                                                var (hasDataInFirstTenRowsAndColumns, rowcnt) = CoreService.CheckDataInFirstTenRowsAndColumns(sheet);

                                                if (hasDataInFirstTenRowsAndColumns && rowcnt > 1)
                                                {
                                                    sheet.ShiftRows(1, rowcnt - 1, 0);
                                                    string outputFilePath = Path.Combine(filePath, strFile);
                                                    using (FileStream outputFile = new FileStream(outputFilePath, FileMode.Create))
                                                    {
                                                        workbook.Write(outputFile);
                                                    }
                                                }
                                                #endregion

                                                #region Start Remove belowe unused rows and columns
                                                int rowCount = sheet.LastRowNum + 1;
                                                int colCount = sheet.GetRow(0).LastCellNum;

                                                int rowsToCheck = Math.Max(rowCount - (rowCount - 1), 1);
                                                bool is_Removed = false;

                                                for (int row = rowCount - 1; row >= rowsToCheck; row--)
                                                {
                                                    bool hasData = false;

                                                    IRow currentRow = sheet.GetRow(row);
                                                    if (currentRow != null)
                                                    {
                                                        for (int col = colCount - 1; col >= colCount - 20; col--)
                                                        {
                                                            ICell cell = currentRow.GetCell(col);
                                                            if (cell != null && !string.IsNullOrEmpty(cell.ToString()))
                                                            {
                                                                hasData = true;
                                                                break;
                                                            }
                                                        }
                                                    }

                                                    if (!hasData)
                                                    {
                                                        sheet.RemoveRow(currentRow);
                                                        rowCount--;
                                                        is_Removed = true;
                                                    }
                                                }

                                                if (is_Removed)
                                                {
                                                    try
                                                    {
                                                        string outputFilePath2 = Path.Combine(filePath, strFile);
                                                        using (FileStream outputFile = new FileStream(outputFilePath2, FileMode.Create))
                                                        {
                                                            workbook.Write(outputFile);
                                                        }
                                                    }
                                                    catch (Exception ex)
                                                    {
                                                        // Handle exception
                                                    }
                                                }
                                                #endregion

                                                #region Start Update URL
                                                List<string> columnNames = new List<string>();
                                                List<Dictionary<string, object>> rowsData = new List<Dictionary<string, object>>();

                                                int totalColumns = sheet.GetRow(0).LastCellNum;
                                                IRow headerRow = sheet.GetRow(0);

                                                for (int col = 0; col < totalColumns; col++)
                                                {
                                                    var cellValue = headerRow.GetCell(col)?.ToString();
                                                    if (!string.IsNullOrEmpty(cellValue))
                                                    {
                                                        columnNames.Add(cellValue);
                                                    }
                                                }
                                                int _rowCount = sheet.PhysicalNumberOfRows;
                                                for (int row = 1; row < _rowCount; row++)
                                                {
                                                    IRow currentRow = sheet.GetRow(row);
                                                    Dictionary<string, object> rowData = new Dictionary<string, object>();

                                                    for (int col = 0; col < totalColumns; col++)
                                                    {
                                                        string columnName = columnNames[col];
                                                        var cell = currentRow.GetCell(col);
                                                        var cellValue = cell?.ToString();
                                                        string formula = string.Empty;
                                                        if (cell.CellType == CellType.Formula)
                                                        {
                                                            formula = cell?.CellFormula;
                                                        }
                                                        if (!string.IsNullOrEmpty(cell.Hyperlink?.Address))
                                                        {
                                                            string linkUrl = cell.Hyperlink.Address;
                                                            rowData.Add(columnName, linkUrl);
                                                        }
                                                        else if (cell.CellType == CellType.Formula && !string.IsNullOrEmpty(formula))
                                                        {
                                                            var urlMatch = Regex.Match(formula, "\"(.*?)\"");
                                                            if (urlMatch.Success)
                                                            {
                                                                string url = urlMatch.Groups[1].Value;
                                                                string text = Regex.Match(formula, ",\"(.*?)\"").Groups[1].Value;
                                                                bool containsOnlyNumbers = Regex.IsMatch(text, @"^[0-9]+$");
                                                                if (containsOnlyNumbers)
                                                                {
                                                                    rowData.Add(columnName, url + "," + text);
                                                                }
                                                                else
                                                                {
                                                                    rowData.Add(columnName, url);
                                                                }
                                                            }
                                                        }
                                                        else
                                                        {
                                                            rowData.Add(columnName, cellValue);
                                                        }
                                                    }

                                                    rowsData.Add(rowData);
                                                }

                                                for (int colIndex = 0; colIndex < columnNames.Count; colIndex++)
                                                {
                                                    headerRow.GetCell(colIndex).SetCellValue(columnNames[colIndex]);
                                                }

                                                for (int rowIndex = 0; rowIndex < rowsData.Count; rowIndex++)
                                                {
                                                    IRow currentRow = sheet.GetRow(rowIndex + 1);
                                                    for (int colIndex = 0; colIndex < columnNames.Count; colIndex++)
                                                    {
                                                        currentRow.GetCell(colIndex)?.SetCellValue(rowsData[rowIndex][columnNames[colIndex]].ToString());
                                                    }
                                                }

                                                string outputFilePath1 = Path.Combine(filePath, strFile);
                                                using (FileStream outputFile = new FileStream(outputFilePath1, FileMode.Create))
                                                {
                                                    workbook.Write(outputFile);
                                                }
                                                #endregion
                                            }
                                        }
                                    }
                                }
                                else if (fileExt == ".xlsx")
                                {
                                    List<Dictionary<string, object>> rowsData = new List<Dictionary<string, object>>();
                                    if (sheet_list != null && sheet_list.Count > 0)
                                    {
                                        foreach (var sheet_name in sheet_list)
                                        {
                                            using (var package = new ExcelPackage(new FileInfo(fileLocation)))
                                            {
                                                ExcelWorksheet worksheet = package.Workbook.Worksheets[sheet_name];
                                                worksheet.Calculate();
                                                #region Start Remove above unused rows and columns
                                                var (hasDataInFirstTenRowsAndColumns, row_count) = CoreService.CheckDataInFirstTenRowsAndColumns(worksheet);
                                                if (hasDataInFirstTenRowsAndColumns && row_count > 1)
                                                {
                                                    worksheet.DeleteRow(1, row_count - 1);
                                                    string outputFilePath = Path.Combine(filePath, strFile);
                                                    package.SaveAs(new FileInfo(outputFilePath));
                                                }
                                                #endregion

                                                #region Start Remove belowe unused rows and columns
                                                var rowCount = worksheet.Dimension.End.Row;
                                                var colCount = worksheet.Dimension.End.Column;

                                                int rowsToCheck = Math.Max(rowCount - (rowCount - 1), 1);
                                                bool is_Removed = false;
                                                for (int row = rowCount; row >= rowsToCheck; row--)
                                                {
                                                    bool hasData = false;

                                                    for (int col = colCount; col > colCount - 20; col--)
                                                    {
                                                        var cell = worksheet.Cells[row, col];

                                                        if (!string.IsNullOrEmpty(cell.Text))
                                                        {
                                                            hasData = true;
                                                            break;
                                                        }
                                                    }

                                                    if (!hasData)
                                                    {
                                                        worksheet.DeleteRow(row);
                                                        rowCount--;
                                                        is_Removed = true;
                                                    }
                                                }
                                                if (is_Removed)
                                                {
                                                    try
                                                    {
                                                        string outputFilePath1 = Path.Combine(filePath, strFile);
                                                        package.SaveAs(new FileInfo(outputFilePath1));
                                                    }
                                                    catch (Exception ex)
                                                    {

                                                    }
                                                }
                                                #endregion

                                                List<string> columnNames = new List<string>();
                                                if (worksheet != null)
                                                {
                                                    // Get column names
                                                    int totalColumns = worksheet.Dimension.End.Column;
                                                    int headerRow = 1;

                                                    for (int col = 1; col <= totalColumns; col++)
                                                    {
                                                        var cellValue = worksheet.Cells[headerRow, col].Value;
                                                        if (cellValue != null)
                                                        {
                                                            columnNames.Add(cellValue.ToString().Trim());
                                                        }
                                                    }

                                                    // Get row values
                                                    int totalRows = worksheet.Dimension.End.Row;

                                                    for (int row = headerRow + 1; row <= totalRows; row++)
                                                    {
                                                        Dictionary<string, object> rowData = new Dictionary<string, object>();

                                                        for (int col = 1; col <= totalColumns; col++)
                                                        {
                                                            var _cellValue = worksheet.Cells[headerRow, col].Value;
                                                            if (_cellValue != null)
                                                            {
                                                                string columnName = columnNames[col - 1];
                                                                var cell = worksheet.Cells[row, col];
                                                                var cellValue = cell.Value;
                                                                var formula = cell.Formula;

                                                                if (cell.Hyperlink != null)
                                                                {
                                                                    string url = cell.Hyperlink.OriginalString.Replace("%22", "");

                                                                    if (url.Length > 0)
                                                                    {
                                                                        string linkUrl = url;
                                                                        rowData.Add(columnName, linkUrl + ", " + cellValue);
                                                                    }
                                                                    else
                                                                    {
                                                                        rowData.Add(columnName, cellValue);
                                                                    }
                                                                }
                                                                else if (!string.IsNullOrEmpty(formula) && formula.Contains("HYPERLINK"))
                                                                {
                                                                    int urlStartIndex = formula.IndexOf("\"") + 1;
                                                                    int urlEndIndex = formula.IndexOf("\",\"");

                                                                    if (urlStartIndex > 0 && urlEndIndex > urlStartIndex)
                                                                    {
                                                                        string url = formula.Substring(urlStartIndex, urlEndIndex - urlStartIndex);

                                                                        int textStartIndex = urlEndIndex + 3;
                                                                        int textEndIndex = formula.LastIndexOf("\"");

                                                                        if (textStartIndex > 0 && textEndIndex > textStartIndex)
                                                                        {
                                                                            string text = formula.Substring(textStartIndex, textEndIndex - textStartIndex);
                                                                            cell.Value = String.Format("{0},{1}", url, text);
                                                                            rowData.Add(columnName, cell.Value);
                                                                        }
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    rowData.Add(columnName, cellValue != null ? cellValue : DBNull.Value);
                                                                }
                                                            }
                                                        }
                                                        rowsData.Add(rowData);
                                                    }
                                                }
                                            }
                                        }
                                        excel_dataTable = CoreService.ConvertToDataTable(rowsData);
                                        goto dataExist;
                                    }
                                }

                                if (fileExt == ".xls")
                                {
                                    var modifiedRows = supplier_column_Mapping.AsEnumerable()
                                                       .Select(row =>
                                                       {
                                                           string originalValue = Convert.ToString(row["Supp_Col_Name"]);
                                                           if (originalValue.Contains("."))
                                                           {
                                                               string modifiedValue = originalValue.Replace(".", "#");
                                                               row.SetField("Supp_Col_Name", modifiedValue);
                                                           }
                                                           return row;
                                                       }).CopyToDataTable();
                                    string connString = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + fileLocation + ";Extended Properties=\"Excel 12.0;HDR=YES;\"";
                                    excel_dataTable = CoreService.Convert_File_To_DataTable(".xls", connString, party_File.Sheet_Name);
                                }
                                else if (fileExt == ".xlsx")
                                {
                                    var modifiedRows = supplier_column_Mapping.AsEnumerable()
                                                       .Select(row =>
                                                       {
                                                           string originalValue = Convert.ToString(row["Supp_Col_Name"]);
                                                           if (originalValue.Contains("."))
                                                           {
                                                               string modifiedValue = originalValue.Replace(".", "#");
                                                               row.SetField("Supp_Col_Name", modifiedValue);
                                                           }
                                                           return row;
                                                       }).CopyToDataTable();
                                    string connString = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + fileLocation + ";Extended Properties='Excel 12.0 Xml;HDR=YES;IMEX=1;'";
                                    excel_dataTable = CoreService.Convert_File_To_DataTable(".xlsx", connString, party_File.Sheet_Name);
                                }
                                else if (fileExt == ".csv")
                                {
                                    excel_dataTable = CoreService.Convert_File_To_DataTable(".csv", fileLocation, "");
                                }

                            dataExist:
                                if (excel_dataTable != null && excel_dataTable.Rows.Count > 0)
                                {
                                    #region Add column to datatable
                                    DataTable dt_stock_data = new DataTable();
                                    dt_stock_data.Columns.Add("SUPPLIER_NO", typeof(string));
                                    dt_stock_data.Columns.Add("CERTIFICATE_NO", typeof(string));
                                    dt_stock_data.Columns.Add("LAB", typeof(string));
                                    dt_stock_data.Columns.Add("SHAPE", typeof(string));
                                    dt_stock_data.Columns.Add("CTS", typeof(string));
                                    dt_stock_data.Columns.Add("BASE_DISC", typeof(string));
                                    dt_stock_data.Columns.Add("BASE_RATE", typeof(string));
                                    dt_stock_data.Columns.Add("BASE_AMOUNT", typeof(string));
                                    dt_stock_data.Columns.Add("COLOR", typeof(string));
                                    dt_stock_data.Columns.Add("CLARITY", typeof(string));
                                    dt_stock_data.Columns.Add("CUT", typeof(string));
                                    dt_stock_data.Columns.Add("POLISH", typeof(string));
                                    dt_stock_data.Columns.Add("SYMM", typeof(string));
                                    dt_stock_data.Columns.Add("FLS_COLOR", typeof(string));
                                    dt_stock_data.Columns.Add("FLS_INTENSITY", typeof(string));
                                    dt_stock_data.Columns.Add("LENGTH", typeof(string));
                                    dt_stock_data.Columns.Add("WIDTH", typeof(string));
                                    dt_stock_data.Columns.Add("DEPTH", typeof(string));
                                    dt_stock_data.Columns.Add("MEASUREMENT", typeof(string));
                                    dt_stock_data.Columns.Add("DEPTH_PER", typeof(string));
                                    dt_stock_data.Columns.Add("TABLE_PER", typeof(string));
                                    dt_stock_data.Columns.Add("CULET", typeof(string));
                                    dt_stock_data.Columns.Add("SHADE", typeof(string));
                                    dt_stock_data.Columns.Add("LUSTER", typeof(string));
                                    dt_stock_data.Columns.Add("MILKY", typeof(string));
                                    dt_stock_data.Columns.Add("BGM", typeof(string));
                                    dt_stock_data.Columns.Add("LOCATION", typeof(string));
                                    dt_stock_data.Columns.Add("STATUS", typeof(string));
                                    dt_stock_data.Columns.Add("TABLE_BLACK", typeof(string));
                                    dt_stock_data.Columns.Add("SIDE_BLACK", typeof(string));
                                    dt_stock_data.Columns.Add("TABLE_WHITE", typeof(string));
                                    dt_stock_data.Columns.Add("SIDE_WHITE", typeof(string));
                                    dt_stock_data.Columns.Add("TABLE_OPEN", typeof(string));
                                    dt_stock_data.Columns.Add("CROWN_OPEN", typeof(string));
                                    dt_stock_data.Columns.Add("PAVILION_OPEN", typeof(string));
                                    dt_stock_data.Columns.Add("GIRDLE_OPEN", typeof(string));
                                    dt_stock_data.Columns.Add("GIRDLE_FROM", typeof(string));
                                    dt_stock_data.Columns.Add("GIRDLE_TO", typeof(string));
                                    dt_stock_data.Columns.Add("GIRDLE_CONDITION", typeof(string));
                                    dt_stock_data.Columns.Add("GIRDLE_TYPE", typeof(string));
                                    dt_stock_data.Columns.Add("LASER_INSCRIPTION", typeof(string));
                                    dt_stock_data.Columns.Add("CERTIFICATE_DATE", typeof(string));
                                    dt_stock_data.Columns.Add("CROWN_ANGLE", typeof(string));
                                    dt_stock_data.Columns.Add("CROWN_HEIGHT", typeof(string));
                                    dt_stock_data.Columns.Add("PAVILION_ANGLE", typeof(string));
                                    dt_stock_data.Columns.Add("PAVILION_HEIGHT", typeof(string));
                                    dt_stock_data.Columns.Add("GIRDLE_PER", typeof(string));
                                    dt_stock_data.Columns.Add("LR_HALF", typeof(string));
                                    dt_stock_data.Columns.Add("STAR_LN", typeof(string));
                                    dt_stock_data.Columns.Add("CERT_TYPE", typeof(string));
                                    dt_stock_data.Columns.Add("FANCY_COLOR", typeof(string));
                                    dt_stock_data.Columns.Add("FANCY_INTENSITY", typeof(string));
                                    dt_stock_data.Columns.Add("FANCY_OVERTONE", typeof(string));
                                    dt_stock_data.Columns.Add("IMAGE_LINK", typeof(string));
                                    dt_stock_data.Columns.Add("Image2", typeof(string));
                                    dt_stock_data.Columns.Add("VIDEO_LINK", typeof(string));
                                    dt_stock_data.Columns.Add("Video2", typeof(string));
                                    dt_stock_data.Columns.Add("CERTIFICATE_LINK", typeof(string));
                                    //dt_stock_data.Columns.Add("DNA_LINK", typeof(string));
                                    dt_stock_data.Columns.Add("DNA", typeof(string));
                                    dt_stock_data.Columns.Add("IMAGE_HEART_LINK", typeof(string));
                                    dt_stock_data.Columns.Add("IMAGE_ARROW_LINK", typeof(string));
                                    dt_stock_data.Columns.Add("H_A_LINK", typeof(string));
                                    dt_stock_data.Columns.Add("CERTIFICATE_TYPE_LINK", typeof(string));
                                    dt_stock_data.Columns.Add("KEY_TO_SYMBOL", typeof(string));
                                    dt_stock_data.Columns.Add("LAB_COMMENTS", typeof(string));
                                    dt_stock_data.Columns.Add("SUPPLIER_COMMENTS", typeof(string));
                                    dt_stock_data.Columns.Add("ORIGIN", typeof(string));
                                    dt_stock_data.Columns.Add("BOW_TIE", typeof(string));
                                    dt_stock_data.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                                    dt_stock_data.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                                    dt_stock_data.Columns.Add("EXTRA_FACET_PAVILION", typeof(string));
                                    dt_stock_data.Columns.Add("INTERNAL_GRAINING", typeof(string));
                                    dt_stock_data.Columns.Add("H_A", typeof(string));
                                    dt_stock_data.Columns.Add("SUPPLIER_DISC", typeof(string));
                                    dt_stock_data.Columns.Add("SUPPLIER_AMOUNT", typeof(string));
                                    dt_stock_data.Columns.Add("OFFER_DISC", typeof(string));
                                    dt_stock_data.Columns.Add("OFFER_VALUE", typeof(string));
                                    dt_stock_data.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                                    dt_stock_data.Columns.Add("MAX_SLAB_BASE_VALUE", typeof(string));
                                    dt_stock_data.Columns.Add("EYE_CLEAN", typeof(string));
                                    dt_stock_data.Columns.Add("GOOD_TYPE", typeof(string));
                                    dt_stock_data.Columns.Add("Short_Code", typeof(string));
                                    #endregion
                                    var mappedRows = excel_dataTable.AsEnumerable()
                                     .Select(row =>
                                     {
                                         var finalRow = dt_stock_data.NewRow();

                                         supplier_column_Mapping.AsEnumerable().ToList().ForEach(suppColRow =>
                                         {
                                             string displayColName = Convert.ToString(suppColRow["Display_Name"]);
                                             string suppColName = Convert.ToString(suppColRow["Supp_Col_Name"]);
                                             bool Is_Split = suppColRow["Is_Split"] != null ? Convert.ToBoolean(suppColRow["Is_Split"]) : false;
                                             bool Is_Sequence = suppColRow["Is_Sequence"] != null ? Convert.ToBoolean(suppColRow["Is_Sequence"]) : false;
                                             string Separator = Convert.ToString(suppColRow["Separator"]);
                                             string Sequence1 = Convert.ToString(suppColRow["Sequence"]);

                                             int Sequence = !string.IsNullOrEmpty(Convert.ToString(suppColRow["Sequence"])) ? Convert.ToInt32(Convert.ToString(suppColRow["Sequence"])) : 0;

                                             if (displayColName != "" && suppColName != "")
                                             {

                                                 if (displayColName != "SHADE")
                                                 {
                                                     finalRow[displayColName] = row[Convert.ToString(suppColRow["Supp_Col_Name"])];
                                                     //if (displayColName == "TABLE_OPEN" || displayColName == "CROWN_OPEN" || displayColName == "PAVILION_OPEN" || displayColName == "GIRDLE_OPEN")
                                                     //{
                                                     //    string foundColumnName = excel_dataTable.Columns.Cast<DataColumn>().FirstOrDefault(column => column.ColumnName == Convert.ToString(suppColRow["Supp_Col_Name"]))?.ColumnName;
                                                     //    if (!string.IsNullOrEmpty(foundColumnName))
                                                     //    {
                                                     //        finalRow[displayColName] = row[Convert.ToString(suppColRow["Supp_Col_Name"])];
                                                     //    }
                                                     //    else
                                                     //    {
                                                     //        finalRow[displayColName] = "";
                                                     //    }

                                                     //}
                                                     //else
                                                     //{
                                                     //    finalRow[displayColName] = row[Convert.ToString(suppColRow["Supp_Col_Name"])];
                                                     //}

                                                 }
                                                 else
                                                 {
                                                     if (suppColName.Contains(","))
                                                     {
                                                         string supp_Col_Name1 = Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",").Length == 3 || Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",").Length == 2 ? Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",")[0] : "";
                                                         string supp_Col_Name2 = Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",").Length == 3 || Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",").Length == 2 ? Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",")[1] : "";
                                                         string supp_Col_Name3 = Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",").Length == 3 ? Convert.ToString(suppColRow["Supp_Col_Name"]).Split(",")[2] : "";
                                                         string shade_Value_1 = !string.IsNullOrEmpty(supp_Col_Name1) ? row[supp_Col_Name1].ToString() : "";
                                                         string shade_Value_2 = !string.IsNullOrEmpty(supp_Col_Name2) ? row[supp_Col_Name2].ToString() : "";
                                                         string shade_Value_3 = !string.IsNullOrEmpty(supp_Col_Name3) ? row[supp_Col_Name3].ToString() : "";

                                                         finalRow[displayColName] = CoreService.ExtractStringWithLargestNumericValue(shade_Value_1, shade_Value_2, shade_Value_3);
                                                     }
                                                     else
                                                     {
                                                         finalRow[displayColName] = row[Convert.ToString(suppColRow["Supp_Col_Name"])];
                                                     }
                                                 }

                                                 if (displayColName == "CTS" || displayColName == "BASE_DISC" || displayColName == "BASE_RATE" ||
                                                     displayColName == "LENGTH" || displayColName == "WIDTH" || displayColName == "DEPTH" ||
                                                     displayColName == "DEPTH_PER" || displayColName == "TABLE_PER" || displayColName == "CROWN_ANGLE" ||
                                                     displayColName == "CROWN_HEIGHT" || displayColName == "PAVILION_ANGLE" ||
                                                     displayColName == "PAVILION_HEIGHT" || displayColName == "GIRDLE_PER" ||
                                                     displayColName == "SUPPLIER_DISC" || displayColName == "SUPPLIER_AMOUNT" ||
                                                     displayColName == "OFFER_DISC" || displayColName == "OFFER_VALUE" ||
                                                     displayColName == "MAX_SLAB_BASE_DISC" || displayColName == "MAX_SLAB_BASE_VALUE")
                                                 {
                                                     finalRow[displayColName] = CoreService.RemoveNonNumericAndDotAndNegativeCharacters(
                                                         Convert.ToString(finalRow[displayColName]));
                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "GIRDLE_TO")
                                                 {
                                                     finalRow[displayColName] = !string.IsNullOrEmpty(Convert.ToString(finalRow[displayColName])) ? (Convert.ToString(finalRow[displayColName]).Contains("-") ? (Convert.ToString(finalRow[displayColName]).Split(" - ").Length == 2 ? Convert.ToString(finalRow[displayColName]).Split(" - ")[1] : Convert.ToString(finalRow[displayColName])) : (Convert.ToString(finalRow[displayColName]).ToUpper().Contains(" TO ") ? (Convert.ToString(finalRow[displayColName]).ToUpper().Split(" TO ").Length == 2 ? Convert.ToString(finalRow[displayColName]).ToUpper().Split(" TO ")[1] : Convert.ToString(finalRow[displayColName])) : Convert.ToString(finalRow[displayColName]))) : null;

                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "BASE_AMOUNT")
                                                 {
                                                     var base_amt = !string.IsNullOrEmpty(finalRow[displayColName].ToString()) ? (finalRow[displayColName].ToString().Contains("$") ? Convert.ToDecimal(finalRow[displayColName].ToString().Replace("$", "")) : Convert.ToDecimal(finalRow[displayColName].ToString())) : 0;
                                                     finalRow[displayColName] = base_amt.ToString("0.00");
                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "DNA")
                                                 {
                                                     finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                        Convert.ToString(finalRow[displayColName]), false);
                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "IMAGE_LINK")
                                                 {
                                                     finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                        Convert.ToString(finalRow[displayColName]), false);
                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "VIDEO_LINK")
                                                 {
                                                     finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                        Convert.ToString(finalRow[displayColName]), false);
                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "LAB")
                                                 {
                                                     finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                        Convert.ToString(finalRow[displayColName]), true);
                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "CERTIFICATE_NO")
                                                 {
                                                     finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                        Convert.ToString(finalRow[displayColName]), true);
                                                 }
                                                 else if (!string.IsNullOrEmpty(displayColName) && displayColName == "CERTIFICATE_LINK")
                                                 {
                                                     finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                        Convert.ToString(finalRow[displayColName]), false);
                                                 }
                                                 else
                                                 {

                                                     finalRow[displayColName] = string.IsNullOrEmpty(Convert.ToString(finalRow[displayColName]))
                                                         ? null : Convert.ToString(finalRow[displayColName]);

                                                 }

                                                 if (Is_Split == true && Is_Sequence == true)
                                                 {
                                                     string col_Val = finalRow[displayColName] != null ? finalRow[displayColName].ToString() : "";
                                                     finalRow[displayColName] = CoreService.GetSupplierSplitSequenceVal(col_Val, Separator, Sequence);
                                                 }
                                             }
                                         });

                                         dt_stock_data.Rows.Add(finalRow);
                                         return finalRow;
                                     })
                                     .ToList();
                                    var party_master = await _partyService.Get_Party_Details(party_File.Party_Id ?? 0);
                                    var party_file = await _partyService.Get_Party_File(0, party_File.Party_Id ?? 0);
                                    dt_stock_data.AsEnumerable().ToList().ForEach(stockDataRow =>
                                    {
                                        //Start Center Inclusion AND Black Inclusion
                                        var lakhi_Party_Code = _configuration["Lakhi_Party_Code"];
                                        var table_white = string.Empty;
                                        var table_Black = string.Empty;
                                        var side_White = string.Empty;
                                        var side_Black = string.Empty;
                                        if (party_master != null && party_master.Party_Code == lakhi_Party_Code)
                                        {
                                            (table_white, _) = CoreService.Table_And_Side_White(Convert.ToString(stockDataRow["TABLE_WHITE"]));
                                            (_, side_White) = CoreService.Table_And_Side_White(Convert.ToString(stockDataRow["SIDE_WHITE"]));

                                            (table_Black, _) = CoreService.Table_And_Side_Black(Convert.ToString(stockDataRow["TABLE_BLACK"]));
                                            (_, side_Black) = CoreService.Table_And_Side_Black(Convert.ToString(stockDataRow["SIDE_BLACK"]));
                                        }
                                        else
                                        {
                                            table_white = Convert.ToString(stockDataRow["TABLE_WHITE"]);
                                            table_Black = Convert.ToString(stockDataRow["SIDE_WHITE"]);
                                            side_White = Convert.ToString(stockDataRow["TABLE_BLACK"]);
                                            side_Black = Convert.ToString(stockDataRow["SIDE_BLACK"]);
                                        }
                                        stockDataRow["TABLE_WHITE"] = table_white;
                                        stockDataRow["SIDE_WHITE"] = table_Black;
                                        stockDataRow["TABLE_BLACK"] = side_White;
                                        stockDataRow["SIDE_BLACK"] = side_Black;
                                        stockDataRow["Short_Code"] = party_file.Short_Code;
                                        //END Center Inclusion AND Black Inclusion

                                        // Check if all three columns are currently null or empty
                                        if ((string.IsNullOrEmpty(Convert.ToString(stockDataRow["LENGTH"]))
                                            && string.IsNullOrEmpty(Convert.ToString(stockDataRow["WIDTH"]))
                                            && string.IsNullOrEmpty(Convert.ToString(stockDataRow["DEPTH"]))))
                                        {
                                            string measurementValue = Convert.ToString(stockDataRow["MEASUREMENT"]).Replace("-", "*").Replace("x", "*");

                                            // Call the function and handle possible null values
                                            string lengthValue = CoreService.Split_Supplier_Stock_Measurement(measurementValue, "LENGTH");
                                            string widthValue = CoreService.Split_Supplier_Stock_Measurement(measurementValue, "WIDTH");
                                            string depthValue = CoreService.Split_Supplier_Stock_Measurement(measurementValue, "DEPTH");

                                            // Set the values in the DataRow, handling nulls or empty strings
                                            stockDataRow["LENGTH"] = !string.IsNullOrEmpty(lengthValue) ? lengthValue : stockDataRow["LENGTH"];
                                            stockDataRow["WIDTH"] = !string.IsNullOrEmpty(widthValue) ? widthValue : stockDataRow["WIDTH"];
                                            stockDataRow["DEPTH"] = !string.IsNullOrEmpty(depthValue) ? depthValue : stockDataRow["DEPTH"];
                                        }
                                    });

                                    Stock_Data_Master_Schedular stock_Data_Master_Schedular = new Stock_Data_Master_Schedular();
                                    stock_Data_Master_Schedular.Stock_Data_Id = 0;
                                    stock_Data_Master_Schedular.Supplier_Id = party_File.Party_Id;
                                    stock_Data_Master_Schedular.Upload_Method = "FILE";
                                    stock_Data_Master_Schedular.Upload_Type = "O";

                                    var (message, stock_Data_Id) = await _supplierService.Stock_Data_Custom_Insert_Update(stock_Data_Master_Schedular);

                                    if (message == "success" && stock_Data_Id > 0)
                                    {
                                        var response = await _supplierService.Stock_Data_Detail_Insert_Update(dt_stock_data, stock_Data_Id);
                                        if (response > 0)
                                        {
                                            if (stock_Data_Master_Schedular.Upload_Type == "O")
                                            {
                                                await _supplierService.Supplier_Stock_Manual_File_Insert_Update((int)stock_Data_Master_Schedular.Supplier_Id, stock_Data_Id, party_File.Is_Overwrite ?? false);
                                                string endTime = DateTime.Now.TimeOfDay.ToString(@"hh\:mm\:ss");

                                                Supplier_Stock_Update supplier_Stock_Update = new Supplier_Stock_Update()
                                                {
                                                    Supplier_Id = party_File.Party_Id ?? 0,
                                                    Stock_Data_Id = stock_Data_Id,
                                                    Start_Time = startTime,
                                                    End_Time = endTime
                                                };
                                                await _supplierService.Supplier_Stock_Start_End_Time_Update(supplier_Stock_Update);
                                            }
                                        }
                                        return Ok(new
                                        {
                                            statusCode = HttpStatusCode.OK,
                                            message = "File uploaded successfully.",
                                            Party_Name = party_name,
                                            Stock_Data_Id = stock_Data_Id
                                        });
                                    }
                                }
                            }
                        }
                        #endregion
                    }
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        Supplier_Id = party_File.Party_Id,
                        Party_Name = party_name,
                        message = "No column mapping found!"
                    });
                    //}
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                string message = string.Empty;
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Manual_Upload", ex.StackTrace);
                if (ex.Message.Contains("An item with the same key has already been added"))
                {
                    message = "Some column name is missing";
                }
                else
                {
                    message = "Either column or value mapping is wrong";
                }

                return Ok(new
                {
                    Supplier_Id = party_File.Party_Id,
                    Party_Name = party_name,
                    message = message,

                });
            }
        }
        */
        [HttpGet]
        [Route("check_api_ftp_exist")]
        [Authorize]
        public async Task<IActionResult> Check_Api_Ftp_Exist(int party_Id, bool is_Continue)
        {
            try
            {
                if (!is_Continue)
                {
                    var party_Api = await _partyService.Get_Party_API(0, party_Id);
                    var party_FTP = await _partyService.Get_Party_FTP(0, party_Id);
                    if (party_Api != null && party_Api.API_Status == true && party_Api.Lab == true)
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            api_Active = true,
                            message = "API is active for this supplier, Do you want to continue ?"
                        });
                    }
                    else if (party_FTP != null && party_FTP.Ftp_Status == true && party_FTP.Lab == true)
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            api_Active = true,
                            message = "FTP is active for this supplier, Do you want to continue ?"
                        });
                    }
                }
                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = "Continue"
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "check_api_ftp_exist", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Supplier Stock Error Log
        [HttpGet]
        [Route("supplier_stock_error_log")]
        [Authorize]
        public async Task<IActionResult> Supplier_Stock_Error_Log(string supplier_Ids, string upload_Type, string from_Date, string from_Time, string to_Date, string to_Time, bool is_Last_Entry, string stock_Type, string? supplierNo_CertNo)
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Stock_Error_Log(supplier_Ids, upload_Type, from_Date, from_Time, to_Date, to_Time, is_Last_Entry, stock_Type, supplierNo_CertNo);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Supplier_Stock_Error_Log", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("supplier_stock_error_log_detail")]
        [Authorize]
        public async Task<IActionResult> Supplier_Stock_Error_Log_Detail(string supplier_Ids, string stock_Data_Ids, string upload_Type, string? supplierNo_CertNo, string? stock_Type)
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Stock_Error_Log_Detail(supplier_Ids, stock_Data_Ids, upload_Type, supplierNo_CertNo, stock_Type);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Supplier_Stock_Error_Log_Detail", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("supplier_stock_file_error_error_log")]
        [Authorize]
        public async Task<IActionResult> Supplier_Stock_File_Error_Error_Log(int supplier_Id, int stock_Data_Id)
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Stock_File_Error_Log(supplier_Id, stock_Data_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Supplier_Stock_File_Error_Error_Log", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("supplier_stock_file_error_error_log_detail")]
        [Authorize]
        public async Task<IActionResult> Supplier_Stock_File_Error_Error_Log_Detail(int supplier_Id, string upload_Type)
        {
            try
            {
                var result = await _supplierService.Get_Supplier_Stock_File_Error_Log_Detail(supplier_Id, upload_Type);
                var party = await _partyService.Get_Party_Details(supplier_Id);
                if (result != null && result.Rows.Count > 0)
                {
                    var folderPath = Path.Combine(Directory.GetCurrentDirectory(), "Files/SupplierErrorLog");
                    if (!(Directory.Exists(folderPath)))
                    {
                        Directory.CreateDirectory(folderPath);
                    }

                    string strFile = party.Party_Name + "_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + ".xlsx";

                    using var package = new ExcelPackage();
                    var worksheet = package.Workbook.Worksheets.Add("Sheet1");
                    worksheet.Cells["A2"].LoadFromDataTable(result, true);

                    int rowEnd = worksheet.Dimension.End.Row;

                    string cellAdress = worksheet.Cells[1, 1, rowEnd, 100].Address;
                    EpExcelExport.removingGreenTagWarning(worksheet, cellAdress);

                    worksheet.Cells[2, 1, 2, result.Columns.Count].AutoFilter = true;

                    worksheet.Cells[2, 1, 2, result.Columns.Count].Style.Font.Bold = true;
                    worksheet.Cells[1, 1, 1, result.Columns.Count].Style.Font.Bold = true;

                    worksheet.Cells[worksheet.Dimension.Address].Style.Font.Size = 10;
                    worksheet.Cells[worksheet.Dimension.Address].Offset(1, 0, rowEnd - 1, 100).Style.Font.Size = 9;

                    worksheet.Cells[1, 1].Value = "Total";
                    worksheet.Cells[1, 3].Formula = $"SUBTOTAL(103, F3:F{rowEnd})";
                    worksheet.Cells[1, 3].Style.Numberformat.Format = "#,##";

                    worksheet.Cells[1, 6].Formula = $"SUBTOTAL(109,F3:F{rowEnd})";

                    byte[] byteArray = package.GetAsByteArray();
                    string filePath = Path.Combine(folderPath, strFile);

                    using (var fileStream = new FileStream(filePath, FileMode.Create))
                    {
                        await fileStream.WriteAsync(byteArray, 0, byteArray.Length);
                    }

                    var file_url = _configuration["BaseUrl"] + CoreCommonFilePath.SupplierErrorLogFilesPath + strFile;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = file_url
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Supplier_Stock_File_Error_Error_Log", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("supplier_stock_excel_error_log_detail")]
        [Authorize]
        public async Task<IActionResult> Supplier_Stock_Excel_Error_Log_Detail(Stock_Data_Master_Excel stock_Data_Master_Excel)
        {
            try
            {
                if (stock_Data_Master_Excel.Supplier_Stock_Data != null)
                {
                    IList<Supplier_Stock_Excel> Supplier_Stock_Excel = JsonConvert.DeserializeObject<IList<Supplier_Stock_Excel>>(stock_Data_Master_Excel.Supplier_Stock_Data.ToString());

                    DataTable dataTable = new DataTable();
                    dataTable = CoreService.ToDataTable(Supplier_Stock_Excel.ToArray());

                    var folderPath = Path.Combine(Directory.GetCurrentDirectory(), "Files/SupplierErrorLog");
                    if (!(Directory.Exists(folderPath)))
                    {
                        Directory.CreateDirectory(folderPath);
                    }
                    string strFile = "Error_Log_File_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + ".xlsx";

                    using var package = new ExcelPackage();
                    var worksheet = package.Workbook.Worksheets.Add("Sheet1");
                    worksheet.Cells["A2"].LoadFromDataTable(dataTable, true);

                    int rowEnd = worksheet.Dimension.End.Row;

                    worksheet.Cells[2, 1, 2, dataTable.Columns.Count].AutoFilter = true;

                    worksheet.Cells[2, 1, 2, dataTable.Columns.Count].Style.Font.Bold = true;
                    worksheet.Cells[1, 1, 1, dataTable.Columns.Count].Style.Font.Bold = true;

                    worksheet.Cells[worksheet.Dimension.Address].Style.Font.Size = 10;
                    worksheet.Cells[worksheet.Dimension.Address].Offset(1, 0, rowEnd - 1, 100).Style.Font.Size = 9;

                    worksheet.Cells[1, 1].Value = "Total";
                    worksheet.Cells[1, 3].Formula = $"SUBTOTAL(103, F3:F{rowEnd})";
                    worksheet.Cells[1, 3].Style.Numberformat.Format = "#,##";

                    worksheet.Cells[1, 6].Formula = $"SUBTOTAL(109,F3:F{rowEnd})";

                    string cellAdress = worksheet.Cells[1, 1, rowEnd, 100].Address;
                    EpExcelExport.removingGreenTagWarning(worksheet, cellAdress);

                    byte[] byteArray = package.GetAsByteArray();
                    string filePath = Path.Combine(folderPath, strFile);

                    using (var fileStream = new FileStream(filePath, FileMode.Create))
                    {
                        await fileStream.WriteAsync(byteArray, 0, byteArray.Length);
                    }

                    var file_url = _configuration["BaseUrl"] + CoreCommonFilePath.SupplierErrorLogFilesPath + strFile;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = file_url
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Supplier_Stock_Excel_Error_Log_Detail", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_data_transfer_log")]
        [Authorize]
        public async Task<IActionResult> Get_Data_Transfer_Log(string from_Date, string to_Date)
        {
            try
            {
                var result = await _supplierService.Get_Data_Transfer_Log(from_Date, to_Date);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Data_Transfer_Log", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Report
        [HttpPost]
        [Route("create_update_report_master")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Report_Master(Report_Master report_Master)
        {
            try
            {

                var (message, Report_Id) = await _supplierService.Create_Update_Report_Master(report_Master);
                if (message == "success" && Report_Id > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.ReportMasterCreated,
                        data = new { report_Id = Report_Id }
                    });
                }
                else if (message == "exist")
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ReportNameExist,
                    });
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Report_Master", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_report_detail")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Report_Detail(IList<Report_Detail> report_Detail)
        {
            try
            {
                if (report_Detail != null && report_Detail.Count > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("Rm_Id", typeof(int));
                    dataTable.Columns.Add("Column_Type", typeof(string));
                    dataTable.Columns.Add("Col_Id", typeof(int));
                    dataTable.Columns.Add("Order_By", typeof(string));
                    dataTable.Columns.Add("Short_No", typeof(int));
                    dataTable.Columns.Add("Display_Type", typeof(string));
                    dataTable.Columns.Add("Width", typeof(int));
                    dataTable.Columns.Add("Column_Format", typeof(string));
                    dataTable.Columns.Add("Alignment", typeof(string));
                    dataTable.Columns.Add("Fore_Colour", typeof(string));
                    dataTable.Columns.Add("Back_Colour", typeof(string));
                    dataTable.Columns.Add("IsBold", typeof(bool));
                    foreach (var item in report_Detail)
                    {
                        dataTable.Rows.Add(item.Id, item.Rm_Id, item.Column_Type, item.Col_Id, item.Order_By, item.Short_No, item.Display_Type, item.Width, item.Column_Format, item.Alignment, item.Fore_Colour, item.Back_Colour, item.IsBold);
                    }
                    var result = await _supplierService.Create_Update_Report_Detail(dataTable);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.ReportDetailCreated,
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Report_Detail", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_report_name")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Name(int id, int user_Id)
        {
            try
            {
                var result = await _supplierService.Get_Report_Name(id, user_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Name", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_report_detail")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Detail(int id)
        {
            try
            {
                var result = await _supplierService.Get_Report_Detail(id);
                if (result != null)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Detail", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_report_detail_filter_parameter")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Detail_Filter_Parameter(int id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _supplierService.Get_Report_Detail_Filter_Parameter(id, user_Id ?? 0);
                if (result != null)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Detail", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_report_users_role")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Users_Role(int id, int user_Id, string user_Type, bool? Is_Display)
        {
            try
            {
                var result = await _supplierService.Get_Report_Users_Role(id, user_Id, user_Type, Is_Display);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Users_Role", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_report_users_role_format_type")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Users_Role_Format_Type(int rm_id, int user_Id)
        {
            try
            {
                var result = await _supplierService.Get_Report_Users_Role_Format_Type(rm_id, user_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Users_Role_Format_Type", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_report_user_role")]
        [Authorize]
        public async Task<IActionResult> Delete_Report_User_Role(int id, int user_Id, string format_Type)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var result = await _supplierService.Delete_Report_User_Role(id, user_Id, format_Type);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.ReportRolesDeleted
                        });
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Report_User_Role", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("create_update_report_user_role")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Report_User_Role(Report_Users_Role_Model report_User_Roles)
        {
            try
            {
                if (report_User_Roles != null)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Rd_Id", typeof(int));
                    dataTable.Columns.Add("User_Id", typeof(int));
                    dataTable.Columns.Add("Display_Type", typeof(string));
                    dataTable.Columns.Add("Order_By", typeof(string));
                    dataTable.Columns.Add("Short_No", typeof(int));
                    dataTable.Columns.Add("Width", typeof(int));
                    dataTable.Columns.Add("Column_Format", typeof(string));
                    dataTable.Columns.Add("Alignment", typeof(string));
                    dataTable.Columns.Add("Fore_Colour", typeof(string));
                    dataTable.Columns.Add("Back_Colour", typeof(string));
                    dataTable.Columns.Add("IsBold", typeof(bool));

                    var UserIds = report_User_Roles.User_Ids.Split(",");

                    if (UserIds != null)
                    {
                        foreach (var item in UserIds)
                        {
                            foreach (var item1 in report_User_Roles.Report_Roles)
                            {
                                dataTable.Rows.Add(item1.Rd_Id, item, item1.Display_Type, item1.Order_By, item1.Short_No, item1.Width, item1.Column_Format, item1.Alignment, item1.Fore_Colour, item1.Back_Colour, item1.IsBold);
                            }
                        }
                        var result = await _supplierService.Create_Update_Report_User_Role(dataTable, report_User_Roles.User_Type);
                        if (result > 0)
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.ReportRoles,
                            });
                        }
                    }

                }
                return BadRequest(ModelState);

            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Report_User_Role", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_report_column_format")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Column_Format(int user_Id, int report_Id, string format_Type)
        {
            try
            {
                var result = await _supplierService.Get_Report_Column_Format(user_Id, report_Id, format_Type);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Column_Format", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_report_search")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Search(Report_Filter report_Filter)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? userId = _jWTAuthentication.Validate_Jwt_Token(token);

                if (!report_Filter.Report_Filter_Parameter.Any(x => x.Column_Name == "USER_ID"))
                {
                    report_Filter.Report_Filter_Parameter.Add(new Report_Filter_Parameter
                    {
                        Column_Name = "USER_ID",
                        Category_Value = userId.ToString()
                    });
                }

                var (result, totalRecordr, totalCtsr, totalAmtr, totalDiscr, totalBaseAmtr, totalBaseDiscr, totalOfferAmtr, totalOfferDiscr, dt_stock) = await _supplierService.Get_Report_Search(report_Filter.id, report_Filter.Report_Filter_Parameter, report_Filter.iPgNo ?? 0, report_Filter.iPgSize ?? 0, report_Filter.iSort, report_Filter.Is_Selected_Supp_Stock_Id, report_Filter.Act_Mod_Id);

                var report_Filter_Id = new HashSet<int> { 1, 2, 3, 4, 5, 6, 7 };

                if (result != null && result.Count > 0)
                {
                    if (report_Filter_Id.Contains(report_Filter.id))
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            total_Records = totalRecordr,
                            total_Cts = totalCtsr,
                            total_Amt = totalAmtr,
                            total_Disc = totalDiscr,
                            total_Base_Amt = totalBaseAmtr,
                            total_Base_Disc = totalBaseDiscr,
                            total_Offer_Amt = totalOfferAmtr,
                            total_Offer_Disc = totalOfferDiscr,
                            data = result
                        });
                    }
                    else
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result
                        });
                    }
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Search", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_lab_report_search")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Report_Search(Report_Lab_Filter report_Lab_Filter)
        {
            try
            {
                string STOCK_ID = string.Empty, SUPPLIER = string.Empty, CUSTOMER = string.Empty, SHAPE = string.Empty,
                        CTS = string.Empty, COLOR = string.Empty, CLARITY = string.Empty, CUT = string.Empty,
                        POLISH = string.Empty, SYMM = string.Empty, FLS_INTENSITY = string.Empty, BGM = string.Empty,
                        LAB = string.Empty, GOOD_TYPE = string.Empty, LOCATION = string.Empty, STATUS = string.Empty,
                        IMAGE_LINK = string.Empty, VIDEO_LINK = string.Empty, LENGTH = string.Empty, WIDTH = string.Empty,
                        DEPTH = string.Empty, TABLE_PER = string.Empty, DEPTH_PER = string.Empty, CROWN_ANGLE = string.Empty,
                        CROWN_HEIGHT = string.Empty, PAVILION_ANGLE = string.Empty, PAVILION_HEIGHT = string.Empty, GIRDLE_PER = string.Empty,
                        RAP_RATE = string.Empty, RAP_AMOUNT = string.Empty, COST_DISC = string.Empty, COST_AMOUNT = string.Empty,
                        OFFER_DISC = string.Empty, OFFER_VALUE = string.Empty, BASE_DISC = string.Empty, BASE_AMOUNT = string.Empty,
                        PRICE_PER_CTS = string.Empty, MAX_SLAB_BASE_DISC = string.Empty, MAX_SLAB_BASE_AMOUNT = string.Empty, MAX_SLAB_PRICE_PER_CTS = string.Empty,
                        BUYER_DISC = string.Empty, BUYER_AMOUNT = string.Empty, TABLE_BLACK = string.Empty, TABLE_WHITE = string.Empty, SIDE_BLACK = string.Empty, SIDE_WHITE = string.Empty,
                        TABLE_OPEN = string.Empty, CROWN_OPEN = string.Empty, PAVILION_OPEN = string.Empty,
                        GIRDLE_OPEN = string.Empty, CULET = string.Empty, KEY_TO_SYMBOL_TRUE = string.Empty,
                        KEY_TO_SYMBOL_FALSE = string.Empty, LAB_COMMENTS_TRUE = string.Empty, LAB_COMMENTS_FALSE = string.Empty,
                        FANCY_COLOR = string.Empty, FANCY_INTENSITY = string.Empty, FANCY_OVERTONE = string.Empty, POINTER = string.Empty, SUB_POINTER = string.Empty,
                        STAR_LN = string.Empty, LR_HALF = string.Empty, CERT_TYPE = string.Empty, COST_RATE = string.Empty, RATIO = string.Empty, DISCOUNT_TYPE = string.Empty,
                        SIGN = string.Empty, DISC_VALUE = string.Empty, DISC_VALUE1 = string.Empty, DISC_VALUE2 = string.Empty, DISC_VALUE3 = string.Empty, BASE_TYPE = string.Empty, SUPP_STOCK_ID = string.Empty,
                        BID_SUPP_STOCK_ID = string.Empty, BID_BUYER_DISC = string.Empty, BID_BUYER_AMOUNT = string.Empty,
                        LUSTER = string.Empty, SHADE = string.Empty, MILKY = string.Empty, GIRDLE_FROM = string.Empty, GIRDLE_TO = string.Empty, GIRDLE_CONDITION = string.Empty, ORIGIN = string.Empty,
                        EXTRA_FACET_TABLE = string.Empty, EXTRA_FACET_CROWN = string.Empty, EXTRA_FACET_PAV = string.Empty,
                        INTERNAL_GRAINING = string.Empty, H_A = string.Empty, SUPPLIER_COMMENTS = string.Empty;

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("SUPPLIER", typeof(string));
                dataTable.Columns.Add("CUSTOMER", typeof(string));
                dataTable.Columns.Add("SHAPE", typeof(string));
                dataTable.Columns.Add("CTS", typeof(string));
                dataTable.Columns.Add("COLOR", typeof(string));
                dataTable.Columns.Add("CLARITY", typeof(string));
                dataTable.Columns.Add("CUT", typeof(string));
                dataTable.Columns.Add("POLISH", typeof(string));
                dataTable.Columns.Add("SYMM", typeof(string));
                dataTable.Columns.Add("FLS_INTENSITY", typeof(string));
                dataTable.Columns.Add("BGM", typeof(string));
                dataTable.Columns.Add("LAB", typeof(string));
                dataTable.Columns.Add("GOOD_TYPE", typeof(string));
                dataTable.Columns.Add("LOCATION", typeof(string));
                dataTable.Columns.Add("STATUS", typeof(string));
                dataTable.Columns.Add("IMAGE_LINK", typeof(string));
                dataTable.Columns.Add("VIDEO_LINK", typeof(string));
                dataTable.Columns.Add("LENGTH", typeof(string));
                dataTable.Columns.Add("WIDTH", typeof(string));
                dataTable.Columns.Add("DEPTH", typeof(string));
                dataTable.Columns.Add("TABLE_PER", typeof(string));
                dataTable.Columns.Add("DEPTH_PER", typeof(string));
                dataTable.Columns.Add("CROWN_ANGLE", typeof(string));
                dataTable.Columns.Add("CROWN_HEIGHT", typeof(string));
                dataTable.Columns.Add("PAVILION_ANGLE", typeof(string));
                dataTable.Columns.Add("PAVILION_HEIGHT", typeof(string));
                dataTable.Columns.Add("GIRDLE_PER", typeof(string));
                dataTable.Columns.Add("RAP_RATE", typeof(string));
                dataTable.Columns.Add("RAP_AMOUNT", typeof(string));
                dataTable.Columns.Add("COST_DISC", typeof(string));
                dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable.Columns.Add("BASE_DISC", typeof(string));
                dataTable.Columns.Add("BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BUYER AMOUNT", typeof(string));
                dataTable.Columns.Add("TABLE_BLACK", typeof(string));
                dataTable.Columns.Add("TABLE_WHITE", typeof(string));
                dataTable.Columns.Add("SIDE_BLACK", typeof(string));
                dataTable.Columns.Add("SIDE_WHITE", typeof(string));
                dataTable.Columns.Add("TABLE_OPEN", typeof(string));
                dataTable.Columns.Add("CROWN_OPEN", typeof(string));
                dataTable.Columns.Add("PAVILION_OPEN", typeof(string));
                dataTable.Columns.Add("GIRDLE_OPEN", typeof(string));
                dataTable.Columns.Add("CULET", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_TRUE", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_FALSE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_TRUE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_FALSE", typeof(string));
                dataTable.Columns.Add("FANCY_COLOR", typeof(string));
                dataTable.Columns.Add("FANCY_INTENSITY", typeof(string));
                dataTable.Columns.Add("FANCY_OVERTONE", typeof(string));
                dataTable.Columns.Add("POINTER", typeof(string));
                dataTable.Columns.Add("SUB_POINTER", typeof(string));
                dataTable.Columns.Add("STAR_LN", typeof(string));
                dataTable.Columns.Add("LR_HALF", typeof(string));
                dataTable.Columns.Add("CERT_TYPE", typeof(string));
                dataTable.Columns.Add("COST_RATE", typeof(string));
                dataTable.Columns.Add("RATIO", typeof(string));
                dataTable.Columns.Add("DISCOUNT_TYPE", typeof(string));
                dataTable.Columns.Add("SIGN", typeof(string));
                dataTable.Columns.Add("DISC_VALUE", typeof(string));
                dataTable.Columns.Add("DISC_VALUE1", typeof(string));
                dataTable.Columns.Add("DISC_VALUE2", typeof(string));
                dataTable.Columns.Add("DISC_VALUE3", typeof(string));
                dataTable.Columns.Add("BASE_TYPE", typeof(string));
                dataTable.Columns.Add("SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BID_BUYER_AMOUNT", typeof(string));
                dataTable.Columns.Add("LUSTER", typeof(string));
                dataTable.Columns.Add("SHADE", typeof(string));
                dataTable.Columns.Add("MILKY", typeof(string));
                dataTable.Columns.Add("GIRDLE_FROM", typeof(string));
                dataTable.Columns.Add("GIRDLE_TO", typeof(string));
                dataTable.Columns.Add("GIRDLE_CONDITION", typeof(string));
                dataTable.Columns.Add("ORIGIN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_PAV", typeof(string));
                dataTable.Columns.Add("INTERNAL_GRAINING", typeof(string));
                dataTable.Columns.Add("H_A", typeof(string));
                dataTable.Columns.Add("SUPPLIER_COMMENTS", typeof(string));

                if (report_Lab_Filter.Report_Filter_Parameter_List != null && report_Lab_Filter.Report_Filter_Parameter_List.Count > 0)
                {
                    foreach (var item in report_Lab_Filter.Report_Filter_Parameter_List)
                    {
                        STOCK_ID = item.Where(x => x.Column_Name == "STOCK ID" || x.Column_Name == "CERTIFICATE NO" || x.Column_Name == "SUPPLIER NO").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER = item.Where(x => x.Column_Name == "SUPPLIER" || x.Column_Name == "COMPANY").Select(x => x.Category_Value).FirstOrDefault();
                        CUSTOMER = item.Where(x => x.Column_Name == "CUSTOMER").Select(x => x.Category_Value).FirstOrDefault();
                        SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Value).FirstOrDefault();
                        CTS = item.Where(x => x.Column_Name == "CTS").Select(x => x.Category_Value).FirstOrDefault();
                        COLOR = item.Where(x => x.Column_Name == "COLOR").Select(x => x.Category_Value).FirstOrDefault();
                        CLARITY = item.Where(x => x.Column_Name == "CLARITY").Select(x => x.Category_Value).FirstOrDefault();
                        CUT = item.Where(x => x.Column_Name == "CUT").Select(x => x.Category_Value).FirstOrDefault();
                        POLISH = item.Where(x => x.Column_Name == "POLISH").Select(x => x.Category_Value).FirstOrDefault();
                        SYMM = item.Where(x => x.Column_Name == "SYMM").Select(x => x.Category_Value).FirstOrDefault();
                        FLS_INTENSITY = item.Where(x => x.Column_Name == "FLS INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                        BGM = item.Where(x => x.Column_Name == "BGM").Select(x => x.Category_Value).FirstOrDefault();
                        LAB = item.Where(x => x.Column_Name == "LAB").Select(x => x.Category_Value).FirstOrDefault();
                        GOOD_TYPE = item.Where(x => x.Column_Name == "GOOD TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        LOCATION = item.Where(x => x.Column_Name == "LOCATION").Select(x => x.Category_Value).FirstOrDefault();
                        STATUS = item.Where(x => x.Column_Name == "STATUS").Select(x => x.Category_Value).FirstOrDefault();
                        IMAGE_LINK = item.Where(x => x.Column_Name == "IMAGE LINK").Select(x => x.Category_Value).FirstOrDefault();
                        VIDEO_LINK = item.Where(x => x.Column_Name == "VIDEO LINK").Select(x => x.Category_Value).FirstOrDefault();
                        LENGTH = item.Where(x => x.Column_Name == "LENGTH").Select(x => x.Category_Value).FirstOrDefault();
                        WIDTH = item.Where(x => x.Column_Name == "WIDTH").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH = item.Where(x => x.Column_Name == "DEPTH").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_PER = item.Where(x => x.Column_Name == "TABLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH_PER = item.Where(x => x.Column_Name == "DEPTH PER").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_ANGLE = item.Where(x => x.Column_Name == "CROWN ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_HEIGHT = item.Where(x => x.Column_Name == "CROWN HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_ANGLE = item.Where(x => x.Column_Name == "PAVILION ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_HEIGHT = item.Where(x => x.Column_Name == "PAVILION HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_PER = item.Where(x => x.Column_Name == "GIRDLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        RAP_RATE = item.Where(x => x.Column_Name == "RAP RATE").Select(x => x.Category_Value).FirstOrDefault();
                        RAP_AMOUNT = item.Where(x => x.Column_Name == "RAP AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        COST_DISC = item.Where(x => x.Column_Name == "COST DISC").Select(x => x.Category_Value).FirstOrDefault();
                        COST_AMOUNT = item.Where(x => x.Column_Name == "COST AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_DISC = item.Where(x => x.Column_Name == "OFFER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_VALUE = item.Where(x => x.Column_Name == "OFFER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_DISC = item.Where(x => x.Column_Name == "BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_AMOUNT = item.Where(x => x.Column_Name == "BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        PRICE_PER_CTS = item.Where(x => x.Column_Name == "PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_BASE_DISC = item.Where(x => x.Column_Name == "MAX SLAB BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_BASE_AMOUNT = item.Where(x => x.Column_Name == "MAX SLAB BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_PRICE_PER_CTS = item.Where(x => x.Column_Name == "MAX SLAB PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        BUYER_DISC = item.Where(x => x.Column_Name == "BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BUYER_AMOUNT = item.Where(x => x.Column_Name == "BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_BLACK = item.Where(x => x.Column_Name == "TABLE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_WHITE = item.Where(x => x.Column_Name == "TABLE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                        SIDE_BLACK = item.Where(x => x.Column_Name == "SIDE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                        SIDE_WHITE = item.Where(x => x.Column_Name == "SIDE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_OPEN = item.Where(x => x.Column_Name == "TABLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_OPEN = item.Where(x => x.Column_Name == "CROWN OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_OPEN = item.Where(x => x.Column_Name == "PAVILION OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_OPEN = item.Where(x => x.Column_Name == "GIRDLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        CULET = item.Where(x => x.Column_Name == "CULET").Select(x => x.Category_Value).FirstOrDefault();
                        KEY_TO_SYMBOL_TRUE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_TRUE).FirstOrDefault();
                        KEY_TO_SYMBOL_FALSE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_FALSE).FirstOrDefault();
                        LAB_COMMENTS_TRUE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_TRUE).FirstOrDefault();
                        LAB_COMMENTS_FALSE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_FALSE).FirstOrDefault();
                        FANCY_COLOR = item.Where(x => x.Column_Name == "FANCY COLOR").Select(x => x.Category_Value).FirstOrDefault();
                        FANCY_INTENSITY = item.Where(x => x.Column_Name == "FANCY INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                        FANCY_OVERTONE = item.Where(x => x.Column_Name == "FANCY OVERTONE").Select(x => x.Category_Value).FirstOrDefault();
                        POINTER = item.Where(x => x.Column_Name == "POINTER").Select(x => x.Category_Value).FirstOrDefault();
                        SUB_POINTER = item.Where(x => x.Column_Name == "SUB POINTER").Select(x => x.Category_Value).FirstOrDefault();
                        STAR_LN = item.Where(x => x.Column_Name == "STAR LN").Select(x => x.Category_Value).FirstOrDefault();
                        LR_HALF = item.Where(x => x.Column_Name == "LR HALF").Select(x => x.Category_Value).FirstOrDefault();
                        CERT_TYPE = item.Where(x => x.Column_Name == "CERT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        COST_RATE = item.Where(x => x.Column_Name == "COST RATE").Select(x => x.Category_Value).FirstOrDefault();
                        RATIO = item.Where(x => x.Column_Name == "RATIO").Select(x => x.Category_Value).FirstOrDefault();
                        DISCOUNT_TYPE = item.Where(x => x.Column_Name == "DISCOUNT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SIGN = item.Where(x => x.Column_Name == "SIGN").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE = item.Where(x => x.Column_Name == "DISC VALUE").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE1 = item.Where(x => x.Column_Name == "DISC VALUE1").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE2 = item.Where(x => x.Column_Name == "DISC VALUE2").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE3 = item.Where(x => x.Column_Name == "DISC VALUE3").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_TYPE = item.Where(x => x.Column_Name == "BASE TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SUPP_STOCK_ID = item.Where(x => x.Column_Name == "SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        BID_SUPP_STOCK_ID = item.Where(x => x.Column_Name == "BID SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        BID_BUYER_DISC = item.Where(x => x.Column_Name == "BID BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BID_BUYER_AMOUNT = item.Where(x => x.Column_Name == "BID BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        LUSTER = item.Where(x => x.Column_Name == "LUSTER").Select(x => x.Category_Value).FirstOrDefault();
                        SHADE = item.Where(x => x.Column_Name == "SHADE").Select(x => x.Category_Value).FirstOrDefault();
                        MILKY = item.Where(x => x.Column_Name == "MILKY").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_FROM = item.Where(x => x.Column_Name == "GIRDLE_FROM").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_TO = item.Where(x => x.Column_Name == "GIRDLE_TO").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_CONDITION = item.Where(x => x.Column_Name == "GIRDLE_CONDITION").Select(x => x.Category_Value).FirstOrDefault();
                        ORIGIN = item.Where(x => x.Column_Name == "ORIGIN").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_TABLE = item.Where(x => x.Column_Name == "EXTRA_FACET_TABLE").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_CROWN = item.Where(x => x.Column_Name == "EXTRA_FACET_CROWN").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_PAV = item.Where(x => x.Column_Name == "EXTRA_FACET_PAV").Select(x => x.Category_Value).FirstOrDefault();
                        INTERNAL_GRAINING = item.Where(x => x.Column_Name == "INTERNAL_GRAINING").Select(x => x.Category_Value).FirstOrDefault();
                        H_A = item.Where(x => x.Column_Name == "H_A").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER_COMMENTS = item.Where(x => x.Column_Name == "SUPPLIER_COMMENTS").Select(x => x.Category_Value).FirstOrDefault();

                        dataTable.Rows.Add(!string.IsNullOrEmpty(STOCK_ID) ? STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(SUPPLIER) ? SUPPLIER : DBNull.Value,
                            !string.IsNullOrEmpty(CUSTOMER) ? CUSTOMER : DBNull.Value,
                            !string.IsNullOrEmpty(SHAPE) ? SHAPE : DBNull.Value,
                            !string.IsNullOrEmpty(CTS) ? CTS : DBNull.Value,
                            !string.IsNullOrEmpty(COLOR) ? COLOR : DBNull.Value,
                            !string.IsNullOrEmpty(CLARITY) ? CLARITY : DBNull.Value,
                            !string.IsNullOrEmpty(CUT) ? CUT : DBNull.Value,
                            !string.IsNullOrEmpty(POLISH) ? POLISH : DBNull.Value,
                            !string.IsNullOrEmpty(SYMM) ? SYMM : DBNull.Value,
                            !string.IsNullOrEmpty(FLS_INTENSITY) ? FLS_INTENSITY : DBNull.Value,
                            !string.IsNullOrEmpty(BGM) ? BGM : DBNull.Value,
                            !string.IsNullOrEmpty(LAB) ? LAB : DBNull.Value,
                            !string.IsNullOrEmpty(GOOD_TYPE) ? GOOD_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(LOCATION) ? LOCATION : DBNull.Value,
                            !string.IsNullOrEmpty(STATUS) ? STATUS : DBNull.Value,
                            !string.IsNullOrEmpty(IMAGE_LINK) ? IMAGE_LINK : DBNull.Value,
                            !string.IsNullOrEmpty(VIDEO_LINK) ? VIDEO_LINK : DBNull.Value,
                            !string.IsNullOrEmpty(LENGTH) ? LENGTH : DBNull.Value,
                            !string.IsNullOrEmpty(WIDTH) ? WIDTH : DBNull.Value,
                            !string.IsNullOrEmpty(DEPTH) ? DEPTH : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_PER) ? TABLE_PER : DBNull.Value,
                            !string.IsNullOrEmpty(DEPTH_PER) ? DEPTH_PER : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_ANGLE) ? CROWN_ANGLE : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_HEIGHT) ? CROWN_HEIGHT : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_ANGLE) ? PAVILION_ANGLE : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_HEIGHT) ? PAVILION_HEIGHT : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_PER) ? GIRDLE_PER : DBNull.Value,
                            !string.IsNullOrEmpty(RAP_RATE) ? RAP_RATE : DBNull.Value,
                            !string.IsNullOrEmpty(RAP_AMOUNT) ? RAP_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(COST_DISC) ? COST_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(COST_AMOUNT) ? COST_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(OFFER_DISC) ? OFFER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(OFFER_VALUE) ? OFFER_VALUE : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_DISC) ? BASE_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_AMOUNT) ? BASE_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(PRICE_PER_CTS) ? PRICE_PER_CTS : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_BASE_DISC) ? MAX_SLAB_BASE_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_BASE_AMOUNT) ? MAX_SLAB_BASE_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_PRICE_PER_CTS) ? MAX_SLAB_PRICE_PER_CTS : DBNull.Value,
                            !string.IsNullOrEmpty(BUYER_DISC) ? BUYER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BUYER_AMOUNT) ? BUYER_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_BLACK) ? TABLE_BLACK : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_WHITE) ? TABLE_WHITE : DBNull.Value,
                            !string.IsNullOrEmpty(SIDE_BLACK) ? SIDE_BLACK : DBNull.Value,
                            !string.IsNullOrEmpty(SIDE_WHITE) ? SIDE_WHITE : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_OPEN) ? TABLE_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_OPEN) ? CROWN_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_OPEN) ? PAVILION_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_OPEN) ? GIRDLE_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(CULET) ? CULET : DBNull.Value,
                            !string.IsNullOrEmpty(KEY_TO_SYMBOL_TRUE) ? KEY_TO_SYMBOL_TRUE : DBNull.Value,
                            !string.IsNullOrEmpty(KEY_TO_SYMBOL_FALSE) ? KEY_TO_SYMBOL_FALSE : DBNull.Value,
                            !string.IsNullOrEmpty(LAB_COMMENTS_TRUE) ? LAB_COMMENTS_TRUE : DBNull.Value,
                            !string.IsNullOrEmpty(LAB_COMMENTS_FALSE) ? LAB_COMMENTS_FALSE : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_COLOR) ? FANCY_COLOR : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_INTENSITY) ? FANCY_INTENSITY : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_OVERTONE) ? FANCY_OVERTONE : DBNull.Value,
                            !string.IsNullOrEmpty(POINTER) ? POINTER : DBNull.Value,
                            !string.IsNullOrEmpty(SUB_POINTER) ? SUB_POINTER : DBNull.Value,
                            !string.IsNullOrEmpty(STAR_LN) ? STAR_LN : DBNull.Value,
                            !string.IsNullOrEmpty(LR_HALF) ? LR_HALF : DBNull.Value,
                            !string.IsNullOrEmpty(CERT_TYPE) ? CERT_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(COST_RATE) ? COST_RATE : DBNull.Value,
                            !string.IsNullOrEmpty(RATIO) ? RATIO : DBNull.Value,
                            !string.IsNullOrEmpty(DISCOUNT_TYPE) ? DISCOUNT_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(SIGN) ? SIGN : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE) ? DISC_VALUE : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE1) ? DISC_VALUE1 : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE2) ? DISC_VALUE2 : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE3) ? DISC_VALUE3 : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_TYPE) ? BASE_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(SUPP_STOCK_ID) ? SUPP_STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(BID_SUPP_STOCK_ID) ? BID_SUPP_STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(BID_BUYER_DISC) ? BID_BUYER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BID_BUYER_AMOUNT) ? BID_BUYER_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(LUSTER) ? LUSTER : DBNull.Value,
                            !string.IsNullOrEmpty(SHADE) ? SHADE : DBNull.Value,
                            !string.IsNullOrEmpty(MILKY) ? MILKY : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_FROM) ? GIRDLE_FROM : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_TO) ? GIRDLE_TO : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_CONDITION) ? GIRDLE_CONDITION : DBNull.Value,
                            !string.IsNullOrEmpty(ORIGIN) ? ORIGIN : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_TABLE) ? EXTRA_FACET_TABLE : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_CROWN) ? EXTRA_FACET_CROWN : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_PAV) ? EXTRA_FACET_PAV : DBNull.Value,
                            !string.IsNullOrEmpty(INTERNAL_GRAINING) ? INTERNAL_GRAINING : DBNull.Value,
                            !string.IsNullOrEmpty(H_A) ? H_A : DBNull.Value,
                            !string.IsNullOrEmpty(SUPPLIER_COMMENTS) ? SUPPLIER_COMMENTS : DBNull.Value);
                    }
                }
                else
                {
                    DataRow newRow = dataTable.NewRow();
                    for (int i = 0; i < dataTable.Columns.Count; i++)
                    {
                        newRow[i] = DBNull.Value;
                    }
                    dataTable.Rows.Add(newRow);
                }
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var (result, totalRecordr, totalCtsr, totalAmtr, totalDiscr, totalBaseDisc, totalBaseAmt, totalOfferDisc, totalOfferAmt, totalMaxSlabDisc, totalMaxSlabAmt) = await _supplierService.Get_Lab_Search_Report_Search(dataTable, report_Lab_Filter.iPgNo ?? 0, report_Lab_Filter.iPgSize ?? 0, report_Lab_Filter.iSort, user_Id, report_Lab_Filter.Is_Selected_Supp_Stock_Id, report_Lab_Filter.User_Format);
                if (result != null)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        total_Records = totalRecordr,
                        total_Cts = totalCtsr,
                        total_Amt = totalAmtr,
                        total_Disc = totalDiscr,
                        total_Base_Disc = totalBaseDisc,
                        total_Base_Amt = totalBaseAmt,
                        total_Offer_Disc = totalOfferDisc,
                        total_Offer_Amt = totalOfferAmt,
                        total_MaxSlab_Disc = totalMaxSlabDisc,
                        total_MaxSlab_Amt = totalMaxSlabAmt,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Report_Search", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("get_lab_distinct_report_search")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Distinct_Report_Search(Report_Lab_Filter report_Lab_Filter)
        {
            try
            {
                string STOCK_ID = string.Empty, SUPPLIER = string.Empty, CUSTOMER = string.Empty, SHAPE = string.Empty,
                        CTS = string.Empty, COLOR = string.Empty, CLARITY = string.Empty, CUT = string.Empty,
                        POLISH = string.Empty, SYMM = string.Empty, FLS_INTENSITY = string.Empty, BGM = string.Empty,
                        LAB = string.Empty, GOOD_TYPE = string.Empty, LOCATION = string.Empty, STATUS = string.Empty,
                        IMAGE_LINK = string.Empty, VIDEO_LINK = string.Empty, LENGTH = string.Empty, WIDTH = string.Empty,
                        DEPTH = string.Empty, TABLE_PER = string.Empty, DEPTH_PER = string.Empty, CROWN_ANGLE = string.Empty,
                        CROWN_HEIGHT = string.Empty, PAVILION_ANGLE = string.Empty, PAVILION_HEIGHT = string.Empty, GIRDLE_PER = string.Empty,
                        RAP_RATE = string.Empty, RAP_AMOUNT = string.Empty, COST_DISC = string.Empty, COST_AMOUNT = string.Empty,
                        OFFER_DISC = string.Empty, OFFER_VALUE = string.Empty, BASE_DISC = string.Empty, BASE_AMOUNT = string.Empty,
                        PRICE_PER_CTS = string.Empty, MAX_SLAB_BASE_DISC = string.Empty, MAX_SLAB_BASE_AMOUNT = string.Empty, MAX_SLAB_PRICE_PER_CTS = string.Empty,
                        BUYER_DISC = string.Empty, BUYER_AMOUNT = string.Empty, TABLE_BLACK = string.Empty, TABLE_WHITE = string.Empty, SIDE_BLACK = string.Empty, SIDE_WHITE = string.Empty,
                        TABLE_OPEN = string.Empty, CROWN_OPEN = string.Empty, PAVILION_OPEN = string.Empty,
                        GIRDLE_OPEN = string.Empty, CULET = string.Empty, KEY_TO_SYMBOL_TRUE = string.Empty,
                        KEY_TO_SYMBOL_FALSE = string.Empty, LAB_COMMENTS_TRUE = string.Empty, LAB_COMMENTS_FALSE = string.Empty,
                        FANCY_COLOR = string.Empty, FANCY_INTENSITY = string.Empty, FANCY_OVERTONE = string.Empty, POINTER = string.Empty, SUB_POINTER = string.Empty,
                        STAR_LN = string.Empty, LR_HALF = string.Empty, CERT_TYPE = string.Empty, COST_RATE = string.Empty, RATIO = string.Empty, DISCOUNT_TYPE = string.Empty,
                        SIGN = string.Empty, DISC_VALUE = string.Empty, DISC_VALUE1 = string.Empty, DISC_VALUE2 = string.Empty, DISC_VALUE3 = string.Empty, BASE_TYPE = string.Empty, SUPP_STOCK_ID = string.Empty,
                        BID_SUPP_STOCK_ID = string.Empty, BID_BUYER_DISC = string.Empty, BID_BUYER_AMOUNT = string.Empty,
                        LUSTER = string.Empty, SHADE = string.Empty, MILKY = string.Empty, GIRDLE_FROM = string.Empty, GIRDLE_TO = string.Empty, GIRDLE_CONDITION = string.Empty, ORIGIN = string.Empty,
                        EXTRA_FACET_TABLE = string.Empty, EXTRA_FACET_CROWN = string.Empty, EXTRA_FACET_PAV = string.Empty,
                        INTERNAL_GRAINING = string.Empty, H_A = string.Empty, SUPPLIER_COMMENTS = string.Empty;

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("SUPPLIER", typeof(string));
                dataTable.Columns.Add("CUSTOMER", typeof(string));
                dataTable.Columns.Add("SHAPE", typeof(string));
                dataTable.Columns.Add("CTS", typeof(string));
                dataTable.Columns.Add("COLOR", typeof(string));
                dataTable.Columns.Add("CLARITY", typeof(string));
                dataTable.Columns.Add("CUT", typeof(string));
                dataTable.Columns.Add("POLISH", typeof(string));
                dataTable.Columns.Add("SYMM", typeof(string));
                dataTable.Columns.Add("FLS_INTENSITY", typeof(string));
                dataTable.Columns.Add("BGM", typeof(string));
                dataTable.Columns.Add("LAB", typeof(string));
                dataTable.Columns.Add("GOOD_TYPE", typeof(string));
                dataTable.Columns.Add("LOCATION", typeof(string));
                dataTable.Columns.Add("STATUS", typeof(string));
                dataTable.Columns.Add("IMAGE_LINK", typeof(string));
                dataTable.Columns.Add("VIDEO_LINK", typeof(string));
                dataTable.Columns.Add("LENGTH", typeof(string));
                dataTable.Columns.Add("WIDTH", typeof(string));
                dataTable.Columns.Add("DEPTH", typeof(string));
                dataTable.Columns.Add("TABLE_PER", typeof(string));
                dataTable.Columns.Add("DEPTH_PER", typeof(string));
                dataTable.Columns.Add("CROWN_ANGLE", typeof(string));
                dataTable.Columns.Add("CROWN_HEIGHT", typeof(string));
                dataTable.Columns.Add("PAVILION_ANGLE", typeof(string));
                dataTable.Columns.Add("PAVILION_HEIGHT", typeof(string));
                dataTable.Columns.Add("GIRDLE_PER", typeof(string));
                dataTable.Columns.Add("RAP_RATE", typeof(string));
                dataTable.Columns.Add("RAP_AMOUNT", typeof(string));
                dataTable.Columns.Add("COST_DISC", typeof(string));
                dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable.Columns.Add("BASE_DISC", typeof(string));
                dataTable.Columns.Add("BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BUYER AMOUNT", typeof(string));
                dataTable.Columns.Add("TABLE_BLACK", typeof(string));
                dataTable.Columns.Add("TABLE_WHITE", typeof(string));
                dataTable.Columns.Add("SIDE_BLACK", typeof(string));
                dataTable.Columns.Add("SIDE_WHITE", typeof(string));
                dataTable.Columns.Add("TABLE_OPEN", typeof(string));
                dataTable.Columns.Add("CROWN_OPEN", typeof(string));
                dataTable.Columns.Add("PAVILION_OPEN", typeof(string));
                dataTable.Columns.Add("GIRDLE_OPEN", typeof(string));
                dataTable.Columns.Add("CULET", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_TRUE", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_FALSE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_TRUE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_FALSE", typeof(string));
                dataTable.Columns.Add("FANCY_COLOR", typeof(string));
                dataTable.Columns.Add("FANCY_INTENSITY", typeof(string));
                dataTable.Columns.Add("FANCY_OVERTONE", typeof(string));
                dataTable.Columns.Add("POINTER", typeof(string));
                dataTable.Columns.Add("SUB_POINTER", typeof(string));
                dataTable.Columns.Add("STAR_LN", typeof(string));
                dataTable.Columns.Add("LR_HALF", typeof(string));
                dataTable.Columns.Add("CERT_TYPE", typeof(string));
                dataTable.Columns.Add("COST_RATE", typeof(string));
                dataTable.Columns.Add("RATIO", typeof(string));
                dataTable.Columns.Add("DISCOUNT_TYPE", typeof(string));
                dataTable.Columns.Add("SIGN", typeof(string));
                dataTable.Columns.Add("DISC_VALUE", typeof(string));
                dataTable.Columns.Add("DISC_VALUE1", typeof(string));
                dataTable.Columns.Add("DISC_VALUE2", typeof(string));
                dataTable.Columns.Add("DISC_VALUE3", typeof(string));
                dataTable.Columns.Add("BASE_TYPE", typeof(string));
                dataTable.Columns.Add("SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BID_BUYER_AMOUNT", typeof(string));
                dataTable.Columns.Add("LUSTER", typeof(string));
                dataTable.Columns.Add("SHADE", typeof(string));
                dataTable.Columns.Add("MILKY", typeof(string));
                dataTable.Columns.Add("GIRDLE_FROM", typeof(string));
                dataTable.Columns.Add("GIRDLE_TO", typeof(string));
                dataTable.Columns.Add("GIRDLE_CONDITION", typeof(string));
                dataTable.Columns.Add("ORIGIN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_PAV", typeof(string));
                dataTable.Columns.Add("INTERNAL_GRAINING", typeof(string));
                dataTable.Columns.Add("H_A", typeof(string));
                dataTable.Columns.Add("SUPPLIER_COMMENTS", typeof(string));

                if (report_Lab_Filter.Report_Filter_Parameter_List != null && report_Lab_Filter.Report_Filter_Parameter_List.Count > 0)
                {
                    foreach (var item in report_Lab_Filter.Report_Filter_Parameter_List)
                    {
                        STOCK_ID = item.Where(x => x.Column_Name == "STOCK ID" || x.Column_Name == "CERTIFICATE NO" || x.Column_Name == "SUPPLIER NO").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER = item.Where(x => x.Column_Name == "SUPPLIER" || x.Column_Name == "COMPANY").Select(x => x.Category_Value).FirstOrDefault();
                        CUSTOMER = item.Where(x => x.Column_Name == "CUSTOMER").Select(x => x.Category_Value).FirstOrDefault();
                        SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Value).FirstOrDefault();
                        CTS = item.Where(x => x.Column_Name == "CTS").Select(x => x.Category_Value).FirstOrDefault();
                        COLOR = item.Where(x => x.Column_Name == "COLOR").Select(x => x.Category_Value).FirstOrDefault();
                        CLARITY = item.Where(x => x.Column_Name == "CLARITY").Select(x => x.Category_Value).FirstOrDefault();
                        CUT = item.Where(x => x.Column_Name == "CUT").Select(x => x.Category_Value).FirstOrDefault();
                        POLISH = item.Where(x => x.Column_Name == "POLISH").Select(x => x.Category_Value).FirstOrDefault();
                        SYMM = item.Where(x => x.Column_Name == "SYMM").Select(x => x.Category_Value).FirstOrDefault();
                        FLS_INTENSITY = item.Where(x => x.Column_Name == "FLS INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                        BGM = item.Where(x => x.Column_Name == "BGM").Select(x => x.Category_Value).FirstOrDefault();
                        LAB = item.Where(x => x.Column_Name == "LAB").Select(x => x.Category_Value).FirstOrDefault();
                        GOOD_TYPE = item.Where(x => x.Column_Name == "GOOD TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        LOCATION = item.Where(x => x.Column_Name == "LOCATION").Select(x => x.Category_Value).FirstOrDefault();
                        STATUS = item.Where(x => x.Column_Name == "STATUS").Select(x => x.Category_Value).FirstOrDefault();
                        IMAGE_LINK = item.Where(x => x.Column_Name == "IMAGE LINK").Select(x => x.Category_Value).FirstOrDefault();
                        VIDEO_LINK = item.Where(x => x.Column_Name == "VIDEO LINK").Select(x => x.Category_Value).FirstOrDefault();
                        LENGTH = item.Where(x => x.Column_Name == "LENGTH").Select(x => x.Category_Value).FirstOrDefault();
                        WIDTH = item.Where(x => x.Column_Name == "WIDTH").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH = item.Where(x => x.Column_Name == "DEPTH").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_PER = item.Where(x => x.Column_Name == "TABLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH_PER = item.Where(x => x.Column_Name == "DEPTH PER").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_ANGLE = item.Where(x => x.Column_Name == "CROWN ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_HEIGHT = item.Where(x => x.Column_Name == "CROWN HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_ANGLE = item.Where(x => x.Column_Name == "PAVILION ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_HEIGHT = item.Where(x => x.Column_Name == "PAVILION HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_PER = item.Where(x => x.Column_Name == "GIRDLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        RAP_RATE = item.Where(x => x.Column_Name == "RAP RATE").Select(x => x.Category_Value).FirstOrDefault();
                        RAP_AMOUNT = item.Where(x => x.Column_Name == "RAP AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        COST_DISC = item.Where(x => x.Column_Name == "COST DISC").Select(x => x.Category_Value).FirstOrDefault();
                        COST_AMOUNT = item.Where(x => x.Column_Name == "COST AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_DISC = item.Where(x => x.Column_Name == "OFFER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_VALUE = item.Where(x => x.Column_Name == "OFFER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_DISC = item.Where(x => x.Column_Name == "BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_AMOUNT = item.Where(x => x.Column_Name == "BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        PRICE_PER_CTS = item.Where(x => x.Column_Name == "PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_BASE_DISC = item.Where(x => x.Column_Name == "MAX SLAB BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_BASE_AMOUNT = item.Where(x => x.Column_Name == "MAX SLAB BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_PRICE_PER_CTS = item.Where(x => x.Column_Name == "MAX SLAB PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        BUYER_DISC = item.Where(x => x.Column_Name == "BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BUYER_AMOUNT = item.Where(x => x.Column_Name == "BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_BLACK = item.Where(x => x.Column_Name == "TABLE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_WHITE = item.Where(x => x.Column_Name == "TABLE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                        SIDE_BLACK = item.Where(x => x.Column_Name == "SIDE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                        SIDE_WHITE = item.Where(x => x.Column_Name == "SIDE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_OPEN = item.Where(x => x.Column_Name == "TABLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_OPEN = item.Where(x => x.Column_Name == "CROWN OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_OPEN = item.Where(x => x.Column_Name == "PAVILION OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_OPEN = item.Where(x => x.Column_Name == "GIRDLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        CULET = item.Where(x => x.Column_Name == "CULET").Select(x => x.Category_Value).FirstOrDefault();
                        KEY_TO_SYMBOL_TRUE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_TRUE).FirstOrDefault();
                        KEY_TO_SYMBOL_FALSE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_FALSE).FirstOrDefault();
                        LAB_COMMENTS_TRUE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_TRUE).FirstOrDefault();
                        LAB_COMMENTS_FALSE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_FALSE).FirstOrDefault();
                        FANCY_COLOR = item.Where(x => x.Column_Name == "FANCY COLOR").Select(x => x.Category_Value).FirstOrDefault();
                        FANCY_INTENSITY = item.Where(x => x.Column_Name == "FANCY INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                        FANCY_OVERTONE = item.Where(x => x.Column_Name == "FANCY OVERTONE").Select(x => x.Category_Value).FirstOrDefault();
                        POINTER = item.Where(x => x.Column_Name == "POINTER").Select(x => x.Category_Value).FirstOrDefault();
                        SUB_POINTER = item.Where(x => x.Column_Name == "SUB POINTER").Select(x => x.Category_Value).FirstOrDefault();
                        STAR_LN = item.Where(x => x.Column_Name == "STAR LN").Select(x => x.Category_Value).FirstOrDefault();
                        LR_HALF = item.Where(x => x.Column_Name == "LR HALF").Select(x => x.Category_Value).FirstOrDefault();
                        CERT_TYPE = item.Where(x => x.Column_Name == "CERT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        COST_RATE = item.Where(x => x.Column_Name == "COST RATE").Select(x => x.Category_Value).FirstOrDefault();
                        RATIO = item.Where(x => x.Column_Name == "RATIO").Select(x => x.Category_Value).FirstOrDefault();
                        DISCOUNT_TYPE = item.Where(x => x.Column_Name == "DISCOUNT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SIGN = item.Where(x => x.Column_Name == "SIGN").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE = item.Where(x => x.Column_Name == "DISC VALUE").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE1 = item.Where(x => x.Column_Name == "DISC VALUE1").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE2 = item.Where(x => x.Column_Name == "DISC VALUE2").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE3 = item.Where(x => x.Column_Name == "DISC VALUE3").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_TYPE = item.Where(x => x.Column_Name == "BASE TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SUPP_STOCK_ID = item.Where(x => x.Column_Name == "SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        BID_SUPP_STOCK_ID = item.Where(x => x.Column_Name == "BID SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        BID_BUYER_DISC = item.Where(x => x.Column_Name == "BID BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BID_BUYER_AMOUNT = item.Where(x => x.Column_Name == "BID BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        LUSTER = item.Where(x => x.Column_Name == "LUSTER").Select(x => x.Category_Value).FirstOrDefault();
                        SHADE = item.Where(x => x.Column_Name == "SHADE").Select(x => x.Category_Value).FirstOrDefault();
                        MILKY = item.Where(x => x.Column_Name == "MILKY").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_FROM = item.Where(x => x.Column_Name == "GIRDLE_FROM").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_TO = item.Where(x => x.Column_Name == "GIRDLE_TO").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_CONDITION = item.Where(x => x.Column_Name == "GIRDLE_CONDITION").Select(x => x.Category_Value).FirstOrDefault();
                        ORIGIN = item.Where(x => x.Column_Name == "ORIGIN").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_TABLE = item.Where(x => x.Column_Name == "EXTRA_FACET_TABLE").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_CROWN = item.Where(x => x.Column_Name == "EXTRA_FACET_CROWN").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_PAV = item.Where(x => x.Column_Name == "EXTRA_FACET_PAV").Select(x => x.Category_Value).FirstOrDefault();
                        INTERNAL_GRAINING = item.Where(x => x.Column_Name == "INTERNAL_GRAINING").Select(x => x.Category_Value).FirstOrDefault();
                        H_A = item.Where(x => x.Column_Name == "H_A").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER_COMMENTS = item.Where(x => x.Column_Name == "SUPPLIER_COMMENTS").Select(x => x.Category_Value).FirstOrDefault();

                        dataTable.Rows.Add(!string.IsNullOrEmpty(STOCK_ID) ? STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(SUPPLIER) ? SUPPLIER : DBNull.Value,
                            !string.IsNullOrEmpty(CUSTOMER) ? CUSTOMER : DBNull.Value,
                            !string.IsNullOrEmpty(SHAPE) ? SHAPE : DBNull.Value,
                            !string.IsNullOrEmpty(CTS) ? CTS : DBNull.Value,
                            !string.IsNullOrEmpty(COLOR) ? COLOR : DBNull.Value,
                            !string.IsNullOrEmpty(CLARITY) ? CLARITY : DBNull.Value,
                            !string.IsNullOrEmpty(CUT) ? CUT : DBNull.Value,
                            !string.IsNullOrEmpty(POLISH) ? POLISH : DBNull.Value,
                            !string.IsNullOrEmpty(SYMM) ? SYMM : DBNull.Value,
                            !string.IsNullOrEmpty(FLS_INTENSITY) ? FLS_INTENSITY : DBNull.Value,
                            !string.IsNullOrEmpty(BGM) ? BGM : DBNull.Value,
                            !string.IsNullOrEmpty(LAB) ? LAB : DBNull.Value,
                            !string.IsNullOrEmpty(GOOD_TYPE) ? GOOD_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(LOCATION) ? LOCATION : DBNull.Value,
                            !string.IsNullOrEmpty(STATUS) ? STATUS : DBNull.Value,
                            !string.IsNullOrEmpty(IMAGE_LINK) ? IMAGE_LINK : DBNull.Value,
                            !string.IsNullOrEmpty(VIDEO_LINK) ? VIDEO_LINK : DBNull.Value,
                            !string.IsNullOrEmpty(LENGTH) ? LENGTH : DBNull.Value,
                            !string.IsNullOrEmpty(WIDTH) ? WIDTH : DBNull.Value,
                            !string.IsNullOrEmpty(DEPTH) ? DEPTH : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_PER) ? TABLE_PER : DBNull.Value,
                            !string.IsNullOrEmpty(DEPTH_PER) ? DEPTH_PER : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_ANGLE) ? CROWN_ANGLE : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_HEIGHT) ? CROWN_HEIGHT : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_ANGLE) ? PAVILION_ANGLE : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_HEIGHT) ? PAVILION_HEIGHT : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_PER) ? GIRDLE_PER : DBNull.Value,
                            !string.IsNullOrEmpty(RAP_RATE) ? RAP_RATE : DBNull.Value,
                            !string.IsNullOrEmpty(RAP_AMOUNT) ? RAP_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(COST_DISC) ? COST_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(COST_AMOUNT) ? COST_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(OFFER_DISC) ? OFFER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(OFFER_VALUE) ? OFFER_VALUE : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_DISC) ? BASE_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_AMOUNT) ? BASE_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(PRICE_PER_CTS) ? PRICE_PER_CTS : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_BASE_DISC) ? MAX_SLAB_BASE_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_BASE_AMOUNT) ? MAX_SLAB_BASE_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_PRICE_PER_CTS) ? MAX_SLAB_PRICE_PER_CTS : DBNull.Value,
                            !string.IsNullOrEmpty(BUYER_DISC) ? BUYER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BUYER_AMOUNT) ? BUYER_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_BLACK) ? TABLE_BLACK : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_WHITE) ? TABLE_WHITE : DBNull.Value,
                            !string.IsNullOrEmpty(SIDE_BLACK) ? SIDE_BLACK : DBNull.Value,
                            !string.IsNullOrEmpty(SIDE_WHITE) ? SIDE_WHITE : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_OPEN) ? TABLE_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_OPEN) ? CROWN_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_OPEN) ? PAVILION_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_OPEN) ? GIRDLE_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(CULET) ? CULET : DBNull.Value,
                            !string.IsNullOrEmpty(KEY_TO_SYMBOL_TRUE) ? KEY_TO_SYMBOL_TRUE : DBNull.Value,
                            !string.IsNullOrEmpty(KEY_TO_SYMBOL_FALSE) ? KEY_TO_SYMBOL_FALSE : DBNull.Value,
                            !string.IsNullOrEmpty(LAB_COMMENTS_TRUE) ? LAB_COMMENTS_TRUE : DBNull.Value,
                            !string.IsNullOrEmpty(LAB_COMMENTS_FALSE) ? LAB_COMMENTS_FALSE : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_COLOR) ? FANCY_COLOR : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_INTENSITY) ? FANCY_INTENSITY : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_OVERTONE) ? FANCY_OVERTONE : DBNull.Value,
                            !string.IsNullOrEmpty(POINTER) ? POINTER : DBNull.Value,
                            !string.IsNullOrEmpty(SUB_POINTER) ? SUB_POINTER : DBNull.Value,
                            !string.IsNullOrEmpty(STAR_LN) ? STAR_LN : DBNull.Value,
                            !string.IsNullOrEmpty(LR_HALF) ? LR_HALF : DBNull.Value,
                            !string.IsNullOrEmpty(CERT_TYPE) ? CERT_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(COST_RATE) ? COST_RATE : DBNull.Value,
                            !string.IsNullOrEmpty(RATIO) ? RATIO : DBNull.Value,
                            !string.IsNullOrEmpty(DISCOUNT_TYPE) ? DISCOUNT_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(SIGN) ? SIGN : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE) ? DISC_VALUE : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE1) ? DISC_VALUE1 : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE2) ? DISC_VALUE2 : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE3) ? DISC_VALUE3 : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_TYPE) ? BASE_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(SUPP_STOCK_ID) ? SUPP_STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(BID_SUPP_STOCK_ID) ? BID_SUPP_STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(BID_BUYER_DISC) ? BID_BUYER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BID_BUYER_AMOUNT) ? BID_BUYER_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(LUSTER) ? LUSTER : DBNull.Value,
                            !string.IsNullOrEmpty(SHADE) ? SHADE : DBNull.Value,
                            !string.IsNullOrEmpty(MILKY) ? MILKY : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_FROM) ? GIRDLE_FROM : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_TO) ? GIRDLE_TO : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_CONDITION) ? GIRDLE_CONDITION : DBNull.Value,
                            !string.IsNullOrEmpty(ORIGIN) ? ORIGIN : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_TABLE) ? EXTRA_FACET_TABLE : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_CROWN) ? EXTRA_FACET_CROWN : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_PAV) ? EXTRA_FACET_PAV : DBNull.Value,
                            !string.IsNullOrEmpty(INTERNAL_GRAINING) ? INTERNAL_GRAINING : DBNull.Value,
                            !string.IsNullOrEmpty(H_A) ? H_A : DBNull.Value,
                            !string.IsNullOrEmpty(SUPPLIER_COMMENTS) ? SUPPLIER_COMMENTS : DBNull.Value);
                    }
                }
                else
                {
                    DataRow newRow = dataTable.NewRow();
                    for (int i = 0; i < dataTable.Columns.Count; i++)
                    {
                        newRow[i] = DBNull.Value;
                    }
                    dataTable.Rows.Add(newRow);
                }
                var result = await _supplierService.Get_Lab_Search_Distinct_Report_Search(dataTable);
                if (result != null)
                {
                    List<Report_Column_Distinct> Report_Distinct_Data = new List<Report_Column_Distinct>();
                    List<Report_Category_Value> Column_Values = new List<Report_Category_Value>();

                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "STOCK ID", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("STOCK ID") && x.ContainsKey("STOCK ID")).Select(x => new { Category_Name = x["STOCK ID"].ToString(), Category_Value = x["STOCK ID"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "IMAGE LINK", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "VIDEO LINK", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "LAB", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("LAB") && x.ContainsKey("LAB_Id")).Select(x => new { Category_Name = x["LAB"].ToString(), Category_Value = x["LAB_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SUPPLIER NO", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("SUPPLIER NO")).Select(x => new { Category_Name = x["SUPPLIER NO"].ToString(), Category_Value = x["SUPPLIER NO"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CERTIFICATE NO", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("CERTIFICATE NO")).Select(x => new { Category_Name = x["CERTIFICATE NO"].ToString(), Category_Value = x["CERTIFICATE NO"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "COMPANY", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("COMPANY")).Select(x => new { Category_Name = x["COMPANY"].ToString(), Category_Value = x["COMPANY_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SHAPE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("SHAPE") && x.ContainsKey("SHAPE_Id")).Select(x => new { Category_Name = x["SHAPE"].ToString(), Category_Value = x["SHAPE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "POINTER", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("POINTER") && x.ContainsKey("POINTER_Id")).Select(x => new { Category_Name = x["POINTER"].ToString(), Category_Value = x["POINTER_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SUB POINTER", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("SUB POINTER") && x.ContainsKey("SUB_POINTER_Id")).Select(x => new { Category_Name = x["SUB POINTER"].ToString(), Category_Value = x["SUB_POINTER_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "BGM", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("BGM") && x.ContainsKey("BGM_Id")).Select(x => new { Category_Name = x["BGM"].ToString(), Category_Value = x["BGM_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "COLOR", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("COLOR") && x.ContainsKey("COLOR_Id")).Select(x => new { Category_Name = x["COLOR"].ToString(), Category_Value = x["COLOR_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CLARITY", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("CLARITY") && x.ContainsKey("CLARITY_Id")).Select(x => new { Category_Name = x["CLARITY"].ToString(), Category_Value = x["CLARITY_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CTS", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "RAP RATE", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "RAP AMOUNT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "COST DISC", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "COST AMOUNT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "OFFER DISC", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "OFFER AMOUNT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "BASE DISC", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "BASE AMOUNT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "PRICE PER CTS", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "MAX SLAB BASE DISC", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "MAX SLAB BASE AMOUNT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CUT", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("CUT") && x.ContainsKey("CUT_Id")).Select(x => new { Category_Name = x["CUT"].ToString(), Category_Value = x["CUT_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "POLISH", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("POLISH") && x.ContainsKey("POLISH_Id")).Select(x => new { Category_Name = x["POLISH"].ToString(), Category_Value = x["POLISH_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SYMM", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("SYMM") && x.ContainsKey("SYMM_Id")).Select(x => new { Category_Name = x["SYMM"].ToString(), Category_Value = x["SYMM_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "FLS INTENSITY", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("FLS INTENSITY") && x.ContainsKey("FLS_INTENSITY_Id")).Select(x => new { Category_Name = x["FLS INTENSITY"].ToString(), Category_Value = x["FLS_INTENSITY_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "RATIO", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "LENGTH", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "WIDTH", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "DEPTH", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "DEPTH PER", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "TABLE PER", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "KEY TO SYMBOL", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "COMMENT", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "GIRDLE PER", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CROWN ANGLE", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CROWN HEIGHT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "PAVILION ANGLE", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "PAVILION HEIGHT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "TABLE BLACK", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("TABLE BLACK") && x.ContainsKey("TABLE_BLACK_Id")).Select(x => new { Category_Name = x["TABLE BLACK"].ToString(), Category_Value = x["TABLE_BLACK_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SIDE BLACK", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("SIDE BLACK") && x.ContainsKey("SIDE_BLACK_Id")).Select(x => new { Category_Name = x["SIDE BLACK"].ToString(), Category_Value = x["SIDE_BLACK_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "TABLE WHITE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("TABLE WHITE") && x.ContainsKey("TABLE_WHITE_Id")).Select(x => new { Category_Name = x["TABLE WHITE"].ToString(), Category_Value = x["TABLE_WHITE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SIDE WHITE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("SIDE WHITE") && x.ContainsKey("SIDE_WHITE_Id")).Select(x => new { Category_Name = x["SIDE WHITE"].ToString(), Category_Value = x["SIDE_WHITE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CULET", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("CULET") && x.ContainsKey("CULET_Id")).Select(x => new { Category_Name = x["CULET"].ToString(), Category_Value = x["CULET_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "TABLE OPEN", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("TABLE OPEN") && x.ContainsKey("TABLE_OPEN_Id")).Select(x => new { Category_Name = x["TABLE OPEN"].ToString(), Category_Value = x["TABLE_OPEN_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CROWN OPEN", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("CROWN OPEN") && x.ContainsKey("CROWN_OPEN_Id")).Select(x => new { Category_Name = x["CROWN OPEN"].ToString(), Category_Value = x["CROWN_OPEN_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "PAVILION OPEN", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("PAVILION OPEN") && x.ContainsKey("PAV_OPEN_Id")).Select(x => new { Category_Name = x["PAVILION OPEN"].ToString(), Category_Value = x["PAV_OPEN_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "GIRDLE OPEN", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("GIRDLE OPEN") && x.ContainsKey("GIRDLE_OPEN_Id")).Select(x => new { Category_Name = x["GIRDLE OPEN"].ToString(), Category_Value = x["GIRDLE_OPEN_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "LUSTER", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("LUSTER") && x.ContainsKey("LUSTER_Id")).Select(x => new { Category_Name = x["LUSTER"].ToString(), Category_Value = x["LUSTER_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SHADE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("SHADE") && x.ContainsKey("SHADE_Id")).Select(x => new { Category_Name = x["SHADE"].ToString(), Category_Value = x["SHADE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "MILKY", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("MILKY") && x.ContainsKey("MILKY_Id")).Select(x => new { Category_Name = x["MILKY"].ToString(), Category_Value = x["MILKY_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "LOCATION", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("LOCATION") && x.ContainsKey("LOCATION_Id")).Select(x => new { Category_Name = x["LOCATION"].ToString(), Category_Value = x["LOCATION_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "GIRDLE FROM", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("GIRDLE FROM") && x.ContainsKey("GIRDLE_FROM_Id")).Select(x => new { Category_Name = x["GIRDLE FROM"].ToString(), Category_Value = x["GIRDLE_FROM_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "GIRDLE TO", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("GIRDLE TO") && x.ContainsKey("GIRDLE_TO_Id")).Select(x => new { Category_Name = x["GIRDLE TO"].ToString(), Category_Value = x["GIRDLE_TO_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "GIRDLE CONDITION", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("GIRDLE CONDITION") && x.ContainsKey("GIRDLE_CONDITION_Id")).Select(x => new { Category_Name = x["GIRDLE CONDITION"].ToString(), Category_Value = x["GIRDLE_CONDITION_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "GIRDLE TYPE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("GIRDLE TYPE") && x.ContainsKey("GIRDLE_TYPE_Id")).Select(x => new { Category_Name = x["GIRDLE TYPE"].ToString(), Category_Value = x["GIRDLE_TYPE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "FANCY COLOR", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("FANCY COLOR") && x.ContainsKey("FANCY_COLOR_Id")).Select(x => new { Category_Name = x["FANCY COLOR"].ToString(), Category_Value = x["FANCY_COLOR_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "FANCY INTENSITY", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("FANCY INTENSITY") && x.ContainsKey("FANCY_INTENSITY_Id")).Select(x => new { Category_Name = x["FANCY INTENSITY"].ToString(), Category_Value = x["FANCY_INTENSITY_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "FANCY OVERSTON", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("FANCY OVERSTON") && x.ContainsKey("FANCY_OVERSTON_Id")).Select(x => new { Category_Name = x["FANCY OVERSTON"].ToString(), Category_Value = x["FANCY_OVERSTON_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "ORIGIN", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("ORIGIN") && x.ContainsKey("ORIGIN_Id")).Select(x => new { Category_Name = x["ORIGIN"].ToString(), Category_Value = x["ORIGIN_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "EXTRA FACET TABLE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("EXTRA FACET TABLE") && x.ContainsKey("EXTRA_FACET_TABLE_Id")).Select(x => new { Category_Name = x["EXTRA FACET TABLE"].ToString(), Category_Value = x["EXTRA_FACET_TABLE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "EXTRA FACET CROWN", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("EXTRA FACET CROWN") && x.ContainsKey("EXTRA_FACET_CROWN_Id")).Select(x => new { Category_Name = x["EXTRA FACET CROWN"].ToString(), Category_Value = x["EXTRA_FACET_CROWN_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "EXTRA FACET PAVILION", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("EXTRA FACET PAVILION") && x.ContainsKey("EXTRA_FACET_PAV_Id")).Select(x => new { Category_Name = x["EXTRA FACET PAVILION"].ToString(), Category_Value = x["EXTRA_FACET_PAV_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "INTERNAL GRAINING", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("INTERNAL GRAINING") && x.ContainsKey("INTERNAL_GRAINING_Id")).Select(x => new { Category_Name = x["INTERNAL GRAINING"].ToString(), Category_Value = x["INTERNAL_GRAINING_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "H_A", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("H_A") && x.ContainsKey("H_A_Id")).Select(x => new { Category_Name = x["H_A"].ToString(), Category_Value = x["H_A_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "GOOD TYPE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("GOOD TYPE") && x.ContainsKey("GOOD_TYPE_Id")).Select(x => new { Category_Name = x["GOOD TYPE"].ToString(), Category_Value = x["GOOD_TYPE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "LR HALF", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "STR LN", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CERTIFICATE LINK", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "DNA", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "RANK", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SUNRISE STATUS", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "STATUS", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("STATUS") && x.ContainsKey("STATUS_Id")).Select(x => new { Category_Name = x["STATUS"].ToString(), Category_Value = x["STATUS_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "BID", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "BUYER", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "BUYER DISC", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "BUYER AMOUNT", Display_Type = "R", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "AVG STOCK DISC", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "AVG STOCK PCS", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "AVG PURCHASE DISC", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "AVG PURCHASE PCS", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "AVG SALE DISC", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "AVG SALE PCS", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "KTS GRADE", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SUNRISE CLARITY GRADE", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "ZONE", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "PARAMETER GRADE", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "CERT TYPE", Display_Type = "M", Column_Value = result.Where(x => x.ContainsKey("CERT TYPE") && x.ContainsKey("CERT_TYPE_Id")).Select(x => new { Category_Name = x["CERT TYPE"].ToString(), Category_Value = x["CERT_TYPE_Id"].ToString() }).Distinct().ToList().Select(x => new Report_Category_Value { Category_Name = x.Category_Name, Category_Value = x.Category_Value }) });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "LAB COMMENTS", Display_Type = "", Column_Value = Column_Values });
                    Report_Distinct_Data.Add(new Report_Column_Distinct { Column_Name = "SUPPLIER COMMENTS", Display_Type = "", Column_Value = Column_Values });

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = Report_Distinct_Data
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Report_Search", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_stock_availibility_report_search")]
        [Authorize]
        public async Task<IActionResult> Get_Stock_Availibility_Report_Search([FromForm] Stock_Avalibility stock_Avalibility, IFormFile? File_Location)
        {
            try
            {
                IList<Stock_Avalibility_Values> stock_Avalibility_Values = new List<Stock_Avalibility_Values>();
                var lst_Stock_Id = new List<string>();
                if (!string.IsNullOrEmpty(stock_Avalibility.stock_Id) && stock_Avalibility.stock_Id.Contains(";"))
                {
                    lst_Stock_Id = stock_Avalibility.stock_Id.Split('/').ToList();
                    if (lst_Stock_Id != null && lst_Stock_Id.Count > 0)
                    {
                        foreach (var item in lst_Stock_Id)
                        {
                            var model = new Stock_Avalibility_Values();
                            var lst_stock_val = item.Split(';').ToList();
                            if (lst_stock_val != null && lst_stock_val.Count > 0)
                            {
                                if (lst_stock_val.Count == 1)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (string.IsNullOrEmpty(lst_stock_val[i]))
                                            continue;

                                        model.Stock_Id = lst_stock_val[0];
                                    }
                                }
                                else if (lst_stock_val.Count == 2)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else
                                        {
                                            if (string.IsNullOrEmpty(lst_stock_val[i]))
                                                continue;

                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                                else if (lst_stock_val.Count == 3)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else
                                        {
                                            if (string.IsNullOrEmpty(lst_stock_val[i]))
                                                continue;

                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                            //var con_val_1 = Convert.ToDecimal(lst_stock_val[2]);
                                            //if (con_val_1 >= -100 && con_val_1 <= 100)
                                            //{
                                            //    model.Offer_Disc = lst_stock_val[2];
                                            //}
                                            //else
                                            //{
                                            //    model.Offer_Amount = lst_stock_val[2];
                                            //}
                                        }
                                    }
                                }
                            }
                            stock_Avalibility_Values.Add(model);
                        }
                        stock_Avalibility_Values = stock_Avalibility_Values.GroupBy(x => x.Stock_Id).Select(x => x.First()).ToList();
                    }
                }

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable.Columns.Add("COST_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                if (File_Location != null)
                {
                    var filePath = Path.GetTempFileName();
                    using (var stream = new FileStream(filePath, FileMode.Create))
                    {
                        await File_Location.CopyToAsync(stream);
                    }
                    using (var package = new ExcelPackage(new FileInfo(filePath)))
                    {
                        var worksheet = package.Workbook.Worksheets[0];
                        int startRow = 2;

                        HashSet<string> uniqueValues = new HashSet<string>();
                        for (int row = startRow; row <= worksheet.Dimension.End.Row; row++)
                        {
                            string value = worksheet.Cells[row, 1].GetValue<string>();
                            string offer_amt = worksheet.Cells[row, 3].GetValue<string>();
                            if (!uniqueValues.Contains(value))
                            {
                                uniqueValues.Add(value);
                                dataTable.Rows.Add(value, DBNull.Value, DBNull.Value, !string.IsNullOrEmpty(offer_amt) ? offer_amt.Replace(",", "") : DBNull.Value, worksheet.Cells[row, 2].GetValue<string>());
                            }
                        }
                        var uniqueRows = dataTable.AsEnumerable()
                                  .GroupBy(row => row.Field<string>("STOCK_ID"))
                                  .Select(grp => grp.First())
                                  .CopyToDataTable();
                    }
                }
                else if (stock_Avalibility_Values != null && stock_Avalibility_Values.Count > 0)
                {
                    stock_Avalibility.stock_Id = null;
                    foreach (var item in stock_Avalibility_Values)
                    {
                        dataTable.Rows.Add(!string.IsNullOrEmpty(item.Stock_Id) ? item.Stock_Id : DBNull.Value, DBNull.Value, DBNull.Value, !string.IsNullOrEmpty(item.Offer_Amount) ? item.Offer_Amount : DBNull.Value, !string.IsNullOrEmpty(item.Offer_Disc) ? item.Offer_Disc : DBNull.Value);
                    }
                }
                else
                {
                    if (!string.IsNullOrEmpty(stock_Avalibility.stock_Id) && !stock_Avalibility.stock_Id.Contains(";"))
                    {
                        lst_Stock_Id = stock_Avalibility.stock_Id.Replace("//", "/").Split('/').Distinct().ToList();
                        foreach (var item in lst_Stock_Id)
                        {
                            dataTable.Rows.Add(!string.IsNullOrEmpty(item) ? item : DBNull.Value, DBNull.Value, DBNull.Value);
                        }
                    }
                }

                var result = await _supplierService.Get_Stock_Avalibility_Report_Search(dataTable, stock_Avalibility.stock_Id, stock_Avalibility.stock_Type, stock_Avalibility.supp_Stock_Id, stock_Avalibility.iPgNo ?? 0, stock_Avalibility.iPgSize ?? 0, stock_Avalibility.iSort, stock_Avalibility.party_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Search", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_saved_report_serach")]
        [Authorize]
        public async Task<IActionResult> Get_Saved_Report_Serach(int user_Id)
        {
            try
            {
                var result = await _supplierService.Get_Search_Save_Report_Search(user_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Saved_Report_Serach", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_report_search_save")]
        [Authorize]
        public async Task<IActionResult> Create_Report_Search_Save(Report_Search_Save report_Search_Save)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    string STOCK_ID = string.Empty, SUPPLIER = string.Empty, CUSTOMER = string.Empty, SHAPE = string.Empty,
                            CTS = string.Empty, COLOR = string.Empty, CLARITY = string.Empty, CUT = string.Empty,
                            POLISH = string.Empty, SYMM = string.Empty, FLS_INTENSITY = string.Empty, BGM = string.Empty,
                            LAB = string.Empty, GOOD_TYPE = string.Empty, LOCATION = string.Empty, STATUS = string.Empty,
                            IMAGE_LINK = string.Empty, VIDEO_LINK = string.Empty, LENGTH = string.Empty, WIDTH = string.Empty,
                            DEPTH = string.Empty, TABLE_PER = string.Empty, DEPTH_PER = string.Empty, CROWN_ANGLE = string.Empty,
                            CROWN_HEIGHT = string.Empty, PAVILION_ANGLE = string.Empty, PAVILION_HEIGHT = string.Empty, GIRDLE_PER = string.Empty,
                            RAP_RATE = string.Empty, RAP_AMOUNT = string.Empty, COST_DISC = string.Empty, COST_AMOUNT = string.Empty,
                            OFFER_DISC = string.Empty, OFFER_AMOUNT = string.Empty, BASE_DISC = string.Empty, BASE_AMOUNT = string.Empty,
                            PRICE_PER_CTS = string.Empty, MAX_SLAB_BASE_DISC = string.Empty, MAX_SLAB_BASE_AMOUNT = string.Empty, MAX_SLAB_PRICE_PER_CTS = string.Empty,
                            BUYER_DISC = string.Empty, BUYER_AMOUNT = string.Empty, TABLE_BLACK = string.Empty, TABLE_WHITE = string.Empty, SIDE_BLACK = string.Empty, SIDE_WHITE = string.Empty,
                            TABLE_OPEN = string.Empty, CROWN_OPEN = string.Empty, PAVILION_OPEN = string.Empty,
                            GIRDLE_OPEN = string.Empty, CULET = string.Empty, KEY_TO_SYMBOL_TRUE = string.Empty,
                            KEY_TO_SYMBOL_FALSE = string.Empty, LAB_COMMENTS_TRUE = string.Empty, LAB_COMMENTS_FALSE = string.Empty,
                            FANCY_COLOR = string.Empty, FANCY_INTENSITY = string.Empty, FANCY_OVERTONE = string.Empty, POINTER = string.Empty, SUB_POINTER = string.Empty,
                            STAR_LN = string.Empty, LR_HALF = string.Empty, CERT_TYPE = string.Empty, COST_RATE = string.Empty, RATIO = string.Empty, DISCOUNT_TYPE = string.Empty,
                            SIGN = string.Empty, DISC_VALUE = string.Empty, DISC_VALUE1 = string.Empty, DISC_VALUE2 = string.Empty, DISC_VALUE3 = string.Empty, BASE_TYPE = string.Empty, SUPP_STOCK_ID = string.Empty;

                    Report_Lab_Filter report_Lab_Filter = JsonConvert.DeserializeObject<Report_Lab_Filter>(report_Search_Save.Search_Value.ToString());

                    string Search_Display = string.Empty;
                    Search_Display += "[";
                    int i = 1;
                    foreach (var item in report_Lab_Filter.Report_Filter_Parameter_List)
                    {
                        STOCK_ID = item.Where(x => x.Column_Name == "STOCK ID" || x.Column_Name == "CERTIFICATE NO" || x.Column_Name == "SUPPLIER NO").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER = item.Where(x => x.Column_Name == "SUPPLIER").Select(x => x.Category_Name).FirstOrDefault();
                        CUSTOMER = item.Where(x => x.Column_Name == "CUSTOMER").Select(x => x.Category_Name).FirstOrDefault();
                        SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Name).FirstOrDefault();
                        CTS = item.Where(x => x.Column_Name == "CTS").Select(x => x.Category_Value).FirstOrDefault();
                        COLOR = item.Where(x => x.Column_Name == "COLOR").Select(x => x.Category_Name).FirstOrDefault();
                        CLARITY = item.Where(x => x.Column_Name == "CLARITY").Select(x => x.Category_Name).FirstOrDefault();
                        CUT = item.Where(x => x.Column_Name == "CUT").Select(x => x.Category_Name).FirstOrDefault();
                        POLISH = item.Where(x => x.Column_Name == "POLISH").Select(x => x.Category_Name).FirstOrDefault();
                        SYMM = item.Where(x => x.Column_Name == "SYMM").Select(x => x.Category_Name).FirstOrDefault();
                        FLS_INTENSITY = item.Where(x => x.Column_Name == "FLS INTENSITY").Select(x => x.Category_Name).FirstOrDefault();
                        BGM = item.Where(x => x.Column_Name == "BGM").Select(x => x.Category_Name).FirstOrDefault();
                        LAB = item.Where(x => x.Column_Name == "LAB").Select(x => x.Category_Name).FirstOrDefault();
                        GOOD_TYPE = item.Where(x => x.Column_Name == "GOOD TYPE").Select(x => x.Category_Name).FirstOrDefault();
                        LOCATION = item.Where(x => x.Column_Name == "LOCATION").Select(x => x.Category_Name).FirstOrDefault();
                        STATUS = item.Where(x => x.Column_Name == "STATUS").Select(x => x.Category_Name).FirstOrDefault();
                        IMAGE_LINK = item.Where(x => x.Column_Name == "IMAGE LINK").Select(x => x.Category_Value).FirstOrDefault();
                        VIDEO_LINK = item.Where(x => x.Column_Name == "VIDEO LINK").Select(x => x.Category_Value).FirstOrDefault();
                        LENGTH = item.Where(x => x.Column_Name == "LENGTH").Select(x => x.Category_Value).FirstOrDefault();
                        WIDTH = item.Where(x => x.Column_Name == "WIDTH").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH = item.Where(x => x.Column_Name == "DEPTH").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_PER = item.Where(x => x.Column_Name == "TABLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH_PER = item.Where(x => x.Column_Name == "DEPTH PER").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_ANGLE = item.Where(x => x.Column_Name == "CROWN ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_HEIGHT = item.Where(x => x.Column_Name == "CROWN HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_ANGLE = item.Where(x => x.Column_Name == "PAVILION ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_HEIGHT = item.Where(x => x.Column_Name == "PAVILION HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_PER = item.Where(x => x.Column_Name == "GIRDLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_DISC = item.Where(x => x.Column_Name == "OFFER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_AMOUNT = item.Where(x => x.Column_Name == "OFFER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        PRICE_PER_CTS = item.Where(x => x.Column_Name == "PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_BLACK = item.Where(x => x.Column_Name == "TABLE BLACK").Select(x => x.Category_Name).FirstOrDefault();
                        TABLE_WHITE = item.Where(x => x.Column_Name == "TABLE WHITE").Select(x => x.Category_Name).FirstOrDefault();
                        SIDE_BLACK = item.Where(x => x.Column_Name == "SIDE BLACK").Select(x => x.Category_Name).FirstOrDefault();
                        SIDE_WHITE = item.Where(x => x.Column_Name == "SIDE WHITE").Select(x => x.Category_Name).FirstOrDefault();
                        TABLE_OPEN = item.Where(x => x.Column_Name == "TABLE OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        CROWN_OPEN = item.Where(x => x.Column_Name == "CROWN OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        PAVILION_OPEN = item.Where(x => x.Column_Name == "PAVILION OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        GIRDLE_OPEN = item.Where(x => x.Column_Name == "GIRDLE OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        KEY_TO_SYMBOL_TRUE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_TRUE).FirstOrDefault();
                        KEY_TO_SYMBOL_FALSE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_FALSE).FirstOrDefault();
                        LAB_COMMENTS_TRUE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_TRUE).FirstOrDefault();
                        LAB_COMMENTS_FALSE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_FALSE).FirstOrDefault();
                        FANCY_COLOR = item.Where(x => x.Column_Name == "FANCY COLOR").Select(x => x.Category_Name).FirstOrDefault();
                        FANCY_INTENSITY = item.Where(x => x.Column_Name == "FANCY INTENSITY").Select(x => x.Category_Name).FirstOrDefault();
                        FANCY_OVERTONE = item.Where(x => x.Column_Name == "FANCY OVERTONE").Select(x => x.Category_Name).FirstOrDefault();
                        POINTER = item.Where(x => x.Column_Name == "POINTER").Select(x => x.Category_Name).FirstOrDefault();
                        STAR_LN = item.Where(x => x.Column_Name == "STAR LN").Select(x => x.Category_Name).FirstOrDefault();
                        LR_HALF = item.Where(x => x.Column_Name == "LR HALF").Select(x => x.Category_Name).FirstOrDefault();
                        CERT_TYPE = item.Where(x => x.Column_Name == "CERT TYPE").Select(x => x.Category_Name).FirstOrDefault();
                        COST_RATE = item.Where(x => x.Column_Name == "COST RATE").Select(x => x.Category_Value).FirstOrDefault();
                        DISCOUNT_TYPE = item.Where(x => x.Column_Name == "DISCOUNT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SIGN = item.Where(x => x.Column_Name == "SIGN").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE = item.Where(x => x.Column_Name == "DISC VALUE").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE1 = item.Where(x => x.Column_Name == "DISC VALUE1").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE2 = item.Where(x => x.Column_Name == "DISC VALUE2").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE3 = item.Where(x => x.Column_Name == "DISC VALUE3").Select(x => x.Category_Value).FirstOrDefault();
                        SUPP_STOCK_ID = item.Where(x => x.Column_Name == "SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        Search_Display += " { \"Filter\" : \"";
                        Search_Display += !string.IsNullOrEmpty(STOCK_ID) ? " SUPPLIER NO/ CERT NO : " + STOCK_ID : "";
                        Search_Display += !string.IsNullOrEmpty(SUPPLIER) ? " SUPPLIER : " + SUPPLIER : "";
                        Search_Display += !string.IsNullOrEmpty(CUSTOMER) ? " CUSTOMER : " + CUSTOMER : "";
                        Search_Display += !string.IsNullOrEmpty(SHAPE) ? " SHAPE : " + SHAPE : "";
                        Search_Display += !string.IsNullOrEmpty(CTS) ? " CTS : " + CTS : "";
                        Search_Display += !string.IsNullOrEmpty(COLOR) ? " COLOR : " + COLOR : "";
                        Search_Display += !string.IsNullOrEmpty(CLARITY) ? " CLARITY : " + CLARITY : "";
                        Search_Display += !string.IsNullOrEmpty(CUT) ? " CUT : " + CUT : "";
                        Search_Display += !string.IsNullOrEmpty(POLISH) ? " POLISH : " + POLISH : "";
                        Search_Display += !string.IsNullOrEmpty(SYMM) ? " SYMM : " + SYMM : "";
                        Search_Display += !string.IsNullOrEmpty(FLS_INTENSITY) ? " FLS INTENSITY : " + FLS_INTENSITY : "";
                        Search_Display += !string.IsNullOrEmpty(BGM) ? " BGM : " + BGM : "";
                        Search_Display += !string.IsNullOrEmpty(LAB) ? " LAB : " + LAB : "";
                        Search_Display += !string.IsNullOrEmpty(GOOD_TYPE) ? " GOOD TYPE : " + GOOD_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(LOCATION) ? " LOCATION : " + LOCATION : "";
                        Search_Display += !string.IsNullOrEmpty(STATUS) ? " STATUS : " + STATUS : "";
                        Search_Display += !string.IsNullOrEmpty(IMAGE_LINK) ? " IMAGE LINK : " + IMAGE_LINK : "";
                        Search_Display += !string.IsNullOrEmpty(VIDEO_LINK) ? " VIDEO LINK : " + VIDEO_LINK : "";
                        Search_Display += !string.IsNullOrEmpty(LENGTH) ? " LENGTH : " + LENGTH : "";
                        Search_Display += !string.IsNullOrEmpty(WIDTH) ? " WIDTH : " + WIDTH : "";
                        Search_Display += !string.IsNullOrEmpty(DEPTH) ? " DEPTH : " + DEPTH : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_PER) ? " TABLE PER : " + TABLE_PER : "";
                        Search_Display += !string.IsNullOrEmpty(DEPTH_PER) ? " DEPTH PER : " + DEPTH_PER : "";
                        Search_Display += !string.IsNullOrEmpty(CROWN_ANGLE) ? " CROWN ANGLE : " + CROWN_ANGLE : "";
                        Search_Display += !string.IsNullOrEmpty(CROWN_HEIGHT) ? " CROWN HEIGHT : " + CROWN_HEIGHT : "";
                        Search_Display += !string.IsNullOrEmpty(PAVILION_ANGLE) ? " PAVILION ANGLE : " + PAVILION_ANGLE : "";
                        Search_Display += !string.IsNullOrEmpty(PAVILION_HEIGHT) ? " PAVILION HEIGHT : " + PAVILION_HEIGHT : "";
                        Search_Display += !string.IsNullOrEmpty(GIRDLE_PER) ? " GIRDLE PER : " + GIRDLE_PER : "";
                        Search_Display += !string.IsNullOrEmpty(OFFER_DISC) ? " OFFER DISC : " + OFFER_DISC : "";
                        Search_Display += !string.IsNullOrEmpty(OFFER_AMOUNT) ? " OFFER AMOUNT : " + OFFER_AMOUNT : "";
                        Search_Display += !string.IsNullOrEmpty(PRICE_PER_CTS) ? " PRICE PER CTS : " + PRICE_PER_CTS : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_BLACK) ? " TABLE BLACK : " + TABLE_BLACK : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_WHITE) ? " TABLE WHITE : " + TABLE_WHITE : "";
                        Search_Display += !string.IsNullOrEmpty(SIDE_BLACK) ? " SIDE BLACK : " + SIDE_BLACK : "";
                        Search_Display += !string.IsNullOrEmpty(SIDE_WHITE) ? " SIDE WHITE : " + SIDE_WHITE : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_OPEN) ? " TABLE OPEN : " + TABLE_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(CROWN_OPEN) ? " CROWN OPEN : " + CROWN_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(PAVILION_OPEN) ? " PAVILION OPEN : " + PAVILION_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(GIRDLE_OPEN) ? " GIRDLE OPEN : " + GIRDLE_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(KEY_TO_SYMBOL_TRUE) ? " KEY TO SYMBOL TRUE : " + KEY_TO_SYMBOL_TRUE : "";
                        Search_Display += !string.IsNullOrEmpty(KEY_TO_SYMBOL_FALSE) ? " KEY TO SYMBOL FALSE : " + KEY_TO_SYMBOL_FALSE : "";
                        Search_Display += !string.IsNullOrEmpty(LAB_COMMENTS_TRUE) ? " LAB COMMENTS TRUE : " + LAB_COMMENTS_TRUE : "";
                        Search_Display += !string.IsNullOrEmpty(LAB_COMMENTS_FALSE) ? " LAB COMMENTS FALSE : " + LAB_COMMENTS_FALSE : "";
                        Search_Display += !string.IsNullOrEmpty(FANCY_COLOR) ? " FANCY COLOR : " + FANCY_COLOR : "";
                        Search_Display += !string.IsNullOrEmpty(FANCY_INTENSITY) ? " FANCY INTENSITY : " + FANCY_INTENSITY : "";
                        Search_Display += !string.IsNullOrEmpty(FANCY_OVERTONE) ? " FANCY OVERTONE : " + FANCY_OVERTONE : "";
                        Search_Display += !string.IsNullOrEmpty(POINTER) ? " POINTER : " + POINTER : "";
                        Search_Display += !string.IsNullOrEmpty(STAR_LN) ? " STAR LN : " + STAR_LN : "";
                        Search_Display += !string.IsNullOrEmpty(LR_HALF) ? " LR HALF : " + LR_HALF : "";
                        Search_Display += !string.IsNullOrEmpty(CERT_TYPE) ? " CERT TYPE : " + CERT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(COST_RATE) ? " COST RATE : " + COST_RATE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE1 : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE2 : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE3 : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(SIGN) ? " SIGN : " + SIGN : "";
                        Search_Display += !string.IsNullOrEmpty(DISC_VALUE) ? " DISC VALUE : " + DISC_VALUE : "";
                        Search_Display += !string.IsNullOrEmpty(SUPP_STOCK_ID) ? " SUPP STOCK ID : " + SUPP_STOCK_ID : "";
                        Search_Display += " \"}";

                        if (report_Lab_Filter.Report_Filter_Parameter_List.Count() != i)
                        {
                            Search_Display += ",";
                        }
                        i++;
                    }
                    Search_Display += "]";
                    report_Search_Save.Search_Display = Search_Display;
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                    var result = await _supplierService.Create_Update_Report_Search(report_Search_Save, (int)user_Id);
                    if (result == "success")
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = report_Search_Save.Id > 0 ? CoreCommonMessage.SearchedReportUpdated : CoreCommonMessage.SearchedReportCreated
                        });
                    }
                    else if (result == "exist")
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.SearchedReportNameExist,
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Report_Search_Save", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_report_search_save")]
        [Authorize]
        public async Task<IActionResult> Update_Report_Search_Save(Report_Search_Save report_Search_Save)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    string STOCK_ID = string.Empty, SUPPLIER = string.Empty, CUSTOMER = string.Empty, SHAPE = string.Empty,
                            CTS = string.Empty, COLOR = string.Empty, CLARITY = string.Empty, CUT = string.Empty,
                            POLISH = string.Empty, SYMM = string.Empty, FLS_INTENSITY = string.Empty, BGM = string.Empty,
                            LAB = string.Empty, GOOD_TYPE = string.Empty, LOCATION = string.Empty, STATUS = string.Empty,
                            IMAGE_LINK = string.Empty, VIDEO_LINK = string.Empty, LENGTH = string.Empty, WIDTH = string.Empty,
                            DEPTH = string.Empty, TABLE_PER = string.Empty, DEPTH_PER = string.Empty, CROWN_ANGLE = string.Empty,
                            CROWN_HEIGHT = string.Empty, PAVILION_ANGLE = string.Empty, PAVILION_HEIGHT = string.Empty, GIRDLE_PER = string.Empty,
                            RAP_RATE = string.Empty, RAP_AMOUNT = string.Empty, COST_DISC = string.Empty, COST_AMOUNT = string.Empty,
                            OFFER_DISC = string.Empty, OFFER_AMOUNT = string.Empty, BASE_DISC = string.Empty, BASE_AMOUNT = string.Empty,
                            PRICE_PER_CTS = string.Empty, MAX_SLAB_BASE_DISC = string.Empty, MAX_SLAB_BASE_AMOUNT = string.Empty, MAX_SLAB_PRICE_PER_CTS = string.Empty,
                            BUYER_DISC = string.Empty, BUYER_AMOUNT = string.Empty, TABLE_BLACK = string.Empty, TABLE_WHITE = string.Empty, SIDE_BLACK = string.Empty, SIDE_WHITE = string.Empty,
                            TABLE_OPEN = string.Empty, CROWN_OPEN = string.Empty, PAVILION_OPEN = string.Empty,
                            GIRDLE_OPEN = string.Empty, CULET = string.Empty, KEY_TO_SYMBOL_TRUE = string.Empty,
                            KEY_TO_SYMBOL_FALSE = string.Empty, LAB_COMMENTS_TRUE = string.Empty, LAB_COMMENTS_FALSE = string.Empty,
                            FANCY_COLOR = string.Empty, FANCY_INTENSITY = string.Empty, FANCY_OVERTONE = string.Empty, POINTER = string.Empty, SUB_POINTER = string.Empty,
                            STAR_LN = string.Empty, LR_HALF = string.Empty, CERT_TYPE = string.Empty, COST_RATE = string.Empty, RATIO = string.Empty, DISCOUNT_TYPE = string.Empty,
                            SIGN = string.Empty, DISC_VALUE = string.Empty, DISC_VALUE1 = string.Empty, DISC_VALUE2 = string.Empty, DISC_VALUE3 = string.Empty, BASE_TYPE = string.Empty, SUPP_STOCK_ID = string.Empty;

                    Report_Lab_Filter report_Lab_Filter = JsonConvert.DeserializeObject<Report_Lab_Filter>(report_Search_Save.Search_Value.ToString());

                    string Search_Display = string.Empty;
                    Search_Display += "[";
                    int i = 1;
                    foreach (var item in report_Lab_Filter.Report_Filter_Parameter_List)
                    {
                        STOCK_ID = item.Where(x => x.Column_Name == "STOCK ID" || x.Column_Name == "CERTIFICATE NO" || x.Column_Name == "SUPPLIER NO").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER = item.Where(x => x.Column_Name == "SUPPLIER").Select(x => x.Category_Name).FirstOrDefault();
                        CUSTOMER = item.Where(x => x.Column_Name == "CUSTOMER").Select(x => x.Category_Name).FirstOrDefault();
                        SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Name).FirstOrDefault();
                        CTS = item.Where(x => x.Column_Name == "CTS").Select(x => x.Category_Value).FirstOrDefault();
                        COLOR = item.Where(x => x.Column_Name == "COLOR").Select(x => x.Category_Name).FirstOrDefault();
                        CLARITY = item.Where(x => x.Column_Name == "CLARITY").Select(x => x.Category_Name).FirstOrDefault();
                        CUT = item.Where(x => x.Column_Name == "CUT").Select(x => x.Category_Name).FirstOrDefault();
                        POLISH = item.Where(x => x.Column_Name == "POLISH").Select(x => x.Category_Name).FirstOrDefault();
                        SYMM = item.Where(x => x.Column_Name == "SYMM").Select(x => x.Category_Name).FirstOrDefault();
                        FLS_INTENSITY = item.Where(x => x.Column_Name == "FLS INTENSITY").Select(x => x.Category_Name).FirstOrDefault();
                        BGM = item.Where(x => x.Column_Name == "BGM").Select(x => x.Category_Name).FirstOrDefault();
                        LAB = item.Where(x => x.Column_Name == "LAB").Select(x => x.Category_Name).FirstOrDefault();
                        GOOD_TYPE = item.Where(x => x.Column_Name == "GOOD TYPE").Select(x => x.Category_Name).FirstOrDefault();
                        LOCATION = item.Where(x => x.Column_Name == "LOCATION").Select(x => x.Category_Name).FirstOrDefault();
                        STATUS = item.Where(x => x.Column_Name == "STATUS").Select(x => x.Category_Name).FirstOrDefault();
                        IMAGE_LINK = item.Where(x => x.Column_Name == "IMAGE LINK").Select(x => x.Category_Value).FirstOrDefault();
                        VIDEO_LINK = item.Where(x => x.Column_Name == "VIDEO LINK").Select(x => x.Category_Value).FirstOrDefault();
                        LENGTH = item.Where(x => x.Column_Name == "LENGTH").Select(x => x.Category_Value).FirstOrDefault();
                        WIDTH = item.Where(x => x.Column_Name == "WIDTH").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH = item.Where(x => x.Column_Name == "DEPTH").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_PER = item.Where(x => x.Column_Name == "TABLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH_PER = item.Where(x => x.Column_Name == "DEPTH PER").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_ANGLE = item.Where(x => x.Column_Name == "CROWN ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_HEIGHT = item.Where(x => x.Column_Name == "CROWN HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_ANGLE = item.Where(x => x.Column_Name == "PAVILION ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_HEIGHT = item.Where(x => x.Column_Name == "PAVILION HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_PER = item.Where(x => x.Column_Name == "GIRDLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_DISC = item.Where(x => x.Column_Name == "OFFER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_AMOUNT = item.Where(x => x.Column_Name == "OFFER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        PRICE_PER_CTS = item.Where(x => x.Column_Name == "PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_BLACK = item.Where(x => x.Column_Name == "TABLE BLACK").Select(x => x.Category_Name).FirstOrDefault();
                        TABLE_WHITE = item.Where(x => x.Column_Name == "TABLE WHITE").Select(x => x.Category_Name).FirstOrDefault();
                        SIDE_BLACK = item.Where(x => x.Column_Name == "SIDE BLACK").Select(x => x.Category_Name).FirstOrDefault();
                        SIDE_WHITE = item.Where(x => x.Column_Name == "SIDE WHITE").Select(x => x.Category_Name).FirstOrDefault();
                        TABLE_OPEN = item.Where(x => x.Column_Name == "TABLE OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        CROWN_OPEN = item.Where(x => x.Column_Name == "CROWN OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        PAVILION_OPEN = item.Where(x => x.Column_Name == "PAVILION OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        GIRDLE_OPEN = item.Where(x => x.Column_Name == "GIRDLE OPEN").Select(x => x.Category_Name).FirstOrDefault();
                        KEY_TO_SYMBOL_TRUE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_TRUE).FirstOrDefault();
                        KEY_TO_SYMBOL_FALSE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_FALSE).FirstOrDefault();
                        LAB_COMMENTS_TRUE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_TRUE).FirstOrDefault();
                        LAB_COMMENTS_FALSE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_FALSE).FirstOrDefault();
                        FANCY_COLOR = item.Where(x => x.Column_Name == "FANCY COLOR").Select(x => x.Category_Name).FirstOrDefault();
                        FANCY_INTENSITY = item.Where(x => x.Column_Name == "FANCY INTENSITY").Select(x => x.Category_Name).FirstOrDefault();
                        FANCY_OVERTONE = item.Where(x => x.Column_Name == "FANCY OVERTONE").Select(x => x.Category_Name).FirstOrDefault();
                        POINTER = item.Where(x => x.Column_Name == "POINTER").Select(x => x.Category_Name).FirstOrDefault();
                        STAR_LN = item.Where(x => x.Column_Name == "STAR LN").Select(x => x.Category_Name).FirstOrDefault();
                        LR_HALF = item.Where(x => x.Column_Name == "LR HALF").Select(x => x.Category_Name).FirstOrDefault();
                        CERT_TYPE = item.Where(x => x.Column_Name == "CERT TYPE").Select(x => x.Category_Name).FirstOrDefault();
                        COST_RATE = item.Where(x => x.Column_Name == "COST RATE").Select(x => x.Category_Value).FirstOrDefault();
                        DISCOUNT_TYPE = item.Where(x => x.Column_Name == "DISCOUNT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SIGN = item.Where(x => x.Column_Name == "SIGN").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE = item.Where(x => x.Column_Name == "DISC VALUE").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE1 = item.Where(x => x.Column_Name == "DISC VALUE1").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE2 = item.Where(x => x.Column_Name == "DISC VALUE2").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE3 = item.Where(x => x.Column_Name == "DISC VALUE3").Select(x => x.Category_Value).FirstOrDefault();
                        SUPP_STOCK_ID = item.Where(x => x.Column_Name == "SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        Search_Display += " { \"Filter\" : \"";
                        Search_Display += !string.IsNullOrEmpty(STOCK_ID) ? " SUPPLIER NO/ CERT NO : " + STOCK_ID : "";
                        Search_Display += !string.IsNullOrEmpty(SUPPLIER) ? " SUPPLIER : " + SUPPLIER : "";
                        Search_Display += !string.IsNullOrEmpty(CUSTOMER) ? " CUSTOMER : " + CUSTOMER : "";
                        Search_Display += !string.IsNullOrEmpty(SHAPE) ? " SHAPE : " + SHAPE : "";
                        Search_Display += !string.IsNullOrEmpty(CTS) ? " CTS : " + CTS : "";
                        Search_Display += !string.IsNullOrEmpty(COLOR) ? " COLOR : " + COLOR : "";
                        Search_Display += !string.IsNullOrEmpty(CLARITY) ? " CLARITY : " + CLARITY : "";
                        Search_Display += !string.IsNullOrEmpty(CUT) ? " CUT : " + CUT : "";
                        Search_Display += !string.IsNullOrEmpty(POLISH) ? " POLISH : " + POLISH : "";
                        Search_Display += !string.IsNullOrEmpty(SYMM) ? " SYMM : " + SYMM : "";
                        Search_Display += !string.IsNullOrEmpty(FLS_INTENSITY) ? " FLS INTENSITY : " + FLS_INTENSITY : "";
                        Search_Display += !string.IsNullOrEmpty(BGM) ? " BGM : " + BGM : "";
                        Search_Display += !string.IsNullOrEmpty(LAB) ? " LAB : " + LAB : "";
                        Search_Display += !string.IsNullOrEmpty(GOOD_TYPE) ? " GOOD TYPE : " + GOOD_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(LOCATION) ? " LOCATION : " + LOCATION : "";
                        Search_Display += !string.IsNullOrEmpty(STATUS) ? " STATUS : " + STATUS : "";
                        Search_Display += !string.IsNullOrEmpty(IMAGE_LINK) ? " IMAGE LINK : " + IMAGE_LINK : "";
                        Search_Display += !string.IsNullOrEmpty(VIDEO_LINK) ? " VIDEO LINK : " + VIDEO_LINK : "";
                        Search_Display += !string.IsNullOrEmpty(LENGTH) ? " LENGTH : " + LENGTH : "";
                        Search_Display += !string.IsNullOrEmpty(WIDTH) ? " WIDTH : " + WIDTH : "";
                        Search_Display += !string.IsNullOrEmpty(DEPTH) ? " DEPTH : " + DEPTH : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_PER) ? " TABLE PER : " + TABLE_PER : "";
                        Search_Display += !string.IsNullOrEmpty(DEPTH_PER) ? " DEPTH PER : " + DEPTH_PER : "";
                        Search_Display += !string.IsNullOrEmpty(CROWN_ANGLE) ? " CROWN ANGLE : " + CROWN_ANGLE : "";
                        Search_Display += !string.IsNullOrEmpty(CROWN_HEIGHT) ? " CROWN HEIGHT : " + CROWN_HEIGHT : "";
                        Search_Display += !string.IsNullOrEmpty(PAVILION_ANGLE) ? " PAVILION ANGLE : " + PAVILION_ANGLE : "";
                        Search_Display += !string.IsNullOrEmpty(PAVILION_HEIGHT) ? " PAVILION HEIGHT : " + PAVILION_HEIGHT : "";
                        Search_Display += !string.IsNullOrEmpty(GIRDLE_PER) ? " GIRDLE PER : " + GIRDLE_PER : "";
                        Search_Display += !string.IsNullOrEmpty(OFFER_DISC) ? " OFFER DISC : " + OFFER_DISC : "";
                        Search_Display += !string.IsNullOrEmpty(OFFER_AMOUNT) ? " OFFER AMOUNT : " + OFFER_AMOUNT : "";
                        Search_Display += !string.IsNullOrEmpty(PRICE_PER_CTS) ? " PRICE PER CTS : " + PRICE_PER_CTS : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_BLACK) ? " TABLE BLACK : " + TABLE_BLACK : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_WHITE) ? " TABLE WHITE : " + TABLE_WHITE : "";
                        Search_Display += !string.IsNullOrEmpty(SIDE_BLACK) ? " SIDE BLACK : " + SIDE_BLACK : "";
                        Search_Display += !string.IsNullOrEmpty(SIDE_WHITE) ? " SIDE WHITE : " + SIDE_WHITE : "";
                        Search_Display += !string.IsNullOrEmpty(TABLE_OPEN) ? " TABLE OPEN : " + TABLE_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(CROWN_OPEN) ? " CROWN OPEN : " + CROWN_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(PAVILION_OPEN) ? " PAVILION OPEN : " + PAVILION_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(GIRDLE_OPEN) ? " GIRDLE OPEN : " + GIRDLE_OPEN : "";
                        Search_Display += !string.IsNullOrEmpty(KEY_TO_SYMBOL_TRUE) ? " KEY TO SYMBOL TRUE : " + KEY_TO_SYMBOL_TRUE : "";
                        Search_Display += !string.IsNullOrEmpty(KEY_TO_SYMBOL_FALSE) ? " KEY TO SYMBOL FALSE : " + KEY_TO_SYMBOL_FALSE : "";
                        Search_Display += !string.IsNullOrEmpty(LAB_COMMENTS_TRUE) ? " LAB COMMENTS TRUE : " + LAB_COMMENTS_TRUE : "";
                        Search_Display += !string.IsNullOrEmpty(LAB_COMMENTS_FALSE) ? " LAB COMMENTS FALSE : " + LAB_COMMENTS_FALSE : "";
                        Search_Display += !string.IsNullOrEmpty(FANCY_COLOR) ? " FANCY COLOR : " + FANCY_COLOR : "";
                        Search_Display += !string.IsNullOrEmpty(FANCY_INTENSITY) ? " FANCY INTENSITY : " + FANCY_INTENSITY : "";
                        Search_Display += !string.IsNullOrEmpty(FANCY_OVERTONE) ? " FANCY OVERTONE : " + FANCY_OVERTONE : "";
                        Search_Display += !string.IsNullOrEmpty(POINTER) ? " POINTER : " + POINTER : "";
                        Search_Display += !string.IsNullOrEmpty(STAR_LN) ? " STAR LN : " + STAR_LN : "";
                        Search_Display += !string.IsNullOrEmpty(LR_HALF) ? " LR HALF : " + LR_HALF : "";
                        Search_Display += !string.IsNullOrEmpty(CERT_TYPE) ? " CERT TYPE : " + CERT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(COST_RATE) ? " COST RATE : " + COST_RATE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE1 : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE2 : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(DISCOUNT_TYPE) ? " DISCOUNT TYPE3 : " + DISCOUNT_TYPE : "";
                        Search_Display += !string.IsNullOrEmpty(SIGN) ? " SIGN : " + SIGN : "";
                        Search_Display += !string.IsNullOrEmpty(DISC_VALUE) ? " DISC VALUE : " + DISC_VALUE : "";
                        Search_Display += !string.IsNullOrEmpty(SUPP_STOCK_ID) ? " SUPP STOCK ID : " + SUPP_STOCK_ID : "";
                        Search_Display += " \"}";

                        if (report_Lab_Filter.Report_Filter_Parameter_List.Count() != i)
                        {
                            Search_Display += ",";
                        }
                        i++;
                    }
                    Search_Display += "]";
                    report_Search_Save.Search_Display = Search_Display;
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                    var result = await _supplierService.Create_Update_Report_Search(report_Search_Save, (int)user_Id);
                    if (result == "success")
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.SearchedReportUpdated
                        });
                    }
                    else if (result == "exist")
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.SearchedReportNameExist,
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Report_Search_Save", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_report_search_save")]
        [Authorize]
        public async Task<IActionResult> Delete_Report_Search_Save(int id)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var result = await _supplierService.Delete_Report_Search(id);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.SearchedReportDeleted
                        });
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Report_Search_Save", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_report_layout_save")]
        [Authorize]
        public async Task<IActionResult> Get_Report_Layout_Save(int User_Id, int Rm_Id)
        {
            try
            {
                var result = await _supplierService.Get_Report_Layout_Save(User_Id, Rm_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Report_Layout_Save", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_report_layout_save")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Report_Layout_Save(Report_Layout_Save report_Layout_Save)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var (message, report_layout_save_Id) = await _supplierService.Create_Update_Report_Layout_Save(report_Layout_Save);
                    if (message == "success" && report_layout_save_Id > 0)
                    {
                        if (report_Layout_Save.Report_Layout_Save_Detail_List != null && report_Layout_Save.Report_Layout_Save_Detail_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Id", typeof(int));
                            dataTable.Columns.Add("Report_Layout_Id", typeof(int));
                            dataTable.Columns.Add("colId", typeof(string));
                            dataTable.Columns.Add("width", typeof(int));
                            dataTable.Columns.Add("hide", typeof(bool));
                            dataTable.Columns.Add("pinned", typeof(string));
                            dataTable.Columns.Add("sort", typeof(string));
                            dataTable.Columns.Add("sortIndex", typeof(int));
                            dataTable.Columns.Add("aggFunc", typeof(string));
                            dataTable.Columns.Add("rowGroup", typeof(bool));
                            dataTable.Columns.Add("rowGroupIndex", typeof(int));
                            dataTable.Columns.Add("pivot", typeof(bool));
                            dataTable.Columns.Add("pivotIndex", typeof(int));
                            dataTable.Columns.Add("flex", typeof(int));

                            foreach (var item in report_Layout_Save.Report_Layout_Save_Detail_List)
                            {
                                dataTable.Rows.Add(item.Id, report_layout_save_Id, item.colId, item.width, item.hide, item.pinned, item.sort, item.sortIndex, item.aggFunc, item.rowGroup, item.rowGroupIndex, item.pivot, item.pivotIndex, item.flex);
                            }
                            await _supplierService.Insert_Update_Report_Layout_Save_Detail(dataTable);
                        }
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = report_Layout_Save.Id > 0 ? CoreCommonMessage.LayoutReportUpdated : CoreCommonMessage.LayoutReportCreated
                        });
                    }
                    else if (message == "exist")
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.LayoutReportNameExist,
                        });

                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Report_Layout_Save", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_report_layout_save")]
        [Authorize]
        public async Task<IActionResult> Delete_Report_Layout_Save(int id)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var result = await _supplierService.Delete_Report_Layout_Save(id);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.LayoutReportDeleted
                        });
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Report_Layout_Save", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("update_report_layout_save_status")]
        [Authorize]
        public async Task<IActionResult> Update_Report_Layout_Save_Status(int id, int user_Id, int rm_Id)
        {
            try
            {
                var result = await _supplierService.Update_Report_Layout_Save_Status(id, user_Id, rm_Id);
                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.TempLayoutStatusUpdate
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Report_Layout_Save_Status", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        //[HttpPost]
        //[Route("get_report_search_total")]
        //[Authorize]
        //public async Task<IActionResult> Get_Report_Search_Total(Report_Filter report_Filter)
        //{
        //    try
        //    {
        //        var (_, totalRecordr, totalCtsr, totalAmtr, totalDiscr, _) = await _supplierService.Get_Report_Search(report_Filter.id, report_Filter.Report_Filter_Parameter, report_Filter.iPgNo ?? 0, report_Filter.iPgSize ?? 0, report_Filter.iSort);
        //        if (!string.IsNullOrEmpty(totalRecordr) && !string.IsNullOrEmpty(totalCtsr) && !string.IsNullOrEmpty(totalAmtr) && !string.IsNullOrEmpty(totalDiscr))
        //        {
        //            return Ok(new
        //            {
        //                statusCode = HttpStatusCode.OK,
        //                message = CoreCommonMessage.DataSuccessfullyFound,
        //                total_Records = totalRecordr,
        //                total_Cts = totalCtsr,
        //                total_Amt = totalAmtr,
        //                total_Disc = totalDiscr
        //            });
        //        }
        //        return NoContent();
        //    }
        //    catch (Exception ex)
        //    {
        //        await _commonService.InsertErrorLog(ex.Message, "Get_Report_Search_Total", ex.StackTrace);
        //        return StatusCode((int)HttpStatusCode.InternalServerError, new
        //        {
        //            message = ex.Message
        //        });
        //    }
        //}

        [HttpPost]
        [Route("get_lab_report_search_total")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Report_Search_Total(Report_Lab_Filter report_Lab_Filter)
        {
            try
            {
                string STOCK_ID = string.Empty, SUPPLIER = string.Empty, CUSTOMER = string.Empty, SHAPE = string.Empty,
                         CTS = string.Empty, COLOR = string.Empty, CLARITY = string.Empty, CUT = string.Empty,
                         POLISH = string.Empty, SYMM = string.Empty, FLS_INTENSITY = string.Empty, BGM = string.Empty,
                         LAB = string.Empty, GOOD_TYPE = string.Empty, LOCATION = string.Empty, STATUS = string.Empty,
                         IMAGE_LINK = string.Empty, VIDEO_LINK = string.Empty, LENGTH = string.Empty, WIDTH = string.Empty,
                         DEPTH = string.Empty, TABLE_PER = string.Empty, DEPTH_PER = string.Empty, CROWN_ANGLE = string.Empty,
                         CROWN_HEIGHT = string.Empty, PAVILION_ANGLE = string.Empty, PAVILION_HEIGHT = string.Empty, GIRDLE_PER = string.Empty,
                         RAP_RATE = string.Empty, RAP_AMOUNT = string.Empty, COST_DISC = string.Empty, COST_AMOUNT = string.Empty,
                         OFFER_DISC = string.Empty, OFFER_VALUE = string.Empty, BASE_DISC = string.Empty, BASE_AMOUNT = string.Empty,
                         PRICE_PER_CTS = string.Empty, MAX_SLAB_BASE_DISC = string.Empty, MAX_SLAB_BASE_AMOUNT = string.Empty, MAX_SLAB_PRICE_PER_CTS = string.Empty,
                         BUYER_DISC = string.Empty, BUYER_AMOUNT = string.Empty, TABLE_BLACK = string.Empty, TABLE_WHITE = string.Empty, SIDE_BLACK = string.Empty, SIDE_WHITE = string.Empty,
                         TABLE_OPEN = string.Empty, CROWN_OPEN = string.Empty, PAVILION_OPEN = string.Empty,
                         GIRDLE_OPEN = string.Empty, CULET = string.Empty, KEY_TO_SYMBOL_TRUE = string.Empty,
                         KEY_TO_SYMBOL_FALSE = string.Empty, LAB_COMMENTS_TRUE = string.Empty, LAB_COMMENTS_FALSE = string.Empty,
                         FANCY_COLOR = string.Empty, FANCY_INTENSITY = string.Empty, FANCY_OVERTONE = string.Empty, POINTER = string.Empty, SUB_POINTER = string.Empty,
                         STAR_LN = string.Empty, LR_HALF = string.Empty, CERT_TYPE = string.Empty, COST_RATE = string.Empty, RATIO = string.Empty, DISCOUNT_TYPE = string.Empty,
                         SIGN = string.Empty, DISC_VALUE = string.Empty, DISC_VALUE1 = string.Empty, DISC_VALUE2 = string.Empty, DISC_VALUE3 = string.Empty, BASE_TYPE = string.Empty, SUPP_STOCK_ID = string.Empty,
                         BID_SUPP_STOCK_ID = string.Empty, BID_BUYER_DISC = string.Empty, BID_BUYER_AMOUNT = string.Empty,
                         LUSTER = string.Empty, SHADE = string.Empty, MILKY = string.Empty, GIRDLE_FROM = string.Empty, GIRDLE_TO = string.Empty, GIRDLE_CONDITION = string.Empty, ORIGIN = string.Empty,
                         EXTRA_FACET_TABLE = string.Empty, EXTRA_FACET_CROWN = string.Empty, EXTRA_FACET_PAV = string.Empty,
                         INTERNAL_GRAINING = string.Empty, H_A = string.Empty, SUPPLIER_COMMENTS = string.Empty;

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("SUPPLIER", typeof(string));
                dataTable.Columns.Add("CUSTOMER", typeof(string));
                dataTable.Columns.Add("SHAPE", typeof(string));
                dataTable.Columns.Add("CTS", typeof(string));
                dataTable.Columns.Add("COLOR", typeof(string));
                dataTable.Columns.Add("CLARITY", typeof(string));
                dataTable.Columns.Add("CUT", typeof(string));
                dataTable.Columns.Add("POLISH", typeof(string));
                dataTable.Columns.Add("SYMM", typeof(string));
                dataTable.Columns.Add("FLS_INTENSITY", typeof(string));
                dataTable.Columns.Add("BGM", typeof(string));
                dataTable.Columns.Add("LAB", typeof(string));
                dataTable.Columns.Add("GOOD_TYPE", typeof(string));
                dataTable.Columns.Add("LOCATION", typeof(string));
                dataTable.Columns.Add("STATUS", typeof(string));
                dataTable.Columns.Add("IMAGE_LINK", typeof(string));
                dataTable.Columns.Add("VIDEO_LINK", typeof(string));
                dataTable.Columns.Add("LENGTH", typeof(string));
                dataTable.Columns.Add("WIDTH", typeof(string));
                dataTable.Columns.Add("DEPTH", typeof(string));
                dataTable.Columns.Add("TABLE_PER", typeof(string));
                dataTable.Columns.Add("DEPTH_PER", typeof(string));
                dataTable.Columns.Add("CROWN_ANGLE", typeof(string));
                dataTable.Columns.Add("CROWN_HEIGHT", typeof(string));
                dataTable.Columns.Add("PAVILION_ANGLE", typeof(string));
                dataTable.Columns.Add("PAVILION_HEIGHT", typeof(string));
                dataTable.Columns.Add("GIRDLE_PER", typeof(string));
                dataTable.Columns.Add("RAP_RATE", typeof(string));
                dataTable.Columns.Add("RAP_AMOUNT", typeof(string));
                dataTable.Columns.Add("COST_DISC", typeof(string));
                dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable.Columns.Add("BASE_DISC", typeof(string));
                dataTable.Columns.Add("BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BUYER AMOUNT", typeof(string));
                dataTable.Columns.Add("TABLE_BLACK", typeof(string));
                dataTable.Columns.Add("TABLE_WHITE", typeof(string));
                dataTable.Columns.Add("SIDE_BLACK", typeof(string));
                dataTable.Columns.Add("SIDE_WHITE", typeof(string));
                dataTable.Columns.Add("TABLE_OPEN", typeof(string));
                dataTable.Columns.Add("CROWN_OPEN", typeof(string));
                dataTable.Columns.Add("PAVILION_OPEN", typeof(string));
                dataTable.Columns.Add("GIRDLE_OPEN", typeof(string));
                dataTable.Columns.Add("CULET", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_TRUE", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_FALSE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_TRUE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_FALSE", typeof(string));
                dataTable.Columns.Add("FANCY_COLOR", typeof(string));
                dataTable.Columns.Add("FANCY_INTENSITY", typeof(string));
                dataTable.Columns.Add("FANCY_OVERTONE", typeof(string));
                dataTable.Columns.Add("POINTER", typeof(string));
                dataTable.Columns.Add("SUB_POINTER", typeof(string));
                dataTable.Columns.Add("STAR_LN", typeof(string));
                dataTable.Columns.Add("LR_HALF", typeof(string));
                dataTable.Columns.Add("CERT_TYPE", typeof(string));
                dataTable.Columns.Add("COST_RATE", typeof(string));
                dataTable.Columns.Add("RATIO", typeof(string));
                dataTable.Columns.Add("DISCOUNT_TYPE", typeof(string));
                dataTable.Columns.Add("SIGN", typeof(string));
                dataTable.Columns.Add("DISC_VALUE", typeof(string));
                dataTable.Columns.Add("DISC_VALUE1", typeof(string));
                dataTable.Columns.Add("DISC_VALUE2", typeof(string));
                dataTable.Columns.Add("DISC_VALUE3", typeof(string));
                dataTable.Columns.Add("BASE_TYPE", typeof(string));
                dataTable.Columns.Add("SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BID_BUYER_AMOUNT", typeof(string));
                dataTable.Columns.Add("LUSTER", typeof(string));
                dataTable.Columns.Add("SHADE", typeof(string));
                dataTable.Columns.Add("MILKY", typeof(string));
                dataTable.Columns.Add("GIRDLE_FROM", typeof(string));
                dataTable.Columns.Add("GIRDLE_TO", typeof(string));
                dataTable.Columns.Add("GIRDLE_CONDITION", typeof(string));
                dataTable.Columns.Add("ORIGIN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_PAV", typeof(string));
                dataTable.Columns.Add("INTERNAL_GRAINING", typeof(string));
                dataTable.Columns.Add("H_A", typeof(string));
                dataTable.Columns.Add("SUPPLIER_COMMENTS", typeof(string));

                if (report_Lab_Filter.Report_Filter_Parameter_List != null && report_Lab_Filter.Report_Filter_Parameter_List.Count > 0)
                {
                    foreach (var item in report_Lab_Filter.Report_Filter_Parameter_List)
                    {
                        STOCK_ID = item.Where(x => x.Column_Name == "STOCK ID" || x.Column_Name == "CERTIFICATE NO" || x.Column_Name == "SUPPLIER NO").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER = item.Where(x => x.Column_Name == "SUPPLIER" || x.Column_Name == "COMPANY").Select(x => x.Category_Value).FirstOrDefault();
                        CUSTOMER = item.Where(x => x.Column_Name == "CUSTOMER").Select(x => x.Category_Value).FirstOrDefault();
                        SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Value).FirstOrDefault();
                        CTS = item.Where(x => x.Column_Name == "CTS").Select(x => x.Category_Value).FirstOrDefault();
                        COLOR = item.Where(x => x.Column_Name == "COLOR").Select(x => x.Category_Value).FirstOrDefault();
                        CLARITY = item.Where(x => x.Column_Name == "CLARITY").Select(x => x.Category_Value).FirstOrDefault();
                        CUT = item.Where(x => x.Column_Name == "CUT").Select(x => x.Category_Value).FirstOrDefault();
                        POLISH = item.Where(x => x.Column_Name == "POLISH").Select(x => x.Category_Value).FirstOrDefault();
                        SYMM = item.Where(x => x.Column_Name == "SYMM").Select(x => x.Category_Value).FirstOrDefault();
                        FLS_INTENSITY = item.Where(x => x.Column_Name == "FLS INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                        BGM = item.Where(x => x.Column_Name == "BGM").Select(x => x.Category_Value).FirstOrDefault();
                        LAB = item.Where(x => x.Column_Name == "LAB").Select(x => x.Category_Value).FirstOrDefault();
                        GOOD_TYPE = item.Where(x => x.Column_Name == "GOOD TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        LOCATION = item.Where(x => x.Column_Name == "LOCATION").Select(x => x.Category_Value).FirstOrDefault();
                        STATUS = item.Where(x => x.Column_Name == "STATUS").Select(x => x.Category_Value).FirstOrDefault();
                        IMAGE_LINK = item.Where(x => x.Column_Name == "IMAGE LINK").Select(x => x.Category_Value).FirstOrDefault();
                        VIDEO_LINK = item.Where(x => x.Column_Name == "VIDEO LINK").Select(x => x.Category_Value).FirstOrDefault();
                        LENGTH = item.Where(x => x.Column_Name == "LENGTH").Select(x => x.Category_Value).FirstOrDefault();
                        WIDTH = item.Where(x => x.Column_Name == "WIDTH").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH = item.Where(x => x.Column_Name == "DEPTH").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_PER = item.Where(x => x.Column_Name == "TABLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        DEPTH_PER = item.Where(x => x.Column_Name == "DEPTH PER").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_ANGLE = item.Where(x => x.Column_Name == "CROWN ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_HEIGHT = item.Where(x => x.Column_Name == "CROWN HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_ANGLE = item.Where(x => x.Column_Name == "PAVILION ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_HEIGHT = item.Where(x => x.Column_Name == "PAVILION HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_PER = item.Where(x => x.Column_Name == "GIRDLE PER").Select(x => x.Category_Value).FirstOrDefault();
                        RAP_RATE = item.Where(x => x.Column_Name == "RAP RATE").Select(x => x.Category_Value).FirstOrDefault();
                        RAP_AMOUNT = item.Where(x => x.Column_Name == "RAP AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        COST_DISC = item.Where(x => x.Column_Name == "COST DISC").Select(x => x.Category_Value).FirstOrDefault();
                        COST_AMOUNT = item.Where(x => x.Column_Name == "COST AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_DISC = item.Where(x => x.Column_Name == "OFFER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        OFFER_VALUE = item.Where(x => x.Column_Name == "OFFER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_DISC = item.Where(x => x.Column_Name == "BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_AMOUNT = item.Where(x => x.Column_Name == "BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        PRICE_PER_CTS = item.Where(x => x.Column_Name == "PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_BASE_DISC = item.Where(x => x.Column_Name == "MAX SLAB BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_BASE_AMOUNT = item.Where(x => x.Column_Name == "MAX SLAB BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        MAX_SLAB_PRICE_PER_CTS = item.Where(x => x.Column_Name == "MAX SLAB PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                        BUYER_DISC = item.Where(x => x.Column_Name == "BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BUYER_AMOUNT = item.Where(x => x.Column_Name == "BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_BLACK = item.Where(x => x.Column_Name == "TABLE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_WHITE = item.Where(x => x.Column_Name == "TABLE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                        SIDE_BLACK = item.Where(x => x.Column_Name == "SIDE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                        SIDE_WHITE = item.Where(x => x.Column_Name == "SIDE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                        TABLE_OPEN = item.Where(x => x.Column_Name == "TABLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        CROWN_OPEN = item.Where(x => x.Column_Name == "CROWN OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        PAVILION_OPEN = item.Where(x => x.Column_Name == "PAVILION OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_OPEN = item.Where(x => x.Column_Name == "GIRDLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                        CULET = item.Where(x => x.Column_Name == "CULET").Select(x => x.Category_Value).FirstOrDefault();
                        KEY_TO_SYMBOL_TRUE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_TRUE).FirstOrDefault();
                        KEY_TO_SYMBOL_FALSE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_FALSE).FirstOrDefault();
                        LAB_COMMENTS_TRUE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_TRUE).FirstOrDefault();
                        LAB_COMMENTS_FALSE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_FALSE).FirstOrDefault();
                        FANCY_COLOR = item.Where(x => x.Column_Name == "FANCY COLOR").Select(x => x.Category_Value).FirstOrDefault();
                        FANCY_INTENSITY = item.Where(x => x.Column_Name == "FANCY INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                        FANCY_OVERTONE = item.Where(x => x.Column_Name == "FANCY OVERTONE").Select(x => x.Category_Value).FirstOrDefault();
                        POINTER = item.Where(x => x.Column_Name == "POINTER").Select(x => x.Category_Value).FirstOrDefault();
                        SUB_POINTER = item.Where(x => x.Column_Name == "SUB POINTER").Select(x => x.Category_Value).FirstOrDefault();
                        STAR_LN = item.Where(x => x.Column_Name == "STAR LN").Select(x => x.Category_Value).FirstOrDefault();
                        LR_HALF = item.Where(x => x.Column_Name == "LR HALF").Select(x => x.Category_Value).FirstOrDefault();
                        CERT_TYPE = item.Where(x => x.Column_Name == "CERT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        COST_RATE = item.Where(x => x.Column_Name == "COST RATE").Select(x => x.Category_Value).FirstOrDefault();
                        RATIO = item.Where(x => x.Column_Name == "RATIO").Select(x => x.Category_Value).FirstOrDefault();
                        DISCOUNT_TYPE = item.Where(x => x.Column_Name == "DISCOUNT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SIGN = item.Where(x => x.Column_Name == "SIGN").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE = item.Where(x => x.Column_Name == "DISC VALUE").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE1 = item.Where(x => x.Column_Name == "DISC VALUE1").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE2 = item.Where(x => x.Column_Name == "DISC VALUE2").Select(x => x.Category_Value).FirstOrDefault();
                        DISC_VALUE3 = item.Where(x => x.Column_Name == "DISC VALUE3").Select(x => x.Category_Value).FirstOrDefault();
                        BASE_TYPE = item.Where(x => x.Column_Name == "BASE TYPE").Select(x => x.Category_Value).FirstOrDefault();
                        SUPP_STOCK_ID = item.Where(x => x.Column_Name == "SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        BID_SUPP_STOCK_ID = item.Where(x => x.Column_Name == "BID SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                        BID_BUYER_DISC = item.Where(x => x.Column_Name == "BID BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                        BID_BUYER_AMOUNT = item.Where(x => x.Column_Name == "BID BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                        LUSTER = item.Where(x => x.Column_Name == "LUSTER").Select(x => x.Category_Value).FirstOrDefault();
                        SHADE = item.Where(x => x.Column_Name == "SHADE").Select(x => x.Category_Value).FirstOrDefault();
                        MILKY = item.Where(x => x.Column_Name == "MILKY").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_FROM = item.Where(x => x.Column_Name == "GIRDLE_FROM").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_TO = item.Where(x => x.Column_Name == "GIRDLE_TO").Select(x => x.Category_Value).FirstOrDefault();
                        GIRDLE_CONDITION = item.Where(x => x.Column_Name == "GIRDLE_CONDITION").Select(x => x.Category_Value).FirstOrDefault();
                        ORIGIN = item.Where(x => x.Column_Name == "ORIGIN").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_TABLE = item.Where(x => x.Column_Name == "EXTRA_FACET_TABLE").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_CROWN = item.Where(x => x.Column_Name == "EXTRA_FACET_CROWN").Select(x => x.Category_Value).FirstOrDefault();
                        EXTRA_FACET_PAV = item.Where(x => x.Column_Name == "EXTRA_FACET_PAV").Select(x => x.Category_Value).FirstOrDefault();
                        INTERNAL_GRAINING = item.Where(x => x.Column_Name == "INTERNAL_GRAINING").Select(x => x.Category_Value).FirstOrDefault();
                        H_A = item.Where(x => x.Column_Name == "H_A").Select(x => x.Category_Value).FirstOrDefault();
                        SUPPLIER_COMMENTS = item.Where(x => x.Column_Name == "SUPPLIER_COMMENTS").Select(x => x.Category_Value).FirstOrDefault();

                        dataTable.Rows.Add(!string.IsNullOrEmpty(STOCK_ID) ? STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(SUPPLIER) ? SUPPLIER : DBNull.Value,
                            !string.IsNullOrEmpty(CUSTOMER) ? CUSTOMER : DBNull.Value,
                            !string.IsNullOrEmpty(SHAPE) ? SHAPE : DBNull.Value,
                            !string.IsNullOrEmpty(CTS) ? CTS : DBNull.Value,
                            !string.IsNullOrEmpty(COLOR) ? COLOR : DBNull.Value,
                            !string.IsNullOrEmpty(CLARITY) ? CLARITY : DBNull.Value,
                            !string.IsNullOrEmpty(CUT) ? CUT : DBNull.Value,
                            !string.IsNullOrEmpty(POLISH) ? POLISH : DBNull.Value,
                            !string.IsNullOrEmpty(SYMM) ? SYMM : DBNull.Value,
                            !string.IsNullOrEmpty(FLS_INTENSITY) ? FLS_INTENSITY : DBNull.Value,
                            !string.IsNullOrEmpty(BGM) ? BGM : DBNull.Value,
                            !string.IsNullOrEmpty(LAB) ? LAB : DBNull.Value,
                            !string.IsNullOrEmpty(GOOD_TYPE) ? GOOD_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(LOCATION) ? LOCATION : DBNull.Value,
                            !string.IsNullOrEmpty(STATUS) ? STATUS : DBNull.Value,
                            !string.IsNullOrEmpty(IMAGE_LINK) ? IMAGE_LINK : DBNull.Value,
                            !string.IsNullOrEmpty(VIDEO_LINK) ? VIDEO_LINK : DBNull.Value,
                            !string.IsNullOrEmpty(LENGTH) ? LENGTH : DBNull.Value,
                            !string.IsNullOrEmpty(WIDTH) ? WIDTH : DBNull.Value,
                            !string.IsNullOrEmpty(DEPTH) ? DEPTH : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_PER) ? TABLE_PER : DBNull.Value,
                            !string.IsNullOrEmpty(DEPTH_PER) ? DEPTH_PER : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_ANGLE) ? CROWN_ANGLE : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_HEIGHT) ? CROWN_HEIGHT : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_ANGLE) ? PAVILION_ANGLE : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_HEIGHT) ? PAVILION_HEIGHT : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_PER) ? GIRDLE_PER : DBNull.Value,
                            !string.IsNullOrEmpty(RAP_RATE) ? RAP_RATE : DBNull.Value,
                            !string.IsNullOrEmpty(RAP_AMOUNT) ? RAP_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(COST_DISC) ? COST_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(COST_AMOUNT) ? COST_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(OFFER_DISC) ? OFFER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(OFFER_VALUE) ? OFFER_VALUE : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_DISC) ? BASE_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_AMOUNT) ? BASE_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(PRICE_PER_CTS) ? PRICE_PER_CTS : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_BASE_DISC) ? MAX_SLAB_BASE_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_BASE_AMOUNT) ? MAX_SLAB_BASE_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(MAX_SLAB_PRICE_PER_CTS) ? MAX_SLAB_PRICE_PER_CTS : DBNull.Value,
                            !string.IsNullOrEmpty(BUYER_DISC) ? BUYER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BUYER_AMOUNT) ? BUYER_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_BLACK) ? TABLE_BLACK : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_WHITE) ? TABLE_WHITE : DBNull.Value,
                            !string.IsNullOrEmpty(SIDE_BLACK) ? SIDE_BLACK : DBNull.Value,
                            !string.IsNullOrEmpty(SIDE_WHITE) ? SIDE_WHITE : DBNull.Value,
                            !string.IsNullOrEmpty(TABLE_OPEN) ? TABLE_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(CROWN_OPEN) ? CROWN_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(PAVILION_OPEN) ? PAVILION_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_OPEN) ? GIRDLE_OPEN : DBNull.Value,
                            !string.IsNullOrEmpty(CULET) ? CULET : DBNull.Value,
                            !string.IsNullOrEmpty(KEY_TO_SYMBOL_TRUE) ? KEY_TO_SYMBOL_TRUE : DBNull.Value,
                            !string.IsNullOrEmpty(KEY_TO_SYMBOL_FALSE) ? KEY_TO_SYMBOL_FALSE : DBNull.Value,
                            !string.IsNullOrEmpty(LAB_COMMENTS_TRUE) ? LAB_COMMENTS_TRUE : DBNull.Value,
                            !string.IsNullOrEmpty(LAB_COMMENTS_FALSE) ? LAB_COMMENTS_FALSE : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_COLOR) ? FANCY_COLOR : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_INTENSITY) ? FANCY_INTENSITY : DBNull.Value,
                            !string.IsNullOrEmpty(FANCY_OVERTONE) ? FANCY_OVERTONE : DBNull.Value,
                            !string.IsNullOrEmpty(POINTER) ? POINTER : DBNull.Value,
                            !string.IsNullOrEmpty(SUB_POINTER) ? SUB_POINTER : DBNull.Value,
                            !string.IsNullOrEmpty(STAR_LN) ? STAR_LN : DBNull.Value,
                            !string.IsNullOrEmpty(LR_HALF) ? LR_HALF : DBNull.Value,
                            !string.IsNullOrEmpty(CERT_TYPE) ? CERT_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(COST_RATE) ? COST_RATE : DBNull.Value,
                            !string.IsNullOrEmpty(RATIO) ? RATIO : DBNull.Value,
                            !string.IsNullOrEmpty(DISCOUNT_TYPE) ? DISCOUNT_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(SIGN) ? SIGN : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE) ? DISC_VALUE : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE1) ? DISC_VALUE1 : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE2) ? DISC_VALUE2 : DBNull.Value,
                            !string.IsNullOrEmpty(DISC_VALUE3) ? DISC_VALUE3 : DBNull.Value,
                            !string.IsNullOrEmpty(BASE_TYPE) ? BASE_TYPE : DBNull.Value,
                            !string.IsNullOrEmpty(SUPP_STOCK_ID) ? SUPP_STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(BID_SUPP_STOCK_ID) ? BID_SUPP_STOCK_ID : DBNull.Value,
                            !string.IsNullOrEmpty(BID_BUYER_DISC) ? BID_BUYER_DISC : DBNull.Value,
                            !string.IsNullOrEmpty(BID_BUYER_AMOUNT) ? BID_BUYER_AMOUNT : DBNull.Value,
                            !string.IsNullOrEmpty(LUSTER) ? LUSTER : DBNull.Value,
                            !string.IsNullOrEmpty(SHADE) ? SHADE : DBNull.Value,
                            !string.IsNullOrEmpty(MILKY) ? MILKY : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_FROM) ? GIRDLE_FROM : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_TO) ? GIRDLE_TO : DBNull.Value,
                            !string.IsNullOrEmpty(GIRDLE_CONDITION) ? GIRDLE_CONDITION : DBNull.Value,
                            !string.IsNullOrEmpty(ORIGIN) ? ORIGIN : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_TABLE) ? EXTRA_FACET_TABLE : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_CROWN) ? EXTRA_FACET_CROWN : DBNull.Value,
                            !string.IsNullOrEmpty(EXTRA_FACET_PAV) ? EXTRA_FACET_PAV : DBNull.Value,
                            !string.IsNullOrEmpty(INTERNAL_GRAINING) ? INTERNAL_GRAINING : DBNull.Value,
                            !string.IsNullOrEmpty(H_A) ? H_A : DBNull.Value,
                            !string.IsNullOrEmpty(SUPPLIER_COMMENTS) ? SUPPLIER_COMMENTS : DBNull.Value);
                    }
                }
                else
                {
                    DataRow newRow = dataTable.NewRow();
                    for (int i = 0; i < dataTable.Columns.Count; i++)
                    {
                        newRow[i] = DBNull.Value;
                    }
                    dataTable.Rows.Add(newRow);
                }
                var (result, totalRecordr, totalCtsr, totalAmtr, totalDiscr, totalBaseDisc, totalBaseAmt, totalOfferDisc, totalOfferAmt, totalMaxSlabDisc, totalMaxSlabAmt, totalRap_Amount) = await _supplierService.Get_Lab_Search_Report_Search_Total(dataTable, report_Lab_Filter.iPgNo ?? 0, report_Lab_Filter.iPgSize ?? 0, report_Lab_Filter.iSort);
                if (result != null)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        total_Records = totalRecordr,
                        total_Cts = totalCtsr,
                        total_Amt = totalAmtr,
                        total_Disc = totalDiscr,
                        total_Base_Disc = totalBaseDisc,
                        total_Base_Amt = totalBaseAmt,
                        total_Offer_Disc = totalOfferDisc,
                        total_Offer_Amt = totalOfferAmt,
                        total_MaxSlab_Disc = totalMaxSlabDisc,
                        total_MaxSlab_Amt = totalMaxSlabAmt,
                        total_Rap_Amt = totalRap_Amount,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Report_Search_Total", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("download_image_video_certificate_stock")]
        [Authorize]
        public async Task<IActionResult> Download_Image_Video_Certificate_Stock(Report_Download report_Download)
        {
            try
            {
                var result = await _supplierService.Download_Image_Video_Certificate_Stock(report_Download.ids, report_Download.document_Type);
                if (result != null && result.Count > 0)
                {
                    List<Report_Download_Model> result_List = new List<Report_Download_Model>();
                    foreach (var item in result)
                    {
                        var filePath = report_Download.document_Type == "I" ?
                                   Path.Combine(Directory.GetCurrentDirectory(), "Files/Image") : (report_Download.document_Type == "V" ?
                                   Path.Combine(Directory.GetCurrentDirectory(), "Files/Video") : report_Download.document_Type == "C" ?
                                   Path.Combine(Directory.GetCurrentDirectory(), "Files/Certificate") : "");
                        if (!(Directory.Exists(filePath)))
                        {
                            Directory.CreateDirectory(filePath);
                        }
                        if (report_Download.document_Type == "I")
                        {
                            string filename = "/" + item.Stock_Id + "_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".jpg";
                            filePath += filename;
                            var path = _configuration["BaseUrl"] + "/Files/Image" + filename;
                            try
                            {
                                using (WebClient client = new WebClient())
                                {
                                    client.DownloadFile(item.Url, filePath);
                                }
                                Report_Download_Model r = new Report_Download_Model()
                                {
                                    Stock_Id = item.Stock_Id,
                                    Url = path
                                };
                                result_List.Add(r);
                            }
                            catch (Exception)
                            {

                            }
                        }
                        else if (report_Download.document_Type == "V")
                        {
                            string filename = "/" + item.Stock_Id + "_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".mp4";
                            filePath += filename;
                            var path = _configuration["BaseUrl"] + "/Files/Video" + filename;
                            try
                            {
                                using (WebClient client = new WebClient())
                                {
                                    client.DownloadFile(item.Url, filePath);
                                }
                                Report_Download_Model r = new Report_Download_Model()
                                {
                                    Stock_Id = item.Stock_Id,
                                    Url = path
                                };
                                result_List.Add(r);
                            }
                            catch (Exception)
                            {

                            }

                        }
                        else if (report_Download.document_Type == "C")
                        {
                            string filename = "/" + item.Stock_Id + "_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".pdf";
                            filePath += filename;
                            var path = _configuration["BaseUrl"] + "/Files/Certificate" + filename;
                            try
                            {
                                using (WebClient client = new WebClient())
                                {
                                    client.DownloadFile(item.Url, filePath);
                                }
                                Report_Download_Model r = new Report_Download_Model()
                                {
                                    Stock_Id = item.Stock_Id,
                                    Url = path
                                };
                                result_List.Add(r);
                            }
                            catch (Exception)
                            {
                            }
                        }
                    }
                    if (result_List.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result_List
                        });
                    }
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Download_Image_Video_Certificate_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_stock_report")]
        [Authorize]
        public async Task<IActionResult> Get_Stock_Report(Purchase_Detail_Stock_Report_Model model)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Detail_Stock_Report(model.StockType, model.Contract, model.Upcoming, model.Offer);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        totalRecord = result.Count,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_Search_Report", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("get_stock_report_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Stock_Report_Excel(Report_Lab_Entry_Filter report_Filter)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Detail_Stock_Report_Excel(report_Filter.Stock_Id ?? null);

                if (result != null && result.Rows.Count > 0)
                {

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/StockReportExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }

                    string filename = report_Filter.Process_Name + "_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    EpExcelExport.Create_Transaction_Report_Column_Wise_Excel(result, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.TransactionReportExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Stock_Report_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Cart/Approval Management        
        [HttpPost]
        [Route("create_update_cart")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Cart(Cart_Model cart_Model)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    IList<Cart_Detail> CartResult = JsonConvert.DeserializeObject<IList<Cart_Detail>>(cart_Model.Cart_Detail.ToString());

                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("Supp_Stock_Id", typeof(int));
                    dataTable.Columns.Add("Cts", typeof(double));
                    dataTable.Columns.Add("Cart_Base_Disc", typeof(double));
                    dataTable.Columns.Add("Cart_Base_Amt", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Disc", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Amt", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Disc_Max_Slab", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Amt_Max_Slab", typeof(double));
                    dataTable.Columns.Add("Cart_Offer_Disc", typeof(double));
                    dataTable.Columns.Add("Cart_Offer_Amt", typeof(double));
                    dataTable.Columns.Add("Buyer_Disc", typeof(double));
                    dataTable.Columns.Add("Buyer_Amt", typeof(double));
                    dataTable.Columns.Add("Buyer_Price_Per_Cts", typeof(double));
                    dataTable.Columns.Add("Expected_Final_Disc", typeof(double));
                    dataTable.Columns.Add("Expected_Final_Amt", typeof(double));
                    dataTable.Columns.Add("Cart_Status", typeof(string));


                    foreach (var item in CartResult)
                    {
                        dataTable.Rows.Add(item.Id, item.Supp_Stock_Id,
                            (item.Cts != null ? !string.IsNullOrEmpty(item.Cts.ToString()) ? Convert.ToDouble(item.Cts.ToString()) : null : null),
                            (item.Cart_Base_Disc != null ? !string.IsNullOrEmpty(item.Cart_Base_Disc.ToString()) ? Convert.ToDouble(item.Cart_Base_Disc.ToString()) : null : null),
                            (item.Cart_Base_Amt != null ? !string.IsNullOrEmpty(item.Cart_Base_Amt.ToString()) ? Convert.ToDouble(item.Cart_Base_Amt.ToString()) : null : null),
                            (item.Cart_Final_Disc != null ? !string.IsNullOrEmpty(item.Cart_Final_Disc.ToString()) ? Convert.ToDouble(item.Cart_Final_Disc.ToString()) : null : null),
                            (item.Cart_Final_Amt != null ? !string.IsNullOrEmpty(item.Cart_Final_Amt.ToString()) ? Convert.ToDouble(item.Cart_Final_Amt.ToString()) : null : null),
                            (item.Cart_Final_Disc_Max_Slab != null ? !string.IsNullOrEmpty(item.Cart_Final_Disc_Max_Slab.ToString()) ? Convert.ToDouble(item.Cart_Final_Disc_Max_Slab.ToString()) : null : null),
                            (item.Cart_Final_Amt_Max_Slab != null ? !string.IsNullOrEmpty(item.Cart_Final_Amt_Max_Slab.ToString()) ? Convert.ToDouble(item.Cart_Final_Amt_Max_Slab.ToString()) : null : null),
                            (item.Cart_Offer_Disc != null ? !string.IsNullOrEmpty(item.Cart_Offer_Disc.ToString()) ? Convert.ToDouble(item.Cart_Offer_Disc.ToString()) : null : null),
                            (item.Cart_Offer_Amt != null ? !string.IsNullOrEmpty(item.Cart_Offer_Amt.ToString()) ? Convert.ToDouble(item.Cart_Offer_Amt.ToString()) : null : null),
                            (item.Buyer_Disc != null ? !string.IsNullOrEmpty(item.Buyer_Disc.ToString()) ? Convert.ToDouble(item.Buyer_Disc.ToString()) : null : null),
                            (item.Buyer_Amt != null ? !string.IsNullOrEmpty(item.Buyer_Amt.ToString()) ? Convert.ToDouble(item.Buyer_Amt.ToString()) : null : null),
                            (item.Buyer_Price_Per_Cts != null ? !string.IsNullOrEmpty(item.Buyer_Price_Per_Cts.ToString()) ? Convert.ToDouble(item.Buyer_Price_Per_Cts.ToString()) : null : null),
                            (item.Expected_Final_Disc != null ? !string.IsNullOrEmpty(item.Expected_Final_Disc.ToString()) ? Convert.ToDouble(item.Expected_Final_Disc.ToString()) : null : null),
                            (item.Expected_Final_Amt != null ? !string.IsNullOrEmpty(item.Expected_Final_Amt.ToString()) ? Convert.ToDouble(item.Expected_Final_Amt.ToString()) : null : null),
                            (!string.IsNullOrEmpty(item.Cart_Status) ? item.Cart_Status.ToString() : null));
                    }

                    var (message, result, msg) = await _cartService.Create_Update_Cart(dataTable, cart_Model.Id, (int)cart_Model.User_Id, cart_Model.Customer_Name, cart_Model.Remarks);
                    if ((message == "exist" && msg.Length > 0) || (message == "success" && msg.Length > 0))
                    {
                        // if alredy exists stone add again then message should show succsessfully added.
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = msg

                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Cart", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("delete_cart")]
        [Authorize]
        public async Task<IActionResult> Delete_Cart(JsonElement requestData)
        {
            try
            {
                if (requestData.TryGetProperty("ids", out var idsElement) && idsElement.ValueKind == JsonValueKind.String)
                {
                    string ids = idsElement.GetString();
                    if (!string.IsNullOrEmpty(ids))
                    {
                        var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                        int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                        var (message, result, msg) = await _cartService.Delete_Cart(ids, user_Id ?? 0);
                        if ((message == "exist" && msg.Length > 0) || (message == "success" && msg.Length > 0))
                        {
                            // if alredy exists stone add again then message should show succsessfully deleted.
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = msg

                            });
                        }
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Cart", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("update_cart_validity_date")]
        [Authorize]
        public async Task<IActionResult> Update_Cart_Validity_Date(int Id, string Validity_Date)
        {
            try
            {
                DateTime Valid_Date;

                string dateFormat = "dd-MM-yyyy";

                if (!DateTime.TryParseExact(Validity_Date, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Valid_Date))
                {
                    Valid_Date = DateTime.Now;
                }

                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _cartService.Cart_Update_Validity_Date(Id, Valid_Date, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.CartUpdateValidityDate
                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Cart_Validity_Date", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("approved_or_rejected_by_management")]
        [Authorize]
        public async Task<IActionResult> Approved_Or_Rejected_by_Management(Approval_Management approval_Management)
        {
            try
            {
                var result = await _cartService.Approved_Or_Rejected_by_Management(approval_Management);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = approval_Management.Is_Approved == true ? CoreCommonMessage.StokeApprovedByManagement : CoreCommonMessage.StokeRejectedByManagement
                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Approved_Or_Rejected_by_Management", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }


        [HttpPost]
        [Route("approved_management_update_status")]
        [Authorize]
        public async Task<IActionResult> Approved_Management_Update_Status(Approval_Management_Status approval_Management)
        {
            try
            {
                var result = await _cartService.Approved_Management_Update_Status(approval_Management);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StockStatusManagement
                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Approved_Or_Rejected_by_Management", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_approved_management")]
        [Authorize]
        public async Task<IActionResult> Create_Approved_Management(Approval_Management_Create_Update approval_Management)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    IList<Approval_Detail> app_mang_Result = JsonConvert.DeserializeObject<IList<Approval_Detail>>(approval_Management.Approval_Detail.ToString());

                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("Supp_Stock_Id", typeof(int));
                    dataTable.Columns.Add("Cart_Id", typeof(int));
                    dataTable.Columns.Add("Buyer_Disc", typeof(double));
                    dataTable.Columns.Add("Buyer_Amt", typeof(double));
                    dataTable.Columns.Add("Expected_Final_Disc", typeof(double));
                    dataTable.Columns.Add("Expected_Final_Amt", typeof(double));
                    dataTable.Columns.Add("Offer_Disc", typeof(double));
                    dataTable.Columns.Add("Offer_Amt", typeof(double));
                    dataTable.Columns.Add("Cart_Base_Disc", typeof(double));
                    dataTable.Columns.Add("Cart_Base_Amt", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Disc", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Amt", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Disc_Max_Slab", typeof(double));
                    dataTable.Columns.Add("Cart_Final_Amt_Max_Slab", typeof(double));
                    dataTable.Columns.Add("Buyer_Id", typeof(int));

                    if (app_mang_Result != null && app_mang_Result.Count > 0)
                    {
                        foreach (var item in app_mang_Result)
                        {


                            dataTable.Rows.Add(item.Id, item.Supp_Stock_Id, item.Cart_Id,
                            (item.Buyer_Disc != null ? !string.IsNullOrEmpty(item.Buyer_Disc.ToString()) ? Convert.ToDouble(item.Buyer_Disc.ToString()) : null : null),
                            (item.Buyer_Amt != null ? !string.IsNullOrEmpty(item.Buyer_Amt.ToString()) ? Convert.ToDouble(item.Buyer_Amt.ToString()) : null : null),
                            (item.Expected_Final_Disc != null ? !string.IsNullOrEmpty(item.Expected_Final_Disc.ToString()) ? Convert.ToDouble(item.Expected_Final_Disc.ToString()) : null : null),
                            (item.Expected_Final_Amt != null ? !string.IsNullOrEmpty(item.Expected_Final_Amt.ToString()) ? Convert.ToDouble(item.Expected_Final_Amt.ToString()) : null : null),
                            ((item.Offer_Disc != null || item.Offer_Disc_1 != null) ?
                             (approval_Management.Id == 1 ? (!string.IsNullOrEmpty(item.Offer_Disc_1.ToString()) ? Convert.ToDouble(item.Offer_Disc_1.ToString()) : null)
                             : (!string.IsNullOrEmpty(item.Offer_Disc.ToString()) ? Convert.ToDouble(item.Offer_Disc.ToString()) : null)) : null),
                            ((item.Offer_Amt != null || item.Offer_Amt_1 != null) ?
                             (approval_Management.Id == 1 ? (!string.IsNullOrEmpty(item.Offer_Amt_1.ToString()) ? Convert.ToDouble(item.Offer_Amt_1.ToString()) : null)
                             : (!string.IsNullOrEmpty(item.Offer_Amt.ToString()) ? Convert.ToDouble(item.Offer_Amt.ToString()) : null)) : null),
                            (item.Cart_Base_Disc != null ? !string.IsNullOrEmpty(item.Cart_Base_Disc.ToString()) ? Convert.ToDouble(item.Cart_Base_Disc.ToString()) : null : null),
                            (item.Cart_Base_Amt != null ? !string.IsNullOrEmpty(item.Cart_Base_Amt.ToString()) ? Convert.ToDouble(item.Cart_Base_Amt.ToString()) : null : null),
                            (item.Cart_Final_Disc != null ? !string.IsNullOrEmpty(item.Cart_Final_Disc.ToString()) ? Convert.ToDouble(item.Cart_Final_Disc.ToString()) : null : null),
                            (item.Cart_Final_Amt != null ? !string.IsNullOrEmpty(item.Cart_Final_Amt.ToString()) ? Convert.ToDouble(item.Cart_Final_Amt.ToString()) : null : null),
                            (item.Cart_Final_Disc_Max_Slab != null ? !string.IsNullOrEmpty(item.Cart_Final_Disc_Max_Slab.ToString()) ? Convert.ToDouble(item.Cart_Final_Disc_Max_Slab.ToString()) : null : null),
                            (item.Cart_Final_Amt_Max_Slab != null ? !string.IsNullOrEmpty(item.Cart_Final_Amt_Max_Slab.ToString()) ? Convert.ToDouble(item.Cart_Final_Amt_Max_Slab.ToString()) : null : null),
                            (item.Buyer_Id > 0 ? item.Buyer_Id : approval_Management.User_Id ?? 0));

                        }
                    }

                    var (message, result, msg) = await _cartService.Create_Approved_Management(dataTable, approval_Management.Id, approval_Management.User_Id ?? 0, approval_Management.Remarks, approval_Management.Status);
                    if ((message == "exist" && msg.Length > 0) || (message == "success" && msg.Length > 0))
                    {
                        // if alredy exists stone add again then message should show succsessfully added.
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = msg

                        });
                    }
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Approved_Management", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_order_processing")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Order_Processing(Order_Processing order_Processing)
        {
            try
            {
                IList<Order_Processing_Detail> OrderResult = JsonConvert.DeserializeObject<IList<Order_Processing_Detail>>(order_Processing.Order_Detail.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Supp_Stock_Id", typeof(int));
                dataTable.Columns.Add("Buyer_Disc", typeof(double));
                dataTable.Columns.Add("Buyer_Amt", typeof(double));
                dataTable.Columns.Add("Cost_Disc", typeof(double));
                dataTable.Columns.Add("Cost_Amt", typeof(double));
                dataTable.Columns.Add("Base_Disc", typeof(double));
                dataTable.Columns.Add("Base_Amt", typeof(double));
                dataTable.Columns.Add("Offer_Disc", typeof(double));
                dataTable.Columns.Add("Offer_Amt", typeof(double));
                dataTable.Columns.Add("Rap_Rate", typeof(double));
                dataTable.Columns.Add("Rap_Amt", typeof(double));
                dataTable.Columns.Add("Status", typeof(string));
                dataTable.Columns.Add("QC_Remarks", typeof(string));

                foreach (var item in OrderResult)
                {
                    dataTable.Rows.Add(item.Id, item.Supp_Stock_Id,
                        (item.Buyer_Disc != null ? !string.IsNullOrEmpty(item.Buyer_Disc.ToString()) ? Convert.ToDouble(item.Buyer_Disc.ToString()) : (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null) : (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null)),
                        (item.Buyer_Amt != null ? !string.IsNullOrEmpty(item.Buyer_Amt.ToString()) ? Convert.ToDouble(item.Buyer_Amt.ToString()) : (item.Cost_Amt != null ? !string.IsNullOrEmpty(item.Cost_Amt.ToString()) ? Convert.ToDouble(item.Cost_Amt.ToString()) : null : null) : (item.Cost_Amt != null ? !string.IsNullOrEmpty(item.Cost_Amt.ToString()) ? Convert.ToDouble(item.Cost_Amt.ToString()) : null : null)),
                        (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null),
                        (item.Cost_Amt != null ? !string.IsNullOrEmpty(item.Cost_Amt.ToString()) ? Convert.ToDouble(item.Cost_Amt.ToString()) : null : null),
                        (item.Base_Disc != null ? !string.IsNullOrEmpty(item.Base_Disc.ToString()) ? Convert.ToDouble(item.Base_Disc.ToString()) : null : null),
                        (item.Base_Amt != null ? !string.IsNullOrEmpty(item.Base_Amt.ToString()) ? Convert.ToDouble(item.Base_Amt.ToString()) : null : null),
                        (item.Offer_Disc != null ? !string.IsNullOrEmpty(item.Offer_Disc.ToString()) ? Convert.ToDouble(item.Offer_Disc.ToString()) : null : null),
                        (item.Offer_Amt != null ? !string.IsNullOrEmpty(item.Offer_Amt.ToString()) ? Convert.ToDouble(item.Offer_Amt.ToString()) : null : null),
                        (item.Rap_Rate != null ? !string.IsNullOrEmpty(item.Rap_Rate.ToString()) ? Convert.ToDouble(item.Rap_Rate.ToString()) : null : null),
                        (item.Rap_Amt != null ? !string.IsNullOrEmpty(item.Rap_Amt.ToString()) ? Convert.ToDouble(item.Rap_Amt.ToString()) : null : null),
                        Convert.ToString(item.Status), Convert.ToString(item.QC_Remarks));
                }

                var (message, result, msg, order_No) = await _cartService.Create_Update_Order_Processing(dataTable, order_Processing.Id, order_Processing.User_Id, order_Processing.Customer_Name, order_Processing.Remarks, order_Processing.Status, order_Processing.Assist_By, order_Processing.Buyer_Code);
                if ((message == "exist" && msg.Length > 0) || (message == "success" && msg.Length > 0))
                {
                    int assistBy = order_Processing.Assist_By ?? 0;

                    string to_Email = "list@sunrisediam.com";

                    string subject = order_Processing.Status + " request for order no " + order_No + " - " + order_Processing.Customer_Name;

                    StringBuilder sb = new StringBuilder();

                    sb.AppendLine(@"Company Name :  " + order_Processing.Customer_Name + "<br/>");

                    var userId = assistBy > 0 ? assistBy : (order_Processing.User_Id ?? 0);

                    var user = await _employeeService.Employee_Master_Name_Select(userId);

                    sb.AppendLine(@"Assist By: " + user[0].Name + "<br/>");

                    sb.AppendLine(@"Request for : " + order_Processing.Status + "<br/>");

                    _emailSender.SendEmail(toEmail: to_Email, externalLink: "", subject: subject, formFile: null, strBody: sb.ToString());

                    List<string> DeviceIds = await _cartService.Get_Order_Process_FCM_Token();

                    if (DeviceIds.Count > 0)
                    {
                        string title = $"Request from Solar";

                        string customerName = order_Processing.Customer_Name?.ToString();

                        if (string.IsNullOrWhiteSpace(customerName))
                        {
                            customerName = "Sunrise Diamonds Ltd";
                        }

                        string body = $"{order_Processing.Status} request for order no #{order_No + ".1"} from {customerName}";

                        await Firebase_Messaging_Notification(DeviceIds: DeviceIds, title: title, body: body);
                    }

                    // if already exists stone add again then message should show successfully added.
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = msg

                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Order_Processing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_order_processing_stock_availability")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Order_Processing_Stock_Availability(Order_Processing order_Processing)
        {
            try
            {
                IList<Order_Processing_Detail> OrderResult = JsonConvert.DeserializeObject<IList<Order_Processing_Detail>>(order_Processing.Order_Detail.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Supp_Stock_Id", typeof(int));
                dataTable.Columns.Add("Buyer_Disc", typeof(double));
                dataTable.Columns.Add("Buyer_Amt", typeof(double));
                dataTable.Columns.Add("Cost_Disc", typeof(double));
                dataTable.Columns.Add("Cost_Amt", typeof(double));
                dataTable.Columns.Add("Base_Disc", typeof(double));
                dataTable.Columns.Add("Base_Amt", typeof(double));
                dataTable.Columns.Add("Offer_Disc", typeof(double));
                dataTable.Columns.Add("Offer_Amt", typeof(double));
                dataTable.Columns.Add("Rap_Rate", typeof(double));
                dataTable.Columns.Add("Rap_Amt", typeof(double));
                dataTable.Columns.Add("Status", typeof(string));
                dataTable.Columns.Add("QC_Remarks", typeof(string));

                foreach (var item in OrderResult)
                {
                    dataTable.Rows.Add(item.Id, item.Supp_Stock_Id,
                        (item.Buyer_Disc != null ? !string.IsNullOrEmpty(item.Buyer_Disc.ToString()) ? Convert.ToDouble(item.Buyer_Disc.ToString()) : (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null) : (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null)),
                        (item.Buyer_Amt != null ? !string.IsNullOrEmpty(item.Buyer_Amt.ToString()) ? Convert.ToDouble(item.Buyer_Amt.ToString()) : (item.Cost_Amt != null ? !string.IsNullOrEmpty(item.Cost_Amt.ToString()) ? Convert.ToDouble(item.Cost_Amt.ToString()) : null : null) : (item.Cost_Amt != null ? !string.IsNullOrEmpty(item.Cost_Amt.ToString()) ? Convert.ToDouble(item.Cost_Amt.ToString()) : null : null)),
                        (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null),
                        (item.Cost_Amt != null ? !string.IsNullOrEmpty(item.Cost_Amt.ToString()) ? Convert.ToDouble(item.Cost_Amt.ToString()) : null : null),
                        (item.Base_Disc != null ? !string.IsNullOrEmpty(item.Base_Disc.ToString()) ? Convert.ToDouble(item.Base_Disc.ToString()) : null : null),
                        (item.Base_Amt != null ? !string.IsNullOrEmpty(item.Base_Amt.ToString()) ? Convert.ToDouble(item.Base_Amt.ToString()) : null : null),
                        (item.Offer_Disc != null ? !string.IsNullOrEmpty(item.Offer_Disc.ToString()) ? Convert.ToDouble(item.Offer_Disc.ToString()) : null : null),
                        (item.Offer_Amt != null ? !string.IsNullOrEmpty(item.Offer_Amt.ToString()) ? Convert.ToDouble(item.Offer_Amt.ToString()) : null : null),
                        (item.Rap_Rate != null ? !string.IsNullOrEmpty(item.Rap_Rate.ToString()) ? Convert.ToDouble(item.Rap_Rate.ToString()) : null : null),
                        (item.Rap_Amt != null ? !string.IsNullOrEmpty(item.Rap_Amt.ToString()) ? Convert.ToDouble(item.Rap_Amt.ToString()) : null : null),
                        Convert.ToString(item.Status), Convert.ToString(item.QC_Remarks));
                }

                var (message, result, msg, order_No) = await _cartService.Create_Update_Order_Processing_Stock_Availability(dataTable, order_Processing.Id, order_Processing.User_Id, order_Processing.Customer_Name, order_Processing.Remarks, order_Processing.Status, order_Processing.Assist_By, order_Processing.Buyer_Code);
                if ((message == "exist" && msg.Length > 0) || (message == "success" && msg.Length > 0))
                {
                    int assistBy = order_Processing.Assist_By ?? 0;

                    string to_Email = "list@sunrisediam.com";

                    string subject = order_Processing.Status + " request for order no " + order_No + " - " + order_Processing.Customer_Name;

                    StringBuilder sb = new StringBuilder();

                    sb.AppendLine(@"Company Name :  " + order_Processing.Customer_Name + "<br/>");

                    var userId = assistBy > 0 ? assistBy : (order_Processing.User_Id ?? 0);

                    var user = await _employeeService.Employee_Master_Name_Select(userId);

                    sb.AppendLine(@"Assist By: " + user[0].Name + "<br/>");

                    sb.AppendLine(@"Request for : " + order_Processing.Status + "<br/>");

                    _emailSender.SendEmail(toEmail: to_Email, externalLink: "", subject: subject, formFile: null, strBody: sb.ToString());

                    List<string> DeviceIds = await _cartService.Get_Order_Process_FCM_Token();

                    if (DeviceIds.Count > 0)
                    {
                        string title = $"Request from Solar";

                        string customerName = order_Processing.Customer_Name?.ToString();

                        if (string.IsNullOrWhiteSpace(customerName))
                        {
                            customerName = "Sunrise Diamonds Ltd";
                        }

                        string body = $"{order_Processing.Status} request for order no #{order_No + ".1"} from {customerName}";

                        await Firebase_Messaging_Notification(DeviceIds: DeviceIds, title: title, body: body);
                    }

                    // if already exists stone add again then message should show successfully added.
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = msg

                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Order_Processing_Stock_Availability", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_processing_inactive")]
        [Authorize]
        public async Task<IActionResult> Order_Processing_Inactive(Order_Processing_Inactive order_processing)
        {
            try
            {
                var result = await _cartService.Order_Processing_Inactive(order_processing);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.OrderInactive
                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Processing_Inactive", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("cart_approval_order_excel_download")]
        [Authorize]
        public async Task<IActionResult> Cart_Approval_Order_Excel_Download(Report_Filter report_Filter)
        {
            try
            {
                var dt_stock = await _supplierService.Get_Report_Search_Excel(report_Filter.id, report_Filter.Report_Filter_Parameter);
                if (dt_stock != null && dt_stock.Rows.Count > 0)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                    var result = await _supplierService.Get_Report_Users_Role(report_Filter.id, (int)user_Id, null, null);
                    List<string> columnNames = new List<string>();
                    if (result != null && result.Count > 0)
                    {
                        foreach (var item in result)
                        {
                            if (item.ContainsKey("Display_Name") && item.ContainsKey("Display_Type") && item["Display_Type"].ToString() == "D")
                            {
                                columnNames.Add(item["Display_Name"].ToString().Trim());
                            }
                        }
                    }
                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;
                    if (report_Filter.id == 2)
                    {
                        filename = "D_Cart_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Cart_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                        excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    }
                    else if (report_Filter.id == 3)
                    {
                        filename = "D_Approval_Management_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Approval_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                        excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    }
                    else if (report_Filter.id == 4)
                    {
                        filename = "D_Order_Processing_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Order_Processing_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                        excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    }
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Cart_Approval_Order_Excel_Download", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("cart_approval_order_column_wise_excel_download")]
        [Authorize]
        public async Task<IActionResult> Cart_Approval_Order_Column_Wise_Excel_Download(Report_Filter report_Filter)
        {
            try
            {
                var dt_stock = await _supplierService.Get_Report_Search_Excel(report_Filter.id, report_Filter.Report_Filter_Parameter);
                if (dt_stock != null && dt_stock.Rows.Count > 0)
                {

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;
                    if (report_Filter.id == 2)
                    {
                        var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                        int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                        var color_dt = await _supplierService.Get_Report_Users_Role(report_Filter.id, (int)user_Id, null, null);

                        filename = "Cart_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Cart_Column_Wise_Excel(dt_stock, columnNamesTable, color_dt, filePath, filePath + filename);
                        excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    }
                    if (report_Filter.id == 3)
                    {
                        filename = "Approval_Management_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Approval_Column_Wise_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                        excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    }
                    else if (report_Filter.id == 4)
                    {
                        filename = "Order_Processing_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Order_Processing_Column_Wise_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                        excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    }
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Cart_Approval_Order_Excel_Download", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("lab_entry_report_excel_export")]
        [Authorize]
        public async Task<IActionResult> Lab_Entry_Report_Excel_Export(Report_Lab_Entry_Filter report_Lab_Entry_Filter)
        {
            try
            {
                var dt_Order = await _supplierService.Get_Lab_Entry_Report_Data(report_Lab_Entry_Filter);

                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    var excelPath = string.Empty;

                    string filename = string.Empty;

                    report_Lab_Entry_Filter.column_Name = new List<string>{
                                        "Stock Id",
                                        "Lab",
                                        "IMAGE LINK",
                                        "VIDEO LINK",
                                        "Cert No",
                                        "Status",
                                        "Shape",
                                        "Pointer",
                                        "BGM",
                                        "Color",
                                        "Clarity",
                                        "Cts",
                                        "Rap Rate",
                                        "Rap Amount",
                                        "Final Disc%",
                                        "Final Amount",
                                        "Cut",
                                        "Polish",
                                        "Symm",
                                        "Fls",
                                        "Length",
                                        "Width",
                                        "Depth",
                                        "Depth%",
                                        "Table%",
                                        "Key To Symbol",
                                        "Comment",
                                        "Girdle%",
                                        "Crown Angle",
                                        "Crown Height",
                                        "Pavilion Angle",
                                        "Pavilion Height",
                                        "Table White",
                                        "Crown White",
                                        "Table Black",
                                        "Crown Black",
                                        "Culet",
                                        "Table Open",
                                        "Crown Open",
                                        "Pavilion Open",
                                        "Girdle Open"
                    };

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Lab_Entry_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");

                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }

                    filename = "D_Lab_Entry_Report_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    EpExcelExport.Create_Lab_Entry_Report_Excel(dt_Order, columnNamesTable, filePath, filePath + filename);

                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Lab_Entry_Report_Excel_Export", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("lab_entry_report_column_wise_excel_download")]
        [Authorize]
        public async Task<IActionResult> Lab_Entry_Report_Column_Wise_Excel_Download(Report_Lab_Entry_Filter report_Lab_Entry_Filter)
        {
            try
            {
                var dt_Order = await _supplierService.Get_Lab_Entry_Report_Data_Dynamic(report_Lab_Entry_Filter);

                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Lab_Entry_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = "Lab_Entry_Report_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Lab_Entry_Report_Column_Wise_Excel(dt_Order, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Lab_Entry_Report_Column_Wise_Excel_Download", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("lab_entry_report_pickup_excel_export")]
        [Authorize]
        public async Task<IActionResult> Lab_Entry_Report_Pickup_Excel_Export(Report_Lab_Entry_Filter report_Lab_Entry_Filter)
        {
            try
            {
                var dt_Order = await _supplierService.Get_Lab_Entry_Report_Data_Pickup(report_Lab_Entry_Filter);

                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    var excelPath = string.Empty;

                    string filename = string.Empty;

                    report_Lab_Entry_Filter.column_Name = new List<string>{
                                        "Stock Id",
                                        "Ref No",
                                        "Location",
                                        "Lab",
                                        "IMAGE LINK",
                                        "VIDEO LINK",
                                        "Cert No",
                                        "Shape",
                                        "Pointer",
                                        "BGM",
                                        "Color",
                                        "Clarity",
                                        "Cts",
                                        "Rap Rate",
                                        "Rap Amount",
                                        "Final Disc%",
                                        "Final Amount",
                                        "Cut",
                                        "Polish",
                                        "Symm",
                                        "Fls",
                                        "Length",
                                        "Width",
                                        "Depth",
                                        "Depth%",
                                        "Table%",
                                        "Key To Symbol",
                                        "Comment",
                                        "Girdle%",
                                        "Crown Angle",
                                        "Crown Height",
                                        "Pavilion Angle",
                                        "Pavilion Height",
                                        "Table White",
                                        "Crown White",
                                        "Table Black",
                                        "Crown Black",
                                        "Culet",
                                        "Table Open",
                                        "Crown Open",
                                        "Pavilion Open",
                                        "Girdle Open"
                    };

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Lab_Entry_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");

                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }

                    filename = "Lab_Entry_Report_Pickup_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    EpExcelExport.Create_Lab_Entry_Report_Pickup_Excel(dt_Order, columnNamesTable, filePath, filePath + filename);

                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Lab_Entry_Report_Pickup_Excel_Export", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_lab_entry_auto_order_not_placed_overseas_email")]
        public async Task<IActionResult> Get_Lab_Entry_Auto_Order_Not_Placed_Overseas_Email()
        {
            try
            {
                var dtOrderDetail = await _supplierService.Get_Lab_Entry_Auto_Order_Not_Placed_Overseas_Email();
                if (dtOrderDetail != null && dtOrderDetail.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/LabEntryNotUploadedOverseasExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = "Lab_Entry_Not_Uploaded_Overseas_Order_" + DateTime.UtcNow.ToString("ddMMyyyy_HHmmss") + ".xlsx";
                    EpExcelExport.Create_Lab_Entry_Auto_Order_Not_Placed_Overseas(dtOrderDetail, filePath, filePath + filename);
                    excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.LabEntryNotUploadedOverseasExcelFiles + filename;

                    byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                    using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                    {
                        IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                        _emailSender.SendEmail(toEmail: "tejash@brainwaves.co.in, jignesh@sunrisediam.com, list@sunrisediam.com, samit@sunrisediam.com", externalLink: "", subject: CoreCommonMessage.Lab_Entry_Overseas_Not_Uploaded_Subject_Email, formFile: formFile, strBody: CoreCommonMessage.Lab_Entry_Overseas_Not_Uploaded_Body_Email);

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.EmailSendSuccessMessage
                        });
                    }
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Lab_Entry_Auto_Order_Not_Placed_Overseas_Email", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("stock_availability_report_excel_download")]
        [Authorize]
        public async Task<IActionResult> Stock_Availability_Report_Excel_Download([FromForm] Stock_Avalibility stock_Avalibility, IFormFile? File_Location)
        {
            try
            {
                IList<Stock_Avalibility_Values> stock_Avalibility_Values = new List<Stock_Avalibility_Values>();
                var lst_Stock_Id = new List<string>();
                if (!string.IsNullOrEmpty(stock_Avalibility.stock_Id) && stock_Avalibility.stock_Id.Contains(";"))
                {
                    lst_Stock_Id = stock_Avalibility.stock_Id.Split('/').ToList();
                    if (lst_Stock_Id != null && lst_Stock_Id.Count > 0)
                    {
                        foreach (var item in lst_Stock_Id)
                        {
                            var model = new Stock_Avalibility_Values();
                            var lst_stock_val = item.Split(';').ToList();
                            if (lst_stock_val != null && lst_stock_val.Count > 0)
                            {
                                if (lst_stock_val.Count == 1)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (string.IsNullOrEmpty(lst_stock_val[i]))
                                            continue;

                                        model.Stock_Id = lst_stock_val[0];
                                    }
                                }
                                else if (lst_stock_val.Count == 2)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else
                                        {
                                            if (string.IsNullOrEmpty(lst_stock_val[i]))
                                                continue;

                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                                else if (lst_stock_val.Count == 3)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else
                                        {
                                            if (string.IsNullOrEmpty(lst_stock_val[i]))
                                                continue;

                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                                else if (lst_stock_val.Count == 4)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else if (i == 1 || i == 2)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Cost_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Cost_Amount = lst_stock_val[i];
                                            }
                                        }
                                        else if (i == 3)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                                else if (lst_stock_val.Count == 5)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else if (i == 1 || i == 2)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Cost_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Cost_Amount = lst_stock_val[i];
                                            }
                                        }
                                        else if (i == 3 || i == 4)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                            }
                            stock_Avalibility_Values.Add(model);
                        }
                        stock_Avalibility_Values = stock_Avalibility_Values.GroupBy(x => x.Stock_Id).Select(x => x.First()).ToList();
                    }
                }

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable.Columns.Add("COST_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                if (File_Location != null)
                {
                    var filePath = Path.GetTempFileName();
                    using (var stream = new FileStream(filePath, FileMode.Create))
                    {
                        await File_Location.CopyToAsync(stream);
                    }
                    using (var package = new ExcelPackage(new FileInfo(filePath)))
                    {
                        var worksheet = package.Workbook.Worksheets[0];
                        int startRow = 2;

                        HashSet<string> uniqueValues = new HashSet<string>();
                        for (int row = startRow; row <= worksheet.Dimension.End.Row; row++)
                        {
                            string value = worksheet.Cells[row, 1].GetValue<string>();
                            string cost_amt = worksheet.Cells[row, 3].GetValue<string>();
                            string offer_amt = worksheet.Cells[row, 5].GetValue<string>();
                            if (!uniqueValues.Contains(value))
                            {
                                uniqueValues.Add(value);

                                dataTable.Rows.Add(value, !string.IsNullOrEmpty(cost_amt) ? offer_amt.Replace(",", "") : DBNull.Value, worksheet.Cells[row, 2].GetValue<string>(), !string.IsNullOrEmpty(offer_amt) ? offer_amt.Replace(",", "") : DBNull.Value, worksheet.Cells[row, 4].GetValue<string>());

                            }
                        }
                        var uniqueRows = dataTable.AsEnumerable()
                                  .GroupBy(row => row.Field<string>("STOCK_ID"))
                                  .Select(grp => grp.First())
                                  .CopyToDataTable();
                    }
                }
                else if (stock_Avalibility_Values != null && stock_Avalibility_Values.Count > 0)
                {
                    stock_Avalibility.stock_Id = null;
                    foreach (var item in stock_Avalibility_Values)
                    {
                        dataTable.Rows.Add(!string.IsNullOrEmpty(item.Stock_Id) ? item.Stock_Id : DBNull.Value, !string.IsNullOrEmpty(item.Cost_Amount) ? item.Cost_Amount : DBNull.Value, !string.IsNullOrEmpty(item.Cost_Disc) ? item.Cost_Disc : DBNull.Value, !string.IsNullOrEmpty(item.Offer_Amount) ? item.Offer_Amount : DBNull.Value, !string.IsNullOrEmpty(item.Offer_Disc) ? item.Offer_Disc : DBNull.Value);
                    }
                }

                var dt_stock = await _supplierService.Get_Stock_Availability_Report_Excel(dataTable, stock_Avalibility.stock_Id, stock_Avalibility.stock_Type, stock_Avalibility.party_Id ?? 0, stock_Avalibility.excel_Format);
                if (dt_stock != null && dt_stock.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in dt_stock.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    if (!string.IsNullOrEmpty(stock_Avalibility.excel_Format) && stock_Avalibility.excel_Format == "Customer")
                    {
                        filename = "Customer_Stock_Availability_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Customer_Stock_Availability_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (!string.IsNullOrEmpty(stock_Avalibility.excel_Format) && stock_Avalibility.excel_Format == "Default")
                    {
                        filename = "Default_Stock_Availability_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Stock_Availability_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                    }

                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Stock_Availability_Report_Excel_Download", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_processing_update_order_status")]
        [Authorize]
        public async Task<IActionResult> Order_Processing_Update_Order_Status(string order_Status, string order_No)
        {
            try
            {
                var (Request_Status, Order_Status, Sub_Order_Id) = await _cartService.Check_Order_Processing_Order_Status(order_No);
                if (Request_Status != "COMPLETED" && Order_Status != "CLOSED")
                {
                    if (Order_Status != order_Status)
                    {
                        var result = await _cartService.Order_Processing_Update_Order_Status(order_Status, order_No);
                        if (result > 0)
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.OrderStatusManagement
                            });
                        }
                        return BadRequest();
                    }
                    else
                    {
                        return Conflict(new { message = "Please refresh order records and then do further activity." });
                    }
                }
                else
                {
                    return Conflict(new { message = "Order is already COMPLETED or CLOSED. Order Status update not allowed." });
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Processing_Update_Order_Status", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        //[HttpGet]
        //[Route("get_order_summary")]
        //[Authorize]
        //public async Task<IActionResult> Get_Order_Summary(int order_No)
        //{
        //    try
        //    {
        //        var result = await _cartService.Get_Order_Summary(order_No);
        //        if (result != null && result.Count > 0)
        //        {
        //            return Ok(new
        //            {
        //                statusCode = HttpStatusCode.OK,
        //                message = CoreCommonMessage.DataSuccessfullyFound,
        //                data = result
        //            });
        //        }
        //        return NoContent();
        //    }
        //    catch (Exception ex)
        //    {
        //        await _commonService.InsertErrorLog(ex.Message, "Get_Order_Summary", ex.StackTrace);
        //        return StatusCode((int)HttpStatusCode.InternalServerError, new
        //        {
        //            message = ex.Message
        //        });
        //    }
        //}
        #endregion

        #region Get GIA Certificate Data
        [HttpPost]
        [Route("get_gia_cert_data")]
        //[Authorize]
        public async Task<IActionResult> Get_GIA_Cert_Data([FromForm] GIA_Certificate_Parameter_Model gIA_Certificate_Parameter_Model, IFormFile gIA_Cert_Excel_File)
        {
            var key = _configuration["Sunrise_Key"];
            try
            {
                bool success = false;

                var query = @"
                             query ReportQuery($ReportNumber: String!) {
                                getReport(report_number: $ReportNumber){
                                    report_number
                                    report_date
                                    results {
                                        __typename
                                        ... on DiamondGradingReportResults {
                                             measurements
                                             carat_weight
                                             color_grade
                                             color_origin
                                             color_distribution
                                             clarity_grade
                                             cut_grade
                                             polish
                                             symmetry
                                             fluorescence
                                             clarity_characteristics
                                             key_to_symbols
                                             {
                                                characteristic
                                             }
                                             inscriptions
                                             report_comments
                                             proportions {
                                                      depth_pct
                                                      table_pct
                                                      crown_angle
                                                      crown_height
                                                      pavilion_angle
                                                      pavilion_depth
                                                      star_length
                                                      lower_half
                                                      girdle
                                                      culet
                                                    }
                                              data {
                                                    shape {
                                                        shape_category
                                                        shape_code
                                                        shape_group
                                                        shape_group_code
                                                        }
                                                        weight {
                                                            weight
                                                            weight_unit
                                                        }
                                                        color {
                                                            color_grade_code
                                                            color_modifier
                                                        }
                                                        clarity
                                                        cut
                                                        polish
                                                        symmetry
                                                        fluorescence {
                                                            fluorescence_intensity
                                                            fluorescence_color
                                                        }
                                                        girdle {
                                                            girdle_condition
                                                            girdle_condition_code
                                                            girdle_pct
                                                            girdle_size
                                                            girdle_size_code
                                                        }
                                                        culet {
                                                            culet_code
                                                        }
                                                    }
                                                }
                                            }
                                            links {
                                                pdf
                                                proportions_diagram
                                                plotting_diagram
                                                digital_card
                                            }
                                    quota {
                                        remaining
                                    }
                                }
                            }
                            ";

                DataTable dataTable = new DataTable();
                #region Set Column In Datatable
                dataTable.Columns.Add("Certificate_No", typeof(string));
                dataTable.Columns.Add("Certificate_Date", typeof(string));
                dataTable.Columns.Add("Sunrise_Stock_Id", typeof(string));
                dataTable.Columns.Add("Shape", typeof(string));
                dataTable.Columns.Add("Cts", typeof(float));
                dataTable.Columns.Add("Color", typeof(string));
                dataTable.Columns.Add("Clarity", typeof(string));
                dataTable.Columns.Add("Cut", typeof(string));
                dataTable.Columns.Add("Polish", typeof(string));
                dataTable.Columns.Add("Symm", typeof(string));
                dataTable.Columns.Add("Fls_Intensity", typeof(string));
                dataTable.Columns.Add("Fls_Color", typeof(string));
                dataTable.Columns.Add("Length", typeof(float));
                dataTable.Columns.Add("Width", typeof(float));
                dataTable.Columns.Add("Depth", typeof(float));
                dataTable.Columns.Add("Depth_Per", typeof(float));
                dataTable.Columns.Add("Table_Per", typeof(float));
                dataTable.Columns.Add("Culet", typeof(string));
                dataTable.Columns.Add("Laser_Inscription", typeof(string));
                dataTable.Columns.Add("Crown_Angle", typeof(float));
                dataTable.Columns.Add("Crown_Height", typeof(float));
                dataTable.Columns.Add("Pavillion_Angle", typeof(float));
                dataTable.Columns.Add("Pavillion_Height", typeof(float));
                dataTable.Columns.Add("Girdle_Per", typeof(float));
                dataTable.Columns.Add("Girdle_Condition", typeof(string));
                dataTable.Columns.Add("LR_Half", typeof(float));
                dataTable.Columns.Add("Str_Ln", typeof(float));
                dataTable.Columns.Add("Certificate_Link", typeof(string));
                dataTable.Columns.Add("Key_to_Symbol", typeof(string));
                dataTable.Columns.Add("Lab_Comment", typeof(string));
                dataTable.Columns.Add("Rap_Rate", typeof(float));
                dataTable.Columns.Add("Rap_Amount", typeof(float));
                dataTable.Columns.Add("Supplier_Cost_Disc", typeof(float));
                dataTable.Columns.Add("Supplier_Cost_Amt", typeof(float));
                dataTable.Columns.Add("Offer_Disc", typeof(float));
                dataTable.Columns.Add("Offer_Amt", typeof(float));
                dataTable.Columns.Add("Pointer", typeof(string));
                dataTable.Columns.Add("Cut_Grade", typeof(string));
                dataTable.Columns.Add("Polish_Grade", typeof(string));
                dataTable.Columns.Add("Symm_Grade", typeof(string));
                dataTable.Columns.Add("Fluorescence", typeof(string));
                dataTable.Columns.Add("Shape_Code", typeof(string));
                dataTable.Columns.Add("Girdle_Condition_Code", typeof(string));
                dataTable.Columns.Add("Plotting_Diagram", typeof(string));
                dataTable.Columns.Add("Proportions_Diagram", typeof(string));
                dataTable.Columns.Add("Digital_Card", typeof(string));
                #endregion

                IList<GIA_Certificate_Excel_Model> excel_data_list = new List<GIA_Certificate_Excel_Model>();
                if (gIA_Cert_Excel_File != null)
                {
                    int col_cnt = 0;

                    IList<GIA_Certificate_All_Data_Excel_Column> excel_all_data_list = new List<GIA_Certificate_All_Data_Excel_Column>();
                    var filePath = Path.GetTempFileName();
                    using (var stream = new FileStream(filePath, FileMode.Create))
                    {
                        await gIA_Cert_Excel_File.CopyToAsync(stream);
                    }
                    using (var package = new ExcelPackage(new FileInfo(filePath)))
                    {
                        var worksheet = package.Workbook.Worksheets[0];
                        int startRow = 2;

                        col_cnt = worksheet.Dimension.End.Column;
                        List<Dictionary<string, object>> rowsData = new List<Dictionary<string, object>>();
                        if (col_cnt > 5)
                        {
                            List<string> columnNames = new List<string>();

                            // Get column names
                            int totalColumns = worksheet.Dimension.End.Column;
                            int headerRow = 1;

                            for (int col = 1; col <= totalColumns; col++)
                            {
                                var cellValue = worksheet.Cells[headerRow, col].Value;
                                if (cellValue != null)
                                {
                                    columnNames.Add(cellValue.ToString().Trim());
                                }
                            }

                            // Get row values
                            int totalRows = worksheet.Dimension.End.Row;

                            for (int row = headerRow + 1; row <= totalRows; row++)
                            {
                                Dictionary<string, object> rowData = new Dictionary<string, object>();

                                for (int col = 1; col <= totalColumns; col++)
                                {
                                    var _cellValue = worksheet.Cells[headerRow, col].Value;
                                    if (_cellValue != null)
                                    {
                                        string columnName = columnNames[col - 1];
                                        var cell = worksheet.Cells[row, col];
                                        var cellValue = cell.Value;
                                        var formula = cell.Formula;

                                        if (cell.Hyperlink != null)
                                        {
                                            string url = cell.Hyperlink.OriginalString.Replace("%22", "");

                                            if (url.Length > 0)
                                            {
                                                string linkUrl = url;
                                                rowData.Add(columnName, linkUrl + ", " + cellValue);
                                            }
                                            else
                                            {
                                                rowData.Add(columnName, cellValue);
                                            }
                                        }
                                        else if (!string.IsNullOrEmpty(formula) && formula.Contains("HYPERLINK"))
                                        {
                                            int urlStartIndex = formula.IndexOf("\"") + 1;
                                            int urlEndIndex = formula.IndexOf("\",\"");

                                            if (urlStartIndex > 0 && urlEndIndex > urlStartIndex)
                                            {
                                                string url = formula.Substring(urlStartIndex, urlEndIndex - urlStartIndex);

                                                int textStartIndex = urlEndIndex + 3;
                                                int textEndIndex = formula.LastIndexOf("\"");

                                                if (textStartIndex > 0 && textEndIndex > textStartIndex)
                                                {
                                                    string text = formula.Substring(textStartIndex, textEndIndex - textStartIndex);
                                                    cell.Value = String.Format("{0},{1}", url, text);
                                                    rowData.Add(columnName, cell.Value);
                                                }
                                            }
                                        }
                                        else
                                        {
                                            if (columnName == "Certificate_Date")
                                            {
                                                string certi_Date = CoreService.ConvertToDateString(cellValue);
                                                rowData.Add(columnName, !string.IsNullOrEmpty(certi_Date) ? certi_Date : null);
                                            }
                                            else
                                            {
                                                rowData.Add(columnName, cellValue != null ? cellValue : null);
                                            }
                                        }
                                    }
                                }
                                rowsData.Add(rowData);
                            }

                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                data = rowsData
                            });


                        }
                        else
                        {
                            for (int row = startRow; row <= worksheet.Dimension.End.Row; row++)
                            {
                                string cert_No = worksheet.Cells[row, 1].GetValue<string>();
                                string supp_cost_disc = worksheet.Cells[row, 2].GetValue<string>();
                                string supp_cost_amt = worksheet.Cells[row, 3].GetValue<string>();
                                string offer_disc = worksheet.Cells[row, 4].GetValue<string>();
                                string offer_amt = worksheet.Cells[row, 5].GetValue<string>();
                                excel_data_list.Add(new GIA_Certificate_Excel_Model()
                                {
                                    Certificate_No = cert_No,
                                    Supplier_Cost_Disc = supp_cost_disc,
                                    Supplier_Cost_Amt = supp_cost_amt,
                                    Offer_Disc = offer_disc,
                                    Offer_Amt = offer_amt
                                });
                            }
                        }
                    }
                }
                if (excel_data_list != null && excel_data_list.Count > 0)
                {
                    foreach (var item in excel_data_list)
                    {
                        var query_variables = new Dictionary<string, string>
                            {
                                { "ReportNumber", item.Certificate_No}
                            };

                        var body = new Dictionary<string, object>
                            {
                                { "query", query },
                                { "variables", query_variables }
                            };

                        string json = System.Text.Json.JsonSerializer.Serialize(body);
                        var client = new WebClient();
                        string url = "https://api.reportresults.gia.edu";

                        client.Headers.Add(HttpRequestHeader.Authorization, key);
                        client.Headers.Add(HttpRequestHeader.ContentType, "application/json");

                        var responseData = client.UploadString(url, json);

                        GIA_Report gIA_Report = JsonConvert.DeserializeObject<GIA_Report>(responseData);
                        if (gIA_Report != null && gIA_Report.Data.GetReport != null && !string.IsNullOrEmpty(gIA_Report.Data.GetReport.ReportNumber))
                        {
                            DataRow dataRow = dataTable.NewRow();
                            var measurements = gIA_Report.Data.GetReport.Results.Measurements;
                            string[] arrMeasurements = null;
                            arrMeasurements = measurements.Split('-', 'x');

                            dataRow["Sunrise_Stock_Id"] = DBNull.Value;
                            dataRow["Pointer"] = DBNull.Value;
                            dataRow["Rap_Rate"] = DBNull.Value;
                            dataRow["Rap_Amount"] = DBNull.Value;
                            dataRow["Supplier_Cost_Disc"] = !string.IsNullOrEmpty(item.Supplier_Cost_Disc) ? float.Parse(item.Supplier_Cost_Disc) : DBNull.Value;
                            dataRow["Supplier_Cost_Amt"] = !string.IsNullOrEmpty(item.Supplier_Cost_Amt) ? float.Parse(item.Supplier_Cost_Amt) : DBNull.Value;
                            dataRow["Offer_Disc"] = !string.IsNullOrEmpty(item.Offer_Disc) ? float.Parse(item.Offer_Disc) : DBNull.Value;
                            dataRow["Offer_Amt"] = !string.IsNullOrEmpty(item.Offer_Amt) ? float.Parse(item.Offer_Amt) : DBNull.Value;

                            dataRow["Certificate_No"] = gIA_Report.Data.GetReport.ReportNumber;
                            dataRow["Certificate_Date"] = Convert.ToDateTime(gIA_Report.Data.GetReport.ReportDate).ToString("dd-MM-yyyy");
                            if (arrMeasurements != null && arrMeasurements.Length == 3)
                            {
                                var length = arrMeasurements[0].ToString().Replace("mm", "").Trim();
                                var width = arrMeasurements[1].ToString().Replace("mm", "").Trim();
                                var depth = arrMeasurements[2].ToString().Replace("mm", "").Trim();
                                dataRow["Length"] = float.Parse(length);
                                dataRow["Width"] = float.Parse(width);
                                dataRow["Depth"] = float.Parse(depth);
                            }
                            else
                            {
                                dataRow["Length"] = DBNull.Value;
                                dataRow["Width"] = DBNull.Value;
                                dataRow["Depth"] = DBNull.Value;
                            }
                            dataRow["Color"] = gIA_Report.Data.GetReport.Results.ColorGrade;
                            dataRow["Cut_Grade"] = gIA_Report.Data.GetReport.Results.CutGrade;
                            dataRow["Polish_Grade"] = gIA_Report.Data.GetReport.Results.Polish;
                            dataRow["Symm_Grade"] = gIA_Report.Data.GetReport.Results.Symmetry;
                            dataRow["Fluorescence"] = gIA_Report.Data.GetReport.Results.Fluorescence;
                            dataRow["Laser_Inscription"] = gIA_Report.Data.GetReport.Results.Inscriptions;
                            if (gIA_Report.Data.GetReport.Results.KeyToSymbols != null)
                            {
                                string keyToSymbols = "";
                                foreach (var obj in gIA_Report.Data.GetReport.Results.KeyToSymbols)
                                {
                                    keyToSymbols += (keyToSymbols.Length == 0 ? "" : ", ") + obj.characteristic;
                                }
                                dataRow["Key_to_Symbol"] = keyToSymbols;
                            }
                            else
                            {
                                dataRow["Key_to_Symbol"] = DBNull.Value;
                            }
                            dataRow["Lab_Comment"] = gIA_Report.Data.GetReport.Results.ReportComments;
                            if (gIA_Report.Data.GetReport.Results.Proportions != null)
                            {
                                dataRow["Table_Per"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.TablePct) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.TablePct) : DBNull.Value;
                                dataRow["Depth_Per"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.DepthPct) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.DepthPct) : DBNull.Value;
                                dataRow["Crown_Angle"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.CrownAngle) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.CrownAngle) : DBNull.Value;
                                dataRow["Crown_Height"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.CrownHeight) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.CrownHeight) : DBNull.Value;
                                dataRow["Pavillion_Angle"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.PavilionAngle) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.PavilionAngle) : DBNull.Value;
                                dataRow["Pavillion_Height"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.PavilionDepth) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.PavilionDepth) : DBNull.Value;
                                dataRow["Str_Ln"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.StarLength) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.StarLength) : DBNull.Value;
                                dataRow["LR_Half"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.LowerHalf) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.LowerHalf) : DBNull.Value;
                            }
                            else
                            {
                                dataRow["Table_Per"] = DBNull.Value;
                                dataRow["Depth_Per"] = DBNull.Value;
                                dataRow["Crown_Angle"] = DBNull.Value;
                                dataRow["Crown_Height"] = DBNull.Value;
                                dataRow["Pavillion_Angle"] = DBNull.Value;
                                dataRow["Pavillion_Height"] = DBNull.Value;
                                dataRow["Str_Ln"] = DBNull.Value;
                                dataRow["LR_Half"] = DBNull.Value;
                            }
                            if (gIA_Report.Data.GetReport.Results.Data.Shape != null)
                            {
                                dataRow["Shape_Code"] = gIA_Report.Data.GetReport.Results.Data.Shape.ShapeCode;
                                dataRow["Shape"] = gIA_Report.Data.GetReport.Results.Data.Shape.ShapeGroup;
                            }
                            else
                            {
                                dataRow["Shape_Code"] = DBNull.Value;
                                dataRow["Shape"] = DBNull.Value;
                            }
                            dataRow["Cts"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Data.Weight.WeightWeight) ? float.Parse(gIA_Report.Data.GetReport.Results.Data.Weight.WeightWeight) : DBNull.Value;
                            dataRow["Clarity"] = gIA_Report.Data.GetReport.Results.Data.Clarity;
                            dataRow["Cut"] = gIA_Report.Data.GetReport.Results.Data.Cut;
                            dataRow["Polish"] = gIA_Report.Data.GetReport.Results.Data.Polish;
                            dataRow["Symm"] = gIA_Report.Data.GetReport.Results.Data.Symmetry;
                            if (gIA_Report.Data.GetReport.Results.Data.Fluorescence != null)
                            {
                                dataRow["Fls_Intensity"] = gIA_Report.Data.GetReport.Results.Data.Fluorescence.FluorescenceIntensity;
                                dataRow["Fls_Color"] = gIA_Report.Data.GetReport.Results.Data.Fluorescence.FluorescenceColor;
                            }
                            else
                            {
                                dataRow["Fls_Intensity"] = DBNull.Value;
                                dataRow["Fls_Color"] = DBNull.Value;
                            }
                            if (gIA_Report.Data.GetReport.Results.Data.Girdle != null)
                            {
                                dataRow["Girdle_Condition"] = gIA_Report.Data.GetReport.Results.Data.Girdle.GirdleCondition;
                                dataRow["Girdle_Condition_Code"] = gIA_Report.Data.GetReport.Results.Data.Girdle.GirdleConditionCode;
                                dataRow["Girdle_Per"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Data.Girdle.GirdlePct) ? float.Parse(gIA_Report.Data.GetReport.Results.Data.Girdle.GirdlePct) : DBNull.Value;
                            }
                            else
                            {
                                dataRow["Girdle_Condition"] = DBNull.Value;
                                dataRow["Girdle_Condition_Code"] = DBNull.Value;
                                dataRow["Girdle_Per"] = DBNull.Value;
                            }
                            dataRow["Culet"] = gIA_Report.Data.GetReport.Results.Data.Culet.CuletCode;
                            if (gIA_Report.Data.GetReport.Links != null)
                            {
                                dataRow["Certificate_Link"] = gIA_Report.Data.GetReport.Links.Pdf;
                                dataRow["Plotting_Diagram"] = gIA_Report.Data.GetReport.Links.PlottingDiagram;
                                dataRow["Proportions_Diagram"] = gIA_Report.Data.GetReport.Links.ProportionsDiagram;
                                dataRow["Digital_Card"] = gIA_Report.Data.GetReport.Links.DigitalCard;
                            }
                            else
                            {
                                dataRow["Certificate_Link"] = DBNull.Value;
                                dataRow["Plotting_Diagram"] = DBNull.Value;
                                dataRow["Proportions_Diagram"] = DBNull.Value;
                                dataRow["Digital_Card"] = DBNull.Value;
                            }
                            dataTable.Rows.Add(dataRow);
                            success = true;
                        }
                        //else
                        //{
                        //    success = false;
                        //}
                    }

                    var result = await _supplierService.Get_GIA_Certificate_Update_Data(dataTable, gIA_Certificate_Parameter_Model.supplier_Name, gIA_Certificate_Parameter_Model.customer_Name);

                    if (success)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result
                        });
                    }
                    else if (!success)
                    {
                        return NoContent();
                    }
                }
                else
                {
                    //if (!string.IsNullOrEmpty(gIA_Certificate_Parameter_Model.report_Date))
                    //{
                    //    var result = await _supplierService.Get_GIA_Certificate_Data(gIA_Certificate_Parameter_Model.report_Date);
                    //    if (result != null && result.Count > 0)
                    //    {
                    //        return Ok(new
                    //        {
                    //            statusCode = HttpStatusCode.OK,
                    //            message = CoreCommonMessage.DataSuccessfullyFound,
                    //            data = result
                    //        });
                    //    }
                    //    return NoContent();
                    //}
                    //else
                    //{
                    List<string> lst_Cert_No = new List<string>();

                    if (gIA_Certificate_Parameter_Model != null && !string.IsNullOrEmpty(gIA_Certificate_Parameter_Model.cert_no))
                    {
                        lst_Cert_No = gIA_Certificate_Parameter_Model.cert_no.Replace(" ", "").Replace("\n", "").Split(",").ToList();
                    }
                    string certificate_no = "";
                    if (lst_Cert_No != null && lst_Cert_No.Count > 0)
                    {
                        foreach (var item in lst_Cert_No)
                        {
                            certificate_no = item;
                            var query_variables = new Dictionary<string, string>
                                {
                                    { "ReportNumber", item}
                                };

                            var body = new Dictionary<string, object>
                                {
                                    { "query", query },
                                    { "variables", query_variables }
                                };

                            string json = System.Text.Json.JsonSerializer.Serialize(body);
                            var client = new WebClient();
                            string url = "https://api.reportresults.gia.edu";

                            client.Headers.Add(HttpRequestHeader.Authorization, key);
                            client.Headers.Add(HttpRequestHeader.ContentType, "application/json");

                            var responseData = client.UploadString(url, json);

                            GIA_Report gIA_Report = JsonConvert.DeserializeObject<GIA_Report>(responseData);
                            if (gIA_Report != null && gIA_Report.Data.GetReport != null && !string.IsNullOrEmpty(gIA_Report.Data.GetReport.ReportNumber))
                            {
                                DataRow dataRow = dataTable.NewRow();
                                var measurements = gIA_Report.Data.GetReport.Results.Measurements;
                                string[] arrMeasurements = null;
                                arrMeasurements = measurements.Split('-', 'x');

                                dataRow["Sunrise_Stock_Id"] = DBNull.Value;
                                dataRow["Pointer"] = DBNull.Value;
                                dataRow["Rap_Rate"] = DBNull.Value;
                                dataRow["Rap_Amount"] = DBNull.Value;
                                dataRow["Supplier_Cost_Disc"] = DBNull.Value;
                                dataRow["Supplier_Cost_Amt"] = DBNull.Value;
                                dataRow["Offer_Disc"] = DBNull.Value;
                                dataRow["Offer_Amt"] = DBNull.Value;

                                dataRow["Certificate_No"] = gIA_Report.Data.GetReport.ReportNumber;
                                dataRow["Certificate_Date"] = Convert.ToDateTime(gIA_Report.Data.GetReport.ReportDate).ToString("dd-MM-yyyy");
                                if (arrMeasurements != null && arrMeasurements.Length == 3)
                                {
                                    var length = arrMeasurements[0].ToString().Replace("mm", "").Trim();
                                    var width = arrMeasurements[1].ToString().Replace("mm", "").Trim();
                                    var depth = arrMeasurements[2].ToString().Replace("mm", "").Trim();
                                    dataRow["Length"] = float.Parse(length);
                                    dataRow["Width"] = float.Parse(width);
                                    dataRow["Depth"] = float.Parse(depth);
                                }
                                else
                                {
                                    dataRow["Length"] = DBNull.Value;
                                    dataRow["Width"] = DBNull.Value;
                                    dataRow["Depth"] = DBNull.Value;
                                }
                                dataRow["Color"] = gIA_Report.Data.GetReport.Results.ColorGrade;
                                dataRow["Cut_Grade"] = gIA_Report.Data.GetReport.Results.CutGrade;
                                dataRow["Polish_Grade"] = gIA_Report.Data.GetReport.Results.Polish;
                                dataRow["Symm_Grade"] = gIA_Report.Data.GetReport.Results.Symmetry;
                                dataRow["Fluorescence"] = gIA_Report.Data.GetReport.Results.Fluorescence;
                                dataRow["Laser_Inscription"] = gIA_Report.Data.GetReport.Results.Inscriptions;
                                if (gIA_Report.Data.GetReport.Results.KeyToSymbols != null)
                                {
                                    string keyToSymbols = "";
                                    foreach (var obj in gIA_Report.Data.GetReport.Results.KeyToSymbols)
                                    {
                                        keyToSymbols += (keyToSymbols.Length == 0 ? "" : ", ") + obj.characteristic;
                                    }
                                    dataRow["Key_to_Symbol"] = keyToSymbols;
                                }
                                else
                                {
                                    dataRow["Key_to_Symbol"] = DBNull.Value;
                                }
                                dataRow["Lab_Comment"] = gIA_Report.Data.GetReport.Results.ReportComments;
                                if (gIA_Report.Data.GetReport.Results.Proportions != null)
                                {
                                    dataRow["Table_Per"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.TablePct) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.TablePct) : DBNull.Value;
                                    dataRow["Depth_Per"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.DepthPct) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.DepthPct) : DBNull.Value;
                                    dataRow["Crown_Angle"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.CrownAngle) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.CrownAngle) : DBNull.Value;
                                    dataRow["Crown_Height"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.CrownHeight) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.CrownHeight) : DBNull.Value;
                                    dataRow["Pavillion_Angle"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.PavilionAngle) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.PavilionAngle) : DBNull.Value;
                                    dataRow["Pavillion_Height"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.PavilionDepth) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.PavilionDepth) : DBNull.Value;
                                    dataRow["Str_Ln"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.StarLength) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.StarLength) : DBNull.Value;
                                    dataRow["LR_Half"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Proportions.LowerHalf) ? float.Parse(gIA_Report.Data.GetReport.Results.Proportions.LowerHalf) : DBNull.Value;
                                }
                                else
                                {
                                    dataRow["Table_Per"] = DBNull.Value;
                                    dataRow["Depth_Per"] = DBNull.Value;
                                    dataRow["Crown_Angle"] = DBNull.Value;
                                    dataRow["Crown_Height"] = DBNull.Value;
                                    dataRow["Pavillion_Angle"] = DBNull.Value;
                                    dataRow["Pavillion_Height"] = DBNull.Value;
                                    dataRow["Str_Ln"] = DBNull.Value;
                                    dataRow["LR_Half"] = DBNull.Value;
                                }
                                if (gIA_Report.Data.GetReport.Results.Data.Shape != null)
                                {
                                    dataRow["Shape_Code"] = gIA_Report.Data.GetReport.Results.Data.Shape.ShapeCode;
                                    dataRow["Shape"] = gIA_Report.Data.GetReport.Results.Data.Shape.ShapeGroup;
                                }
                                else
                                {
                                    dataRow["Shape_Code"] = DBNull.Value;
                                    dataRow["Shape"] = DBNull.Value;
                                }
                                dataRow["Cts"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Data.Weight.WeightWeight) ? float.Parse(gIA_Report.Data.GetReport.Results.Data.Weight.WeightWeight) : DBNull.Value;
                                dataRow["Clarity"] = gIA_Report.Data.GetReport.Results.Data.Clarity;
                                dataRow["Cut"] = gIA_Report.Data.GetReport.Results.Data.Cut;
                                dataRow["Polish"] = gIA_Report.Data.GetReport.Results.Data.Polish;
                                dataRow["Symm"] = gIA_Report.Data.GetReport.Results.Data.Symmetry;
                                if (gIA_Report.Data.GetReport.Results.Data.Fluorescence != null)
                                {
                                    dataRow["Fls_Intensity"] = gIA_Report.Data.GetReport.Results.Data.Fluorescence.FluorescenceIntensity;
                                    dataRow["Fls_Color"] = gIA_Report.Data.GetReport.Results.Data.Fluorescence.FluorescenceColor;
                                }
                                else
                                {
                                    dataRow["Fls_Intensity"] = DBNull.Value;
                                    dataRow["Fls_Color"] = DBNull.Value;
                                }
                                if (gIA_Report.Data.GetReport.Results.Data.Girdle != null)
                                {
                                    dataRow["Girdle_Condition"] = gIA_Report.Data.GetReport.Results.Data.Girdle.GirdleCondition;
                                    dataRow["Girdle_Condition_Code"] = gIA_Report.Data.GetReport.Results.Data.Girdle.GirdleConditionCode;
                                    dataRow["Girdle_Per"] = !string.IsNullOrEmpty(gIA_Report.Data.GetReport.Results.Data.Girdle.GirdlePct) ? float.Parse(gIA_Report.Data.GetReport.Results.Data.Girdle.GirdlePct) : DBNull.Value;
                                }
                                else
                                {
                                    dataRow["Girdle_Condition"] = DBNull.Value;
                                    dataRow["Girdle_Condition_Code"] = DBNull.Value;
                                    dataRow["Girdle_Per"] = DBNull.Value;
                                }
                                dataRow["Culet"] = gIA_Report.Data.GetReport.Results.Data.Culet.CuletCode;
                                if (gIA_Report.Data.GetReport.Links != null)
                                {
                                    dataRow["Certificate_Link"] = gIA_Report.Data.GetReport.Links.Pdf;
                                    dataRow["Plotting_Diagram"] = gIA_Report.Data.GetReport.Links.PlottingDiagram;
                                    dataRow["Proportions_Diagram"] = gIA_Report.Data.GetReport.Links.ProportionsDiagram;
                                    dataRow["Digital_Card"] = gIA_Report.Data.GetReport.Links.DigitalCard;
                                }
                                else
                                {
                                    dataRow["Certificate_Link"] = DBNull.Value;
                                    dataRow["Plotting_Diagram"] = DBNull.Value;
                                    dataRow["Proportions_Diagram"] = DBNull.Value;
                                    dataRow["Digital_Card"] = DBNull.Value;
                                }
                                dataTable.Rows.Add(dataRow);
                                success = true;
                                if (lst_Cert_No.Count > 1)
                                {
                                    certificate_no += ", " + certificate_no;
                                }
                            }
                            //else
                            //{
                            //    success = false;
                            //}
                        }

                        var result = await _supplierService.Get_GIA_Certificate_Update_Data(dataTable, gIA_Certificate_Parameter_Model.supplier_Name, gIA_Certificate_Parameter_Model.customer_Name);

                        if (success)
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                data = result
                            });
                        }
                        else if (!success)
                        {
                            return NoContent();
                        }
                    }
                    return NoContent();
                    //}
                }

                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_GIA_Cert_Data", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        //[HttpPost]
        //[Route("save_gia_lab_cert_data")]
        //[Authorize]
        //public async Task<IActionResult> Save_GIA_Lab_Cert_Data(IList<GIA_Lab_Parameter> gIA_Lab_Parameters)
        //{
        //    try
        //    {
        //        if (gIA_Lab_Parameters != null && gIA_Lab_Parameters.Count > 0)
        //        {
        //            DataTable dataTable = new DataTable();
        //            dataTable = Set_GIA_Lab_Parameter_Column_In_Datatable(new DataTable(), gIA_Lab_Parameters);
        //            var result = await _supplierService.Insert_GIA_Certificate_Data(dataTable);
        //            if (result > 0)
        //            {
        //                return Ok(new
        //                {
        //                    statusCode = HttpStatusCode.OK,
        //                    message = "GIA lab parameter saved successfully."
        //                });
        //            }
        //            return BadRequest();
        //        }
        //        return BadRequest();
        //    }
        //    catch (Exception ex)
        //    {
        //        await _commonService.InsertErrorLog(ex.Message, "Save_GIA_Lab_Cert_Data", ex.StackTrace);
        //        return Ok(new
        //        {
        //            message = ex.Message
        //        });
        //    }
        //}

        [HttpPost]
        [Route("create_gia_certificate_data")]
        [Authorize]
        public async Task<IActionResult> Create_GIA_Certificate_Data(GIA_Certificate_Data gIA_Certificate_Data)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    if (gIA_Certificate_Data.GIA_Certificate_Data_Details != null && gIA_Certificate_Data.GIA_Certificate_Data_Details.Count > 0)
                    {
                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Certificate_No", typeof(string));
                        dataTable.Columns.Add("Certificate_Date", typeof(string));
                        dataTable.Columns.Add("Shape", typeof(string));
                        dataTable.Columns.Add("Cts", typeof(float));
                        dataTable.Columns.Add("Color", typeof(string));
                        dataTable.Columns.Add("Clarity", typeof(string));
                        dataTable.Columns.Add("Cut", typeof(string));
                        dataTable.Columns.Add("Polish", typeof(string));
                        dataTable.Columns.Add("Symm", typeof(string));
                        dataTable.Columns.Add("Fls_Intensity", typeof(string));
                        dataTable.Columns.Add("Fls_Color", typeof(string));
                        dataTable.Columns.Add("Length", typeof(float));
                        dataTable.Columns.Add("Width", typeof(float));
                        dataTable.Columns.Add("Depth", typeof(float));
                        dataTable.Columns.Add("Depth_Per", typeof(float));
                        dataTable.Columns.Add("Table_Per", typeof(float));
                        dataTable.Columns.Add("Culet", typeof(string));
                        dataTable.Columns.Add("Laser_Inscription", typeof(string));
                        dataTable.Columns.Add("Crown_Angle", typeof(float));
                        dataTable.Columns.Add("Crown_Height", typeof(float));
                        dataTable.Columns.Add("Pavillion_Angle", typeof(float));
                        dataTable.Columns.Add("Pavillion_Height", typeof(float));
                        dataTable.Columns.Add("Girdle_Per", typeof(float));
                        dataTable.Columns.Add("Girdle_Condition", typeof(string));
                        dataTable.Columns.Add("LR_Half", typeof(float));
                        dataTable.Columns.Add("Str_Ln", typeof(float));
                        dataTable.Columns.Add("Certificate_Link", typeof(string));
                        dataTable.Columns.Add("Key_to_Symbol", typeof(string));
                        dataTable.Columns.Add("Lab_Comment", typeof(string));
                        dataTable.Columns.Add("Rap_Rate", typeof(float));
                        dataTable.Columns.Add("Rap_Amount", typeof(float));
                        dataTable.Columns.Add("Supplier_Cost_Disc", typeof(float));
                        dataTable.Columns.Add("Supplier_Cost_Amt", typeof(float));
                        dataTable.Columns.Add("Offer_Disc", typeof(float));
                        dataTable.Columns.Add("Offer_Amt", typeof(float));
                        dataTable.Columns.Add("Pointer", typeof(string));
                        dataTable.Columns.Add("Cut_Grade", typeof(string));
                        dataTable.Columns.Add("Polish_Grade", typeof(string));
                        dataTable.Columns.Add("Symm_Grade", typeof(string));
                        dataTable.Columns.Add("Fluorescence", typeof(string));
                        dataTable.Columns.Add("Shape_Code", typeof(string));
                        dataTable.Columns.Add("Girdle_Condition_Code", typeof(string));
                        dataTable.Columns.Add("Plotting_Diagram", typeof(string));
                        dataTable.Columns.Add("Proportions_Diagram", typeof(string));
                        dataTable.Columns.Add("Digital_Card", typeof(string));

                        foreach (var item in gIA_Certificate_Data.GIA_Certificate_Data_Details)
                        {
                            dataTable.Rows.Add(item.Certificate_No,
                                item.Certificate_Date,
                                item.Shape,
                                item.Cts,
                                item.Color,
                                item.Clarity,
                                item.Cut,
                                item.Polish,
                                item.Symm,
                                item.Fls_Intensity,
                                item.Fls_Color,
                                item.Length,
                                item.Width,
                                item.Depth,
                                item.Depth_Per,
                                item.Table_Per,
                                item.Culet,
                                item.Laser_Inscription,
                                item.Crown_Angle,
                                item.Crown_Height,
                                item.Pavillion_Angle,
                                item.Pavillion_Height,
                                item.Girdle_Per,
                                item.Girdle_Condition,
                                item.LR_Half,
                                item.Str_Ln,
                                item.Certificate_Link,
                                item.Key_to_Symbol,
                                item.Lab_Comment,
                                item.Rap_Rate,
                                item.Rap_Amount,
                                item.Supplier_Cost_Disc,
                                item.Supplier_Cost_Amt,
                                item.Offer_Disc,
                                item.Offer_Amt,
                                item.Pointer,
                                item.Cut_Grade,
                                item.Polish_Grade,
                                item.Symm_Grade,
                                item.Fluorescence,
                                item.Shape_Code,
                                item.Girdle_Condition_Code,
                                item.Plotting_Diagram,
                                item.Proportions_Diagram,
                                item.Digital_Card);
                        }
                        var result = await _supplierService.Insert_GIA_Certificate_Data(dataTable, gIA_Certificate_Data.Supplier_Id ?? 0, gIA_Certificate_Data.Customer_Name);
                        if (result > 0)
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = "GIA Ceriticate data saved successfully."
                            });
                        }
                    }
                    return BadRequest(new
                    {
                        statusCode = HttpStatusCode.BadRequest,
                        message = CoreCommonMessage.ParameterMismatched
                    });
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_GIA_Certificate_Data", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("gia_certificate_placed_order")]
        [Authorize]
        public async Task<IActionResult> GIA_Certificate_Placed_Order(GIA_Certificate_Place_Order gIA_Certificate_Place_Order)
        {
            try
            {
                IList<GIA_Certificate_Place_Order_Detail> order_result = JsonConvert.DeserializeObject<IList<GIA_Certificate_Place_Order_Detail>>(gIA_Certificate_Place_Order.Order_Detail.ToString());
                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Certificate_No", typeof(string));
                dataTable.Columns.Add("Supplier_Cost_Amt", typeof(string));
                dataTable.Columns.Add("Supplier_Cost_Disc", typeof(string));
                dataTable.Columns.Add("Offer_Amt", typeof(string));
                dataTable.Columns.Add("Offer_Disc", typeof(string));

                if (order_result != null && order_result.Count > 0)
                {
                    foreach (var item in order_result)
                    {
                        dataTable.Rows.Add(
                                Convert.ToString(item.Certificate_No),
                                (item.Supplier_Cost_Amt != null ? !string.IsNullOrEmpty(item.Supplier_Cost_Amt.ToString()) ? Convert.ToDouble(item.Supplier_Cost_Amt.ToString()) : null : null),
                                (item.Supplier_Cost_Disc != null ? !string.IsNullOrEmpty(item.Supplier_Cost_Disc.ToString()) ? Convert.ToDouble(item.Supplier_Cost_Disc.ToString()) : null : null),
                                (item.Offer_Amt != null ? !string.IsNullOrEmpty(item.Offer_Amt.ToString()) ? Convert.ToDouble(item.Offer_Amt.ToString()) : null : null),
                                (item.Offer_Disc != null ? !string.IsNullOrEmpty(item.Offer_Disc.ToString()) ? Convert.ToDouble(item.Offer_Disc.ToString()) : null : null)
                            );
                    }

                    var result = await _supplierService.GIA_Certificate_Placed_Order(dataTable, gIA_Certificate_Place_Order.Supplier_Id ?? 0, gIA_Certificate_Place_Order.Customer_Name);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = "Order placed successfully."
                        });
                    }
                }

                return BadRequest();
            }
            catch (Exception)
            {

                throw;
            }
        }
        #endregion

        #region Create Stock In Excel Format
        [HttpPost]
        [Route("export_stock_excel_new")]
        [Authorize]
        public async Task<IActionResult> Export_Stock_Excel_New(Excel_Model excel_Model)
        {
            var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
            int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

            //DataTable supp_stock_dt = await _supplierService.Get_Stock_In_Datatable(excel_Model.supplier_Ref_No, excel_Model.excel_Format);
            DataTable supp_stock_dt = await _supplierService.Get_Excel_Report_Search_New(excel_Model.Report_Filter_Parameter, excel_Model.excel_Format, excel_Model.supplier_Ref_No, user_Id ?? 0);
            if (supp_stock_dt != null && supp_stock_dt.Rows.Count > 0)
            {
                List<string> columnNames = new List<string>();
                foreach (DataColumn column in supp_stock_dt.Columns)
                {
                    columnNames.Add(column.ColumnName);
                }

                DataTable columnNamesTable = new DataTable();
                columnNamesTable.Columns.Add("Column_Name", typeof(string));

                foreach (string columnName in columnNames)
                {
                    columnNamesTable.Rows.Add(columnName);
                }
                var excelPath = string.Empty;
                var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                if (!(Directory.Exists(filePath)))
                {
                    Directory.CreateDirectory(filePath);
                }
                string filename = string.Empty;
                if (excel_Model.excel_Format == "Customer")
                {
                    filename = "Customer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Customer_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                }
                else if (excel_Model.excel_Format == "Buyer")
                {
                    filename = "Buyer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Buyer_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                }
                else if (excel_Model.excel_Format == "Supplier")
                {
                    filename = "Supplier_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Supplier_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                }
                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    result = excelPath,
                    file_name = filename
                });
            }
            return NoContent();
        }

        [HttpPost]
        [Route("export_stock_excel")]
        [Authorize]
        public async Task<IActionResult> Export_Stock_Excel(Excel_Model_New excel_Model)
        {


            string STOCK_ID = string.Empty, SUPPLIER = string.Empty, CUSTOMER = string.Empty, SHAPE = string.Empty,
                        CTS = string.Empty, COLOR = string.Empty, CLARITY = string.Empty, CUT = string.Empty,
                        POLISH = string.Empty, SYMM = string.Empty, FLS_INTENSITY = string.Empty, BGM = string.Empty,
                        LAB = string.Empty, GOOD_TYPE = string.Empty, LOCATION = string.Empty, STATUS = string.Empty,
                        IMAGE_LINK = string.Empty, VIDEO_LINK = string.Empty, LENGTH = string.Empty, WIDTH = string.Empty,
                        DEPTH = string.Empty, TABLE_PER = string.Empty, DEPTH_PER = string.Empty, CROWN_ANGLE = string.Empty,
                        CROWN_HEIGHT = string.Empty, PAVILION_ANGLE = string.Empty, PAVILION_HEIGHT = string.Empty, GIRDLE_PER = string.Empty,
                        RAP_RATE = string.Empty, RAP_AMOUNT = string.Empty, COST_DISC = string.Empty, COST_AMOUNT = string.Empty,
                        OFFER_DISC = string.Empty, OFFER_VALUE = string.Empty, BASE_DISC = string.Empty, BASE_AMOUNT = string.Empty,
                        PRICE_PER_CTS = string.Empty, MAX_SLAB_BASE_DISC = string.Empty, MAX_SLAB_BASE_AMOUNT = string.Empty, MAX_SLAB_PRICE_PER_CTS = string.Empty,
                        BUYER_DISC = string.Empty, BUYER_AMOUNT = string.Empty, TABLE_BLACK = string.Empty, TABLE_WHITE = string.Empty, SIDE_BLACK = string.Empty, SIDE_WHITE = string.Empty,
                        TABLE_OPEN = string.Empty, CROWN_OPEN = string.Empty, PAVILION_OPEN = string.Empty,
                        GIRDLE_OPEN = string.Empty, CULET = string.Empty, KEY_TO_SYMBOL_TRUE = string.Empty,
                        KEY_TO_SYMBOL_FALSE = string.Empty, LAB_COMMENTS_TRUE = string.Empty, LAB_COMMENTS_FALSE = string.Empty,
                        FANCY_COLOR = string.Empty, FANCY_INTENSITY = string.Empty, FANCY_OVERTONE = string.Empty, POINTER = string.Empty, SUB_POINTER = string.Empty,
                        STAR_LN = string.Empty, LR_HALF = string.Empty, CERT_TYPE = string.Empty, COST_RATE = string.Empty, RATIO = string.Empty, DISCOUNT_TYPE = string.Empty,
                        SIGN = string.Empty, DISC_VALUE = string.Empty, DISC_VALUE1 = string.Empty, DISC_VALUE2 = string.Empty, DISC_VALUE3 = string.Empty, BASE_TYPE = string.Empty, SUPP_STOCK_ID = string.Empty,
                        BID_SUPP_STOCK_ID = string.Empty, BID_BUYER_DISC = string.Empty, BID_BUYER_AMOUNT = string.Empty,
                        LUSTER = string.Empty, SHADE = string.Empty, MILKY = string.Empty, GIRDLE_FROM = string.Empty, GIRDLE_TO = string.Empty, GIRDLE_CONDITION = string.Empty, ORIGIN = string.Empty,
                        EXTRA_FACET_TABLE = string.Empty, EXTRA_FACET_CROWN = string.Empty, EXTRA_FACET_PAV = string.Empty,
                        INTERNAL_GRAINING = string.Empty, H_A = string.Empty, SUPPLIER_COMMENTS = string.Empty;

            DataTable dataTable = new DataTable();
            dataTable.Columns.Add("STOCK_ID", typeof(string));
            dataTable.Columns.Add("SUPPLIER", typeof(string));
            dataTable.Columns.Add("CUSTOMER", typeof(string));
            dataTable.Columns.Add("SHAPE", typeof(string));
            dataTable.Columns.Add("CTS", typeof(string));
            dataTable.Columns.Add("COLOR", typeof(string));
            dataTable.Columns.Add("CLARITY", typeof(string));
            dataTable.Columns.Add("CUT", typeof(string));
            dataTable.Columns.Add("POLISH", typeof(string));
            dataTable.Columns.Add("SYMM", typeof(string));
            dataTable.Columns.Add("FLS_INTENSITY", typeof(string));
            dataTable.Columns.Add("BGM", typeof(string));
            dataTable.Columns.Add("LAB", typeof(string));
            dataTable.Columns.Add("GOOD_TYPE", typeof(string));
            dataTable.Columns.Add("LOCATION", typeof(string));
            dataTable.Columns.Add("STATUS", typeof(string));
            dataTable.Columns.Add("IMAGE_LINK", typeof(string));
            dataTable.Columns.Add("VIDEO_LINK", typeof(string));
            dataTable.Columns.Add("LENGTH", typeof(string));
            dataTable.Columns.Add("WIDTH", typeof(string));
            dataTable.Columns.Add("DEPTH", typeof(string));
            dataTable.Columns.Add("TABLE_PER", typeof(string));
            dataTable.Columns.Add("DEPTH_PER", typeof(string));
            dataTable.Columns.Add("CROWN_ANGLE", typeof(string));
            dataTable.Columns.Add("CROWN_HEIGHT", typeof(string));
            dataTable.Columns.Add("PAVILION_ANGLE", typeof(string));
            dataTable.Columns.Add("PAVILION_HEIGHT", typeof(string));
            dataTable.Columns.Add("GIRDLE_PER", typeof(string));
            dataTable.Columns.Add("RAP_RATE", typeof(string));
            dataTable.Columns.Add("RAP_AMOUNT", typeof(string));
            dataTable.Columns.Add("COST_DISC", typeof(string));
            dataTable.Columns.Add("COST_AMOUNT", typeof(string));
            dataTable.Columns.Add("OFFER_DISC", typeof(string));
            dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
            dataTable.Columns.Add("BASE_DISC", typeof(string));
            dataTable.Columns.Add("BASE_AMOUNT", typeof(string));
            dataTable.Columns.Add("PRICE_PER_CTS", typeof(string));
            dataTable.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
            dataTable.Columns.Add("MAX_SLAB_BASE_AMOUNT", typeof(string));
            dataTable.Columns.Add("MAX_SLAB_PRICE_PER_CTS", typeof(string));
            dataTable.Columns.Add("BUYER_DISC", typeof(string));
            dataTable.Columns.Add("BUYER AMOUNT", typeof(string));
            dataTable.Columns.Add("TABLE_BLACK", typeof(string));
            dataTable.Columns.Add("TABLE_WHITE", typeof(string));
            dataTable.Columns.Add("SIDE_BLACK", typeof(string));
            dataTable.Columns.Add("SIDE_WHITE", typeof(string));
            dataTable.Columns.Add("TABLE_OPEN", typeof(string));
            dataTable.Columns.Add("CROWN_OPEN", typeof(string));
            dataTable.Columns.Add("PAVILION_OPEN", typeof(string));
            dataTable.Columns.Add("GIRDLE_OPEN", typeof(string));
            dataTable.Columns.Add("CULET", typeof(string));
            dataTable.Columns.Add("KEY_TO_SYMBOL_TRUE", typeof(string));
            dataTable.Columns.Add("KEY_TO_SYMBOL_FALSE", typeof(string));
            dataTable.Columns.Add("LAB_COMMENTS_TRUE", typeof(string));
            dataTable.Columns.Add("LAB_COMMENTS_FALSE", typeof(string));
            dataTable.Columns.Add("FANCY_COLOR", typeof(string));
            dataTable.Columns.Add("FANCY_INTENSITY", typeof(string));
            dataTable.Columns.Add("FANCY_OVERTONE", typeof(string));
            dataTable.Columns.Add("POINTER", typeof(string));
            dataTable.Columns.Add("SUB_POINTER", typeof(string));
            dataTable.Columns.Add("STAR_LN", typeof(string));
            dataTable.Columns.Add("LR_HALF", typeof(string));
            dataTable.Columns.Add("CERT_TYPE", typeof(string));
            dataTable.Columns.Add("COST_RATE", typeof(string));
            dataTable.Columns.Add("RATIO", typeof(string));
            dataTable.Columns.Add("DISCOUNT_TYPE", typeof(string));
            dataTable.Columns.Add("SIGN", typeof(string));
            dataTable.Columns.Add("DISC_VALUE", typeof(string));
            dataTable.Columns.Add("DISC_VALUE1", typeof(string));
            dataTable.Columns.Add("DISC_VALUE2", typeof(string));
            dataTable.Columns.Add("DISC_VALUE3", typeof(string));
            dataTable.Columns.Add("BASE_TYPE", typeof(string));
            dataTable.Columns.Add("SUPP_STOCK_ID", typeof(string));
            dataTable.Columns.Add("BID_SUPP_STOCK_ID", typeof(string));
            dataTable.Columns.Add("BID_BUYER_DISC", typeof(string));
            dataTable.Columns.Add("BID_BUYER_AMOUNT", typeof(string));
            dataTable.Columns.Add("LUSTER", typeof(string));
            dataTable.Columns.Add("SHADE", typeof(string));
            dataTable.Columns.Add("MILKY", typeof(string));
            dataTable.Columns.Add("GIRDLE_FROM", typeof(string));
            dataTable.Columns.Add("GIRDLE_TO", typeof(string));
            dataTable.Columns.Add("GIRDLE_CONDITION", typeof(string));
            dataTable.Columns.Add("ORIGIN", typeof(string));
            dataTable.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
            dataTable.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
            dataTable.Columns.Add("EXTRA_FACET_PAV", typeof(string));
            dataTable.Columns.Add("INTERNAL_GRAINING", typeof(string));
            dataTable.Columns.Add("H_A", typeof(string));
            dataTable.Columns.Add("SUPPLIER_COMMENTS", typeof(string));

            var Round_Cat_Val_Id = _configuration["Round_Cat_Val_Id"];
            bool Is_Round = false;
            if (excel_Model.Report_Filter_Parameter_List != null && excel_Model.Report_Filter_Parameter_List.Count == 1)
            {
                foreach (var item in excel_Model.Report_Filter_Parameter_List)
                {
                    SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Value).FirstOrDefault();

                    if (item.Count == 1 && SHAPE == Round_Cat_Val_Id)
                    {
                        Is_Round = true;
                    }
                }
            }
            if (excel_Model.Report_Filter_Parameter_List != null && excel_Model.Report_Filter_Parameter_List.Count > 0)
            {
                foreach (var item in excel_Model.Report_Filter_Parameter_List)
                {
                    STOCK_ID = item.Where(x => x.Column_Name == "STOCK ID" || x.Column_Name == "CERTIFICATE NO" || x.Column_Name == "SUPPLIER NO").Select(x => x.Category_Value).FirstOrDefault();
                    SUPPLIER = item.Where(x => x.Column_Name == "SUPPLIER" || x.Column_Name == "COMPANY").Select(x => x.Category_Value).FirstOrDefault();
                    CUSTOMER = item.Where(x => x.Column_Name == "CUSTOMER").Select(x => x.Category_Value).FirstOrDefault();
                    SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Value).FirstOrDefault();
                    CTS = item.Where(x => x.Column_Name == "CTS").Select(x => x.Category_Value).FirstOrDefault();
                    COLOR = item.Where(x => x.Column_Name == "COLOR").Select(x => x.Category_Value).FirstOrDefault();
                    CLARITY = item.Where(x => x.Column_Name == "CLARITY").Select(x => x.Category_Value).FirstOrDefault();
                    CUT = item.Where(x => x.Column_Name == "CUT").Select(x => x.Category_Value).FirstOrDefault();
                    POLISH = item.Where(x => x.Column_Name == "POLISH").Select(x => x.Category_Value).FirstOrDefault();
                    SYMM = item.Where(x => x.Column_Name == "SYMM").Select(x => x.Category_Value).FirstOrDefault();
                    FLS_INTENSITY = item.Where(x => x.Column_Name == "FLS INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                    BGM = item.Where(x => x.Column_Name == "BGM").Select(x => x.Category_Value).FirstOrDefault();
                    LAB = item.Where(x => x.Column_Name == "LAB").Select(x => x.Category_Value).FirstOrDefault();
                    GOOD_TYPE = item.Where(x => x.Column_Name == "GOOD TYPE").Select(x => x.Category_Value).FirstOrDefault();
                    LOCATION = item.Where(x => x.Column_Name == "LOCATION").Select(x => x.Category_Value).FirstOrDefault();
                    STATUS = item.Where(x => x.Column_Name == "STATUS").Select(x => x.Category_Value).FirstOrDefault();
                    IMAGE_LINK = item.Where(x => x.Column_Name == "IMAGE LINK").Select(x => x.Category_Value).FirstOrDefault();
                    VIDEO_LINK = item.Where(x => x.Column_Name == "VIDEO LINK").Select(x => x.Category_Value).FirstOrDefault();
                    LENGTH = item.Where(x => x.Column_Name == "LENGTH").Select(x => x.Category_Value).FirstOrDefault();
                    WIDTH = item.Where(x => x.Column_Name == "WIDTH").Select(x => x.Category_Value).FirstOrDefault();
                    DEPTH = item.Where(x => x.Column_Name == "DEPTH").Select(x => x.Category_Value).FirstOrDefault();
                    TABLE_PER = item.Where(x => x.Column_Name == "TABLE PER").Select(x => x.Category_Value).FirstOrDefault();
                    DEPTH_PER = item.Where(x => x.Column_Name == "DEPTH PER").Select(x => x.Category_Value).FirstOrDefault();
                    CROWN_ANGLE = item.Where(x => x.Column_Name == "CROWN ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                    CROWN_HEIGHT = item.Where(x => x.Column_Name == "CROWN HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                    PAVILION_ANGLE = item.Where(x => x.Column_Name == "PAVILION ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                    PAVILION_HEIGHT = item.Where(x => x.Column_Name == "PAVILION HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                    GIRDLE_PER = item.Where(x => x.Column_Name == "GIRDLE PER").Select(x => x.Category_Value).FirstOrDefault();
                    RAP_RATE = item.Where(x => x.Column_Name == "RAP RATE").Select(x => x.Category_Value).FirstOrDefault();
                    RAP_AMOUNT = item.Where(x => x.Column_Name == "RAP AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                    COST_DISC = item.Where(x => x.Column_Name == "COST DISC").Select(x => x.Category_Value).FirstOrDefault();
                    COST_AMOUNT = item.Where(x => x.Column_Name == "COST AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                    OFFER_DISC = item.Where(x => x.Column_Name == "OFFER DISC").Select(x => x.Category_Value).FirstOrDefault();
                    OFFER_VALUE = item.Where(x => x.Column_Name == "OFFER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                    BASE_DISC = item.Where(x => x.Column_Name == "BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                    BASE_AMOUNT = item.Where(x => x.Column_Name == "BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                    PRICE_PER_CTS = item.Where(x => x.Column_Name == "PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                    MAX_SLAB_BASE_DISC = item.Where(x => x.Column_Name == "MAX SLAB BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                    MAX_SLAB_BASE_AMOUNT = item.Where(x => x.Column_Name == "MAX SLAB BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                    MAX_SLAB_PRICE_PER_CTS = item.Where(x => x.Column_Name == "MAX SLAB PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                    BUYER_DISC = item.Where(x => x.Column_Name == "BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                    BUYER_AMOUNT = item.Where(x => x.Column_Name == "BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                    TABLE_BLACK = item.Where(x => x.Column_Name == "TABLE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                    TABLE_WHITE = item.Where(x => x.Column_Name == "TABLE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                    SIDE_BLACK = item.Where(x => x.Column_Name == "SIDE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                    SIDE_WHITE = item.Where(x => x.Column_Name == "SIDE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                    TABLE_OPEN = item.Where(x => x.Column_Name == "TABLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                    CROWN_OPEN = item.Where(x => x.Column_Name == "CROWN OPEN").Select(x => x.Category_Value).FirstOrDefault();
                    PAVILION_OPEN = item.Where(x => x.Column_Name == "PAVILION OPEN").Select(x => x.Category_Value).FirstOrDefault();
                    GIRDLE_OPEN = item.Where(x => x.Column_Name == "GIRDLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                    CULET = item.Where(x => x.Column_Name == "CULET").Select(x => x.Category_Value).FirstOrDefault();
                    KEY_TO_SYMBOL_TRUE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_TRUE).FirstOrDefault();
                    KEY_TO_SYMBOL_FALSE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_FALSE).FirstOrDefault();
                    LAB_COMMENTS_TRUE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_TRUE).FirstOrDefault();
                    LAB_COMMENTS_FALSE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_FALSE).FirstOrDefault();
                    FANCY_COLOR = item.Where(x => x.Column_Name == "FANCY COLOR").Select(x => x.Category_Value).FirstOrDefault();
                    FANCY_INTENSITY = item.Where(x => x.Column_Name == "FANCY INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                    FANCY_OVERTONE = item.Where(x => x.Column_Name == "FANCY OVERTONE").Select(x => x.Category_Value).FirstOrDefault();
                    POINTER = item.Where(x => x.Column_Name == "POINTER").Select(x => x.Category_Value).FirstOrDefault();
                    SUB_POINTER = item.Where(x => x.Column_Name == "SUB POINTER").Select(x => x.Category_Value).FirstOrDefault();
                    STAR_LN = item.Where(x => x.Column_Name == "STAR LN").Select(x => x.Category_Value).FirstOrDefault();
                    LR_HALF = item.Where(x => x.Column_Name == "LR HALF").Select(x => x.Category_Value).FirstOrDefault();
                    CERT_TYPE = item.Where(x => x.Column_Name == "CERT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                    COST_RATE = item.Where(x => x.Column_Name == "COST RATE").Select(x => x.Category_Value).FirstOrDefault();
                    RATIO = item.Where(x => x.Column_Name == "RATIO").Select(x => x.Category_Value).FirstOrDefault();
                    DISCOUNT_TYPE = item.Where(x => x.Column_Name == "DISCOUNT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                    SIGN = item.Where(x => x.Column_Name == "SIGN").Select(x => x.Category_Value).FirstOrDefault();
                    DISC_VALUE = item.Where(x => x.Column_Name == "DISC VALUE").Select(x => x.Category_Value).FirstOrDefault();
                    DISC_VALUE1 = item.Where(x => x.Column_Name == "DISC VALUE1").Select(x => x.Category_Value).FirstOrDefault();
                    DISC_VALUE2 = item.Where(x => x.Column_Name == "DISC VALUE2").Select(x => x.Category_Value).FirstOrDefault();
                    DISC_VALUE3 = item.Where(x => x.Column_Name == "DISC VALUE3").Select(x => x.Category_Value).FirstOrDefault();
                    BASE_TYPE = item.Where(x => x.Column_Name == "BASE TYPE").Select(x => x.Category_Value).FirstOrDefault();
                    SUPP_STOCK_ID = item.Where(x => x.Column_Name == "SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                    BID_SUPP_STOCK_ID = item.Where(x => x.Column_Name == "BID SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                    BID_BUYER_DISC = item.Where(x => x.Column_Name == "BID BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                    BID_BUYER_AMOUNT = item.Where(x => x.Column_Name == "BID BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                    LUSTER = item.Where(x => x.Column_Name == "LUSTER").Select(x => x.Category_Value).FirstOrDefault();
                    SHADE = item.Where(x => x.Column_Name == "SHADE").Select(x => x.Category_Value).FirstOrDefault();
                    MILKY = item.Where(x => x.Column_Name == "MILKY").Select(x => x.Category_Value).FirstOrDefault();
                    GIRDLE_FROM = item.Where(x => x.Column_Name == "GIRDLE_FROM").Select(x => x.Category_Value).FirstOrDefault();
                    GIRDLE_TO = item.Where(x => x.Column_Name == "GIRDLE_TO").Select(x => x.Category_Value).FirstOrDefault();
                    GIRDLE_CONDITION = item.Where(x => x.Column_Name == "GIRDLE_CONDITION").Select(x => x.Category_Value).FirstOrDefault();
                    ORIGIN = item.Where(x => x.Column_Name == "ORIGIN").Select(x => x.Category_Value).FirstOrDefault();
                    EXTRA_FACET_TABLE = item.Where(x => x.Column_Name == "EXTRA_FACET_TABLE").Select(x => x.Category_Value).FirstOrDefault();
                    EXTRA_FACET_CROWN = item.Where(x => x.Column_Name == "EXTRA_FACET_CROWN").Select(x => x.Category_Value).FirstOrDefault();
                    EXTRA_FACET_PAV = item.Where(x => x.Column_Name == "EXTRA_FACET_PAV").Select(x => x.Category_Value).FirstOrDefault();
                    INTERNAL_GRAINING = item.Where(x => x.Column_Name == "INTERNAL_GRAINING").Select(x => x.Category_Value).FirstOrDefault();
                    H_A = item.Where(x => x.Column_Name == "H_A").Select(x => x.Category_Value).FirstOrDefault();
                    SUPPLIER_COMMENTS = item.Where(x => x.Column_Name == "SUPPLIER_COMMENTS").Select(x => x.Category_Value).FirstOrDefault();

                    dataTable.Rows.Add(!string.IsNullOrEmpty(STOCK_ID) ? STOCK_ID : DBNull.Value,
                        !string.IsNullOrEmpty(SUPPLIER) ? SUPPLIER : DBNull.Value,
                        !string.IsNullOrEmpty(CUSTOMER) ? CUSTOMER : DBNull.Value,
                        !string.IsNullOrEmpty(SHAPE) ? SHAPE : DBNull.Value,
                        !string.IsNullOrEmpty(CTS) ? CTS : DBNull.Value,
                        !string.IsNullOrEmpty(COLOR) ? COLOR : DBNull.Value,
                        !string.IsNullOrEmpty(CLARITY) ? CLARITY : DBNull.Value,
                        !string.IsNullOrEmpty(CUT) ? CUT : DBNull.Value,
                        !string.IsNullOrEmpty(POLISH) ? POLISH : DBNull.Value,
                        !string.IsNullOrEmpty(SYMM) ? SYMM : DBNull.Value,
                        !string.IsNullOrEmpty(FLS_INTENSITY) ? FLS_INTENSITY : DBNull.Value,
                        !string.IsNullOrEmpty(BGM) ? BGM : DBNull.Value,
                        !string.IsNullOrEmpty(LAB) ? LAB : DBNull.Value,
                        !string.IsNullOrEmpty(GOOD_TYPE) ? GOOD_TYPE : DBNull.Value,
                        !string.IsNullOrEmpty(LOCATION) ? LOCATION : DBNull.Value,
                        !string.IsNullOrEmpty(STATUS) ? STATUS : DBNull.Value,
                        !string.IsNullOrEmpty(IMAGE_LINK) ? IMAGE_LINK : DBNull.Value,
                        !string.IsNullOrEmpty(VIDEO_LINK) ? VIDEO_LINK : DBNull.Value,
                        !string.IsNullOrEmpty(LENGTH) ? LENGTH : DBNull.Value,
                        !string.IsNullOrEmpty(WIDTH) ? WIDTH : DBNull.Value,
                        !string.IsNullOrEmpty(DEPTH) ? DEPTH : DBNull.Value,
                        !string.IsNullOrEmpty(TABLE_PER) ? TABLE_PER : DBNull.Value,
                        !string.IsNullOrEmpty(DEPTH_PER) ? DEPTH_PER : DBNull.Value,
                        !string.IsNullOrEmpty(CROWN_ANGLE) ? CROWN_ANGLE : DBNull.Value,
                        !string.IsNullOrEmpty(CROWN_HEIGHT) ? CROWN_HEIGHT : DBNull.Value,
                        !string.IsNullOrEmpty(PAVILION_ANGLE) ? PAVILION_ANGLE : DBNull.Value,
                        !string.IsNullOrEmpty(PAVILION_HEIGHT) ? PAVILION_HEIGHT : DBNull.Value,
                        !string.IsNullOrEmpty(GIRDLE_PER) ? GIRDLE_PER : DBNull.Value,
                        !string.IsNullOrEmpty(RAP_RATE) ? RAP_RATE : DBNull.Value,
                        !string.IsNullOrEmpty(RAP_AMOUNT) ? RAP_AMOUNT : DBNull.Value,
                        !string.IsNullOrEmpty(COST_DISC) ? COST_DISC : DBNull.Value,
                        !string.IsNullOrEmpty(COST_AMOUNT) ? COST_AMOUNT : DBNull.Value,
                        !string.IsNullOrEmpty(OFFER_DISC) ? OFFER_DISC : DBNull.Value,
                        !string.IsNullOrEmpty(OFFER_VALUE) ? OFFER_VALUE : DBNull.Value,
                        !string.IsNullOrEmpty(BASE_DISC) ? BASE_DISC : DBNull.Value,
                        !string.IsNullOrEmpty(BASE_AMOUNT) ? BASE_AMOUNT : DBNull.Value,
                        !string.IsNullOrEmpty(PRICE_PER_CTS) ? PRICE_PER_CTS : DBNull.Value,
                        !string.IsNullOrEmpty(MAX_SLAB_BASE_DISC) ? MAX_SLAB_BASE_DISC : DBNull.Value,
                        !string.IsNullOrEmpty(MAX_SLAB_BASE_AMOUNT) ? MAX_SLAB_BASE_AMOUNT : DBNull.Value,
                        !string.IsNullOrEmpty(MAX_SLAB_PRICE_PER_CTS) ? MAX_SLAB_PRICE_PER_CTS : DBNull.Value,
                        !string.IsNullOrEmpty(BUYER_DISC) ? BUYER_DISC : DBNull.Value,
                        !string.IsNullOrEmpty(BUYER_AMOUNT) ? BUYER_AMOUNT : DBNull.Value,
                        !string.IsNullOrEmpty(TABLE_BLACK) ? TABLE_BLACK : DBNull.Value,
                        !string.IsNullOrEmpty(TABLE_WHITE) ? TABLE_WHITE : DBNull.Value,
                        !string.IsNullOrEmpty(SIDE_BLACK) ? SIDE_BLACK : DBNull.Value,
                        !string.IsNullOrEmpty(SIDE_WHITE) ? SIDE_WHITE : DBNull.Value,
                        !string.IsNullOrEmpty(TABLE_OPEN) ? TABLE_OPEN : DBNull.Value,
                        !string.IsNullOrEmpty(CROWN_OPEN) ? CROWN_OPEN : DBNull.Value,
                        !string.IsNullOrEmpty(PAVILION_OPEN) ? PAVILION_OPEN : DBNull.Value,
                        !string.IsNullOrEmpty(GIRDLE_OPEN) ? GIRDLE_OPEN : DBNull.Value,
                        !string.IsNullOrEmpty(CULET) ? CULET : DBNull.Value,
                        !string.IsNullOrEmpty(KEY_TO_SYMBOL_TRUE) ? KEY_TO_SYMBOL_TRUE : DBNull.Value,
                        !string.IsNullOrEmpty(KEY_TO_SYMBOL_FALSE) ? KEY_TO_SYMBOL_FALSE : DBNull.Value,
                        !string.IsNullOrEmpty(LAB_COMMENTS_TRUE) ? LAB_COMMENTS_TRUE : DBNull.Value,
                        !string.IsNullOrEmpty(LAB_COMMENTS_FALSE) ? LAB_COMMENTS_FALSE : DBNull.Value,
                        !string.IsNullOrEmpty(FANCY_COLOR) ? FANCY_COLOR : DBNull.Value,
                        !string.IsNullOrEmpty(FANCY_INTENSITY) ? FANCY_INTENSITY : DBNull.Value,
                        !string.IsNullOrEmpty(FANCY_OVERTONE) ? FANCY_OVERTONE : DBNull.Value,
                        !string.IsNullOrEmpty(POINTER) ? POINTER : DBNull.Value,
                        !string.IsNullOrEmpty(SUB_POINTER) ? SUB_POINTER : DBNull.Value,
                        !string.IsNullOrEmpty(STAR_LN) ? STAR_LN : DBNull.Value,
                        !string.IsNullOrEmpty(LR_HALF) ? LR_HALF : DBNull.Value,
                        !string.IsNullOrEmpty(CERT_TYPE) ? CERT_TYPE : DBNull.Value,
                        !string.IsNullOrEmpty(COST_RATE) ? COST_RATE : DBNull.Value,
                        !string.IsNullOrEmpty(RATIO) ? RATIO : DBNull.Value,
                        !string.IsNullOrEmpty(DISCOUNT_TYPE) ? DISCOUNT_TYPE : DBNull.Value,
                        !string.IsNullOrEmpty(SIGN) ? SIGN : DBNull.Value,
                        !string.IsNullOrEmpty(DISC_VALUE) ? DISC_VALUE : DBNull.Value,
                        !string.IsNullOrEmpty(DISC_VALUE1) ? DISC_VALUE1 : DBNull.Value,
                        !string.IsNullOrEmpty(DISC_VALUE2) ? DISC_VALUE2 : DBNull.Value,
                        !string.IsNullOrEmpty(DISC_VALUE3) ? DISC_VALUE3 : DBNull.Value,
                        !string.IsNullOrEmpty(BASE_TYPE) ? BASE_TYPE : DBNull.Value,
                        !string.IsNullOrEmpty(SUPP_STOCK_ID) ? SUPP_STOCK_ID : DBNull.Value,
                        !string.IsNullOrEmpty(BID_SUPP_STOCK_ID) ? BID_SUPP_STOCK_ID : DBNull.Value,
                        !string.IsNullOrEmpty(BID_BUYER_DISC) ? BID_BUYER_DISC : DBNull.Value,
                        !string.IsNullOrEmpty(BID_BUYER_AMOUNT) ? BID_BUYER_AMOUNT : DBNull.Value,
                        !string.IsNullOrEmpty(LUSTER) ? LUSTER : DBNull.Value,
                        !string.IsNullOrEmpty(SHADE) ? SHADE : DBNull.Value,
                        !string.IsNullOrEmpty(MILKY) ? MILKY : DBNull.Value,
                        !string.IsNullOrEmpty(GIRDLE_FROM) ? GIRDLE_FROM : DBNull.Value,
                        !string.IsNullOrEmpty(GIRDLE_TO) ? GIRDLE_TO : DBNull.Value,
                        !string.IsNullOrEmpty(GIRDLE_CONDITION) ? GIRDLE_CONDITION : DBNull.Value,
                        !string.IsNullOrEmpty(ORIGIN) ? ORIGIN : DBNull.Value,
                        !string.IsNullOrEmpty(EXTRA_FACET_TABLE) ? EXTRA_FACET_TABLE : DBNull.Value,
                        !string.IsNullOrEmpty(EXTRA_FACET_CROWN) ? EXTRA_FACET_CROWN : DBNull.Value,
                        !string.IsNullOrEmpty(EXTRA_FACET_PAV) ? EXTRA_FACET_PAV : DBNull.Value,
                        !string.IsNullOrEmpty(INTERNAL_GRAINING) ? INTERNAL_GRAINING : DBNull.Value,
                        !string.IsNullOrEmpty(H_A) ? H_A : DBNull.Value,
                        !string.IsNullOrEmpty(SUPPLIER_COMMENTS) ? SUPPLIER_COMMENTS : DBNull.Value);
                }
            }
            else
            {
                if (string.IsNullOrEmpty(excel_Model.supplier_Ref_No))
                {
                    var destinationFolderPath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    /*if (excel_Model.excel_Format == "Customer" && Is_Round == false)
                    {
                        string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Customer.xlsx";
                        string newFileName = "Customer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                        if (System.IO.File.Exists(sourceFilePath))
                        {
                            System.IO.File.Copy(sourceFilePath, destinationFilePath);
                            if (System.IO.File.Exists(destinationFilePath))
                            {
                                var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.DataSuccessfullyFound,
                                    result = excelPath,
                                    file_name = newFileName
                                });
                            }
                        }
                    }
                    else if (excel_Model.excel_Format == "Buyer" && Is_Round == false)
                    {
                        string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Buyer.xlsx";
                        string newFileName = "Buyer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                        if (System.IO.File.Exists(sourceFilePath))
                        {
                            System.IO.File.Copy(sourceFilePath, destinationFilePath, true);
                            if (System.IO.File.Exists(destinationFilePath))
                            {
                                var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.DataSuccessfullyFound,
                                    result = excelPath,
                                    file_name = newFileName
                                });
                            }
                        }
                    }
                    else if (excel_Model.excel_Format == "Supplier" && Is_Round == false)
                    {
                        string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Supplier.xlsx";
                        string newFileName = "Supplier_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                        if (System.IO.File.Exists(sourceFilePath))
                        {
                            System.IO.File.Copy(sourceFilePath, destinationFilePath);
                            if (System.IO.File.Exists(destinationFilePath))
                            {
                                var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.DataSuccessfullyFound,
                                    result = excelPath,
                                    file_name = newFileName
                                });
                            }
                        }
                    }
                    else if (excel_Model.excel_Format == "Customer" && Is_Round == true)
                    {
                        string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Customer_Round.xlsx";
                        string newFileName = "Customer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                        if (System.IO.File.Exists(sourceFilePath))
                        {
                            System.IO.File.Copy(sourceFilePath, destinationFilePath);
                            if (System.IO.File.Exists(destinationFilePath))
                            {
                                var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.DataSuccessfullyFound,
                                    result = excelPath,
                                    file_name = newFileName
                                });
                            }
                        }
                    }
                    else if (excel_Model.excel_Format == "Buyer" && Is_Round == true)
                    {
                        string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Buyer_Round.xlsx";
                        string newFileName = "Buyer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                        if (System.IO.File.Exists(sourceFilePath))
                        {
                            System.IO.File.Copy(sourceFilePath, destinationFilePath, true);
                            if (System.IO.File.Exists(destinationFilePath))
                            {
                                var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.DataSuccessfullyFound,
                                    result = excelPath,
                                    file_name = newFileName
                                });
                            }
                        }
                    }
                    else if (excel_Model.excel_Format == "Supplier" && Is_Round == true)
                    {
                        string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Supplier_Round.xlsx";
                        string newFileName = "Supplier_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                        if (System.IO.File.Exists(sourceFilePath))
                        {
                            System.IO.File.Copy(sourceFilePath, destinationFilePath);
                            if (System.IO.File.Exists(destinationFilePath))
                            {
                                var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.DataSuccessfullyFound,
                                    result = excelPath,
                                    file_name = newFileName
                                });
                            }
                        }
                    }*/
                }
                else
                {
                    DataRow newRow = dataTable.NewRow();
                    for (int i = 0; i < dataTable.Columns.Count; i++)
                    {
                        newRow[i] = DBNull.Value;
                    }
                    dataTable.Rows.Add(newRow);
                }
            }

            var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
            int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

            DataTable supp_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable, excel_Model.excel_Format, excel_Model.supplier_Ref_No, user_Id ?? 0);
            if (supp_stock_dt != null && supp_stock_dt.Rows.Count > 0)
            {
                List<string> columnNames = new List<string>();
                foreach (DataColumn column in supp_stock_dt.Columns)
                {
                    columnNames.Add(column.ColumnName);
                }

                DataTable columnNamesTable = new DataTable();
                columnNamesTable.Columns.Add("Column_Name", typeof(string));

                foreach (string columnName in columnNames)
                {
                    columnNamesTable.Rows.Add(columnName);
                }
                var excelPath = string.Empty;
                var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                if (!(Directory.Exists(filePath)))
                {
                    Directory.CreateDirectory(filePath);
                }
                string filename = string.Empty;
                if (excel_Model.excel_Format == "Customer")
                {
                    filename = "Customer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Customer_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                }
                else if (excel_Model.excel_Format == "Buyer")
                {
                    filename = "Buyer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Buyer_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                }
                else if (excel_Model.excel_Format == "Supplier")
                {
                    filename = "Supplier_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Supplier_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                }
                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    result = excelPath,
                    file_name = filename
                });
            }
            return NoContent();
        }

        [HttpGet]
        [Route("pre_generated_export_stock_excel")]
        [Authorize]
        public async Task<IActionResult> Pre_Generated_Export_Stock_Excel()
        {
            try
            {

                #region ALL STOCK
                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("SUPPLIER", typeof(string));
                dataTable.Columns.Add("CUSTOMER", typeof(string));
                dataTable.Columns.Add("SHAPE", typeof(string));
                dataTable.Columns.Add("CTS", typeof(string));
                dataTable.Columns.Add("COLOR", typeof(string));
                dataTable.Columns.Add("CLARITY", typeof(string));
                dataTable.Columns.Add("CUT", typeof(string));
                dataTable.Columns.Add("POLISH", typeof(string));
                dataTable.Columns.Add("SYMM", typeof(string));
                dataTable.Columns.Add("FLS_INTENSITY", typeof(string));
                dataTable.Columns.Add("BGM", typeof(string));
                dataTable.Columns.Add("LAB", typeof(string));
                dataTable.Columns.Add("GOOD_TYPE", typeof(string));
                dataTable.Columns.Add("LOCATION", typeof(string));
                dataTable.Columns.Add("STATUS", typeof(string));
                dataTable.Columns.Add("IMAGE_LINK", typeof(string));
                dataTable.Columns.Add("VIDEO_LINK", typeof(string));
                dataTable.Columns.Add("LENGTH", typeof(string));
                dataTable.Columns.Add("WIDTH", typeof(string));
                dataTable.Columns.Add("DEPTH", typeof(string));
                dataTable.Columns.Add("TABLE_PER", typeof(string));
                dataTable.Columns.Add("DEPTH_PER", typeof(string));
                dataTable.Columns.Add("CROWN_ANGLE", typeof(string));
                dataTable.Columns.Add("CROWN_HEIGHT", typeof(string));
                dataTable.Columns.Add("PAVILION_ANGLE", typeof(string));
                dataTable.Columns.Add("PAVILION_HEIGHT", typeof(string));
                dataTable.Columns.Add("GIRDLE_PER", typeof(string));
                dataTable.Columns.Add("RAP_RATE", typeof(string));
                dataTable.Columns.Add("RAP_AMOUNT", typeof(string));
                dataTable.Columns.Add("COST_DISC", typeof(string));
                dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable.Columns.Add("BASE_DISC", typeof(string));
                dataTable.Columns.Add("BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_BASE_AMOUNT", typeof(string));
                dataTable.Columns.Add("MAX_SLAB_PRICE_PER_CTS", typeof(string));
                dataTable.Columns.Add("BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BUYER AMOUNT", typeof(string));
                dataTable.Columns.Add("TABLE_BLACK", typeof(string));
                dataTable.Columns.Add("TABLE_WHITE", typeof(string));
                dataTable.Columns.Add("SIDE_BLACK", typeof(string));
                dataTable.Columns.Add("SIDE_WHITE", typeof(string));
                dataTable.Columns.Add("TABLE_OPEN", typeof(string));
                dataTable.Columns.Add("CROWN_OPEN", typeof(string));
                dataTable.Columns.Add("PAVILION_OPEN", typeof(string));
                dataTable.Columns.Add("GIRDLE_OPEN", typeof(string));
                dataTable.Columns.Add("CULET", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_TRUE", typeof(string));
                dataTable.Columns.Add("KEY_TO_SYMBOL_FALSE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_TRUE", typeof(string));
                dataTable.Columns.Add("LAB_COMMENTS_FALSE", typeof(string));
                dataTable.Columns.Add("FANCY_COLOR", typeof(string));
                dataTable.Columns.Add("FANCY_INTENSITY", typeof(string));
                dataTable.Columns.Add("FANCY_OVERTONE", typeof(string));
                dataTable.Columns.Add("POINTER", typeof(string));
                dataTable.Columns.Add("SUB_POINTER", typeof(string));
                dataTable.Columns.Add("STAR_LN", typeof(string));
                dataTable.Columns.Add("LR_HALF", typeof(string));
                dataTable.Columns.Add("CERT_TYPE", typeof(string));
                dataTable.Columns.Add("COST_RATE", typeof(string));
                dataTable.Columns.Add("RATIO", typeof(string));
                dataTable.Columns.Add("DISCOUNT_TYPE", typeof(string));
                dataTable.Columns.Add("SIGN", typeof(string));
                dataTable.Columns.Add("DISC_VALUE", typeof(string));
                dataTable.Columns.Add("DISC_VALUE1", typeof(string));
                dataTable.Columns.Add("DISC_VALUE2", typeof(string));
                dataTable.Columns.Add("DISC_VALUE3", typeof(string));
                dataTable.Columns.Add("BASE_TYPE", typeof(string));
                dataTable.Columns.Add("SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_SUPP_STOCK_ID", typeof(string));
                dataTable.Columns.Add("BID_BUYER_DISC", typeof(string));
                dataTable.Columns.Add("BID_BUYER_AMOUNT", typeof(string));
                dataTable.Columns.Add("LUSTER", typeof(string));
                dataTable.Columns.Add("SHADE", typeof(string));
                dataTable.Columns.Add("MILKY", typeof(string));
                dataTable.Columns.Add("GIRDLE_FROM", typeof(string));
                dataTable.Columns.Add("GIRDLE_TO", typeof(string));
                dataTable.Columns.Add("GIRDLE_CONDITION", typeof(string));
                dataTable.Columns.Add("ORIGIN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                dataTable.Columns.Add("EXTRA_FACET_PAV", typeof(string));
                dataTable.Columns.Add("INTERNAL_GRAINING", typeof(string));
                dataTable.Columns.Add("H_A", typeof(string));
                dataTable.Columns.Add("SUPPLIER_COMMENTS", typeof(string));


                DataRow newRow = dataTable.NewRow();
                for (int i = 0; i < dataTable.Columns.Count; i++)
                {
                    newRow[i] = DBNull.Value;
                }
                dataTable.Rows.Add(newRow);

                var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/PreGeneratedStockExcelFiles/");
                if (!(Directory.Exists(filePath)))
                {
                    Directory.CreateDirectory(filePath);
                }

                //Supplier all stock
                DataTable supp_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable, "Supplier", null, 0);
                if (supp_stock_dt != null && supp_stock_dt.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in supp_stock_dt.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    EpExcelExport.Create_Supplier_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + "Supplier.xlsx");
                }
                //Customer all stock
                DataTable cust_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable, "Customer", null, 0);
                if (cust_stock_dt != null && cust_stock_dt.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in cust_stock_dt.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    EpExcelExport.Create_Customer_Excel(cust_stock_dt, columnNamesTable, filePath, filePath + "Customer.xlsx");
                }

                //Buyer all stock
                DataTable buyer_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable, "Buyer", null, 0);
                if (buyer_stock_dt != null && buyer_stock_dt.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in buyer_stock_dt.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    EpExcelExport.Create_Buyer_Excel(buyer_stock_dt, columnNamesTable, filePath, filePath + "Buyer.xlsx");
                }
                #endregion

                #region ROUND STOCK
                DataTable dataTable1 = new DataTable();
                dataTable1.Columns.Add("STOCK_ID", typeof(string));
                dataTable1.Columns.Add("SUPPLIER", typeof(string));
                dataTable1.Columns.Add("CUSTOMER", typeof(string));
                dataTable1.Columns.Add("SHAPE", typeof(string));
                dataTable1.Columns.Add("CTS", typeof(string));
                dataTable1.Columns.Add("COLOR", typeof(string));
                dataTable1.Columns.Add("CLARITY", typeof(string));
                dataTable1.Columns.Add("CUT", typeof(string));
                dataTable1.Columns.Add("POLISH", typeof(string));
                dataTable1.Columns.Add("SYMM", typeof(string));
                dataTable1.Columns.Add("FLS_INTENSITY", typeof(string));
                dataTable1.Columns.Add("BGM", typeof(string));
                dataTable1.Columns.Add("LAB", typeof(string));
                dataTable1.Columns.Add("GOOD_TYPE", typeof(string));
                dataTable1.Columns.Add("LOCATION", typeof(string));
                dataTable1.Columns.Add("STATUS", typeof(string));
                dataTable1.Columns.Add("IMAGE_LINK", typeof(string));
                dataTable1.Columns.Add("VIDEO_LINK", typeof(string));
                dataTable1.Columns.Add("LENGTH", typeof(string));
                dataTable1.Columns.Add("WIDTH", typeof(string));
                dataTable1.Columns.Add("DEPTH", typeof(string));
                dataTable1.Columns.Add("TABLE_PER", typeof(string));
                dataTable1.Columns.Add("DEPTH_PER", typeof(string));
                dataTable1.Columns.Add("CROWN_ANGLE", typeof(string));
                dataTable1.Columns.Add("CROWN_HEIGHT", typeof(string));
                dataTable1.Columns.Add("PAVILION_ANGLE", typeof(string));
                dataTable1.Columns.Add("PAVILION_HEIGHT", typeof(string));
                dataTable1.Columns.Add("GIRDLE_PER", typeof(string));
                dataTable1.Columns.Add("RAP_RATE", typeof(string));
                dataTable1.Columns.Add("RAP_AMOUNT", typeof(string));
                dataTable1.Columns.Add("COST_DISC", typeof(string));
                dataTable1.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable1.Columns.Add("OFFER_DISC", typeof(string));
                dataTable1.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable1.Columns.Add("BASE_DISC", typeof(string));
                dataTable1.Columns.Add("BASE_AMOUNT", typeof(string));
                dataTable1.Columns.Add("PRICE_PER_CTS", typeof(string));
                dataTable1.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                dataTable1.Columns.Add("MAX_SLAB_BASE_AMOUNT", typeof(string));
                dataTable1.Columns.Add("MAX_SLAB_PRICE_PER_CTS", typeof(string));
                dataTable1.Columns.Add("BUYER_DISC", typeof(string));
                dataTable1.Columns.Add("BUYER AMOUNT", typeof(string));
                dataTable1.Columns.Add("TABLE_BLACK", typeof(string));
                dataTable1.Columns.Add("TABLE_WHITE", typeof(string));
                dataTable1.Columns.Add("SIDE_BLACK", typeof(string));
                dataTable1.Columns.Add("SIDE_WHITE", typeof(string));
                dataTable1.Columns.Add("TABLE_OPEN", typeof(string));
                dataTable1.Columns.Add("CROWN_OPEN", typeof(string));
                dataTable1.Columns.Add("PAVILION_OPEN", typeof(string));
                dataTable1.Columns.Add("GIRDLE_OPEN", typeof(string));
                dataTable1.Columns.Add("CULET", typeof(string));
                dataTable1.Columns.Add("KEY_TO_SYMBOL_TRUE", typeof(string));
                dataTable1.Columns.Add("KEY_TO_SYMBOL_FALSE", typeof(string));
                dataTable1.Columns.Add("LAB_COMMENTS_TRUE", typeof(string));
                dataTable1.Columns.Add("LAB_COMMENTS_FALSE", typeof(string));
                dataTable1.Columns.Add("FANCY_COLOR", typeof(string));
                dataTable1.Columns.Add("FANCY_INTENSITY", typeof(string));
                dataTable1.Columns.Add("FANCY_OVERTONE", typeof(string));
                dataTable1.Columns.Add("POINTER", typeof(string));
                dataTable1.Columns.Add("SUB_POINTER", typeof(string));
                dataTable1.Columns.Add("STAR_LN", typeof(string));
                dataTable1.Columns.Add("LR_HALF", typeof(string));
                dataTable1.Columns.Add("CERT_TYPE", typeof(string));
                dataTable1.Columns.Add("COST_RATE", typeof(string));
                dataTable1.Columns.Add("RATIO", typeof(string));
                dataTable1.Columns.Add("DISCOUNT_TYPE", typeof(string));
                dataTable1.Columns.Add("SIGN", typeof(string));
                dataTable1.Columns.Add("DISC_VALUE", typeof(string));
                dataTable1.Columns.Add("DISC_VALUE1", typeof(string));
                dataTable1.Columns.Add("DISC_VALUE2", typeof(string));
                dataTable1.Columns.Add("DISC_VALUE3", typeof(string));
                dataTable1.Columns.Add("BASE_TYPE", typeof(string));
                dataTable1.Columns.Add("SUPP_STOCK_ID", typeof(string));
                dataTable1.Columns.Add("BID_SUPP_STOCK_ID", typeof(string));
                dataTable1.Columns.Add("BID_BUYER_DISC", typeof(string));
                dataTable1.Columns.Add("BID_BUYER_AMOUNT", typeof(string));
                dataTable1.Columns.Add("LUSTER", typeof(string));
                dataTable1.Columns.Add("SHADE", typeof(string));
                dataTable1.Columns.Add("MILKY", typeof(string));
                dataTable1.Columns.Add("GIRDLE_FROM", typeof(string));
                dataTable1.Columns.Add("GIRDLE_TO", typeof(string));
                dataTable1.Columns.Add("GIRDLE_CONDITION", typeof(string));
                dataTable1.Columns.Add("ORIGIN", typeof(string));
                dataTable1.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                dataTable1.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                dataTable1.Columns.Add("EXTRA_FACET_PAV", typeof(string));
                dataTable1.Columns.Add("INTERNAL_GRAINING", typeof(string));
                dataTable1.Columns.Add("H_A", typeof(string));
                dataTable1.Columns.Add("SUPPLIER_COMMENTS", typeof(string));
                var Round_Cat_Val_Id = _configuration["Round_Cat_Val_Id"];
                dataTable1.Rows.Add(DBNull.Value, DBNull.Value, DBNull.Value, Round_Cat_Val_Id, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value,
                            DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value, DBNull.Value);


                //Supplier round stock
                DataTable supp_round_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable1, "Supplier", null, 0);
                if (supp_round_stock_dt != null && supp_round_stock_dt.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in supp_round_stock_dt.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    EpExcelExport.Create_Supplier_Excel(supp_round_stock_dt, columnNamesTable, filePath, filePath + "Supplier_Round.xlsx");
                }
                //Customer round stock
                DataTable cust_round_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable1, "Customer", null, 0);
                if (cust_round_stock_dt != null && cust_round_stock_dt.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in cust_round_stock_dt.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    EpExcelExport.Create_Customer_Excel(cust_round_stock_dt, columnNamesTable, filePath, filePath + "Customer_Round.xlsx");
                }
                //Buyer round stock
                DataTable buyer_round_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable1, "Buyer", null, 0);
                if (buyer_round_stock_dt != null && buyer_round_stock_dt.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in buyer_round_stock_dt.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    EpExcelExport.Create_Buyer_Excel(buyer_round_stock_dt, columnNamesTable, filePath, filePath + "Buyer_Round.xlsx");
                }
                #endregion

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Pre_Generated_Export_Stock_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("download_all_stock_excel")]
        [Authorize]
        public async Task<IActionResult> Download_All_Stock_Excel(string excel_Format)
        {
            try
            {
                string filename = string.Empty;
                var destinationFolderPath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                if (excel_Format == "Customer")
                {
                    string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Customer.xlsx";
                    string newFileName = "Customer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                    if (System.IO.File.Exists(sourceFilePath))
                    {
                        System.IO.File.Move(sourceFilePath, destinationFilePath);
                        if (System.IO.File.Exists(destinationFilePath))
                        {
                            var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                result = excelPath,
                                file_name = filename
                            });
                        }
                    }
                }
                else if (excel_Format == "Buyer")
                {
                    string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Buyer.xlsx";
                    string newFileName = "Buyer_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                    if (System.IO.File.Exists(sourceFilePath))
                    {
                        System.IO.File.Copy(sourceFilePath, destinationFilePath, true);
                        if (System.IO.File.Exists(destinationFilePath))
                        {
                            var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                result = excelPath,
                                file_name = filename
                            });
                        }
                    }
                }
                else if (excel_Format == "Supplier")
                {
                    string sourceFilePath = Directory.GetCurrentDirectory() + CoreCommonFilePath.PreGeneratedStockExcelFilesPath + "Supplier.xlsx";
                    string newFileName = "Supplier_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    string destinationFilePath = Path.Combine(destinationFolderPath, newFileName);
                    if (System.IO.File.Exists(sourceFilePath))
                    {
                        System.IO.File.Move(sourceFilePath, destinationFilePath);
                        if (System.IO.File.Exists(destinationFilePath))
                        {
                            var excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + newFileName;
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                result = excelPath,
                                file_name = filename
                            });
                        }
                    }
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Download_All_Stock_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Send Stock On Email
        [HttpPost]
        [Route("send_stock_on_email")]
        [Authorize]
        public async Task<IActionResult> Send_Stock_On_Email(Stock_Email_Model stock_Email_Model)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    string STOCK_ID = string.Empty, SUPPLIER = string.Empty, CUSTOMER = string.Empty, SHAPE = string.Empty,
                        CTS = string.Empty, COLOR = string.Empty, CLARITY = string.Empty, CUT = string.Empty,
                        POLISH = string.Empty, SYMM = string.Empty, FLS_INTENSITY = string.Empty, BGM = string.Empty,
                        LAB = string.Empty, GOOD_TYPE = string.Empty, LOCATION = string.Empty, STATUS = string.Empty,
                        IMAGE_LINK = string.Empty, VIDEO_LINK = string.Empty, LENGTH = string.Empty, WIDTH = string.Empty,
                        DEPTH = string.Empty, TABLE_PER = string.Empty, DEPTH_PER = string.Empty, CROWN_ANGLE = string.Empty,
                        CROWN_HEIGHT = string.Empty, PAVILION_ANGLE = string.Empty, PAVILION_HEIGHT = string.Empty, GIRDLE_PER = string.Empty,
                        RAP_RATE = string.Empty, RAP_AMOUNT = string.Empty, COST_DISC = string.Empty, COST_AMOUNT = string.Empty,
                        OFFER_DISC = string.Empty, OFFER_VALUE = string.Empty, BASE_DISC = string.Empty, BASE_AMOUNT = string.Empty,
                        PRICE_PER_CTS = string.Empty, MAX_SLAB_BASE_DISC = string.Empty, MAX_SLAB_BASE_AMOUNT = string.Empty, MAX_SLAB_PRICE_PER_CTS = string.Empty,
                        BUYER_DISC = string.Empty, BUYER_AMOUNT = string.Empty, TABLE_BLACK = string.Empty, TABLE_WHITE = string.Empty, SIDE_BLACK = string.Empty, SIDE_WHITE = string.Empty,
                        TABLE_OPEN = string.Empty, CROWN_OPEN = string.Empty, PAVILION_OPEN = string.Empty,
                        GIRDLE_OPEN = string.Empty, CULET = string.Empty, KEY_TO_SYMBOL_TRUE = string.Empty,
                        KEY_TO_SYMBOL_FALSE = string.Empty, LAB_COMMENTS_TRUE = string.Empty, LAB_COMMENTS_FALSE = string.Empty,
                        FANCY_COLOR = string.Empty, FANCY_INTENSITY = string.Empty, FANCY_OVERTONE = string.Empty, POINTER = string.Empty, SUB_POINTER = string.Empty,
                        STAR_LN = string.Empty, LR_HALF = string.Empty, CERT_TYPE = string.Empty, COST_RATE = string.Empty, RATIO = string.Empty, DISCOUNT_TYPE = string.Empty,
                        SIGN = string.Empty, DISC_VALUE = string.Empty, DISC_VALUE1 = string.Empty, DISC_VALUE2 = string.Empty, DISC_VALUE3 = string.Empty, BASE_TYPE = string.Empty, SUPP_STOCK_ID = string.Empty,
                        BID_SUPP_STOCK_ID = string.Empty, BID_BUYER_DISC = string.Empty, BID_BUYER_AMOUNT = string.Empty,
                        LUSTER = string.Empty, SHADE = string.Empty, MILKY = string.Empty, GIRDLE_FROM = string.Empty, GIRDLE_TO = string.Empty, GIRDLE_CONDITION = string.Empty, ORIGIN = string.Empty,
                        EXTRA_FACET_TABLE = string.Empty, EXTRA_FACET_CROWN = string.Empty, EXTRA_FACET_PAV = string.Empty,
                        INTERNAL_GRAINING = string.Empty, H_A = string.Empty, SUPPLIER_COMMENTS = string.Empty;

                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("STOCK_ID", typeof(string));
                    dataTable.Columns.Add("SUPPLIER", typeof(string));
                    dataTable.Columns.Add("CUSTOMER", typeof(string));
                    dataTable.Columns.Add("SHAPE", typeof(string));
                    dataTable.Columns.Add("CTS", typeof(string));
                    dataTable.Columns.Add("COLOR", typeof(string));
                    dataTable.Columns.Add("CLARITY", typeof(string));
                    dataTable.Columns.Add("CUT", typeof(string));
                    dataTable.Columns.Add("POLISH", typeof(string));
                    dataTable.Columns.Add("SYMM", typeof(string));
                    dataTable.Columns.Add("FLS_INTENSITY", typeof(string));
                    dataTable.Columns.Add("BGM", typeof(string));
                    dataTable.Columns.Add("LAB", typeof(string));
                    dataTable.Columns.Add("GOOD_TYPE", typeof(string));
                    dataTable.Columns.Add("LOCATION", typeof(string));
                    dataTable.Columns.Add("STATUS", typeof(string));
                    dataTable.Columns.Add("IMAGE_LINK", typeof(string));
                    dataTable.Columns.Add("VIDEO_LINK", typeof(string));
                    dataTable.Columns.Add("LENGTH", typeof(string));
                    dataTable.Columns.Add("WIDTH", typeof(string));
                    dataTable.Columns.Add("DEPTH", typeof(string));
                    dataTable.Columns.Add("TABLE_PER", typeof(string));
                    dataTable.Columns.Add("DEPTH_PER", typeof(string));
                    dataTable.Columns.Add("CROWN_ANGLE", typeof(string));
                    dataTable.Columns.Add("CROWN_HEIGHT", typeof(string));
                    dataTable.Columns.Add("PAVILION_ANGLE", typeof(string));
                    dataTable.Columns.Add("PAVILION_HEIGHT", typeof(string));
                    dataTable.Columns.Add("GIRDLE_PER", typeof(string));
                    dataTable.Columns.Add("RAP_RATE", typeof(string));
                    dataTable.Columns.Add("RAP_AMOUNT", typeof(string));
                    dataTable.Columns.Add("COST_DISC", typeof(string));
                    dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                    dataTable.Columns.Add("OFFER_DISC", typeof(string));
                    dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                    dataTable.Columns.Add("BASE_DISC", typeof(string));
                    dataTable.Columns.Add("BASE_AMOUNT", typeof(string));
                    dataTable.Columns.Add("PRICE_PER_CTS", typeof(string));
                    dataTable.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                    dataTable.Columns.Add("MAX_SLAB_BASE_AMOUNT", typeof(string));
                    dataTable.Columns.Add("MAX_SLAB_PRICE_PER_CTS", typeof(string));
                    dataTable.Columns.Add("BUYER_DISC", typeof(string));
                    dataTable.Columns.Add("BUYER AMOUNT", typeof(string));
                    dataTable.Columns.Add("TABLE_BLACK", typeof(string));
                    dataTable.Columns.Add("TABLE_WHITE", typeof(string));
                    dataTable.Columns.Add("SIDE_BLACK", typeof(string));
                    dataTable.Columns.Add("SIDE_WHITE", typeof(string));
                    dataTable.Columns.Add("TABLE_OPEN", typeof(string));
                    dataTable.Columns.Add("CROWN_OPEN", typeof(string));
                    dataTable.Columns.Add("PAVILION_OPEN", typeof(string));
                    dataTable.Columns.Add("GIRDLE_OPEN", typeof(string));
                    dataTable.Columns.Add("CULET", typeof(string));
                    dataTable.Columns.Add("KEY_TO_SYMBOL_TRUE", typeof(string));
                    dataTable.Columns.Add("KEY_TO_SYMBOL_FALSE", typeof(string));
                    dataTable.Columns.Add("LAB_COMMENTS_TRUE", typeof(string));
                    dataTable.Columns.Add("LAB_COMMENTS_FALSE", typeof(string));
                    dataTable.Columns.Add("FANCY_COLOR", typeof(string));
                    dataTable.Columns.Add("FANCY_INTENSITY", typeof(string));
                    dataTable.Columns.Add("FANCY_OVERTONE", typeof(string));
                    dataTable.Columns.Add("POINTER", typeof(string));
                    dataTable.Columns.Add("SUB_POINTER", typeof(string));
                    dataTable.Columns.Add("STAR_LN", typeof(string));
                    dataTable.Columns.Add("LR_HALF", typeof(string));
                    dataTable.Columns.Add("CERT_TYPE", typeof(string));
                    dataTable.Columns.Add("COST_RATE", typeof(string));
                    dataTable.Columns.Add("RATIO", typeof(string));
                    dataTable.Columns.Add("DISCOUNT_TYPE", typeof(string));
                    dataTable.Columns.Add("SIGN", typeof(string));
                    dataTable.Columns.Add("DISC_VALUE", typeof(string));
                    dataTable.Columns.Add("DISC_VALUE1", typeof(string));
                    dataTable.Columns.Add("DISC_VALUE2", typeof(string));
                    dataTable.Columns.Add("DISC_VALUE3", typeof(string));
                    dataTable.Columns.Add("BASE_TYPE", typeof(string));
                    dataTable.Columns.Add("SUPP_STOCK_ID", typeof(string));
                    dataTable.Columns.Add("BID_SUPP_STOCK_ID", typeof(string));
                    dataTable.Columns.Add("BID_BUYER_DISC", typeof(string));
                    dataTable.Columns.Add("BID_BUYER_AMOUNT", typeof(string));
                    dataTable.Columns.Add("LUSTER", typeof(string));
                    dataTable.Columns.Add("SHADE", typeof(string));
                    dataTable.Columns.Add("MILKY", typeof(string));
                    dataTable.Columns.Add("GIRDLE_FROM", typeof(string));
                    dataTable.Columns.Add("GIRDLE_TO", typeof(string));
                    dataTable.Columns.Add("GIRDLE_CONDITION", typeof(string));
                    dataTable.Columns.Add("ORIGIN", typeof(string));
                    dataTable.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                    dataTable.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                    dataTable.Columns.Add("EXTRA_FACET_PAV", typeof(string));
                    dataTable.Columns.Add("INTERNAL_GRAINING", typeof(string));
                    dataTable.Columns.Add("H_A", typeof(string));
                    dataTable.Columns.Add("SUPPLIER_COMMENTS", typeof(string));

                    if (stock_Email_Model.Report_Filter_Parameter_List != null && stock_Email_Model.Report_Filter_Parameter_List.Count > 0)
                    {
                        foreach (var item in stock_Email_Model.Report_Filter_Parameter_List)
                        {
                            STOCK_ID = item.Where(x => x.Column_Name == "STOCK ID" || x.Column_Name == "CERTIFICATE NO" || x.Column_Name == "SUPPLIER NO").Select(x => x.Category_Value).FirstOrDefault();
                            SUPPLIER = item.Where(x => x.Column_Name == "SUPPLIER" || x.Column_Name == "COMPANY").Select(x => x.Category_Value).FirstOrDefault();
                            CUSTOMER = item.Where(x => x.Column_Name == "CUSTOMER").Select(x => x.Category_Value).FirstOrDefault();
                            SHAPE = item.Where(x => x.Column_Name == "SHAPE").Select(x => x.Category_Value).FirstOrDefault();
                            CTS = item.Where(x => x.Column_Name == "CTS").Select(x => x.Category_Value).FirstOrDefault();
                            COLOR = item.Where(x => x.Column_Name == "COLOR").Select(x => x.Category_Value).FirstOrDefault();
                            CLARITY = item.Where(x => x.Column_Name == "CLARITY").Select(x => x.Category_Value).FirstOrDefault();
                            CUT = item.Where(x => x.Column_Name == "CUT").Select(x => x.Category_Value).FirstOrDefault();
                            POLISH = item.Where(x => x.Column_Name == "POLISH").Select(x => x.Category_Value).FirstOrDefault();
                            SYMM = item.Where(x => x.Column_Name == "SYMM").Select(x => x.Category_Value).FirstOrDefault();
                            FLS_INTENSITY = item.Where(x => x.Column_Name == "FLS INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                            BGM = item.Where(x => x.Column_Name == "BGM").Select(x => x.Category_Value).FirstOrDefault();
                            LAB = item.Where(x => x.Column_Name == "LAB").Select(x => x.Category_Value).FirstOrDefault();
                            GOOD_TYPE = item.Where(x => x.Column_Name == "GOOD TYPE").Select(x => x.Category_Value).FirstOrDefault();
                            LOCATION = item.Where(x => x.Column_Name == "LOCATION").Select(x => x.Category_Value).FirstOrDefault();
                            STATUS = item.Where(x => x.Column_Name == "STATUS").Select(x => x.Category_Value).FirstOrDefault();
                            IMAGE_LINK = item.Where(x => x.Column_Name == "IMAGE LINK").Select(x => x.Category_Value).FirstOrDefault();
                            VIDEO_LINK = item.Where(x => x.Column_Name == "VIDEO LINK").Select(x => x.Category_Value).FirstOrDefault();
                            LENGTH = item.Where(x => x.Column_Name == "LENGTH").Select(x => x.Category_Value).FirstOrDefault();
                            WIDTH = item.Where(x => x.Column_Name == "WIDTH").Select(x => x.Category_Value).FirstOrDefault();
                            DEPTH = item.Where(x => x.Column_Name == "DEPTH").Select(x => x.Category_Value).FirstOrDefault();
                            TABLE_PER = item.Where(x => x.Column_Name == "TABLE PER").Select(x => x.Category_Value).FirstOrDefault();
                            DEPTH_PER = item.Where(x => x.Column_Name == "DEPTH PER").Select(x => x.Category_Value).FirstOrDefault();
                            CROWN_ANGLE = item.Where(x => x.Column_Name == "CROWN ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                            CROWN_HEIGHT = item.Where(x => x.Column_Name == "CROWN HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                            PAVILION_ANGLE = item.Where(x => x.Column_Name == "PAVILION ANGLE").Select(x => x.Category_Value).FirstOrDefault();
                            PAVILION_HEIGHT = item.Where(x => x.Column_Name == "PAVILION HEIGHT").Select(x => x.Category_Value).FirstOrDefault();
                            GIRDLE_PER = item.Where(x => x.Column_Name == "GIRDLE PER").Select(x => x.Category_Value).FirstOrDefault();
                            RAP_RATE = item.Where(x => x.Column_Name == "RAP RATE").Select(x => x.Category_Value).FirstOrDefault();
                            RAP_AMOUNT = item.Where(x => x.Column_Name == "RAP AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                            COST_DISC = item.Where(x => x.Column_Name == "COST DISC").Select(x => x.Category_Value).FirstOrDefault();
                            COST_AMOUNT = item.Where(x => x.Column_Name == "COST AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                            OFFER_DISC = item.Where(x => x.Column_Name == "OFFER DISC").Select(x => x.Category_Value).FirstOrDefault();
                            OFFER_VALUE = item.Where(x => x.Column_Name == "OFFER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                            BASE_DISC = item.Where(x => x.Column_Name == "BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                            BASE_AMOUNT = item.Where(x => x.Column_Name == "BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                            PRICE_PER_CTS = item.Where(x => x.Column_Name == "PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                            MAX_SLAB_BASE_DISC = item.Where(x => x.Column_Name == "MAX SLAB BASE DISC").Select(x => x.Category_Value).FirstOrDefault();
                            MAX_SLAB_BASE_AMOUNT = item.Where(x => x.Column_Name == "MAX SLAB BASE AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                            MAX_SLAB_PRICE_PER_CTS = item.Where(x => x.Column_Name == "MAX SLAB PRICE PER CTS").Select(x => x.Category_Value).FirstOrDefault();
                            BUYER_DISC = item.Where(x => x.Column_Name == "BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                            BUYER_AMOUNT = item.Where(x => x.Column_Name == "BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                            TABLE_BLACK = item.Where(x => x.Column_Name == "TABLE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                            TABLE_WHITE = item.Where(x => x.Column_Name == "TABLE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                            SIDE_BLACK = item.Where(x => x.Column_Name == "SIDE BLACK").Select(x => x.Category_Value).FirstOrDefault();
                            SIDE_WHITE = item.Where(x => x.Column_Name == "SIDE WHITE").Select(x => x.Category_Value).FirstOrDefault();
                            TABLE_OPEN = item.Where(x => x.Column_Name == "TABLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                            CROWN_OPEN = item.Where(x => x.Column_Name == "CROWN OPEN").Select(x => x.Category_Value).FirstOrDefault();
                            PAVILION_OPEN = item.Where(x => x.Column_Name == "PAVILION OPEN").Select(x => x.Category_Value).FirstOrDefault();
                            GIRDLE_OPEN = item.Where(x => x.Column_Name == "GIRDLE OPEN").Select(x => x.Category_Value).FirstOrDefault();
                            CULET = item.Where(x => x.Column_Name == "CULET").Select(x => x.Category_Value).FirstOrDefault();
                            KEY_TO_SYMBOL_TRUE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_TRUE).FirstOrDefault();
                            KEY_TO_SYMBOL_FALSE = item.Where(x => x.Column_Name == "KEY TO SYMBOL").Select(x => x.KEY_TO_SYMBOL_FALSE).FirstOrDefault();
                            LAB_COMMENTS_TRUE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_TRUE).FirstOrDefault();
                            LAB_COMMENTS_FALSE = item.Where(x => x.Column_Name == "LAB COMMENTS").Select(x => x.LAB_COMMENTS_FALSE).FirstOrDefault();
                            FANCY_COLOR = item.Where(x => x.Column_Name == "FANCY COLOR").Select(x => x.Category_Value).FirstOrDefault();
                            FANCY_INTENSITY = item.Where(x => x.Column_Name == "FANCY INTENSITY").Select(x => x.Category_Value).FirstOrDefault();
                            FANCY_OVERTONE = item.Where(x => x.Column_Name == "FANCY OVERTONE").Select(x => x.Category_Value).FirstOrDefault();
                            POINTER = item.Where(x => x.Column_Name == "POINTER").Select(x => x.Category_Value).FirstOrDefault();
                            SUB_POINTER = item.Where(x => x.Column_Name == "SUB POINTER").Select(x => x.Category_Value).FirstOrDefault();
                            STAR_LN = item.Where(x => x.Column_Name == "STAR LN").Select(x => x.Category_Value).FirstOrDefault();
                            LR_HALF = item.Where(x => x.Column_Name == "LR HALF").Select(x => x.Category_Value).FirstOrDefault();
                            CERT_TYPE = item.Where(x => x.Column_Name == "CERT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                            COST_RATE = item.Where(x => x.Column_Name == "COST RATE").Select(x => x.Category_Value).FirstOrDefault();
                            RATIO = item.Where(x => x.Column_Name == "RATIO").Select(x => x.Category_Value).FirstOrDefault();
                            DISCOUNT_TYPE = item.Where(x => x.Column_Name == "DISCOUNT TYPE").Select(x => x.Category_Value).FirstOrDefault();
                            SIGN = item.Where(x => x.Column_Name == "SIGN").Select(x => x.Category_Value).FirstOrDefault();
                            DISC_VALUE = item.Where(x => x.Column_Name == "DISC VALUE").Select(x => x.Category_Value).FirstOrDefault();
                            DISC_VALUE1 = item.Where(x => x.Column_Name == "DISC VALUE1").Select(x => x.Category_Value).FirstOrDefault();
                            DISC_VALUE2 = item.Where(x => x.Column_Name == "DISC VALUE2").Select(x => x.Category_Value).FirstOrDefault();
                            DISC_VALUE3 = item.Where(x => x.Column_Name == "DISC VALUE3").Select(x => x.Category_Value).FirstOrDefault();
                            BASE_TYPE = item.Where(x => x.Column_Name == "BASE TYPE").Select(x => x.Category_Value).FirstOrDefault();
                            SUPP_STOCK_ID = item.Where(x => x.Column_Name == "SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                            BID_SUPP_STOCK_ID = item.Where(x => x.Column_Name == "BID SUPP STOCK ID").Select(x => x.Category_Value).FirstOrDefault();
                            BID_BUYER_DISC = item.Where(x => x.Column_Name == "BID BUYER DISC").Select(x => x.Category_Value).FirstOrDefault();
                            BID_BUYER_AMOUNT = item.Where(x => x.Column_Name == "BID BUYER AMOUNT").Select(x => x.Category_Value).FirstOrDefault();
                            LUSTER = item.Where(x => x.Column_Name == "LUSTER").Select(x => x.Category_Value).FirstOrDefault();
                            SHADE = item.Where(x => x.Column_Name == "SHADE").Select(x => x.Category_Value).FirstOrDefault();
                            MILKY = item.Where(x => x.Column_Name == "MILKY").Select(x => x.Category_Value).FirstOrDefault();
                            GIRDLE_FROM = item.Where(x => x.Column_Name == "GIRDLE_FROM").Select(x => x.Category_Value).FirstOrDefault();
                            GIRDLE_TO = item.Where(x => x.Column_Name == "GIRDLE_TO").Select(x => x.Category_Value).FirstOrDefault();
                            GIRDLE_CONDITION = item.Where(x => x.Column_Name == "GIRDLE_CONDITION").Select(x => x.Category_Value).FirstOrDefault();
                            ORIGIN = item.Where(x => x.Column_Name == "ORIGIN").Select(x => x.Category_Value).FirstOrDefault();
                            EXTRA_FACET_TABLE = item.Where(x => x.Column_Name == "EXTRA_FACET_TABLE").Select(x => x.Category_Value).FirstOrDefault();
                            EXTRA_FACET_CROWN = item.Where(x => x.Column_Name == "EXTRA_FACET_CROWN").Select(x => x.Category_Value).FirstOrDefault();
                            EXTRA_FACET_PAV = item.Where(x => x.Column_Name == "EXTRA_FACET_PAV").Select(x => x.Category_Value).FirstOrDefault();
                            INTERNAL_GRAINING = item.Where(x => x.Column_Name == "INTERNAL_GRAINING").Select(x => x.Category_Value).FirstOrDefault();
                            H_A = item.Where(x => x.Column_Name == "H_A").Select(x => x.Category_Value).FirstOrDefault();
                            SUPPLIER_COMMENTS = item.Where(x => x.Column_Name == "SUPPLIER_COMMENTS").Select(x => x.Category_Value).FirstOrDefault();

                            dataTable.Rows.Add(!string.IsNullOrEmpty(STOCK_ID) ? STOCK_ID : DBNull.Value,
                                !string.IsNullOrEmpty(SUPPLIER) ? SUPPLIER : DBNull.Value,
                                !string.IsNullOrEmpty(CUSTOMER) ? CUSTOMER : DBNull.Value,
                                !string.IsNullOrEmpty(SHAPE) ? SHAPE : DBNull.Value,
                                !string.IsNullOrEmpty(CTS) ? CTS : DBNull.Value,
                                !string.IsNullOrEmpty(COLOR) ? COLOR : DBNull.Value,
                                !string.IsNullOrEmpty(CLARITY) ? CLARITY : DBNull.Value,
                                !string.IsNullOrEmpty(CUT) ? CUT : DBNull.Value,
                                !string.IsNullOrEmpty(POLISH) ? POLISH : DBNull.Value,
                                !string.IsNullOrEmpty(SYMM) ? SYMM : DBNull.Value,
                                !string.IsNullOrEmpty(FLS_INTENSITY) ? FLS_INTENSITY : DBNull.Value,
                                !string.IsNullOrEmpty(BGM) ? BGM : DBNull.Value,
                                !string.IsNullOrEmpty(LAB) ? LAB : DBNull.Value,
                                !string.IsNullOrEmpty(GOOD_TYPE) ? GOOD_TYPE : DBNull.Value,
                                !string.IsNullOrEmpty(LOCATION) ? LOCATION : DBNull.Value,
                                !string.IsNullOrEmpty(STATUS) ? STATUS : DBNull.Value,
                                !string.IsNullOrEmpty(IMAGE_LINK) ? IMAGE_LINK : DBNull.Value,
                                !string.IsNullOrEmpty(VIDEO_LINK) ? VIDEO_LINK : DBNull.Value,
                                !string.IsNullOrEmpty(LENGTH) ? LENGTH : DBNull.Value,
                                !string.IsNullOrEmpty(WIDTH) ? WIDTH : DBNull.Value,
                                !string.IsNullOrEmpty(DEPTH) ? DEPTH : DBNull.Value,
                                !string.IsNullOrEmpty(TABLE_PER) ? TABLE_PER : DBNull.Value,
                                !string.IsNullOrEmpty(DEPTH_PER) ? DEPTH_PER : DBNull.Value,
                                !string.IsNullOrEmpty(CROWN_ANGLE) ? CROWN_ANGLE : DBNull.Value,
                                !string.IsNullOrEmpty(CROWN_HEIGHT) ? CROWN_HEIGHT : DBNull.Value,
                                !string.IsNullOrEmpty(PAVILION_ANGLE) ? PAVILION_ANGLE : DBNull.Value,
                                !string.IsNullOrEmpty(PAVILION_HEIGHT) ? PAVILION_HEIGHT : DBNull.Value,
                                !string.IsNullOrEmpty(GIRDLE_PER) ? GIRDLE_PER : DBNull.Value,
                                !string.IsNullOrEmpty(RAP_RATE) ? RAP_RATE : DBNull.Value,
                                !string.IsNullOrEmpty(RAP_AMOUNT) ? RAP_AMOUNT : DBNull.Value,
                                !string.IsNullOrEmpty(COST_DISC) ? COST_DISC : DBNull.Value,
                                !string.IsNullOrEmpty(COST_AMOUNT) ? COST_AMOUNT : DBNull.Value,
                                !string.IsNullOrEmpty(OFFER_DISC) ? OFFER_DISC : DBNull.Value,
                                !string.IsNullOrEmpty(OFFER_VALUE) ? OFFER_VALUE : DBNull.Value,
                                !string.IsNullOrEmpty(BASE_DISC) ? BASE_DISC : DBNull.Value,
                                !string.IsNullOrEmpty(BASE_AMOUNT) ? BASE_AMOUNT : DBNull.Value,
                                !string.IsNullOrEmpty(PRICE_PER_CTS) ? PRICE_PER_CTS : DBNull.Value,
                                !string.IsNullOrEmpty(MAX_SLAB_BASE_DISC) ? MAX_SLAB_BASE_DISC : DBNull.Value,
                                !string.IsNullOrEmpty(MAX_SLAB_BASE_AMOUNT) ? MAX_SLAB_BASE_AMOUNT : DBNull.Value,
                                !string.IsNullOrEmpty(MAX_SLAB_PRICE_PER_CTS) ? MAX_SLAB_PRICE_PER_CTS : DBNull.Value,
                                !string.IsNullOrEmpty(BUYER_DISC) ? BUYER_DISC : DBNull.Value,
                                !string.IsNullOrEmpty(BUYER_AMOUNT) ? BUYER_AMOUNT : DBNull.Value,
                                !string.IsNullOrEmpty(TABLE_BLACK) ? TABLE_BLACK : DBNull.Value,
                                !string.IsNullOrEmpty(TABLE_WHITE) ? TABLE_WHITE : DBNull.Value,
                                !string.IsNullOrEmpty(SIDE_BLACK) ? SIDE_BLACK : DBNull.Value,
                                !string.IsNullOrEmpty(SIDE_WHITE) ? SIDE_WHITE : DBNull.Value,
                                !string.IsNullOrEmpty(TABLE_OPEN) ? TABLE_OPEN : DBNull.Value,
                                !string.IsNullOrEmpty(CROWN_OPEN) ? CROWN_OPEN : DBNull.Value,
                                !string.IsNullOrEmpty(PAVILION_OPEN) ? PAVILION_OPEN : DBNull.Value,
                                !string.IsNullOrEmpty(GIRDLE_OPEN) ? GIRDLE_OPEN : DBNull.Value,
                                !string.IsNullOrEmpty(CULET) ? CULET : DBNull.Value,
                                !string.IsNullOrEmpty(KEY_TO_SYMBOL_TRUE) ? KEY_TO_SYMBOL_TRUE : DBNull.Value,
                                !string.IsNullOrEmpty(KEY_TO_SYMBOL_FALSE) ? KEY_TO_SYMBOL_FALSE : DBNull.Value,
                                !string.IsNullOrEmpty(LAB_COMMENTS_TRUE) ? LAB_COMMENTS_TRUE : DBNull.Value,
                                !string.IsNullOrEmpty(LAB_COMMENTS_FALSE) ? LAB_COMMENTS_FALSE : DBNull.Value,
                                !string.IsNullOrEmpty(FANCY_COLOR) ? FANCY_COLOR : DBNull.Value,
                                !string.IsNullOrEmpty(FANCY_INTENSITY) ? FANCY_INTENSITY : DBNull.Value,
                                !string.IsNullOrEmpty(FANCY_OVERTONE) ? FANCY_OVERTONE : DBNull.Value,
                                !string.IsNullOrEmpty(POINTER) ? POINTER : DBNull.Value,
                                !string.IsNullOrEmpty(SUB_POINTER) ? SUB_POINTER : DBNull.Value,
                                !string.IsNullOrEmpty(STAR_LN) ? STAR_LN : DBNull.Value,
                                !string.IsNullOrEmpty(LR_HALF) ? LR_HALF : DBNull.Value,
                                !string.IsNullOrEmpty(CERT_TYPE) ? CERT_TYPE : DBNull.Value,
                                !string.IsNullOrEmpty(COST_RATE) ? COST_RATE : DBNull.Value,
                                !string.IsNullOrEmpty(RATIO) ? RATIO : DBNull.Value,
                                !string.IsNullOrEmpty(DISCOUNT_TYPE) ? DISCOUNT_TYPE : DBNull.Value,
                                !string.IsNullOrEmpty(SIGN) ? SIGN : DBNull.Value,
                                !string.IsNullOrEmpty(DISC_VALUE) ? DISC_VALUE : DBNull.Value,
                                !string.IsNullOrEmpty(DISC_VALUE1) ? DISC_VALUE1 : DBNull.Value,
                                !string.IsNullOrEmpty(DISC_VALUE2) ? DISC_VALUE2 : DBNull.Value,
                                !string.IsNullOrEmpty(DISC_VALUE3) ? DISC_VALUE3 : DBNull.Value,
                                !string.IsNullOrEmpty(BASE_TYPE) ? BASE_TYPE : DBNull.Value,
                                !string.IsNullOrEmpty(SUPP_STOCK_ID) ? SUPP_STOCK_ID : DBNull.Value,
                                !string.IsNullOrEmpty(BID_SUPP_STOCK_ID) ? BID_SUPP_STOCK_ID : DBNull.Value,
                                !string.IsNullOrEmpty(BID_BUYER_DISC) ? BID_BUYER_DISC : DBNull.Value,
                                !string.IsNullOrEmpty(BID_BUYER_AMOUNT) ? BID_BUYER_AMOUNT : DBNull.Value,
                                !string.IsNullOrEmpty(LUSTER) ? LUSTER : DBNull.Value,
                                !string.IsNullOrEmpty(SHADE) ? SHADE : DBNull.Value,
                                !string.IsNullOrEmpty(MILKY) ? MILKY : DBNull.Value,
                                !string.IsNullOrEmpty(GIRDLE_FROM) ? GIRDLE_FROM : DBNull.Value,
                                !string.IsNullOrEmpty(GIRDLE_TO) ? GIRDLE_TO : DBNull.Value,
                                !string.IsNullOrEmpty(GIRDLE_CONDITION) ? GIRDLE_CONDITION : DBNull.Value,
                                !string.IsNullOrEmpty(ORIGIN) ? ORIGIN : DBNull.Value,
                                !string.IsNullOrEmpty(EXTRA_FACET_TABLE) ? EXTRA_FACET_TABLE : DBNull.Value,
                                !string.IsNullOrEmpty(EXTRA_FACET_CROWN) ? EXTRA_FACET_CROWN : DBNull.Value,
                                !string.IsNullOrEmpty(EXTRA_FACET_PAV) ? EXTRA_FACET_PAV : DBNull.Value,
                                !string.IsNullOrEmpty(INTERNAL_GRAINING) ? INTERNAL_GRAINING : DBNull.Value,
                                !string.IsNullOrEmpty(H_A) ? H_A : DBNull.Value,
                                !string.IsNullOrEmpty(SUPPLIER_COMMENTS) ? SUPPLIER_COMMENTS : DBNull.Value);
                        }
                    }
                    else
                    {
                        DataRow newRow = dataTable.NewRow();
                        for (int i = 0; i < dataTable.Columns.Count; i++)
                        {
                            newRow[i] = DBNull.Value;
                        }
                        dataTable.Rows.Add(newRow);
                    }

                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                    DataTable supp_stock_dt = await _supplierService.Get_Excel_Report_Search(dataTable, stock_Email_Model.User_Format, stock_Email_Model.Supplier_Ref_No, user_Id ?? 0);
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in supp_stock_dt.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }
                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = "Stock_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    if (stock_Email_Model.User_Format == "Customer")
                    {
                        EpExcelExport.Create_Customer_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (stock_Email_Model.User_Format == "Buyer")
                    {
                        EpExcelExport.Create_Buyer_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (stock_Email_Model.User_Format == "Supplier")
                    {
                        EpExcelExport.Create_Supplier_Excel(supp_stock_dt, columnNamesTable, filePath, filePath + filename);
                    }

                    excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                    using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                    {

                        //var employeeEmails = await _employeeService.GetEmployeeMail(user_Id ?? 0);
                        var emp_email = await _employeeService.Get_Employee_Email_Or_Default_Email(0);
                        if (emp_email != null)
                        {
                            if (!(stock_Email_Model.Send_From_Default ?? false) && (emp_email.Is_Default ?? false))
                                return Conflict(new
                                {
                                    statusCode = HttpStatusCode.Conflict,
                                    message = CoreCommonMessage.EmailSendFromDefaultSuccessMessage
                                });

                            IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                            _emailSender.Send_Stock_Email(toEmail: stock_Email_Model.To_Email, externalLink: "", subject: CoreCommonMessage.StoneSelectionSubject, formFile: formFile, strBody: stock_Email_Model.Remarks, user_Id: user_Id ?? 0, employee_Mail: emp_email);
                        }
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.EmailSendSuccessMessage
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Send_Stock_On_Email", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("send_cart_approval_order_email")]
        [Authorize]
        public async Task<IActionResult> Send_Cart_Approval_Order_Email(Cart_Approval_Order_Email_Model cart_Approval_Order_Email_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if (cart_Approval_Order_Email_Model.Report_Filter_Parameter != null)
                {
                    cart_Approval_Order_Email_Model.Report_Filter_Parameter.Add(new Report_Filter_Parameter()
                    {
                        Column_Name = "USER ID",
                        Category_Value = Convert.ToString(user_Id ?? 0),
                        Col_Id = 1163
                    });
                }
                var dt_stock = await _supplierService.Get_Report_Search_Excel(cart_Approval_Order_Email_Model.id, cart_Approval_Order_Email_Model.Report_Filter_Parameter);
                if (dt_stock != null && dt_stock.Rows.Count > 0)
                {
                    var result = await _supplierService.Get_Report_Users_Role(cart_Approval_Order_Email_Model.id, (int)user_Id, null, null);
                    List<string> columnNames = new List<string>();
                    if (result != null && result.Count > 0)
                    {
                        foreach (var item in result)
                        {
                            if (item.ContainsKey("Display_Name") && item.ContainsKey("Display_Type") && item["Display_Type"].ToString() == "D")
                            {
                                columnNames.Add(item["Display_Name"].ToString().Trim());
                            }
                        }
                    }
                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }

                    //List<string> columnNames = new List<string>();
                    //foreach (DataColumn column in dt_stock.Columns)
                    //{
                    //    columnNames.Add(column.ColumnName);
                    //}

                    //DataTable columnNamesTable = new DataTable();
                    //columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    //foreach (string columnName in columnNames)
                    //{
                    //    columnNamesTable.Rows.Add(columnName);
                    //}
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;
                    if (cart_Approval_Order_Email_Model.id == 2)
                    {
                        filename = "Cart_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Cart_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (cart_Approval_Order_Email_Model.id == 3)
                    {
                        filename = "Approval_Management_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Approval_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (cart_Approval_Order_Email_Model.id == 4)
                    {
                        filename = "Order_Processing_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Order_Processing_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                    }
                    excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                    using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                    {
                        //string user_Id = cart_Approval_Order_Email_Model.Report_Filter_Parameter.Where(x => x.Column_Name == "USER_ID").Select(x => x.Category_Value).FirstOrDefault();
                        //int? login_user_id = Convert.ToInt32(user_Id);
                        //var employeeEmails = await _employeeService.GetEmployeeMail(user_Id ?? 0);
                        var emp_email = await _employeeService.Get_Employee_Email_Or_Default_Email(user_Id ?? 0);
                        if (emp_email != null)
                        {
                            if (!(cart_Approval_Order_Email_Model.Send_From_Default ?? false) && (emp_email.Is_Default ?? false))
                                return Conflict(new
                                {
                                    statusCode = HttpStatusCode.Conflict,
                                    message = CoreCommonMessage.EmailSendFromDefaultSuccessMessage
                                });

                            IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                            _emailSender.Send_Stock_Email(toEmail: cart_Approval_Order_Email_Model.To_Email, externalLink: "", subject: CoreCommonMessage.StoneSelectionSubject, formFile: formFile, strBody: cart_Approval_Order_Email_Model.Remarks, user_Id: user_Id ?? 0, employee_Mail: emp_email);
                        }
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.EmailSendSuccessMessage
                        });
                    }
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Send_Cart_Approval_Order_Email", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }


        [HttpPost]
        [Route("send_stock_availability_email")]
        [Authorize]
        public async Task<IActionResult> Send_Stock_Availability_Email([FromForm] Stock_Avalibility_Send_Email stock_Avalibility, IFormFile? File_Location)
        {
            try
            {
                IList<Stock_Avalibility_Values> stock_Avalibility_Values = new List<Stock_Avalibility_Values>();
                var lst_Stock_Id = new List<string>();
                if (!string.IsNullOrEmpty(stock_Avalibility.stock_Id) && stock_Avalibility.stock_Id.Contains(";"))
                {
                    lst_Stock_Id = stock_Avalibility.stock_Id.Split('/').ToList();
                    if (lst_Stock_Id != null && lst_Stock_Id.Count > 0)
                    {
                        foreach (var item in lst_Stock_Id)
                        {
                            var model = new Stock_Avalibility_Values();
                            var lst_stock_val = item.Split(';').ToList();
                            if (lst_stock_val != null && lst_stock_val.Count > 0)
                            {
                                if (lst_stock_val.Count == 1)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (string.IsNullOrEmpty(lst_stock_val[i]))
                                            continue;

                                        model.Stock_Id = lst_stock_val[0];
                                    }
                                }
                                else if (lst_stock_val.Count == 2)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else
                                        {
                                            if (string.IsNullOrEmpty(lst_stock_val[i]))
                                                continue;

                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                                else if (lst_stock_val.Count == 3)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else
                                        {
                                            if (string.IsNullOrEmpty(lst_stock_val[i]))
                                                continue;

                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                                else if (lst_stock_val.Count == 4)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else if (i == 1 || i == 2)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Cost_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Cost_Amount = lst_stock_val[i];
                                            }
                                        }
                                        else if (i == 3)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                                else if (lst_stock_val.Count == 5)
                                {
                                    for (int i = 0; i < lst_stock_val.Count; i++)
                                    {
                                        if (i == 0)
                                        {
                                            model.Stock_Id = lst_stock_val[0];
                                        }
                                        else if (i == 1 || i == 2)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Cost_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Cost_Amount = lst_stock_val[i];
                                            }
                                        }
                                        else if (i == 3 || i == 4)
                                        {
                                            var con_val = Convert.ToDecimal(lst_stock_val[i]);
                                            if (con_val >= -100 && con_val <= 100)
                                            {
                                                model.Offer_Disc = lst_stock_val[i];
                                            }
                                            else
                                            {
                                                model.Offer_Amount = lst_stock_val[i];
                                            }
                                        }
                                    }
                                }
                            }
                            stock_Avalibility_Values.Add(model);
                        }
                        stock_Avalibility_Values = stock_Avalibility_Values.GroupBy(x => x.Stock_Id).Select(x => x.First()).ToList();
                    }
                }

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("COST_AMOUNT", typeof(string));
                dataTable.Columns.Add("COST_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMOUNT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                if (File_Location != null)
                {
                    var filePath = Path.GetTempFileName();
                    using (var stream = new FileStream(filePath, FileMode.Create))
                    {
                        await File_Location.CopyToAsync(stream);
                    }
                    using (var package = new ExcelPackage(new FileInfo(filePath)))
                    {
                        var worksheet = package.Workbook.Worksheets[0];
                        int startRow = 2;

                        HashSet<string> uniqueValues = new HashSet<string>();
                        for (int row = startRow; row <= worksheet.Dimension.End.Row; row++)
                        {
                            string value = worksheet.Cells[row, 1].GetValue<string>();
                            string cost_amt = worksheet.Cells[row, 3].GetValue<string>();
                            string offer_amt = worksheet.Cells[row, 5].GetValue<string>();
                            if (!uniqueValues.Contains(value))
                            {
                                uniqueValues.Add(value);
                                dataTable.Rows.Add(value, !string.IsNullOrEmpty(cost_amt) ? cost_amt.Replace(",", "") : DBNull.Value, worksheet.Cells[row, 2].GetValue<string>(), !string.IsNullOrEmpty(offer_amt) ? offer_amt.Replace(",", "") : DBNull.Value, worksheet.Cells[row, 4].GetValue<string>());
                            }
                        }
                        var uniqueRows = dataTable.AsEnumerable()
                                  .GroupBy(row => row.Field<string>("STOCK_ID"))
                                  .Select(grp => grp.First())
                                  .CopyToDataTable();
                    }
                }
                else if (stock_Avalibility_Values != null && stock_Avalibility_Values.Count > 0)
                {
                    stock_Avalibility.stock_Id = null;
                    foreach (var item in stock_Avalibility_Values)
                    {
                        dataTable.Rows.Add(!string.IsNullOrEmpty(item.Stock_Id) ? item.Stock_Id : DBNull.Value, !string.IsNullOrEmpty(item.Cost_Amount) ? item.Cost_Amount : DBNull.Value, !string.IsNullOrEmpty(item.Cost_Disc) ? item.Cost_Disc : DBNull.Value, !string.IsNullOrEmpty(item.Offer_Amount) ? item.Offer_Amount : DBNull.Value, !string.IsNullOrEmpty(item.Offer_Disc) ? item.Offer_Disc : DBNull.Value);
                    }
                }
                var dt_stock = await _supplierService.Get_Stock_Availability_Report_Excel(dataTable, stock_Avalibility.stock_Id, stock_Avalibility.stock_Type, stock_Avalibility.party_Id ?? 0, stock_Avalibility.excel_Format);
                if (dt_stock != null && dt_stock.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in dt_stock.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    if (!string.IsNullOrEmpty(stock_Avalibility.excel_Format) && stock_Avalibility.excel_Format == "Customer")
                    {
                        filename = "Customer_Stock_Availability_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Create_Customer_Stock_Availability_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (!string.IsNullOrEmpty(stock_Avalibility.excel_Format) && stock_Avalibility.excel_Format == "Default")
                    {
                        filename = "Default_Stock_Availability_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                        EpExcelExport.Stock_Availability_Excel(dt_stock, columnNamesTable, filePath, filePath + filename);
                    }

                    excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                    byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                    using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                    {
                        var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                        var user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                        int? login_user_id = Convert.ToInt32(user_Id);
                        //var employeeEmails = await _employeeService.GetEmployeeMail(user_Id ?? 0);
                        var emp_email = await _employeeService.Get_Employee_Email_Or_Default_Email(user_Id ?? 0);
                        if (emp_email != null)
                        {
                            if (!(stock_Avalibility.Send_From_Default ?? false) && (emp_email.Is_Default ?? false))
                                return Conflict(new
                                {
                                    statusCode = HttpStatusCode.Conflict,
                                    message = CoreCommonMessage.EmailSendFromDefaultSuccessMessage
                                });

                            IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                            _emailSender.Send_Stock_Email(toEmail: stock_Avalibility.To_Email, externalLink: "", subject: CoreCommonMessage.StoneSelectionSubject, formFile: formFile, strBody: stock_Avalibility.Remarks, user_Id: login_user_id ?? 0, employee_Mail: emp_email);
                        }
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.EmailSendSuccessMessage
                        });
                    }
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Send_Stock_Availability_Email", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Purchase Order
        [HttpPost]
        [Route("purchase_order")]
        [Authorize]
        public async Task<IActionResult> Purchase_Order(string supp_ref_No)
        {
            try
            {
                if (!string.IsNullOrEmpty(supp_ref_No))
                {
                    var lst_sup_ref_no = supp_ref_No.Split(",").ToList();
                    if (lst_sup_ref_no != null && lst_sup_ref_no.Count > 0)
                    {
                        foreach (var obj_ref_no in lst_sup_ref_no)
                        {
                            if (!string.IsNullOrEmpty(obj_ref_no))
                            {
                                var supplier = await _supplierService.Get_Purchase_Order_Supplier(obj_ref_no);
                                if (supplier != null && !string.IsNullOrEmpty(supplier.Name))
                                {
                                    if (supplier.Name.Equals("J.B. AND BROTHERS PVT. LTD - (S)"))
                                    {

                                    }
                                    else if (supplier.Name.Equals("SHAIRU GEMS DIAMONDS PVT. LTD - (S)"))
                                    {

                                    }
                                    else if (supplier.Name.Equals("RATNA"))
                                    {

                                    }
                                    else if (supplier.Name.Equals("VENUS JEWEL - (S)"))
                                    {

                                    }
                                }
                            }
                        }
                    }
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Order", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Lab User
        [HttpPost]
        [Route("create_update_lab_user")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Lab_User(Lab_User_Detail lab_User_Detail)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("User_Name", typeof(string));
                    dataTable.Columns.Add("Password", typeof(string));
                    dataTable.Columns.Add("Active_Status", typeof(bool));
                    dataTable.Columns.Add("User_Type", typeof(string));
                    dataTable.Columns.Add("Stock_View", typeof(bool));
                    dataTable.Columns.Add("Stock_Download", typeof(bool));
                    dataTable.Columns.Add("Order_Placed", typeof(bool));
                    dataTable.Columns.Add("Enable_Status", typeof(bool));
                    dataTable.Columns.Add("Last_Login_Date", typeof(string));
                    dataTable.Columns.Add("Query_Flag", typeof(string));
                    dataTable.Columns.Add("User_For", typeof(string));
                    dataTable.Columns.Add("Email", typeof(string));
                    dataTable.Columns.Add("Show_Amount", typeof(bool));
                    dataTable.Columns.Add("Order_History", typeof(bool));
                    dataTable.Columns.Add("Display_Own_Records", typeof(bool));
                    dataTable.Columns.Add("Sub_User", typeof(bool));

                    if (lab_User_Detail.Lab_User_Masters != null && lab_User_Detail.Lab_User_Masters.Count > 0)
                    {
                        foreach (var item in lab_User_Detail.Lab_User_Masters)
                        {
                            dataTable.Rows.Add(item.Id,
                                !string.IsNullOrEmpty(item.User_Name) ? item.User_Name : DBNull.Value,
                                !string.IsNullOrEmpty(item.Password) ? CoreService.Encrypt(item.Password) : DBNull.Value,
                                item.Active_Status,
                                !string.IsNullOrEmpty(item.User_Type) ? item.User_Type : DBNull.Value,
                                item.Stock_View,
                                item.Stock_Download,
                                item.Order_Placed,
                                item.Enable_Status,
                                DBNull.Value,
                                !string.IsNullOrEmpty(item.Query_Flag) ? item.Query_Flag : DBNull.Value,
                                !string.IsNullOrEmpty(item.User_For) ? item.User_For : DBNull.Value,
                                !string.IsNullOrEmpty(item.Email) ? item.Email : DBNull.Value,
                                item.Show_Amount,
                                item.Order_History,
                                item.Display_Own_Records,
                                item.Sub_User);
                        }
                        var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                        int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                        var result = await _labUserService.Create_Update_Lab_User(dataTable, lab_User_Detail.Party_Id, user_Id ?? 0);
                        if (result == 409)
                        {
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = "User name already exists."
                            });
                        }
                        if (result == 410)
                        {
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = "Primary user already exists."
                            });
                        }
                        else if (result > 0)
                        {
                            foreach (var item in lab_User_Detail.Lab_User_Masters)
                            {
                                var customer_Party_File = await _partyService.Get_Customer_Party_File(null, item.Id, "CPL");

                                if (customer_Party_File != null && customer_Party_File.User_Pricing_Id > 0)
                                {
                                    var userDetails = await _labUserService.Get_Lab_User(item.Id, 0, 0);

                                    if (userDetails != null && userDetails.Count > 0)
                                    {
                                        var userDetail = userDetails[0];

                                        customer_Party_File.User_Pricing_Id = item.Id;

                                        if (userDetail.ContainsKey("User_Name") && userDetail.ContainsKey("Password"))
                                        {
                                            var username = Convert.ToString(userDetail["User_Name"]);
                                            var password = Convert.ToString(userDetail["Password"]);

                                            var encryptedUsername = CoreService.Encrypt(username);
                                            var encryptedPassword = CoreService.Encrypt(password);

                                            customer_Party_File.API_URL = $"api/apisettings/url?UN={encryptedUsername}&PW={encryptedPassword}";
                                        }

                                        var party_file = await _partyService.Add_Update_Customer_Party_File(customer_Party_File, user_Id ?? 0, "CPL");
                                    }
                                }
                            }
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = "Lab user saved successfully."
                            });
                        }
                    }
                }
                return BadRequest(ModelState);
            }
            catch (SqlException ex)
            {
                string message = ex.Message;
                if (ex.Number == 515)
                {
                    if (message.Contains("User_Name") && message.Contains("Password"))
                    {
                        message = "User name and password is required.";
                    }
                    else if (message.Contains("User_Name"))
                    {
                        message = "User name is required.";
                    }
                    else if (message.Contains("Password"))
                    {
                        message = "Password is required.";
                    }
                    else if (message.Contains("User_Type"))
                    {
                        message = "User type is required.";
                    }
                }
                else if (ex.Number == 547)
                {
                    message = "Company name is required.";
                }
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Lab_User", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = message
                });
            }
        }

        [HttpGet]
        [Route("get_lab_user_company")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_User_Company()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _labUserService.Get_Lab_User_Company(user_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_User_Company", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_lab_user")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_User(int id, int party_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _labUserService.Get_Lab_User(id, party_Id, user_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        Party_Id = party_Id > 0 ? party_Id : 0,
                        party_Name = party_Id > 0 ? result.Where(x => x.ContainsKey("Party_Name")).Select(x => x["Party_Name"]).FirstOrDefault() : "",
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_User", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("change_lab_user_active_status")]
        [Authorize]
        public async Task<IActionResult> Change_Lab_User_Active_Status(int id, bool active_Status)
        {
            try
            {
                var result = await _labUserService.Change_Active_Status(id, active_Status);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StatusChangedSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Change_Lab_User_Active_Status", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_suspend_day")]
        [Authorize]
        public async Task<IActionResult> Get_Suspend_Day()
        {
            try
            {
                var result = await _labUserService.Get_Suspend_Day();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Suspend_Day", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_lab_user")]
        [Authorize]
        public async Task<IActionResult> Delete_Lab_User(int id, bool check_Primary_User)
        {
            try
            {
                var (result, message) = await _labUserService.Delete_Lab_User(id, check_Primary_User);
                if (result > 0 && message == "success")
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Lab user deleted successfully.",
                    });
                }
                else if (result == 409 && message == "exist")
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = "Sub user available are you sure you want to delete?",
                    });
                }
                else if (result == 409 && message == "subExist")
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = "Are you sure you want to delete?",
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Lab_User", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("update_suspend_days")]
        [Authorize]
        public async Task<IActionResult> Update_Suspend_Days(int id, int days)
        {
            try
            {
                var result = await _labUserService.Create_Update_Suspend_Days(id, days);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Suspend days updated successfully."
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Suspend_Days", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_customer_lab_user")]
        [Authorize]
        public async Task<IActionResult> Get_Customer_Lab_User(int party_Id)
        {
            try
            {
                var result = await _labUserService.Get_Customer_Lab_User(party_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Customer_Lab_User", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Customer API/FILE/FTP
        [HttpPost]
        [Route("create_update_customer_detail")]
        [Authorize]
        public virtual async Task<IActionResult> Create_Update_Customer_Detail(List<Customer_Detail> customer_Details_data)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                    bool success = false;
                    foreach (var customer_Details in customer_Details_data)
                    {
                        if (customer_Details.Customer_Party_Api != null && customer_Details.Customer_Party_Api.Customer_Column_Caption != null && customer_Details.Customer_Party_Api.Customer_Column_Caption.Count > 0)
                        {
                            customer_Details.Customer_Party_Api.User_Pricing_Id = customer_Details.User_Pricing_Id;
                            var party_ftp = await _partyService.Add_Update_Customer_Party_API(customer_Details.Customer_Party_Api, user_Id ?? 0, customer_Details.Map_Flag);
                            if (party_ftp > 0)
                            {
                                success = true;
                                if (customer_Details.Customer_Party_Api.Customer_Column_Caption != null && customer_Details.Customer_Party_Api.Customer_Column_Caption.Count > 0)
                                {

                                    DataTable dataTable = new DataTable();
                                    dataTable.Columns.Add("User_Pricing_Id", typeof(int));
                                    dataTable.Columns.Add("Col_Id", typeof(int));
                                    dataTable.Columns.Add("Caption_Name", typeof(string));
                                    dataTable.Columns.Add("Upload_Method", typeof(string));
                                    dataTable.Columns.Add("Status", typeof(bool));
                                    dataTable.Columns.Add("Map_Flag", typeof(string));

                                    foreach (var item in customer_Details.Customer_Party_Api.Customer_Column_Caption)
                                    {
                                        dataTable.Rows.Add(customer_Details.User_Pricing_Id, item.Col_Id, item.Caption_Name, "API", item.Status, customer_Details.Map_Flag);
                                    }
                                    var column_Caption = await _partyService.Add_Update_Customer_Column_Caption(dataTable, user_Id ?? 0);
                                    if (column_Caption > 0)
                                    {
                                        success = true;
                                    }
                                }

                            }
                        }
                        if (customer_Details.Customer_Party_FTP != null && customer_Details.Customer_Party_FTP.Customer_Column_Caption != null && customer_Details.Customer_Party_FTP.Customer_Column_Caption.Count > 0)
                        {
                            customer_Details.Customer_Party_FTP.User_Pricing_Id = customer_Details.User_Pricing_Id;
                            var party_ftp = await _partyService.Add_Update_Customer_Party_FTP(customer_Details.Customer_Party_FTP, user_Id ?? 0, customer_Details.Map_Flag);
                            if (party_ftp > 0)
                            {
                                success = true;
                                if (customer_Details.Customer_Party_FTP.Customer_Column_Caption != null && customer_Details.Customer_Party_FTP.Customer_Column_Caption.Count > 0)
                                {
                                    DataTable dataTable = new DataTable();
                                    dataTable.Columns.Add("User_Pricing_Id", typeof(int));
                                    dataTable.Columns.Add("Col_Id", typeof(int));
                                    dataTable.Columns.Add("Caption_Name", typeof(string));
                                    dataTable.Columns.Add("Upload_Method", typeof(string));
                                    dataTable.Columns.Add("Status", typeof(bool));
                                    dataTable.Columns.Add("Map_Flag", typeof(string));

                                    foreach (var item in customer_Details.Customer_Party_FTP.Customer_Column_Caption)
                                    {
                                        dataTable.Rows.Add(customer_Details.User_Pricing_Id, item.Col_Id, item.Caption_Name, "FTP", item.Status, customer_Details.Map_Flag);
                                    }
                                    var column_Caption = await _partyService.Add_Update_Customer_Column_Caption(dataTable, user_Id ?? 0);
                                    if (column_Caption > 0)
                                    {
                                        success = true;
                                    }
                                }

                            }
                        }
                        if (customer_Details.Customer_Party_File != null && customer_Details.Customer_Party_File.Customer_Column_Caption != null && customer_Details.Customer_Party_File.Customer_Column_Caption.Count > 0)
                        {
                            customer_Details.Customer_Party_File.User_Pricing_Id = customer_Details.User_Pricing_Id;

                            var userDetails = await _labUserService.Get_Lab_User(customer_Details.User_Pricing_Id ?? 0, 0, 0);

                            if (userDetails != null && userDetails.Count > 0)
                            {
                                var userDetail = userDetails[0];

                                if (userDetail.ContainsKey("User_Name") && userDetail.ContainsKey("Password"))
                                {
                                    var username = Convert.ToString(userDetail["User_Name"]);
                                    var password = Convert.ToString(userDetail["Password"]);

                                    var encryptedUsername = CoreService.Encrypt(username);
                                    var encryptedPassword = CoreService.Encrypt(password);

                                    customer_Details.Customer_Party_File.API_URL = $"api/apisettings/url?UN={encryptedUsername}&PW={encryptedPassword}";
                                }
                            }

                            var party_file = await _partyService.Add_Update_Customer_Party_File(customer_Details.Customer_Party_File, user_Id ?? 0, customer_Details.Map_Flag);
                            if (party_file > 0)
                            {
                                success = true;
                                if (customer_Details.Customer_Party_File.Customer_Column_Caption != null && customer_Details.Customer_Party_File.Customer_Column_Caption.Count > 0)
                                {
                                    DataTable dataTable = new DataTable();
                                    dataTable.Columns.Add("User_Pricing_Id", typeof(int));
                                    dataTable.Columns.Add("Col_Id", typeof(int));
                                    dataTable.Columns.Add("Caption_Name", typeof(string));
                                    dataTable.Columns.Add("Upload_Method", typeof(string));
                                    dataTable.Columns.Add("Status", typeof(bool));
                                    dataTable.Columns.Add("Map_Flag", typeof(string));

                                    foreach (var item in customer_Details.Customer_Party_File.Customer_Column_Caption)
                                    {
                                        dataTable.Rows.Add(customer_Details.User_Pricing_Id, item.Col_Id, item.Caption_Name, "URL", item.Status, customer_Details.Map_Flag);
                                    }
                                    var column_Caption = await _partyService.Add_Update_Customer_Column_Caption(dataTable, user_Id ?? 0);
                                    if (column_Caption > 0)
                                    {
                                        success = true;
                                    }

                                }
                            }
                        }
                    }
                    if (success)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.CustomerDetailSavedSuccessfully
                        });
                    }
                    else
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.CustomerDetailRequired
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Customer_Detail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }


        [HttpGet]
        [Route("get_customer_pricing_column_caption")]
        [Authorize]
        public async Task<IActionResult> Get_Customer_Pricing_Column_Caption()
        {
            try
            {
                var result = await _partyService.Get_Customer_Pricing_Column_Caption(null, null, null);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Customer_Pricing_Column_Caption", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpGet]
        [Route("get_customer_pricing_detail")]
        [Authorize]
        public async Task<IActionResult> Get_Customer_Pricing_Detail(int user_pricing_id, string map_flag)
        {
            try
            {
                Customer_Detail customer_Detail = new Customer_Detail();
                customer_Detail.Customer_Party_Api = await _partyService.Get_Customer_Party_API(null, user_pricing_id, map_flag);
                var Customer_Party_Api = await _partyService.Get_Customer_Pricing_Column_Caption(user_pricing_id, map_flag, "API");
                if (customer_Detail.Customer_Party_Api != null && Customer_Party_Api != null && Customer_Party_Api.Count > 0)
                {
                    customer_Detail.Customer_Party_Api.Customer_Column_Caption = Customer_Party_Api;
                }
                customer_Detail.Customer_Party_File = await _partyService.Get_Customer_Party_File(null, user_pricing_id, map_flag);
                var Customer_Party_File = await _partyService.Get_Customer_Pricing_Column_Caption(user_pricing_id, map_flag, "URL");
                if (customer_Detail.Customer_Party_File != null && Customer_Party_File != null && Customer_Party_File.Count > 0)
                {
                    customer_Detail.Customer_Party_File.Customer_Column_Caption = Customer_Party_File;
                }
                customer_Detail.Customer_Party_FTP = await _partyService.Get_Customer_Party_FTP(null, user_pricing_id, map_flag);
                var Customer_Party_FTP = await _partyService.Get_Customer_Pricing_Column_Caption(user_pricing_id, map_flag, "FTP");
                if (customer_Detail.Customer_Party_FTP != null && Customer_Party_FTP != null && Customer_Party_FTP.Count > 0)
                {
                    customer_Detail.Customer_Party_FTP.Customer_Column_Caption = Customer_Party_FTP;
                }
                if (customer_Detail != null && (customer_Detail.Customer_Party_FTP != null || customer_Detail.Customer_Party_Api != null || customer_Detail.Customer_Party_File != null))
                {
                    customer_Detail.User_Pricing_Id = user_pricing_id;
                    customer_Detail.Map_Flag = customer_Detail.Customer_Party_FTP != null ? customer_Detail.Customer_Party_FTP.Map_Flag :
                        (customer_Detail.Customer_Party_Api != null ? customer_Detail.Customer_Party_Api.Map_Flag : (customer_Detail.Customer_Party_File != null ? customer_Detail.Customer_Party_File.Map_Flag : map_flag));
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = customer_Detail
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Customer_Pricing_Detail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Order Processing New
        [HttpPost]
        [Route("get_order_summary")]
        [Authorize]
        public async Task<IActionResult> Get_Order_Summary(Order_Processing_Summary order_Processing_Summary)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _supplierService.Get_Order_Summary(user_Id ?? 0, order_Processing_Summary);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Order_Summary", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_lab_entry_summary")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Entry_Summary(Order_Processing_Summary order_Processing_Summary)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _supplierService.Get_Lab_Entry_Summary(user_Id ?? 0, order_Processing_Summary);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Entry_Summary", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_lab_entry_detail")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Entry_Detail(int trans_id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                Order_Processing_Summary order_Processing_Summary = new Order_Processing_Summary();
                order_Processing_Summary.Stock_Id = trans_id.ToString();

                var result = await _supplierService.Get_Lab_Entry_Summary(user_Id ?? 0, order_Processing_Summary);
                var result_det = await _supplierService.Get_Lab_Entry_Detail(trans_id);

                if (result != null && result.Count > 0)
                {
                    var json = JsonConvert.SerializeObject(result);
                    List<Lab_Entry_Master> lab_Entry_Master = JsonConvert.DeserializeObject<List<Lab_Entry_Master>>(json);

                    Lab_Entry_Master lab_Entry_Master1 = lab_Entry_Master[0];

                    var response = new
                    {
                        Trans_Id = lab_Entry_Master1.Trans_Id,
                        Order_No = lab_Entry_Master1.Order_No,
                        Order_Date = lab_Entry_Master1.Order_Date,
                        Order_Time = lab_Entry_Master1.Order_Time,
                        Type = lab_Entry_Master1.Type,
                        Company_Name = lab_Entry_Master1.Company_Name,
                        Party_Id = lab_Entry_Master1.Party_Id,
                        Entry_Type = lab_Entry_Master1.Entry_Type,
                        Assist_By = lab_Entry_Master1.Assist_By,
                        Assist_By_Name = lab_Entry_Master1.Assist_By_Name,
                        Remarks = lab_Entry_Master1.Remarks
                    };

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = new
                        {
                            Lab_Entry_Master = response,
                            Lab_Entry_Detail_List = result_det
                        }
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Entry_Detail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_stone_order_process")]
        [Authorize]
        public async Task<IActionResult> Create_Stone_Order_Process(Order_Stone_Process order_Stone_Process)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                    var (Request_Status, Order_Status, Sub_Order_Id) = await _cartService.Check_Order_Processing_Order_Status(order_Stone_Process.Order_No);
                    //if (Request_Status != "COMPLETED" && Order_Status != "CLOSED")
                    //{
                    //if (Request_Status == "REQUESTED" && Order_Status == "OPEN" && Sub_Order_Id <= 0)
                    //{

                    Sub_Order_Id = Sub_Order_Id + 1;

                    var result = await _supplierService.Create_Stone_Order_Process(order_Stone_Process, user_Id ?? 0);
                    if (result > 0)
                    {
                        if (order_Stone_Process.Order_Status == "CANCEL" && order_Stone_Process.Order_No.StartsWith("S"))
                        {
                            var orderProcessDetail = new Order_Process_Detail { Order_No = order_Stone_Process.Order_No };
                            var orderResult = await _supplierService.Get_Order_Detail(user_Id ?? 0, orderProcessDetail);

                            var json = JsonConvert.SerializeObject(orderResult);
                            IList<Order_Processing_Complete_Detail> orderDetails = JsonConvert.DeserializeObject<IList<Order_Processing_Complete_Detail>>(json);

                            List<string> stockIds = new List<string>();

                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Id", typeof(int));
                            dataTable.Columns.Add("Status", typeof(string));
                            dataTable.Columns.Add("Remarks", typeof(string));
                            dataTable.Columns.Add("Cost_Disc", typeof(double));
                            dataTable.Columns.Add("Cost_Amt", typeof(double));

                            var orderIds = order_Stone_Process.Order_Id.Split(',').Select(id => id.Trim()).ToList();

                            var canceledOrders = orderDetails
                                .Where(item => item.Status == "CANCEL" && orderIds.Contains(item.Id.ToString()))
                                .ToList();

                            foreach (var item in canceledOrders)
                            {
                                dataTable.Rows.Add(item.Id, item.Status, item.Remarks,
                                    item.CurrentCostDisc,
                                    item.CurrentCostAmount);

                                stockIds.Add(item.StockId);
                            }

                            if (canceledOrders.Any())
                            {

                                var order_Processing = await _cartService.Get_Order_Summary(order_Stone_Process.Order_No);

                                if (order_Processing != null && order_Processing.Count > 0)
                                {
                                    string to_Email = "list@sunrisediam.com";

                                    string subject = order_Stone_Process.Order_Status + " - " + order_Processing[0]["Customer_Name"] + " - " + order_Stone_Process.Order_No;

                                    StringBuilder sb = new StringBuilder();

                                    sb.AppendLine(@"Company Name :  " + order_Processing[0]["Customer_Name"] + "<br/>");

                                    var userId = Convert.ToInt32(order_Processing[0]["Assist_By"]) > 0 ? Convert.ToInt32(order_Processing[0]["Assist_By"]) : (user_Id ?? 0);

                                    var user = await _employeeService.Employee_Master_Name_Select(userId);

                                    sb.AppendLine(@"Assist By: " + user[0].Name + "<br/>");

                                    sb.AppendLine(@"Request for : " + order_Stone_Process.Order_Status + "<br/>");

                                    _emailSender.SendEmail(toEmail: to_Email, externalLink: "", subject: subject, formFile: null, strBody: sb.ToString());
                                }

                                var fortuneId = await _employeeService.GetEmployeeFortuneIdByOrderNo(order_Stone_Process.Order_No);
                                if (fortuneId != null)
                                {
                                    var transferResult = await _oracleService.Order_Data_Transfer_Oracle(canceledOrders, fortuneId, order_Stone_Process.QC_Request, "W", "O");
                                }

                                List<string> DeviceIds = await _cartService.Get_Order_Process_FCM_Token();

                                if (DeviceIds.Count > 0)
                                {
                                    string title = $"Request from Solar";

                                    string customerName = order_Processing[0]["Customer_Name"]?.ToString();

                                    if (string.IsNullOrWhiteSpace(customerName))
                                    {
                                        customerName = "Sunrise Diamonds Ltd";
                                    }

                                    string body = $"{order_Stone_Process.Order_Status} request for order no #{order_Stone_Process.Order_No + "." + Sub_Order_Id} from {customerName}";

                                    await Firebase_Messaging_Notification(DeviceIds: DeviceIds, title: title, body: body);
                                }
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = "Order completed successfully."
                                });
                            }
                        }
                        else
                        {
                            var order_Processing = await _cartService.Get_Order_Summary(order_Stone_Process.Order_No);

                            if (order_Processing != null && order_Processing.Count > 0)
                            {
                                string to_Email = "list@sunrisediam.com";

                                string subject = order_Stone_Process.Order_Status + " request for order no " + order_Stone_Process.Order_No + " - " + order_Processing[0]["Customer_Name"];

                                StringBuilder sb = new StringBuilder();

                                sb.AppendLine(@"Company Name :  " + order_Processing[0]["Customer_Name"] + "<br/>");

                                var userId = Convert.ToInt32(order_Processing[0]["Assist_By"]) > 0 ? Convert.ToInt32(order_Processing[0]["Assist_By"]) : (user_Id ?? 0);

                                var user = await _employeeService.Employee_Master_Name_Select(userId);

                                sb.AppendLine(@"Assist By: " + user[0].Name + "<br/>");

                                sb.AppendLine(@"Request for : " + order_Stone_Process.Order_Status + "<br/>");

                                _emailSender.SendEmail(toEmail: to_Email, externalLink: "", subject: subject, formFile: null, strBody: sb.ToString());

                                List<string> DeviceIds = await _cartService.Get_Order_Process_FCM_Token();

                                if (DeviceIds.Count > 0)
                                {
                                    string title = $"Request from Solar";

                                    string customerName = order_Processing[0]["Customer_Name"]?.ToString();

                                    if (string.IsNullOrWhiteSpace(customerName))
                                    {
                                        customerName = "Sunrise Diamonds Ltd";
                                    }

                                    string body = $"{order_Stone_Process.Order_Status} request for order no #{order_Stone_Process.Order_No + "." + Sub_Order_Id} from {customerName}";

                                    await Firebase_Messaging_Notification(DeviceIds: DeviceIds, title: title, body: body);
                                }
                            }
                        }
                        /*var employees = await _employeeService.GetEmployees(user_Id ?? 0, null, null);
                            var employee = employees.FirstOrDefault();
                            var (dt_Order, is_Admin) = await _supplierService.Get_Order_Excel_Data(null, user_Id ?? 0, order_Stone_Process.Order_Id);
                            if (dt_Order != null && dt_Order.Rows.Count > 0)
                            {
                                List<string> columnNames = new List<string>();
                                foreach (DataColumn column in dt_Order.Columns)
                                {
                                    columnNames.Add(column.ColumnName);
                                }

                                DataTable columnNamesTable = new DataTable();
                                columnNamesTable.Columns.Add("Column_Name", typeof(string));

                                foreach (string columnName in columnNames)
                                {
                                    columnNamesTable.Rows.Add(columnName);
                                }
                                var excelPath = string.Empty;
                                var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                                if (!(Directory.Exists(filePath)))
                                {
                                    Directory.CreateDirectory(filePath);
                                }
                                string filename = string.Empty;

                                filename = "Order_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                                EpExcelExport.Create_Order_Processing_Excel_User(dt_Order, columnNamesTable, filePath, filePath + filename);

                                excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;
                                byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                                using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                                {
                                    var emp_email = await _employeeService.Get_Employee_Email_Or_Default_Email(0);
                                    if (emp_email != null)
                                    {
                                        IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                                        _emailSender.Send_Stock_Email(toEmail: employee.Company_Email, externalLink: "", subject: CoreCommonMessage.StoneSelectionSubject, formFile: formFile, user_Id: user_Id ?? 0, employee_Mail: emp_email);
                                    }
                                }
                            }
                            */
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = "Stone has been processed successfully."
                        });
                    }
                    //}
                    //else
                    {
                        return Conflict(new { message = "Previous order incomplete, so can't place new order." });
                    }
                    //}
                    //else
                    //{
                    //    return Conflict(new { message = "Order is already COMPLETED or CLOSED. Order Status update not allowed." });
                    //}
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Stone_Order_Process", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_order_detail")]
        [Authorize]
        public async Task<IActionResult> Get_Order_Detail(Order_Process_Detail order_Process_Detail)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _supplierService.Get_Order_Detail(user_Id ?? 0, order_Process_Detail);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Order_Detail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_order_request_status")]
        [Authorize]
        public async Task<IActionResult> Get_Order_Request_Status(Order_Process_Detail order_Process_Detail)
        {
            try
            {
                var result = await _supplierService.Get_Order_Request_Status(order_Process_Detail);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Order_Request_Status", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("order_processing_delete")]
        [Authorize]
        public async Task<IActionResult> Order_Processing_Delete(string Order_No, int Sub_Order_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _supplierService.Delete_Order_Process(Order_No, Sub_Order_Id, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Order deleted successfully.",
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.OrderAccept
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Processing_Delete", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("entire_order_processing_delete")]
        [Authorize]
        public async Task<IActionResult> Entire_Order_Processing_Delete(string Order_No)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var (msg, result) = await _supplierService.Delete_Entire_Order_Process(Order_No, user_Id ?? 0);
                if (msg == "success" && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Order deleted successfully."
                    });
                }
                else if (msg == "exist" && result == 409)
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = "Sub Order already exists."
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.OrderAccept
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Processing_Entire_Delete", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("order_process_request_accept")]
        [Authorize]
        public async Task<IActionResult> Order_Process_Request_Accept(Order_Process_Detail order_Process_Detail)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                    var result = await _supplierService.Accept_Request_Order_Process(order_Process_Detail, user_Id ?? 0);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = "Order request accepted successfully."
                        });
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Process_Request_Accept", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("order_stones_delete")]
        [Authorize]
        public async Task<IActionResult> Order_Stones_Delete(string order_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _supplierService.Delete_Order_Stones(order_Id, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Order stones deleted successfully.",
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.OrderAccept
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Stones_Delete", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_processing_reply_to_assist")]
        [Authorize]
        public async Task<IActionResult> Order_Processing_Reply_To_Assist(Order_Processing_Reply_To_Assist order_Processing_Reply_To_Assist)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Order_Processing_Reply_To_Assist_Detail> OrderResult = JsonConvert.DeserializeObject<IList<Order_Processing_Reply_To_Assist_Detail>>(order_Processing_Reply_To_Assist.Order_Detail.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Status", typeof(string));
                dataTable.Columns.Add("Remarks", typeof(string));
                dataTable.Columns.Add("Cost_Disc", typeof(double));
                dataTable.Columns.Add("Cost_Amt", typeof(double));

                foreach (var item in OrderResult)
                {
                    dataTable.Rows.Add(item.Id, Convert.ToString(item.Status), Convert.ToString(item.Remarks),
                        (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null),
                        (item.Cost_Amt != null ? !string.IsNullOrEmpty(item.Cost_Amt.ToString()) ? Convert.ToDouble(item.Cost_Amt.ToString()) : null : null));
                }

                var result = await _supplierService.Order_Processing_Reply_To_Assist(dataTable, order_Processing_Reply_To_Assist.Order_No, order_Processing_Reply_To_Assist.Sub_Order_Id ?? 0, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Order completed successfully."
                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Processing_Reply_To_Assist", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_processing_completed")]
        [Authorize]
        public async Task<IActionResult> Order_Processing_Completed(Order_Processing_Reply_To_Assist order_Processing_Reply_To_Assist)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Order_Processing_Complete_Detail> OrderResult = JsonConvert.DeserializeObject<IList<Order_Processing_Complete_Detail>>(order_Processing_Reply_To_Assist.Order_Detail.ToString());
                bool tofortune = false;
                List<string> Stock_Id = new List<string>();
                List<string> Stock_Ids = new List<string>();

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Cert_No", typeof(string));
                dataTable.Columns.Add("Certi_Flag", typeof(bool));
                dataTable.Columns.Add("Status", typeof(string));
                dataTable.Columns.Add("Remarks", typeof(string));
                dataTable.Columns.Add("Cost_Disc", typeof(double));
                dataTable.Columns.Add("Cost_Amt", typeof(double));

                foreach (var item in OrderResult)
                {
                    dataTable.Rows.Add(item.Id, Convert.ToString(item.CertificateNo), Convert.ToBoolean(item.Certi_Flag), Convert.ToString(item.Status), Convert.ToString(item.Remarks),
                        (item.CurrentCostDisc != null ? !string.IsNullOrEmpty(item.CurrentCostDisc.ToString()) ? Convert.ToDouble(item.CurrentCostDisc.ToString()) : null : null),
                        (item.CurrentCostAmount != null ? !string.IsNullOrEmpty(item.CurrentCostAmount.ToString()) ? Convert.ToDouble(item.CurrentCostAmount.ToString()) : null : null));
                    if (item.Status == "CONFIRM")
                    {
                        Stock_Id.Add(item.StockId);
                    }
                    Stock_Ids.Add(item.StockId);
                }

                var result = await _supplierService.Order_Processing_Completed(dataTable, order_Processing_Reply_To_Assist.Order_No, order_Processing_Reply_To_Assist.Sub_Order_Id ?? 0, user_Id ?? 0, OrderResult[0].Customer);
                if (result > 0)
                {
                    var result_e = await _employeeService.GetEmployeeFortuneIdByOrderNo(order_Processing_Reply_To_Assist.Order_No);

                    if (result_e != null && result_e.Employee_Id > 0)
                    {
                        List<string> DeviceIds = await _cartService.Get_Employee_Secretary_FCM_Token(result_e.Employee_Id);

                        if (DeviceIds.Count > 0)
                        {
                            string title = $"Request Completed";

                            string customerName = OrderResult[0].Customer?.ToString();

                            if (string.IsNullOrWhiteSpace(customerName))
                            {
                                customerName = "Sunrise Diamonds Ltd";
                            }
                            string body = $"{order_Processing_Reply_To_Assist.Request_For} request for order no #{order_Processing_Reply_To_Assist.Order_No + "." + order_Processing_Reply_To_Assist.Sub_Order_Id} is completed for {customerName}";

                            await Firebase_Messaging_Notification(DeviceIds: DeviceIds, title: title, body: body);
                        }
                    }

                    tofortune = OrderResult.Any(order => order_Processing_Reply_To_Assist.Request_For.ToUpper().Contains("PLACE ORDER"));

                    string to_Email = "list@sunrisediam.com";
                    if (result_e != null)
                    {
                        to_Email = string.IsNullOrEmpty(result_e.Company_Email)
                                    ? "list@sunrisediam.com"
                                    : $"{result_e.Company_Email},list@sunrisediam.com";
                    }
                    if (tofortune)
                    {
                        if ((string.IsNullOrEmpty(OrderResult[0].Customer) || OrderResult[0].Customer == "") && !order_Processing_Reply_To_Assist.Order_No.StartsWith("S"))
                        {
                            if (Stock_Ids.Count > 0)
                            {
                                string concatenatedStockId = string.Join(",", Stock_Ids);

                                var dt_Order = await _supplierService.Get_Order_Data_Mazal_Excel(concatenatedStockId, order_Processing_Reply_To_Assist.Order_No);

                                if (dt_Order != null && dt_Order.Rows.Count > 0)
                                {
                                    var excelPath = string.Empty;

                                    string filename = $"{"Order_Status_"}{DateTime.UtcNow.ToString("ddMMyyyy-HHmmss")}{order_Processing_Reply_To_Assist.Order_No}.xlsx";

                                    string subject = order_Processing_Reply_To_Assist.Request_For + " request for order no " + order_Processing_Reply_To_Assist.Order_No + " completed";

                                    StringBuilder body = new StringBuilder();

                                    body.AppendLine(@"Request for : " + order_Processing_Reply_To_Assist.Request_For + "<br/>");

                                    List<string> columnNames = new List<string>();
                                    foreach (DataColumn column in dt_Order.Columns)
                                    {
                                        columnNames.Add(column.ColumnName);
                                    }

                                    DataTable columnNamesTable = new DataTable();
                                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                                    foreach (string columnName in columnNames)
                                    {
                                        columnNamesTable.Rows.Add(columnName);
                                    }
                                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                                    if (!(Directory.Exists(filePath)))
                                    {
                                        Directory.CreateDirectory(filePath);
                                    }

                                    EpExcelExport.Create_Order_Processing_Excel_Mazal(dt_Order, columnNamesTable, filePath, filePath + filename);

                                    excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                                    byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                                    using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                                    {
                                        Employee_Mail employee_Mail = new Employee_Mail
                                        {
                                            Email_id = _configuration["EmailSetting:FromEmail"],
                                            Email_Password = _configuration["EmailSetting:FromPassword"],
                                            SMTP_Server_Address = _configuration["EmailSetting:SmtpHost"],
                                            SMTP_Port = Convert.ToInt32(_configuration["EmailSetting:SmtpPort"])
                                        };

                                        IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                                        _emailSender.Send_Stock_Email(toEmail: to_Email, externalLink: "", subject: subject, formFile: formFile, strBody: body.ToString(), user_Id: 0, employee_Mail: employee_Mail);
                                    }
                                }
                            }

                            DataTable masterDataTable = new DataTable();
                            masterDataTable.Columns.Add("Trans_Id", typeof(int));
                            masterDataTable.Columns.Add("Order_No", typeof(string));
                            masterDataTable.Columns.Add("Entry_Type", typeof(string));
                            masterDataTable.Columns.Add("Company_Name", typeof(string));
                            masterDataTable.Columns.Add("Remarks", typeof(string));
                            masterDataTable.Columns.Add("Order_Type", typeof(string));
                            masterDataTable.Columns.Add("Assist_By", typeof(int));
                            masterDataTable.Columns.Add("Entry_User", typeof(int));

                            masterDataTable.Rows.Add(
                                0,
                                (order_Processing_Reply_To_Assist.Order_No + "." + order_Processing_Reply_To_Assist.Sub_Order_Id.ToString()) ?? null,
                                "A",
                                result_e != null ? result_e.Company_Name ?? null : null,
                                order_Processing_Reply_To_Assist.Summary_QC_Remarks != null ? order_Processing_Reply_To_Assist.Summary_QC_Remarks : null,
                                "S",
                                result_e != null ? result_e.Fortune_Id : null,
                                user_Id ?? null
                            );

                            DataTable detailDataTable = new DataTable();
                            detailDataTable.Columns.Add("Id", typeof(int));
                            detailDataTable.Columns.Add("Trans_Id", typeof(int));
                            detailDataTable.Columns.Add("Stock_Id", typeof(string));
                            detailDataTable.Columns.Add("Cert_No", typeof(string));
                            detailDataTable.Columns.Add("Supplier_Id", typeof(int));
                            detailDataTable.Columns.Add("Supplier_Name", typeof(string));
                            detailDataTable.Columns.Add("Supplier_Short_Name", typeof(string));
                            detailDataTable.Columns.Add("Supplier_Ref_No", typeof(string));
                            detailDataTable.Columns.Add("Status", typeof(string));
                            detailDataTable.Columns.Add("Remarks", typeof(string));
                            detailDataTable.Columns.Add("Buyer", typeof(int));
                            detailDataTable.Columns.Add("Lab", typeof(int));
                            detailDataTable.Columns.Add("Shape", typeof(int));
                            detailDataTable.Columns.Add("BGM", typeof(int));
                            detailDataTable.Columns.Add("Color", typeof(int));
                            detailDataTable.Columns.Add("Clarity", typeof(int));
                            detailDataTable.Columns.Add("Cts", typeof(double));
                            detailDataTable.Columns.Add("Rap_Rate", typeof(double));
                            detailDataTable.Columns.Add("Rap_Amt", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Base_Disc", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Base_Amt", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Cost_Disc", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Cost_Amt", typeof(double));
                            detailDataTable.Columns.Add("Offer_Disc", typeof(double));
                            detailDataTable.Columns.Add("Offer_Amt", typeof(double));
                            detailDataTable.Columns.Add("Cut", typeof(int));
                            detailDataTable.Columns.Add("Polish", typeof(int));
                            detailDataTable.Columns.Add("Symm", typeof(int));
                            detailDataTable.Columns.Add("Flour_Intensity", typeof(int));
                            detailDataTable.Columns.Add("Length", typeof(double));
                            detailDataTable.Columns.Add("Width", typeof(double));
                            detailDataTable.Columns.Add("Depth", typeof(double));
                            detailDataTable.Columns.Add("Depth_Per", typeof(double));
                            detailDataTable.Columns.Add("Table_Per", typeof(double));
                            detailDataTable.Columns.Add("Key_to_Symbol", typeof(string));
                            detailDataTable.Columns.Add("Additional_Comment", typeof(string));
                            detailDataTable.Columns.Add("Girdle_Per", typeof(double));
                            detailDataTable.Columns.Add("Crown_Angle", typeof(double));
                            detailDataTable.Columns.Add("Crown_Height", typeof(double));
                            detailDataTable.Columns.Add("Pavillion_Angle", typeof(double));
                            detailDataTable.Columns.Add("Pavillion_Height", typeof(double));
                            detailDataTable.Columns.Add("Table_Black", typeof(int));
                            detailDataTable.Columns.Add("Crown_Black", typeof(int));
                            detailDataTable.Columns.Add("Table_White", typeof(int));
                            detailDataTable.Columns.Add("Crown_White", typeof(int));
                            detailDataTable.Columns.Add("Culet", typeof(int));
                            detailDataTable.Columns.Add("Table_Open", typeof(int));
                            detailDataTable.Columns.Add("Crown_Open", typeof(int));
                            detailDataTable.Columns.Add("Pav_Open", typeof(int));
                            detailDataTable.Columns.Add("Girdle_Open", typeof(int));
                            detailDataTable.Columns.Add("Cert_Date", typeof(DateTime));
                            detailDataTable.Columns.Add("Cert_Type", typeof(int));
                            detailDataTable.Columns.Add("LR_Half", typeof(double));
                            detailDataTable.Columns.Add("Str_Ln", typeof(double));
                            detailDataTable.Columns.Add("Fancy_Color", typeof(int));
                            detailDataTable.Columns.Add("Fancy_Intensity", typeof(int));
                            detailDataTable.Columns.Add("Fancy_Overtone", typeof(int));
                            detailDataTable.Columns.Add("Rough_Origin", typeof(int));
                            detailDataTable.Columns.Add("Image", typeof(string));
                            detailDataTable.Columns.Add("Video", typeof(string));
                            detailDataTable.Columns.Add("Cert_Link", typeof(string));
                            detailDataTable.Columns.Add("DNA", typeof(string));
                            detailDataTable.Columns.Add("Cert_Type_Link", typeof(string));
                            detailDataTable.Columns.Add("Lab_C", typeof(string));
                            detailDataTable.Columns.Add("Shape_C", typeof(string));
                            detailDataTable.Columns.Add("BGM_C", typeof(string));
                            detailDataTable.Columns.Add("Color_C", typeof(string));
                            detailDataTable.Columns.Add("Clarity_C", typeof(string));
                            detailDataTable.Columns.Add("Cut_C", typeof(string));
                            detailDataTable.Columns.Add("Polish_C", typeof(string));
                            detailDataTable.Columns.Add("Symm_C", typeof(string));
                            detailDataTable.Columns.Add("Flour_Intensity_C", typeof(string));
                            detailDataTable.Columns.Add("Table_Black_C", typeof(string));
                            detailDataTable.Columns.Add("Crown_Black_C", typeof(string));
                            detailDataTable.Columns.Add("Table_White_C", typeof(string));
                            detailDataTable.Columns.Add("Crown_White_C", typeof(string));
                            detailDataTable.Columns.Add("Culet_C", typeof(string));
                            detailDataTable.Columns.Add("Table_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Crown_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Pav_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Girdle_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Cert_Type_C", typeof(string));
                            detailDataTable.Columns.Add("Fancy_Color_C", typeof(string));
                            detailDataTable.Columns.Add("Fancy_Intensity_C", typeof(string));
                            detailDataTable.Columns.Add("Fancy_Overtone_C", typeof(string));
                            detailDataTable.Columns.Add("Rough_Origin_C", typeof(string));
                            detailDataTable.Columns.Add("Laser_Insc", typeof(int));
                            detailDataTable.Columns.Add("Girdle_Condition", typeof(int));
                            detailDataTable.Columns.Add("Laser_Insc_C", typeof(string));
                            detailDataTable.Columns.Add("Girdle_Condition_C", typeof(string));
                            detailDataTable.Columns.Add("Company", typeof(string));
                            detailDataTable.Columns.Add("Milky", typeof(int));
                            detailDataTable.Columns.Add("Milky_C", typeof(string));
                            detailDataTable.Columns.Add("Shade", typeof(int));
                            detailDataTable.Columns.Add("Shade_C", typeof(string));

                            foreach (var item in OrderResult)
                            {
                                DateTime Valid_Date;

                                string dateFormat = "dd-MM-yyyy";

                                if (!DateTime.TryParseExact(item.Cert_Date, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Valid_Date))
                                {
                                    Valid_Date = DateTime.MinValue;
                                }

                                detailDataTable.Rows.Add(
                                    0,
                                    0,
                                    item.StockId,
                                    item.CertificateNo,
                                    item.Supplier_Id != null ? Convert.ToInt32(item.Supplier_Id) : null,
                                    item.Supplier_Name ?? null,
                                    item.Supplier_Short_Name ?? null,
                                    item.SupplierNo ?? null,
                                    item.Status ?? null,
                                    item.Remarks ?? null,
                                    item.Buyer_Code != null ? Convert.ToInt32(item.Buyer_Code) : null,
                                    item.LAB_Id != null ? Convert.ToInt32(item.LAB_Id) : null,
                                    item.Shape_Id != null ? Convert.ToInt32(item.Shape_Id) : null,
                                    item.BGM_Id != null ? Convert.ToInt32(item.BGM_Id) : null,
                                    item.Color_Id != null ? Convert.ToInt32(item.Color_Id) : null,
                                    item.Clarity_Id != null ? Convert.ToInt32(item.Clarity_Id) : null,
                                    SafeConvertToDouble(item.Cts?.ToString()),
                                    SafeConvertToDouble(item.RapRate?.ToString()),
                                    SafeConvertToDouble(item.RapAmount?.ToString()),
                                    SafeConvertToDouble(item.BaseDisc?.ToString()),
                                    SafeConvertToDouble(item.BaseAmount?.ToString()),
                                    SafeConvertToDouble(item.CurrentCostDisc?.ToString()),
                                    SafeConvertToDouble(item.CurrentCostAmount?.ToString()),
                                    SafeConvertToDouble(item.OfferDisc?.ToString()),
                                    SafeConvertToDouble(item.OfferAmount?.ToString()),
                                    item.Cut_Id != null ? Convert.ToInt32(item.Cut_Id) : null,
                                    item.Polish_Id != null ? Convert.ToInt32(item.Polish_Id) : null,
                                    item.Symm_Id != null ? Convert.ToInt32(item.Symm_Id) : null,
                                    item.FLS_INTENSITY_Id != null ? Convert.ToInt32(item.FLS_INTENSITY_Id) : null,
                                    SafeConvertToDouble(item.Length?.ToString()),
                                    SafeConvertToDouble(item.Width?.ToString()),
                                    SafeConvertToDouble(item.Depth?.ToString()),
                                    SafeConvertToDouble(item.DepthPer?.ToString()),
                                    SafeConvertToDouble(item.TablePer?.ToString()),
                                    item.KeyToSymbol ?? null,
                                    item.GiaComments ?? null,
                                    SafeConvertToDouble(item.GirdlePer?.ToString()),
                                    SafeConvertToDouble(item.CrownAngle?.ToString()),
                                    SafeConvertToDouble(item.CrownHeight?.ToString()),
                                    SafeConvertToDouble(item.PavilionAngle?.ToString()),
                                    SafeConvertToDouble(item.PavilionHeight?.ToString()),
                                    item.Table_Black_Id != null ? Convert.ToInt32(item.Table_Black_Id) : null,
                                    item.Crown_Black_Id != null ? Convert.ToInt32(item.Crown_Black_Id) : null,
                                    item.Table_White_Id != null ? Convert.ToInt32(item.Table_White_Id) : null,
                                    item.Crown_White_Id != null ? Convert.ToInt32(item.Crown_White_Id) : null,
                                    item.Culet_Id != null ? Convert.ToInt32(item.Culet_Id) : null,
                                    item.Table_Open_Id != null ? Convert.ToInt32(item.Table_Open_Id) : null,
                                    item.Crown_Open_Id != null ? Convert.ToInt32(item.Crown_Open_Id) : null,
                                    item.Pav_Open_Id != null ? Convert.ToInt32(item.Pav_Open_Id) : null,
                                    item.Girdle_Open_Id != null ? Convert.ToInt32(item.Girdle_Open_Id) : null,
                                    Valid_Date != null ? Convert.ToDateTime(Valid_Date) : null,
                                    item.Cert_Type_Id != null ? Convert.ToInt32(item.Cert_Type_Id) : null,
                                    SafeConvertToDouble(item.LR_Half?.ToString()),
                                    SafeConvertToDouble(item.Str_Ln?.ToString()),
                                    item.Fancy_Color_Id != null ? Convert.ToInt32(item.Fancy_Color_Id) : null,
                                    item.Fancy_Intensity_Id != null ? Convert.ToInt32(item.Fancy_Intensity_Id) : null,
                                    item.Fancy_Overtone_Id != null ? Convert.ToInt32(item.Fancy_Overtone_Id) : null,
                                    item.Rough_Origin_Id != null ? Convert.ToInt32(item.Rough_Origin_Id) : null,
                                    item.ImageLink ?? null,
                                    item.VideoLink ?? null,
                                    item.CertificateLink ?? null,
                                    item.Dna ?? null,
                                    item.Cert_Type_Link ?? null,
                                    item.Lab ?? null,
                                    item.Shape ?? null,
                                    item.Bgm ?? null,
                                    item.Color ?? null,
                                    item.Clarity ?? null,
                                    item.Cut ?? null,
                                    item.Polish ?? null,
                                    item.Symm ?? null,
                                    item.FlsIntensity ?? null,
                                    item.TableBlack ?? null,
                                    item.SideBlack ?? null,
                                    item.TableWhite ?? null,
                                    item.SideWhite ?? null,
                                    item.Culet ?? null,
                                    item.TableOpen ?? null,
                                    item.CrownOpen ?? null,
                                    item.PavilionOpen ?? null,
                                    item.GirdleOpen ?? null,
                                    item.GiaType ?? null,
                                    item.Fancy_Color ?? null,
                                    item.Fancy_Intensity ?? null,
                                    item.Fancy_Overtone ?? null,
                                    item.Rough_Origin ?? null,
                                    item.Laser_Insc_Id != null ? Convert.ToInt32(item.Laser_Insc_Id) : null,
                                    item.Girdle_Condition_Id != null ? Convert.ToInt32(item.Girdle_Condition_Id) : null,
                                    item.LaserInscription ?? null,
                                    item.Girdle_Condition ?? null,
                                    item.Company ?? null,
                                    item.Milky_Id != null ? Convert.ToInt32(item.Milky_Id) : null,
                                    item.Milky ?? null,
                                    item.Shade_Id != null ? Convert.ToInt32(item.Shade_Id) : null,
                                    item.Shade ?? null
                                );
                            }

                            var lab_entry_result = await _supplierService.Insert_Update_Lab_Entry(masterDataTable, detailDataTable, user_Id ?? 0);

                            if (lab_entry_result > 0)
                            {
                                /*
                                IList<Order_Processing_Complete_Fortune_Detail> order_Processing_Complete_Fortune_Details = new List<Order_Processing_Complete_Fortune_Detail>();

                                foreach (var item in OrderResult)
                                {
                                    int? buyerCode = 0;

                                    if (!string.IsNullOrEmpty(item.Buyer_Code))
                                    {
                                        buyerCode = Convert.ToInt32(item.Buyer_Code);
                                    }

                                    var fortuneDetail = new Order_Processing_Complete_Fortune_Detail
                                    {
                                        Id = item.Id,
                                        Supplier_code = item.Supplier_code,
                                        SuppStockId = item.SupplierNo,
                                        CertificateNo = item.CertificateNo,
                                        Status = item.Status.ToUpper(),
                                        BuyerCode = buyerCode,
                                        BaseAmount = item.BaseAmount != null ? item.BaseAmount : null,
                                        CostAmount = item.CurrentCostAmount != null ? item.CurrentCostAmount : null,
                                        Shade = item.Shade,
                                        Milky = item.Milky,
                                        TableOpen = item.TableOpen,
                                        GirdleOpen = item.GirdleOpen,
                                        CrownOpen = item.CrownOpen,
                                        PavilionOpen = item.PavilionOpen
                                    };

                                    order_Processing_Complete_Fortune_Details.Add(fortuneDetail);
                                }
                                var result_det = await _oracleService.Order_Data_Detail_Transfer_Oracle(order_Processing_Complete_Fortune_Details);
                                */
                                //if (result_det > 0)
                                //{
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = "Order completed successfully."
                                });
                                //}
                            }
                        }
                        else
                        {
                            if (Stock_Ids.Count > 0)
                            {
                                string concatenatedStockIds = string.Join(", ", Stock_Id);

                                string concatenatedStockId = string.Join(",", Stock_Ids);

                                var result_lo = await _supplierService.Order_Procesing_Stone_Location_Solar(order_Processing_Reply_To_Assist.Order_No, concatenatedStockIds);

                                var dt_Order = await _supplierService.Get_Order_Data_Mazal_Excel(concatenatedStockId, order_Processing_Reply_To_Assist.Order_No);

                                if (dt_Order != null && dt_Order.Rows.Count > 0)
                                {
                                    var excelPath = string.Empty;

                                    string filename = $"{"Order_Status_"}{DateTime.UtcNow.ToString("ddMMyyyy-HHmmss")}{order_Processing_Reply_To_Assist.Order_No}.xlsx";

                                    string subject = order_Processing_Reply_To_Assist.Request_For + " request for order no " + order_Processing_Reply_To_Assist.Order_No + " completed";

                                    StringBuilder body = new StringBuilder();

                                    if (result_e != null && !string.IsNullOrEmpty(result_e.Company_Name))
                                    {
                                        body.AppendLine(@"Company Name :  " + result_e.Company_Name + "<br/>");
                                    }

                                    body.AppendLine(@"Request for : " + order_Processing_Reply_To_Assist.Request_For + "<br/>");

                                    List<string> columnNames = new List<string>();
                                    foreach (DataColumn column in dt_Order.Columns)
                                    {
                                        columnNames.Add(column.ColumnName);
                                    }

                                    DataTable columnNamesTable = new DataTable();
                                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                                    foreach (string columnName in columnNames)
                                    {
                                        columnNamesTable.Rows.Add(columnName);
                                    }
                                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                                    if (!(Directory.Exists(filePath)))
                                    {
                                        Directory.CreateDirectory(filePath);
                                    }

                                    EpExcelExport.Create_Order_Processing_Excel_Mazal(dt_Order, columnNamesTable, filePath, filePath + filename);

                                    excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                                    byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                                    using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                                    {
                                        Employee_Mail employee_Mail = new Employee_Mail
                                        {
                                            Email_id = _configuration["EmailSetting:FromEmail"],
                                            Email_Password = _configuration["EmailSetting:FromPassword"],
                                            SMTP_Server_Address = _configuration["EmailSetting:SmtpHost"],
                                            SMTP_Port = Convert.ToInt32(_configuration["EmailSetting:SmtpPort"])
                                        };

                                        IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                                        _emailSender.Send_Stock_Email(toEmail: to_Email, externalLink: "", subject: subject, formFile: formFile, strBody: body.ToString(), user_Id: 0, employee_Mail: employee_Mail);
                                    }
                                }
                            }

                            DataTable masterDataTable = new DataTable();
                            masterDataTable.Columns.Add("Trans_Id", typeof(int));
                            masterDataTable.Columns.Add("Order_No", typeof(string));
                            masterDataTable.Columns.Add("Entry_Type", typeof(string));
                            masterDataTable.Columns.Add("Company_Name", typeof(string));
                            masterDataTable.Columns.Add("Remarks", typeof(string));
                            masterDataTable.Columns.Add("Order_Type", typeof(string));
                            masterDataTable.Columns.Add("Assist_By", typeof(int));
                            masterDataTable.Columns.Add("Entry_User", typeof(int));

                            masterDataTable.Rows.Add(
                                0,
                                (order_Processing_Reply_To_Assist.Order_No + "." + order_Processing_Reply_To_Assist.Sub_Order_Id.ToString()) ?? null,
                                "A",
                                result_e != null ? result_e.Company_Name ?? null : null,
                                order_Processing_Reply_To_Assist.Summary_QC_Remarks != null ? order_Processing_Reply_To_Assist.Summary_QC_Remarks : null,
                                "L",
                                result_e != null ? result_e.Fortune_Id : null,
                                user_Id ?? null
                            );


                            DataTable detailDataTable = new DataTable();
                            detailDataTable.Columns.Add("Id", typeof(int));
                            detailDataTable.Columns.Add("Trans_Id", typeof(int));
                            detailDataTable.Columns.Add("Stock_Id", typeof(string));
                            detailDataTable.Columns.Add("Cert_No", typeof(string));
                            detailDataTable.Columns.Add("Supplier_Id", typeof(int));
                            detailDataTable.Columns.Add("Supplier_Name", typeof(string));
                            detailDataTable.Columns.Add("Supplier_Short_Name", typeof(string));
                            detailDataTable.Columns.Add("Supplier_Ref_No", typeof(string));
                            detailDataTable.Columns.Add("Status", typeof(string));
                            detailDataTable.Columns.Add("Remarks", typeof(string));
                            detailDataTable.Columns.Add("Buyer", typeof(int));
                            detailDataTable.Columns.Add("Lab", typeof(int));
                            detailDataTable.Columns.Add("Shape", typeof(int));
                            detailDataTable.Columns.Add("BGM", typeof(int));
                            detailDataTable.Columns.Add("Color", typeof(int));
                            detailDataTable.Columns.Add("Clarity", typeof(int));
                            detailDataTable.Columns.Add("Cts", typeof(double));
                            detailDataTable.Columns.Add("Rap_Rate", typeof(double));
                            detailDataTable.Columns.Add("Rap_Amt", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Base_Disc", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Base_Amt", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Cost_Disc", typeof(double));
                            detailDataTable.Columns.Add("Supplier_Cost_Amt", typeof(double));
                            detailDataTable.Columns.Add("Offer_Disc", typeof(double));
                            detailDataTable.Columns.Add("Offer_Amt", typeof(double));
                            detailDataTable.Columns.Add("Cut", typeof(int));
                            detailDataTable.Columns.Add("Polish", typeof(int));
                            detailDataTable.Columns.Add("Symm", typeof(int));
                            detailDataTable.Columns.Add("Flour_Intensity", typeof(int));
                            detailDataTable.Columns.Add("Length", typeof(double));
                            detailDataTable.Columns.Add("Width", typeof(double));
                            detailDataTable.Columns.Add("Depth", typeof(double));
                            detailDataTable.Columns.Add("Depth_Per", typeof(double));
                            detailDataTable.Columns.Add("Table_Per", typeof(double));
                            detailDataTable.Columns.Add("Key_to_Symbol", typeof(string));
                            detailDataTable.Columns.Add("Additional_Comment", typeof(string));
                            detailDataTable.Columns.Add("Girdle_Per", typeof(double));
                            detailDataTable.Columns.Add("Crown_Angle", typeof(double));
                            detailDataTable.Columns.Add("Crown_Height", typeof(double));
                            detailDataTable.Columns.Add("Pavillion_Angle", typeof(double));
                            detailDataTable.Columns.Add("Pavillion_Height", typeof(double));
                            detailDataTable.Columns.Add("Table_Black", typeof(int));
                            detailDataTable.Columns.Add("Crown_Black", typeof(int));
                            detailDataTable.Columns.Add("Table_White", typeof(int));
                            detailDataTable.Columns.Add("Crown_White", typeof(int));
                            detailDataTable.Columns.Add("Culet", typeof(int));
                            detailDataTable.Columns.Add("Table_Open", typeof(int));
                            detailDataTable.Columns.Add("Crown_Open", typeof(int));
                            detailDataTable.Columns.Add("Pav_Open", typeof(int));
                            detailDataTable.Columns.Add("Girdle_Open", typeof(int));
                            detailDataTable.Columns.Add("Cert_Date", typeof(DateTime));
                            detailDataTable.Columns.Add("Cert_Type", typeof(int));
                            detailDataTable.Columns.Add("LR_Half", typeof(double));
                            detailDataTable.Columns.Add("Str_Ln", typeof(double));
                            detailDataTable.Columns.Add("Fancy_Color", typeof(int));
                            detailDataTable.Columns.Add("Fancy_Intensity", typeof(int));
                            detailDataTable.Columns.Add("Fancy_Overtone", typeof(int));
                            detailDataTable.Columns.Add("Rough_Origin", typeof(int));
                            detailDataTable.Columns.Add("Image", typeof(string));
                            detailDataTable.Columns.Add("Video", typeof(string));
                            detailDataTable.Columns.Add("Cert_Link", typeof(string));
                            detailDataTable.Columns.Add("DNA", typeof(string));
                            detailDataTable.Columns.Add("Cert_Type_Link", typeof(string));
                            detailDataTable.Columns.Add("Lab_C", typeof(string));
                            detailDataTable.Columns.Add("Shape_C", typeof(string));
                            detailDataTable.Columns.Add("BGM_C", typeof(string));
                            detailDataTable.Columns.Add("Color_C", typeof(string));
                            detailDataTable.Columns.Add("Clarity_C", typeof(string));
                            detailDataTable.Columns.Add("Cut_C", typeof(string));
                            detailDataTable.Columns.Add("Polish_C", typeof(string));
                            detailDataTable.Columns.Add("Symm_C", typeof(string));
                            detailDataTable.Columns.Add("Flour_Intensity_C", typeof(string));
                            detailDataTable.Columns.Add("Table_Black_C", typeof(string));
                            detailDataTable.Columns.Add("Crown_Black_C", typeof(string));
                            detailDataTable.Columns.Add("Table_White_C", typeof(string));
                            detailDataTable.Columns.Add("Crown_White_C", typeof(string));
                            detailDataTable.Columns.Add("Culet_C", typeof(string));
                            detailDataTable.Columns.Add("Table_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Crown_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Pav_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Girdle_Open_C", typeof(string));
                            detailDataTable.Columns.Add("Cert_Type_C", typeof(string));
                            detailDataTable.Columns.Add("Fancy_Color_C", typeof(string));
                            detailDataTable.Columns.Add("Fancy_Intensity_C", typeof(string));
                            detailDataTable.Columns.Add("Fancy_Overtone_C", typeof(string));
                            detailDataTable.Columns.Add("Rough_Origin_C", typeof(string));
                            detailDataTable.Columns.Add("Laser_Insc", typeof(int));
                            detailDataTable.Columns.Add("Girdle_Condition", typeof(int));
                            detailDataTable.Columns.Add("Laser_Insc_C", typeof(string));
                            detailDataTable.Columns.Add("Girdle_Condition_C", typeof(string));
                            detailDataTable.Columns.Add("Company", typeof(string));
                            detailDataTable.Columns.Add("Milky", typeof(int));
                            detailDataTable.Columns.Add("Milky_C", typeof(string));
                            detailDataTable.Columns.Add("Shade", typeof(int));
                            detailDataTable.Columns.Add("Shade_C", typeof(string));

                            foreach (var item in OrderResult)
                            {
                                DateTime Valid_Date;

                                string dateFormat = "dd-MM-yyyy";

                                if (!DateTime.TryParseExact(item.Cert_Date, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Valid_Date))
                                {
                                    Valid_Date = DateTime.MinValue;
                                }

                                detailDataTable.Rows.Add(
                                    0,
                                    0,
                                    item.StockId,
                                    item.CertificateNo,
                                    item.Supplier_Id != null ? Convert.ToInt32(item.Supplier_Id) : null,
                                    item.Supplier_Name ?? null,
                                    item.Supplier_Short_Name ?? null,
                                    item.SupplierNo ?? null,
                                    item.Status ?? null,
                                    item.Remarks ?? null,
                                    item.Buyer_Code != null ? Convert.ToInt32(item.Buyer_Code) : null,
                                    item.LAB_Id != null ? Convert.ToInt32(item.LAB_Id) : null,
                                    item.Shape_Id != null ? Convert.ToInt32(item.Shape_Id) : null,
                                    item.BGM_Id != null ? Convert.ToInt32(item.BGM_Id) : null,
                                    item.Color_Id != null ? Convert.ToInt32(item.Color_Id) : null,
                                    item.Clarity_Id != null ? Convert.ToInt32(item.Clarity_Id) : null,
                                    SafeConvertToDouble(item.Cts?.ToString()),
                                    SafeConvertToDouble(item.RapRate?.ToString()),
                                    SafeConvertToDouble(item.RapAmount?.ToString()),
                                    SafeConvertToDouble(item.BaseDisc?.ToString()),
                                    SafeConvertToDouble(item.BaseAmount?.ToString()),
                                    SafeConvertToDouble(item.CurrentCostDisc?.ToString()),
                                    SafeConvertToDouble(item.CurrentCostAmount?.ToString()),
                                    SafeConvertToDouble(item.OfferDisc?.ToString()),
                                    SafeConvertToDouble(item.OfferAmount?.ToString()),
                                    item.Cut_Id != null ? Convert.ToInt32(item.Cut_Id) : null,
                                    item.Polish_Id != null ? Convert.ToInt32(item.Polish_Id) : null,
                                    item.Symm_Id != null ? Convert.ToInt32(item.Symm_Id) : null,
                                    item.FLS_INTENSITY_Id != null ? Convert.ToInt32(item.FLS_INTENSITY_Id) : null,
                                    SafeConvertToDouble(item.Length?.ToString()),
                                    SafeConvertToDouble(item.Width?.ToString()),
                                    SafeConvertToDouble(item.Depth?.ToString()),
                                    SafeConvertToDouble(item.DepthPer?.ToString()),
                                    SafeConvertToDouble(item.TablePer?.ToString()),
                                    item.KeyToSymbol ?? null,
                                    item.GiaComments ?? null,
                                    SafeConvertToDouble(item.GirdlePer?.ToString()),
                                    SafeConvertToDouble(item.CrownAngle?.ToString()),
                                    SafeConvertToDouble(item.CrownHeight?.ToString()),
                                    SafeConvertToDouble(item.PavilionAngle?.ToString()),
                                    SafeConvertToDouble(item.PavilionHeight?.ToString()),
                                    item.Table_Black_Id != null ? Convert.ToInt32(item.Table_Black_Id) : null,
                                    item.Crown_Black_Id != null ? Convert.ToInt32(item.Crown_Black_Id) : null,
                                    item.Table_White_Id != null ? Convert.ToInt32(item.Table_White_Id) : null,
                                    item.Crown_White_Id != null ? Convert.ToInt32(item.Crown_White_Id) : null,
                                    item.Culet_Id != null ? Convert.ToInt32(item.Culet_Id) : null,
                                    item.Table_Open_Id != null ? Convert.ToInt32(item.Table_Open_Id) : null,
                                    item.Crown_Open_Id != null ? Convert.ToInt32(item.Crown_Open_Id) : null,
                                    item.Pav_Open_Id != null ? Convert.ToInt32(item.Pav_Open_Id) : null,
                                    item.Girdle_Open_Id != null ? Convert.ToInt32(item.Girdle_Open_Id) : null,
                                    Valid_Date != null ? Convert.ToDateTime(Valid_Date) : null,
                                    item.Cert_Type_Id != null ? Convert.ToInt32(item.Cert_Type_Id) : null,
                                    SafeConvertToDouble(item.LR_Half?.ToString()),
                                    SafeConvertToDouble(item.Str_Ln?.ToString()),
                                    item.Fancy_Color_Id != null ? Convert.ToInt32(item.Fancy_Color_Id) : null,
                                    item.Fancy_Intensity_Id != null ? Convert.ToInt32(item.Fancy_Intensity_Id) : null,
                                    item.Fancy_Overtone_Id != null ? Convert.ToInt32(item.Fancy_Overtone_Id) : null,
                                    item.Rough_Origin_Id != null ? Convert.ToInt32(item.Rough_Origin_Id) : null,
                                    item.ImageLink ?? null,
                                    item.VideoLink ?? null,
                                    item.CertificateLink ?? null,
                                    item.Dna ?? null,
                                    item.Cert_Type_Link ?? null,
                                    item.Lab ?? null,
                                    item.Shape ?? null,
                                    item.Bgm ?? null,
                                    item.Color ?? null,
                                    item.Clarity ?? null,
                                    item.Cut ?? null,
                                    item.Polish ?? null,
                                    item.Symm ?? null,
                                    item.FlsIntensity ?? null,
                                    item.TableBlack ?? null,
                                    item.SideBlack ?? null,
                                    item.TableWhite ?? null,
                                    item.SideWhite ?? null,
                                    item.Culet ?? null,
                                    item.TableOpen ?? null,
                                    item.CrownOpen ?? null,
                                    item.PavilionOpen ?? null,
                                    item.GirdleOpen ?? null,
                                    item.GiaType ?? null,
                                    item.Fancy_Color ?? null,
                                    item.Fancy_Intensity ?? null,
                                    item.Fancy_Overtone ?? null,
                                    item.Rough_Origin ?? null,
                                    item.Laser_Insc_Id != null ? Convert.ToInt32(item.Laser_Insc_Id) : null,
                                    item.Girdle_Condition_Id != null ? Convert.ToInt32(item.Girdle_Condition_Id) : null,
                                    item.LaserInscription ?? null,
                                    item.Girdle_Condition ?? null,
                                    item.Company ?? null,
                                    item.Milky_Id != null ? Convert.ToInt32(item.Milky_Id) : null,
                                    item.Milky ?? null,
                                    item.Shade_Id != null ? Convert.ToInt32(item.Shade_Id) : null,
                                    item.Shade ?? null
                                );
                            }

                            var lab_entry_result = await _supplierService.Insert_Update_Lab_Entry(masterDataTable, detailDataTable, user_Id ?? 0);

                            if (lab_entry_result > 0)
                            {
                                var result_ = await _oracleService.Order_Data_Transfer_Oracle(OrderResult, result_e, order_Processing_Reply_To_Assist.Summary_QC_Remarks, "W", "O");
                                if (result_ > 0)
                                {
                                    return Ok(new
                                    {
                                        statusCode = HttpStatusCode.OK,
                                        message = "Order completed successfully."
                                    });
                                }
                            }
                        }
                    }
                    else
                    {
                        string subject = order_Processing_Reply_To_Assist.Request_For + " request for order no " + order_Processing_Reply_To_Assist.Order_No + " completed";

                        StringBuilder sb = new StringBuilder();

                        if (result_e != null)
                        {
                            sb.AppendLine(@"Company Name :  " + result_e.Company_Name + "<br/>");
                        }

                        sb.AppendLine(@"Request for : " + order_Processing_Reply_To_Assist.Request_For + "<br/>");

                        _emailSender.SendEmail(toEmail: to_Email, externalLink: "", subject: subject, formFile: null, strBody: sb.ToString());

                    }
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Order completed successfully."
                    });
                }
                return BadRequest();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "order_processing_completed", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        /*
        * Date: 2025/05/24 Get Order Processing AND Summary With Hold Stones..  by Jashmin Patel
        */
        [HttpGet]
        [Route("get_order_processing_hold")]
        [Authorize]
        public async Task<IActionResult> Get_Order_Processing_Hold()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_Order_Processing_Hold(user_Id ?? 0);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Order_Processing_Hold", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        /*
        * Date: 2025/05/23 Validate Lab Entry Is_Img_Cert by Jashmin Patel
        */
        [HttpPost]
        [Route("validate_lab_entry_is_img_cert")]
        [Authorize]
        public async Task<IActionResult> Validate_Lab_Entry_Is_Img_Cert(Lab_Entry_Is_Img_Cert_Model model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_Lab_Entry_Is_Img_Cert(model);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Validate_Lab_Entry_Is_Img_Cert", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_lab_entry")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Lab_Entry(Lab_Entry_Master_Model lab_Entry_Master_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                Lab_Entry_Master Lab_Entry_Master = JsonConvert.DeserializeObject<Lab_Entry_Master>(lab_Entry_Master_Model.Lab_Entry_Master.ToString());

                IList<Lab_Entry_Detail_Model> Lab_Entry_Detail_List = JsonConvert.DeserializeObject<IList<Lab_Entry_Detail_Model>>(lab_Entry_Master_Model.Lab_Entry_Detail_List.ToString());

                DataTable masterDataTable = new DataTable();
                masterDataTable.Columns.Add("Trans_Id", typeof(int));
                masterDataTable.Columns.Add("Order_No", typeof(string));
                masterDataTable.Columns.Add("Entry_Type", typeof(string));
                masterDataTable.Columns.Add("Company_Name", typeof(string));
                masterDataTable.Columns.Add("Remarks", typeof(string));
                masterDataTable.Columns.Add("Order_Type", typeof(string));
                masterDataTable.Columns.Add("Assist_By", typeof(int));
                masterDataTable.Columns.Add("Entry_User", typeof(int));

                masterDataTable.Rows.Add(
                    Lab_Entry_Master.Trans_Id ?? 0,
                    (Lab_Entry_Master.Order_No) ?? null,
                    Lab_Entry_Master.Entry_Type,
                    Lab_Entry_Master.Company_Name ?? null,
                    Lab_Entry_Master.Remarks != null ? Lab_Entry_Master.Remarks : null,
                    Lab_Entry_Master.Type,
                    Lab_Entry_Master.Assist_By > 0 ? Lab_Entry_Master.Assist_By : null,
                    user_Id ?? null
                );

                DataTable detailDataTable = new DataTable();
                detailDataTable.Columns.Add("Id", typeof(int));
                detailDataTable.Columns.Add("Trans_Id", typeof(int));
                detailDataTable.Columns.Add("Stock_Id", typeof(string));
                detailDataTable.Columns.Add("Cert_No", typeof(string));
                detailDataTable.Columns.Add("Supplier_Id", typeof(int));
                detailDataTable.Columns.Add("Supplier_Name", typeof(string));
                detailDataTable.Columns.Add("Supplier_Short_Name", typeof(string));
                detailDataTable.Columns.Add("Supplier_Ref_No", typeof(string));
                detailDataTable.Columns.Add("Status", typeof(string));
                detailDataTable.Columns.Add("Remarks", typeof(string));
                detailDataTable.Columns.Add("Buyer", typeof(int));
                detailDataTable.Columns.Add("Lab", typeof(int));
                detailDataTable.Columns.Add("Shape", typeof(int));
                detailDataTable.Columns.Add("BGM", typeof(int));
                detailDataTable.Columns.Add("Color", typeof(int));
                detailDataTable.Columns.Add("Clarity", typeof(int));
                detailDataTable.Columns.Add("Cts", typeof(double));
                detailDataTable.Columns.Add("Rap_Rate", typeof(double));
                detailDataTable.Columns.Add("Rap_Amt", typeof(double));
                detailDataTable.Columns.Add("Supplier_Base_Disc", typeof(double));
                detailDataTable.Columns.Add("Supplier_Base_Amt", typeof(double));
                detailDataTable.Columns.Add("Supplier_Cost_Disc", typeof(double));
                detailDataTable.Columns.Add("Supplier_Cost_Amt", typeof(double));
                detailDataTable.Columns.Add("Offer_Disc", typeof(double));
                detailDataTable.Columns.Add("Offer_Amt", typeof(double));
                detailDataTable.Columns.Add("Cut", typeof(int));
                detailDataTable.Columns.Add("Polish", typeof(int));
                detailDataTable.Columns.Add("Symm", typeof(int));
                detailDataTable.Columns.Add("Flour_Intensity", typeof(int));
                detailDataTable.Columns.Add("Length", typeof(double));
                detailDataTable.Columns.Add("Width", typeof(double));
                detailDataTable.Columns.Add("Depth", typeof(double));
                detailDataTable.Columns.Add("Depth_Per", typeof(double));
                detailDataTable.Columns.Add("Table_Per", typeof(double));
                detailDataTable.Columns.Add("Key_to_Symbol", typeof(string));
                detailDataTable.Columns.Add("Additional_Comment", typeof(string));
                detailDataTable.Columns.Add("Girdle_Per", typeof(double));
                detailDataTable.Columns.Add("Crown_Angle", typeof(double));
                detailDataTable.Columns.Add("Crown_Height", typeof(double));
                detailDataTable.Columns.Add("Pavillion_Angle", typeof(double));
                detailDataTable.Columns.Add("Pavillion_Height", typeof(double));
                detailDataTable.Columns.Add("Table_Black", typeof(int));
                detailDataTable.Columns.Add("Crown_Black", typeof(int));
                detailDataTable.Columns.Add("Table_White", typeof(int));
                detailDataTable.Columns.Add("Crown_White", typeof(int));
                detailDataTable.Columns.Add("Culet", typeof(int));
                detailDataTable.Columns.Add("Table_Open", typeof(int));
                detailDataTable.Columns.Add("Crown_Open", typeof(int));
                detailDataTable.Columns.Add("Pav_Open", typeof(int));
                detailDataTable.Columns.Add("Girdle_Open", typeof(int));
                detailDataTable.Columns.Add("Cert_Date", typeof(DateTime));
                detailDataTable.Columns.Add("Cert_Type", typeof(int));
                detailDataTable.Columns.Add("LR_Half", typeof(double));
                detailDataTable.Columns.Add("Str_Ln", typeof(double));
                detailDataTable.Columns.Add("Fancy_Color", typeof(int));
                detailDataTable.Columns.Add("Fancy_Intensity", typeof(int));
                detailDataTable.Columns.Add("Fancy_Overtone", typeof(int));
                detailDataTable.Columns.Add("Rough_Origin", typeof(int));
                detailDataTable.Columns.Add("Image", typeof(string));
                detailDataTable.Columns.Add("Video", typeof(string));
                detailDataTable.Columns.Add("Cert_Link", typeof(string));
                detailDataTable.Columns.Add("DNA", typeof(string));
                detailDataTable.Columns.Add("Cert_Type_Link", typeof(string));
                detailDataTable.Columns.Add("Lab_C", typeof(string));
                detailDataTable.Columns.Add("Shape_C", typeof(string));
                detailDataTable.Columns.Add("BGM_C", typeof(string));
                detailDataTable.Columns.Add("Color_C", typeof(string));
                detailDataTable.Columns.Add("Clarity_C", typeof(string));
                detailDataTable.Columns.Add("Cut_C", typeof(string));
                detailDataTable.Columns.Add("Polish_C", typeof(string));
                detailDataTable.Columns.Add("Symm_C", typeof(string));
                detailDataTable.Columns.Add("Flour_Intensity_C", typeof(string));
                detailDataTable.Columns.Add("Table_Black_C", typeof(string));
                detailDataTable.Columns.Add("Crown_Black_C", typeof(string));
                detailDataTable.Columns.Add("Table_White_C", typeof(string));
                detailDataTable.Columns.Add("Crown_White_C", typeof(string));
                detailDataTable.Columns.Add("Culet_C", typeof(string));
                detailDataTable.Columns.Add("Table_Open_C", typeof(string));
                detailDataTable.Columns.Add("Crown_Open_C", typeof(string));
                detailDataTable.Columns.Add("Pav_Open_C", typeof(string));
                detailDataTable.Columns.Add("Girdle_Open_C", typeof(string));
                detailDataTable.Columns.Add("Cert_Type_C", typeof(string));
                detailDataTable.Columns.Add("Fancy_Color_C", typeof(string));
                detailDataTable.Columns.Add("Fancy_Intensity_C", typeof(string));
                detailDataTable.Columns.Add("Fancy_Overtone_C", typeof(string));
                detailDataTable.Columns.Add("Rough_Origin_C", typeof(string));
                detailDataTable.Columns.Add("Laser_Insc", typeof(int));
                detailDataTable.Columns.Add("Girdle_Condition", typeof(int));
                detailDataTable.Columns.Add("Laser_Insc_C", typeof(string)).MaxLength = 20;
                detailDataTable.Columns.Add("Girdle_Condition_C", typeof(string));
                detailDataTable.Columns.Add("Company", typeof(string));
                detailDataTable.Columns.Add("Milky", typeof(int));
                detailDataTable.Columns.Add("Milky_C", typeof(string));
                detailDataTable.Columns.Add("Shade", typeof(int));
                detailDataTable.Columns.Add("Shade_C", typeof(string));

                foreach (var item in Lab_Entry_Detail_List)
                {

                    DateTime Valid_Date;

                    string dateFormat = "dd-MM-yyyy";

                    if (!DateTime.TryParseExact(item.CertificateDate, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Valid_Date))
                    {
                        Valid_Date = DateTime.MinValue;
                    }

                    detailDataTable.Rows.Add(
                        item.Id ?? 0,
                        Lab_Entry_Master.Trans_Id ?? 0,
                        item.StockId,
                        item.CertificateNo,
                        item.SupplierId != null ? Convert.ToInt32(item.SupplierId) : null,
                        item.SupplierName ?? null,
                        item.SupplierShortName ?? null,
                        item.SupplierNo ?? null,
                        item.Status ?? null,
                        item.Remarks ?? null,
                        item.BuyerCode != null ? Convert.ToInt32(item.BuyerCode) : null,
                        item.LabId != null ? Convert.ToInt32(item.LabId) : null,
                        item.ShapeId != null ? Convert.ToInt32(item.ShapeId) : null,
                        item.BgmId != null ? Convert.ToInt32(item.BgmId) : null,
                        item.ColorId != null ? Convert.ToInt32(item.ColorId) : null,
                        item.ClarityId != null ? Convert.ToInt32(item.ClarityId) : null,
                        SafeConvertToDouble(item.Cts?.ToString()),
                        SafeConvertToDouble(item.RapRate?.ToString()),
                        SafeConvertToDouble(item.RapAmount?.ToString()),
                        SafeConvertToDouble(item.BaseDisc?.ToString()),
                        SafeConvertToDouble(item.BaseAmount?.ToString()),
                        SafeConvertToDouble(item.CostDisc?.ToString()),
                        SafeConvertToDouble(item.CostAmount?.ToString()),
                        SafeConvertToDouble(item.OfferDisc?.ToString()),
                        SafeConvertToDouble(item.OfferAmount?.ToString()),
                        item.CutId != null ? Convert.ToInt32(item.CutId) : null,
                        item.PolishId != null ? Convert.ToInt32(item.PolishId) : null,
                        item.SymmId != null ? Convert.ToInt32(item.SymmId) : null,
                        item.FlsintensityId != null ? Convert.ToInt32(item.FlsintensityId) : null,
                        SafeConvertToDouble(item.Length?.ToString()),
                        SafeConvertToDouble(item.Width?.ToString()),
                        SafeConvertToDouble(item.Depth?.ToString()),
                        SafeConvertToDouble(item.DepthPer?.ToString()),
                        SafeConvertToDouble(item.TablePer?.ToString()),
                        item.KeyToSymbol ?? null,
                        item.GiaComments ?? null,
                        SafeConvertToDouble(item.GirdlePer?.ToString()),
                        SafeConvertToDouble(item.CrownAngle?.ToString()),
                        SafeConvertToDouble(item.CrownHeight?.ToString()),
                        SafeConvertToDouble(item.PavilionAngle?.ToString()),
                        SafeConvertToDouble(item.PavilionHeight?.ToString()),
                        item.TableBlackId != null ? Convert.ToInt32(item.TableBlackId) : null,
                        item.CrownBlackId != null ? Convert.ToInt32(item.CrownBlackId) : null,
                        item.TableWhiteId != null ? Convert.ToInt32(item.TableWhiteId) : null,
                        item.CrownWhiteId != null ? Convert.ToInt32(item.CrownWhiteId) : null,
                        item.CuletId != null ? Convert.ToInt32(item.CuletId) : null,
                        item.TableOpenId != null ? Convert.ToInt32(item.TableOpenId) : null,
                        item.CrownOpenId != null ? Convert.ToInt32(item.CrownOpenId) : null,
                        item.PavOpenId != null ? Convert.ToInt32(item.PavOpenId) : null,
                        item.GirdleOpenId != null ? Convert.ToInt32(item.GirdleOpenId) : null,
                        Valid_Date != null ? Convert.ToDateTime(Valid_Date) : null,
                        item.CertTypeId != null ? Convert.ToInt32(item.CertTypeId) : null,
                        SafeConvertToDouble(item.LrHalf?.ToString()),
                        SafeConvertToDouble(item.StarLn?.ToString()),
                        item.FancyColorId != null ? Convert.ToInt32(item.FancyColorId) : null,
                        item.FancyintensityId != null ? Convert.ToInt32(item.FancyintensityId) : null,
                        item.FancyOvertoneId != null ? Convert.ToInt32(item.FancyOvertoneId) : null,
                        item.RoughOriginId != null ? Convert.ToInt32(item.RoughOriginId) : null,
                        item.ImageLink ?? null,
                        item.VideoLink ?? null,
                        item.CertificateLink ?? null,
                        item.Dna ?? null,
                        item.CertTypeLink ?? null,
                        item.Lab ?? null,
                        item.Shape ?? null,
                        item.Bgm ?? null,
                        item.Color ?? null,
                        item.Clarity ?? null,
                        item.Cut ?? null,
                        item.Polish ?? null,
                        item.Symm ?? null,
                        item.Flsintensity ?? null,
                        item.TableBlack ?? null,
                        item.SideBlack ?? null,
                        item.TableWhite ?? null,
                        item.SideWhite ?? null,
                        item.Culet ?? null,
                        item.TableOpen ?? null,
                        item.CrownOpen ?? null,
                        item.PavilionOpen ?? null,
                        item.GirdleOpen ?? null,
                        item.GiaType ?? null,
                        item.FancyColor ?? null,
                        item.Fancyintensity ?? null,
                        item.FancyOvertone ?? null,
                        item.RoughOrigin ?? null,
                        item.LaserInscId != null ? Convert.ToInt32(item.LaserInscId) : null,
                        item.GirdleConditionId != null ? Convert.ToInt32(item.GirdleConditionId) : null,
                        string.IsNullOrEmpty(item.LaserInscription) ? DBNull.Value : item.LaserInscription.Length > 20 ? item.LaserInscription.Substring(0, 20) : item.LaserInscription,
                        item.GirdleCondition ?? null,
                        item.Company ?? null,
                        item.Milky_Id != null ? Convert.ToInt32(item.Milky_Id) : null,
                        item.Milky ?? null,
                        item.Shade_Id != null ? Convert.ToInt32(item.Shade_Id) : null,
                        item.Shade ?? null
                    );

                    string certificateLink = item.CertificateLink;

                    if (!string.IsNullOrWhiteSpace(certificateLink) &&
                        (Lab_Entry_Master.Trans_Id == null || Lab_Entry_Master.Trans_Id == 0))
                    {
                        var filePath = Path.Combine(Directory.GetCurrentDirectory(), CoreCommonFilePath.CertificatesFilePath);
                        if (!(Directory.Exists(filePath)))
                        {
                            Directory.CreateDirectory(filePath);
                        }

                        string filename = "/" + item.CertificateNo + ".pdf";
                        filePath += filename;

                        try
                        {
                            using (WebClient client = new WebClient())
                            {
                                client.DownloadFile(certificateLink, filePath);
                            }
                        }
                        catch (Exception)
                        {

                        }
                    }
                }

                var lab_entry_result = await _supplierService.Insert_Update_Lab_Entry(masterDataTable, detailDataTable, user_Id ?? 0);

                if (Lab_Entry_Master.Trans_Id == null || Lab_Entry_Master.Trans_Id == 0)
                {
                    IList<Order_Processing_Complete_Detail> OrderResult = Lab_Entry_Detail_List
                        .Select(labDetail => new Order_Processing_Complete_Detail
                        {
                            Id = labDetail.TransId ?? 0,
                            Dna = labDetail.Dna,
                            ImageLink = labDetail.ImageLink,
                            VideoLink = labDetail.VideoLink,
                            Lab = labDetail.Lab,
                            CertificateLink = labDetail.CertificateLink,
                            Company = labDetail.Company,
                            Customer = Lab_Entry_Master.Company_Name,
                            StockId = labDetail.StockId,
                            SupplierNo = labDetail.SupplierNo,
                            CertificateNo = labDetail.CertificateNo,
                            Shape = labDetail.Shape,
                            Color = labDetail.Color,
                            Clarity = labDetail.Clarity,
                            Cts = labDetail.Cts,
                            RapRate = labDetail.RapRate,
                            RapAmount = labDetail.RapAmount,
                            BaseDisc = labDetail.BaseDisc,
                            BaseAmount = labDetail.BaseAmount,
                            CurrentCostDisc = labDetail.CostDisc,
                            CurrentCostAmount = labDetail.CostAmount,
                            CostDisc = labDetail.CostDisc,
                            CostAmount = labDetail.CostAmount,
                            OfferDisc = labDetail.OfferDisc,
                            OfferAmount = labDetail.OfferAmount,
                            Status = labDetail.Status,
                            Remarks = labDetail.Remarks,
                            Cut = labDetail.Cut,
                            Polish = labDetail.Polish,
                            Symm = labDetail.Symm,
                            FlsIntensity = labDetail.Flsintensity,
                            KeyToSymbol = labDetail.KeyToSymbol,
                            Length = labDetail.Length,
                            Width = labDetail.Width,
                            Depth = labDetail.Depth,
                            DepthPer = labDetail.DepthPer,
                            TablePer = labDetail.TablePer,
                            CrownAngle = labDetail.CrownAngle,
                            CrownHeight = labDetail.CrownHeight,
                            PavilionAngle = labDetail.PavilionAngle,
                            PavilionHeight = labDetail.PavilionHeight,
                            LaserInscription = !string.IsNullOrEmpty(labDetail.LaserInscription) && labDetail.LaserInscription.Length > 1 ? "Y" : labDetail.LaserInscription,
                            GirdlePer = labDetail.GirdlePer,
                            TableWhite = labDetail.TableWhite,
                            SideWhite = labDetail.SideWhite,
                            TableBlack = labDetail.TableBlack,
                            SideBlack = labDetail.SideBlack,
                            Culet = labDetail.Culet,
                            GiaComments = labDetail.GiaComments,
                            GiaType = labDetail.GiaType,
                            TableOpen = labDetail.TableOpen,
                            CrownOpen = labDetail.CrownOpen,
                            PavilionOpen = labDetail.PavilionOpen,
                            GirdleOpen = labDetail.GirdleOpen,
                            Shade = labDetail.Shade,
                            Milky = labDetail.Milky,
                            SupplierComments = labDetail.GiaComments,
                            Bgm = labDetail.Bgm,
                            Party_code = Lab_Entry_Master.Party_Id.ToString(),
                            Cert_Date = labDetail.CertificateDate,
                            LR_Half = labDetail.LrHalf.ToString(),
                            Str_Ln = labDetail.StarLn.ToString()
                        }).ToList();

                    Employee_Fortune_Order_Master result_e = new Employee_Fortune_Order_Master();
                    result_e.Fortune_Id = Lab_Entry_Master.Assist_By ?? 0;

                    if (Lab_Entry_Master.Entry_Type == "M" && Lab_Entry_Master.Type == "L")
                    {
                        var result_ = await _oracleService.Order_Data_Transfer_Oracle(OrderResult, result_e, Lab_Entry_Master.Remarks, "W", "L");
                    }
                    else if (Lab_Entry_Master.Type == "O")
                    {
                        var result_ = await _oracleService.Order_Data_Transfer_Oracle(OrderResult, result_e, Lab_Entry_Master.Remarks, "OS", "L");
                    }
                }
                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = Lab_Entry_Master.Trans_Id > 0 ? CoreCommonMessage.Lab_Entry_Updated : CoreCommonMessage.Lab_Entry_Created
                });

            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Lab_Entry", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        public static double? SafeConvertToDouble(string value)
        {
            if (double.TryParse(value, out double result))
            {
                return result;
            }
            return null;
        }

        [HttpPost]
        [Route("job_add_to_fortune_lab_entry")]
        public async Task<IActionResult> Job_Add_To_Fortune_Lab_Entry()
        {
            try
            {
                var trans_Id_List = await _supplierService.Get_Fortune_Lab_Entry_Data();

                if (trans_Id_List != null && trans_Id_List.Count > 0)
                {
                    foreach (var trans_Id in trans_Id_List)
                    {
                        if (trans_Id.TryGetValue("Trans_Id", out var idValue) && idValue != null)
                        {
                            int Id = Convert.ToInt32(idValue);

                            Order_Processing_Summary order_Processing_Summary = new Order_Processing_Summary();
                            order_Processing_Summary.Stock_Id = Id.ToString();

                            var result = await _supplierService.Get_Lab_Entry_Summary(0, order_Processing_Summary);
                            var result_det = await _supplierService.Get_Lab_Entry_Detail(Id);

                            if (result != null && result.Count > 0 && result_det != null && result_det.Count > 0)
                            {
                                var json = JsonConvert.SerializeObject(result);
                                List<Lab_Entry_Master> lab_Entry_Master = JsonConvert.DeserializeObject<List<Lab_Entry_Master>>(json);

                                string jsonResult = JsonConvert.SerializeObject(result_det);

                                IList<Lab_Entry_Detail_Model> Lab_Entry_Detail_List = JsonConvert.DeserializeObject<IList<Lab_Entry_Detail_Model>>(jsonResult);

                                IList<Order_Processing_Complete_Detail> OrderResult = Lab_Entry_Detail_List
                                    .Select(labDetail => new Order_Processing_Complete_Detail
                                    {
                                        Id = labDetail.TransId ?? 0,
                                        Dna = labDetail.Dna,
                                        ImageLink = labDetail.ImageLink,
                                        VideoLink = labDetail.VideoLink,
                                        Lab = labDetail.Lab,
                                        CertificateLink = labDetail.CertificateLink,
                                        Company = labDetail.SupplierName,
                                        Customer = lab_Entry_Master[0].Company_Name,
                                        StockId = labDetail.StockId,
                                        SupplierNo = labDetail.SupplierNo,
                                        CertificateNo = labDetail.CertificateNo,
                                        Shape = labDetail.Shape,
                                        Color = labDetail.Color,
                                        Clarity = labDetail.Clarity,
                                        Cts = labDetail.Cts,
                                        RapRate = labDetail.RapRate,
                                        RapAmount = labDetail.RapAmount,
                                        BaseDisc = labDetail.BaseDisc,
                                        BaseAmount = labDetail.BaseAmount,
                                        CurrentCostDisc = labDetail.CostDisc,
                                        CurrentCostAmount = labDetail.CostAmount,
                                        CostDisc = labDetail.CostDisc,
                                        CostAmount = labDetail.CostAmount,
                                        OfferDisc = labDetail.OfferDisc,
                                        OfferAmount = labDetail.OfferAmount,
                                        Status = labDetail.Status,
                                        Remarks = labDetail.Remarks,
                                        Cut = labDetail.Cut,
                                        Polish = labDetail.Polish,
                                        Symm = labDetail.Symm,
                                        FlsIntensity = labDetail.Flsintensity,
                                        KeyToSymbol = labDetail.KeyToSymbol,
                                        Length = labDetail.Length,
                                        Width = labDetail.Width,
                                        Depth = labDetail.Depth,
                                        DepthPer = labDetail.DepthPer,
                                        TablePer = labDetail.TablePer,
                                        CrownAngle = labDetail.CrownAngle,
                                        CrownHeight = labDetail.CrownHeight,
                                        PavilionAngle = labDetail.PavilionAngle,
                                        PavilionHeight = labDetail.PavilionHeight,
                                        LaserInscription = !string.IsNullOrEmpty(labDetail.LaserInscription) && labDetail.LaserInscription.Length > 1 ? "Y" : labDetail.LaserInscription,
                                        GirdlePer = labDetail.GirdlePer,
                                        TableWhite = labDetail.TableWhite,
                                        SideWhite = labDetail.SideWhite,
                                        TableBlack = labDetail.TableBlack,
                                        SideBlack = labDetail.SideBlack,
                                        Culet = labDetail.Culet,
                                        GiaComments = labDetail.GiaComments,
                                        GiaType = labDetail.GiaType,
                                        TableOpen = labDetail.TableOpen,
                                        CrownOpen = labDetail.CrownOpen,
                                        PavilionOpen = labDetail.PavilionOpen,
                                        GirdleOpen = labDetail.GirdleOpen,
                                        Shade = labDetail.Shade,
                                        Milky = labDetail.Milky,
                                        SupplierComments = labDetail.GiaComments,
                                        Bgm = labDetail.Bgm,
                                        Party_code = lab_Entry_Master[0].Party_Id.ToString(),
                                        Cert_Date = labDetail.CertificateDate,
                                        LR_Half = labDetail.LrHalf.ToString(),
                                        Str_Ln = labDetail.StarLn.ToString()
                                    }).ToList();

                                Employee_Fortune_Order_Master result_e = new Employee_Fortune_Order_Master();
                                result_e.Fortune_Id = lab_Entry_Master[0].Assist_By ?? 0;

                                if (result_e.Fortune_Id > 0)
                                {
                                    if (lab_Entry_Master[0].Entry_Type == "M" && lab_Entry_Master[0].Type == "LAB")
                                    {
                                        var result_ = await _oracleService.Order_Data_Transfer_Oracle(OrderResult, result_e, lab_Entry_Master[0].Remarks, "W", "L");
                                    }
                                    else if (lab_Entry_Master[0].Type == "OVERSEAS")
                                    {
                                        var result_ = await _oracleService.Order_Data_Transfer_Oracle(OrderResult, result_e, lab_Entry_Master[0].Remarks, "OS", "L");
                                    }
                                }
                            }
                        }
                    }

                    return Ok(new
                    {
                        StatusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Lab_Entry_Created
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Add_To_Fortune_Lab_Entry", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_lab_entry")]
        [Authorize]
        public async Task<IActionResult> Delete_Lab_Entry(int? Trans_Id)
        {
            try
            {
                var (result, Is_Exist) = await _supplierService.Delete_Lab_Entry(Trans_Id ?? 0);

                if (result == 409 && Is_Exist)
                {
                    if (Is_Exist)
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.Lab_Entry_Auto_Deleted,
                        });
                    }
                }
                else if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Lab_Entry_Deleted,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Lab_Entry", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_lab_entry_report_summary")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Entry_Report_Summary(Lab_Entry_Summary lab_Entry_Summary)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Lab_Entry_Report_Summary(user_Id ?? 0, lab_Entry_Summary);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Entry_Report_Summary", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_excel_export")]
        [Authorize]
        public async Task<IActionResult> Order_Excel_Export(Report_Filter report_Filter)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var (dt_Order, is_Admin) = await _supplierService.Get_Order_Excel_Data(report_Filter.Report_Filter_Parameter, user_Id ?? 0, report_Filter.Order_Id, report_Filter.Sub_Order_Id);
                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in dt_Order.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");

                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = "AdminStatus_" + DateTime.UtcNow.ToString("ddMMyyyy") + "_" + report_Filter.Order_Id + ".xlsx";
                    if (is_Admin)
                    {
                        EpExcelExport.Create_Order_Processing_Excel_Admin(dt_Order, columnNamesTable, filePath, filePath + filename);
                    }
                    else
                    {
                        EpExcelExport.Create_Order_Processing_Excel_User(dt_Order, columnNamesTable, filePath, filePath + filename);
                    }
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Excel_Export", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_excel_export_mazal")]
        [Authorize]
        public async Task<IActionResult> Order_Excel_Export_Mazal(Report_Filter report_Filter)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var dt_Order = await _supplierService.Get_Order_Excel_Data_Mazal(report_Filter.Report_Filter_Parameter, report_Filter.Order_Id);

                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    var excelPath = string.Empty;

                    string filename = string.Empty;

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in dt_Order.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }

                    filename = "OrderStatus_" + DateTime.UtcNow.ToString("ddMMyyyy") + "_" + report_Filter.Order_Id.ToString() + ".xlsx";

                    EpExcelExport.Create_Order_Processing_Excel_Mazal(dt_Order, columnNamesTable, filePath, filePath + filename);

                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Excel_Export_Mazal", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("send_mazal_on_email")]
        [Authorize]
        public async Task<IActionResult> Send_Mazal_On_Email(Order_Excel_Email_Model order_Excel_Email_Model)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                    var Order_det = await _supplierService.Get_Order_Processing_Name_Status_Select(order_Excel_Email_Model.Sub_Order_Id ?? 0, order_Excel_Email_Model.Order_Id);
                    string status = Order_det[0]["Status"]?.ToString() ?? "";
                    string name = Order_det[0]["Name"]?.ToString() ?? "";

                    string subject = $"{"Order Status - "}{(!string.IsNullOrEmpty(name) ? $"{name} - " : "")}{"Order No (" + order_Excel_Email_Model.Order_Id + ")"}";

                    string filename = $"{"Order_Status_"}{(!string.IsNullOrEmpty(name) ? $"{name}_" : "")}{order_Excel_Email_Model.Order_Id}.xlsx";
                    string body = $"Please find attached order status";

                    if (order_Excel_Email_Model.Majal_Excel_Exist == "M")
                    {
                        var dt_Order = await _supplierService.Get_Order_Data_Mazal_Excel(order_Excel_Email_Model.Stock_Id, order_Excel_Email_Model.Order_Id);

                        if (dt_Order != null && dt_Order.Rows.Count > 0)
                        {
                            var excelPath = string.Empty;


                            List<string> columnNames = new List<string>();
                            foreach (DataColumn column in dt_Order.Columns)
                            {
                                columnNames.Add(column.ColumnName);
                            }

                            DataTable columnNamesTable = new DataTable();
                            columnNamesTable.Columns.Add("Column_Name", typeof(string));

                            foreach (string columnName in columnNames)
                            {
                                columnNamesTable.Rows.Add(columnName);
                            }
                            var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                            if (!(Directory.Exists(filePath)))
                            {
                                Directory.CreateDirectory(filePath);
                            }

                            EpExcelExport.Create_Order_Processing_Excel_Mazal(dt_Order, columnNamesTable, filePath, filePath + filename);

                            excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                            byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                            using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                            {
                                var emp_email = await _employeeService.Get_Employee_Email_Or_Default_Email(user_Id ?? 0);
                                if (emp_email != null)
                                {
                                    if (!(order_Excel_Email_Model.Send_From_Default ?? false) && (emp_email.Is_Default ?? false))
                                        return Conflict(new
                                        {
                                            statusCode = HttpStatusCode.Conflict,
                                            message = CoreCommonMessage.EmailSendFromDefaultSuccessMessage
                                        });

                                    IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                                    _emailSender.Send_Stock_Email(toEmail: order_Excel_Email_Model.To_Email, externalLink: "", subject: subject, formFile: formFile, strBody: body, user_Id: user_Id ?? 0, employee_Mail: emp_email);
                                }
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.EmailSendSuccessMessage
                                });
                            }
                        }
                    }
                    else if (order_Excel_Email_Model.Majal_Excel_Exist == "E")
                    {
                        var (dt_Order, is_Admin) = await _supplierService.Get_Order_Data_Excel(order_Excel_Email_Model.Stock_Id, user_Id ?? 0, order_Excel_Email_Model.Order_Id);
                        if (dt_Order != null && dt_Order.Rows.Count > 0)
                        {
                            List<string> columnNames = new List<string>();
                            foreach (DataColumn column in dt_Order.Columns)
                            {
                                columnNames.Add(column.ColumnName);
                            }

                            DataTable columnNamesTable = new DataTable();
                            columnNamesTable.Columns.Add("Column_Name", typeof(string));

                            foreach (string columnName in columnNames)
                            {
                                columnNamesTable.Rows.Add(columnName);
                            }
                            var excelPath = string.Empty;
                            var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                            if (!(Directory.Exists(filePath)))
                            {
                                Directory.CreateDirectory(filePath);
                            }

                            if (is_Admin)
                            {
                                EpExcelExport.Create_Order_Processing_Excel_Admin(dt_Order, columnNamesTable, filePath, filePath + filename);
                            }
                            else
                            {
                                EpExcelExport.Create_Order_Processing_Excel_User(dt_Order, columnNamesTable, filePath, filePath + filename);
                            }

                            excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                            byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                            using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                            {
                                var emp_email = await _employeeService.Get_Employee_Email_Or_Default_Email(user_Id ?? 0);
                                if (emp_email != null)
                                {
                                    if (!(order_Excel_Email_Model.Send_From_Default ?? false) && (emp_email.Is_Default ?? false))
                                        return Conflict(new
                                        {
                                            statusCode = HttpStatusCode.Conflict,
                                            message = CoreCommonMessage.EmailSendFromDefaultSuccessMessage
                                        });

                                    IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                                    _emailSender.Send_Stock_Email(toEmail: order_Excel_Email_Model.To_Email, externalLink: "", subject: subject, formFile: formFile, strBody: body, user_Id: user_Id ?? 0, employee_Mail: emp_email);
                                }
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.EmailSendSuccessMessage
                                });
                            }
                        }
                    }
                    return NoContent();
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Send_Stock_On_Email", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_excel_export_pre_post")]
        [Authorize]
        public async Task<IActionResult> Order_Excel_Export_Pre_Post(Order_Processing_Summary order_Processing_Summary)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var dt_Order = await _supplierService.Get_Order_Summary_Pre_Post_Excel(user_Id ?? 0, order_Processing_Summary);

                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    var excelPath = string.Empty;

                    string filename = string.Empty;

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in dt_Order.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadStockExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }

                    if (order_Processing_Summary.Module_Id == "PR")
                    {
                        filename = "Pre_Order_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    }
                    else
                    {
                        filename = "Post_Order_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    }

                    EpExcelExport.Create_Order_Processing_Excel_Pre_Post(dt_Order, filePath, filePath + filename);

                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadStockExcelFilesPath + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Excel_Export_Pre_Post", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_company_name")]
        [Authorize]
        public async Task<IActionResult> Get_Company_Name()
        {
            try
            {
                var result = await _supplierService.Get_Company_Name();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Company_Name", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_final_order")]
        [Authorize]
        public async Task<IActionResult> Get_Final_Order(Final_Order_Model final_Order_Model)
        {
            try
            {
                var result = await _supplierService.Get_Final_Order(final_Order_Model);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Final_Order", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("order_processing_status_update")]
        [Authorize]
        public async Task<IActionResult> Order_Processing_Status_Update(Order_Processing_Status_Model order_Processing_Status_Model)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                    if (string.IsNullOrEmpty(order_Processing_Status_Model.current_cost_disc) && string.IsNullOrEmpty(order_Processing_Status_Model.current_cost_amt))
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = "Both current cost discount and amount cannot be null"
                        });
                    }
                    else if (string.IsNullOrEmpty(order_Processing_Status_Model.current_cost_disc))
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = "Current cost discount cannot be null"
                        });
                    }
                    else if (string.IsNullOrEmpty(order_Processing_Status_Model.current_cost_amt))
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = "Current cost amount cannot be null"
                        });
                    }
                    else if (string.IsNullOrEmpty(order_Processing_Status_Model.offer_disc))
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = "Offer discount cannot be null"
                        });
                    }
                    else if (string.IsNullOrEmpty(order_Processing_Status_Model.offer_amt))
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = "Offer amount cannot be null"
                        });
                    }
                    else
                    {
                        var result = await _supplierService.Order_Processing_Status_Update(order_Processing_Status_Model, user_Id ?? 0);
                        if (result > 0)
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.StatusChangedSuccessMessage
                            });
                        }
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Processing_Status_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("final_order_processing_create_update")]
        [Authorize]
        public async Task<IActionResult> Final_Order_Processing_Create_Update(IFormFile? File_Location)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("ORDER_COST_DISC", typeof(string));
                dataTable.Columns.Add("ORDER_COST_AMT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMT", typeof(string));
                if (File_Location != null)
                {
                    var filePath = Path.GetTempFileName();
                    using (var stream = new FileStream(filePath, FileMode.Create))
                    {
                        await File_Location.CopyToAsync(stream);
                    }
                    using (var package = new ExcelPackage(new FileInfo(filePath)))
                    {
                        var worksheet = package.Workbook.Worksheets[0];
                        int startRow = 2;

                        HashSet<string> uniqueValues = new HashSet<string>();
                        for (int row = startRow; row <= worksheet.Dimension.End.Row; row++)
                        {
                            string value = worksheet.Cells[row, 1].GetValue<string>();
                            string order_cost_amt = worksheet.Cells[row, 3].GetValue<string>();
                            string offer_amt = worksheet.Cells[row, 5].GetValue<string>();
                            if (!uniqueValues.Contains(value))
                            {
                                uniqueValues.Add(value);
                                dataTable.Rows.Add(value, worksheet.Cells[row, 2].GetValue<string>(), !string.IsNullOrEmpty(order_cost_amt) ? order_cost_amt.Replace(",", "") : DBNull.Value, worksheet.Cells[row, 4].GetValue<string>(), !string.IsNullOrEmpty(offer_amt) ? offer_amt.Replace(",", "") : DBNull.Value);
                            }
                        }
                        var uniqueRows = dataTable.AsEnumerable()
                                  .GroupBy(row => row.Field<string>("STOCK_ID"))
                                  .Select(grp => grp.First())
                                  .CopyToDataTable();
                    }
                }

                var result = await _supplierService.Final_Order_Processing_Create_Update(dataTable, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.OrderProcessingFinalUpdate
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Final_Order_Processing_Create_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("final_order_processing_create_update")]
        [Authorize]
        public async Task<IActionResult> Final_Order_Processing_Create_Update([FromBody] object order_Processing_Final)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Order_Processing_Final> OrderResult = JsonConvert.DeserializeObject<IList<Order_Processing_Final>>(order_Processing_Final.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("STOCK_ID", typeof(string));
                dataTable.Columns.Add("ORDER_COST_DISC", typeof(string));
                dataTable.Columns.Add("ORDER_COST_AMT", typeof(string));
                dataTable.Columns.Add("OFFER_DISC", typeof(string));
                dataTable.Columns.Add("OFFER_AMT", typeof(string));

                foreach (var item in OrderResult)
                {
                    dataTable.Rows.Add(item.SuppStockId,
                        (item.Cost_Disc != null ? !string.IsNullOrEmpty(item.Cost_Disc.ToString()) ? Convert.ToDouble(item.Cost_Disc.ToString()) : null : null),
                        (item.Cost_Amount != null ? !string.IsNullOrEmpty(item.Cost_Amount.ToString()) ? Convert.ToDouble(item.Cost_Amount.ToString()) : null : null),
                        (item.Offer_Disc != null ? !string.IsNullOrEmpty(item.Offer_Disc.ToString()) ? Convert.ToDouble(item.Offer_Disc.ToString()) : null : null),
                        (item.Offer_Amount != null ? !string.IsNullOrEmpty(item.Offer_Amount.ToString()) ? Convert.ToDouble(item.Offer_Amount.ToString()) : null : null));
                }

                var result = await _supplierService.Final_Order_Processing_Create_Update_Save(dataTable, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.OrderProcessingFinalUpdate
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Final_Order_Processing_Create_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_lab_entry_detail_for_shipment")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Entry_Detail_For_Shipment(Lab_Entry_Detail_For_Shipment lab_Entry_Detail_For_Shipment)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Lab_Entry_Detail_For_Shipment_Verification(lab_Entry_Detail_For_Shipment.Supplier_Id ?? 0, lab_Entry_Detail_For_Shipment.Certificate_No);

                var result_Message = await _supplierService.Get_Unavailable_Lab_Entry_Detail_For_Shipment_Verification(lab_Entry_Detail_For_Shipment.Certificate_No);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Entry_Detail_For_Shipment", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_lab_entry_detail_for_shipment_gia")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Entry_Detail_For_Shipment_GIA(Lab_Entry_Detail_For_Shipment lab_Entry_Detail_For_Shipment)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Lab_Entry_Detail_For_Shipment_Verification_By_Id(lab_Entry_Detail_For_Shipment.Lab_Entry_Detail_Id);

                if (result != null && result.Count > 0)
                {
                    List<Dictionary<string, object>> matchedRecords = new List<Dictionary<string, object>>();

                    List<Dictionary<string, object>> finalRecords = new List<Dictionary<string, object>>();

                    var certificateNos = result.Select(entry => entry["CERTIFICATE NO"].ToString()).ToList();

                    string finalCertificateNos = string.Join(",", certificateNos);

                    GIA_Certificate_Parameter_Model gIA_Certificate_Parameter_Model = new GIA_Certificate_Parameter_Model();
                    gIA_Certificate_Parameter_Model.cert_no = finalCertificateNos;

                    var gia = await Get_GIA_Cert_Data(gIA_Certificate_Parameter_Model, null);

                    if (gia != null)
                    {
                        var shape_values = await _categoryService.GetCategoryValuesByCatId(13);
                        var color_values = await _categoryService.GetCategoryValuesByCatId(14);
                        var clarity_values = await _categoryService.GetCategoryValuesByCatId(15);
                        var cut_values = await _categoryService.GetCategoryValuesByCatId(16);
                        var polish_values = await _categoryService.GetCategoryValuesByCatId(17);
                        var symm_values = await _categoryService.GetCategoryValuesByCatId(19);
                        var fls_values = await _categoryService.GetCategoryValuesByCatId(21);
                        var culet_values = await _categoryService.GetCategoryValuesByCatId(37);

                        if (gia is OkObjectResult okResult)
                        {
                            var json = JsonConvert.SerializeObject(okResult.Value);
                            GiaResponse response = JsonConvert.DeserializeObject<GiaResponse>(json);

                            var shape = JsonConvert.SerializeObject(shape_values);
                            List<Category_Value> category_Value_Shape = JsonConvert.DeserializeObject<List<Category_Value>>(shape);

                            var color = JsonConvert.SerializeObject(color_values);
                            List<Category_Value> category_Value_Color = JsonConvert.DeserializeObject<List<Category_Value>>(color);

                            var clarity = JsonConvert.SerializeObject(clarity_values);
                            List<Category_Value> category_Value_Clarity = JsonConvert.DeserializeObject<List<Category_Value>>(clarity);

                            var cut = JsonConvert.SerializeObject(cut_values);
                            List<Category_Value> category_Value_Cut = JsonConvert.DeserializeObject<List<Category_Value>>(cut);

                            var polish = JsonConvert.SerializeObject(polish_values);
                            List<Category_Value> category_Value_Polish = JsonConvert.DeserializeObject<List<Category_Value>>(polish);

                            var symm = JsonConvert.SerializeObject(symm_values);
                            List<Category_Value> category_Value_Symm = JsonConvert.DeserializeObject<List<Category_Value>>(symm);

                            var fls = JsonConvert.SerializeObject(fls_values);
                            List<Category_Value> category_Value_Fls = JsonConvert.DeserializeObject<List<Category_Value>>(fls);

                            var culet = JsonConvert.SerializeObject(culet_values);
                            List<Category_Value> category_Value_Culet = JsonConvert.DeserializeObject<List<Category_Value>>(culet);

                            var certificateDict = result.GroupBy(r => r["CERTIFICATE NO"].ToString()).ToDictionary(g => g.Key, g => g.First());

                            foreach (var certificate in response.Data)
                            {
                                if (certificateDict.ContainsKey(certificate.CertificateNo))
                                {
                                    var matchingEntry = certificateDict[certificate.CertificateNo];

                                    decimal? ctsResult = matchingEntry["CTS"] != null ? Convert.ToDecimal(matchingEntry["CTS"]) : (decimal?)null;
                                    string ctsResultFormatted = ctsResult.HasValue ? ctsResult.Value.ToString("F2") : null;

                                    decimal? ctsCertificate = (decimal?)certificate.CTS;
                                    string ctsCertificateFormatted = ctsCertificate.HasValue ? ctsCertificate.Value.ToString("F2") : null;

                                    string shapeResult = matchingEntry["SHAPE"]?.ToString();
                                    string colorResult = matchingEntry["COLOR"]?.ToString();
                                    string clarityResult = matchingEntry["CLARITY"]?.ToString();
                                    string cutResult = matchingEntry["CUT"]?.ToString();
                                    string polishResult = matchingEntry["POLISH"]?.ToString();
                                    string symmResult = matchingEntry["SYMM"]?.ToString();
                                    string flsResult = matchingEntry["FLS INTENSITY"]?.ToString();
                                    string culetResult = matchingEntry["CULET"]?.ToString();

                                    var matchingShape = category_Value_Shape.FirstOrDefault(shape =>
                                    shape.Cat_Name.Equals(certificate.Shape, StringComparison.OrdinalIgnoreCase) ||
                                    (shape.Synonyms != null && shape.Synonyms.Split(',')
                                        .Any(s => s.Trim().Equals(certificate.Shape, StringComparison.OrdinalIgnoreCase))));

                                    var matchingColor = category_Value_Color.FirstOrDefault(color =>
                                        color.Cat_Name.Equals(certificate.Color, StringComparison.OrdinalIgnoreCase) ||
                                        (color.Synonyms != null && color.Synonyms.Split(',')
                                            .Any(s => s.Trim().Equals(certificate.Color, StringComparison.OrdinalIgnoreCase))));

                                    var matchingClarity = category_Value_Clarity.FirstOrDefault(clarity =>
                                        clarity.Cat_Name.Equals(certificate.Clarity, StringComparison.OrdinalIgnoreCase) ||
                                        (clarity.Synonyms != null && clarity.Synonyms.Split(',')
                                            .Any(s => s.Trim().Equals(certificate.Clarity, StringComparison.OrdinalIgnoreCase))));

                                    var matchingCut = category_Value_Cut.FirstOrDefault(cut =>
                                        cut.Cat_Name.Equals(certificate.Cut, StringComparison.OrdinalIgnoreCase) ||
                                        (cut.Synonyms != null && cut.Synonyms.Split(',')
                                            .Any(s => s.Trim().Equals(certificate.Cut, StringComparison.OrdinalIgnoreCase))));

                                    var matchingPolish = category_Value_Polish.FirstOrDefault(polish =>
                                        polish.Cat_Name.Equals(certificate.Polish, StringComparison.OrdinalIgnoreCase) ||
                                        (polish.Synonyms != null && polish.Synonyms.Split(',')
                                            .Any(s => s.Trim().Equals(certificate.Polish, StringComparison.OrdinalIgnoreCase))));

                                    var matchingSymm = category_Value_Symm.FirstOrDefault(symm =>
                                        symm.Cat_Name.Equals(certificate.Symm, StringComparison.OrdinalIgnoreCase) ||
                                        (symm.Synonyms != null && symm.Synonyms.Split(',')
                                            .Any(s => s.Trim().Equals(certificate.Symm, StringComparison.OrdinalIgnoreCase))));

                                    var matchingFls = category_Value_Fls.FirstOrDefault(fls =>
                                        fls.Cat_Name.Equals(certificate.FlsIntensity, StringComparison.OrdinalIgnoreCase) ||
                                        (fls.Synonyms != null && fls.Synonyms.Split(',')
                                            .Any(s => s.Trim().Equals(certificate.FlsIntensity, StringComparison.OrdinalIgnoreCase))));

                                    var matchingCulet = category_Value_Culet.FirstOrDefault(culet =>
                                        culet.Cat_Name.Equals(certificate.Culet, StringComparison.OrdinalIgnoreCase) ||
                                        (culet.Synonyms != null && culet.Synonyms.Split(',')
                                            .Any(s => s.Trim().Equals(certificate.Culet, StringComparison.OrdinalIgnoreCase))));

                                    string shapeCertificate = matchingShape?.Cat_Name ?? certificate.Shape;
                                    string colorCertificate = matchingColor?.Cat_Name ?? certificate.Color;
                                    string clarityCertificate = matchingClarity?.Cat_Name ?? certificate.Clarity;
                                    string cutCertificate = matchingCut?.Cat_Name ?? certificate.Cut;
                                    string polishCertificate = matchingPolish?.Cat_Name ?? certificate.Polish;
                                    string symmCertificate = matchingSymm?.Cat_Name ?? certificate.Symm;
                                    string flsCertificate = matchingFls?.Cat_Name ?? certificate.FlsIntensity;
                                    string culetCertificate = matchingCulet?.Cat_Name ?? certificate.Culet;
                                    int shapeCertificate_Id = matchingShape?.Cat_val_Id ?? 0;
                                    int colorCertificate_Id = matchingColor?.Cat_val_Id ?? 0;
                                    int clarityCertificate_Id = matchingClarity?.Cat_val_Id ?? 0;
                                    int cutCertificate_Id = matchingCut?.Cat_val_Id ?? 0;
                                    int polishCertificate_Id = matchingPolish?.Cat_val_Id ?? 0;
                                    int symmCertificate_Id = matchingSymm?.Cat_val_Id ?? 0;
                                    int flsCertificate_Id = matchingFls?.Cat_val_Id ?? 0;
                                    int culetCertificate_Id = matchingCulet?.Cat_val_Id ?? 0;

                                    if (cutCertificate == "EX" && polishCertificate == "EX" && symmCertificate == "EX")
                                    {
                                        cutCertificate = "3EX";

                                        var cut_Certificate_Id = category_Value_Cut.FirstOrDefault(cut =>
                                                            cut.Cat_Name.Equals(cutCertificate, StringComparison.OrdinalIgnoreCase) ||
                                                            (cut.Synonyms != null && cut.Synonyms.Split(',')
                                                                .Any(s => s.Trim().Equals(cutCertificate, StringComparison.OrdinalIgnoreCase))));

                                        cutCertificate_Id = cut_Certificate_Id?.Cat_val_Id ?? 0;
                                    }

                                    bool attributesMatch =
                                        string.Equals(shapeResult, shapeCertificate, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(colorResult, colorCertificate, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(clarityResult, clarityCertificate, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(ctsResultFormatted, ctsCertificateFormatted, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(cutResult, cutCertificate, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(polishResult, polishCertificate, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(symmResult, symmCertificate, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(flsResult, flsCertificate, StringComparison.OrdinalIgnoreCase) &&
                                        string.Equals(culetResult, culetCertificate, StringComparison.OrdinalIgnoreCase);

                                    if (attributesMatch)
                                    {
                                        matchedRecords.Add(matchingEntry);
                                    }
                                    else
                                    {
                                        matchingEntry["GIA_SHAPE"] = shapeCertificate;
                                        matchingEntry["GIA_COLOR"] = colorCertificate;
                                        matchingEntry["GIA_CLARITY"] = clarityCertificate;
                                        matchingEntry["GIA_CUT"] = cutCertificate;
                                        matchingEntry["GIA_POLISH"] = polishCertificate;
                                        matchingEntry["GIA_SYMM"] = symmCertificate;
                                        matchingEntry["GIA_FLS_INTENSITY"] = flsCertificate;
                                        matchingEntry["GIA_CULET"] = culetCertificate;
                                        matchingEntry["GIA_CTS"] = ctsCertificateFormatted;
                                        matchingEntry["GIA_SHAPE_ID"] = shapeCertificate_Id;
                                        matchingEntry["GIA_COLOR_ID"] = colorCertificate_Id;
                                        matchingEntry["GIA_CLARITY_ID"] = clarityCertificate_Id;
                                        matchingEntry["GIA_CUT_ID"] = cutCertificate_Id;
                                        matchingEntry["GIA_POLISH_ID"] = polishCertificate_Id;
                                        matchingEntry["GIA_SYMM_ID"] = symmCertificate_Id;
                                        matchingEntry["GIA_FLS_INTENSITY_ID"] = flsCertificate_Id;
                                        matchingEntry["GIA_CULET_ID"] = culetCertificate_Id;

                                        finalRecords.Add(matchingEntry);
                                    }

                                    string certificateLink = certificate.CertificateLink;

                                    if (!string.IsNullOrWhiteSpace(certificateLink))
                                    {

                                        var filePath = Path.Combine(Directory.GetCurrentDirectory(), CoreCommonFilePath.CertificatesFilePath);
                                        if (!(Directory.Exists(filePath)))
                                        {
                                            Directory.CreateDirectory(filePath);
                                        }
                                        string filename = "/" + certificate.CertificateNo + ".pdf";
                                        filePath += filename;
                                        var path = _configuration["BaseUrl"] + "/Files/Image" + filename;
                                        try
                                        {
                                            using (WebClient client = new WebClient())
                                            {
                                                client.DownloadFile(certificateLink, filePath);
                                            }
                                        }
                                        catch (Exception)
                                        {

                                        }
                                    }
                                }
                            }

                            foreach (var certificate in result)
                            {
                                if (!response.Data.Any(c => c.CertificateNo == certificate["CERTIFICATE NO"].ToString()))
                                {
                                    matchedRecords.Add(certificate);
                                }
                            }
                        }
                        else
                        {
                            foreach (var certificate in result)
                            {
                                matchedRecords.Add(certificate);
                            }
                        }
                    }
                    else
                    {
                        foreach (var certificate in result)
                        {
                            matchedRecords.Add(certificate);
                        }
                    }

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = new
                        {
                            Lab_Entry_Detail_List = matchedRecords,
                            GIA_Lab_Entry_Detail_List = finalRecords
                        }
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Entry_Detail_For_Shipment_GIA", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_purchase_expenses_dropdown")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Expenses_DropDown(int Process_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Expenses_DropDown(Process_Id);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Expenses_DropDown", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }


        [HttpPost]
        [Route("create_update_purchase")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Purchase(Purchase_Master_Model purchase_Master_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                Purchase_Master purchase_Master = JsonConvert.DeserializeObject<Purchase_Master>(purchase_Master_Model.Purchase_Master.ToString());

                IList<Purchase_Detail> purchase_Detail_List = JsonConvert.DeserializeObject<IList<Purchase_Detail>>(purchase_Master_Model.Purchase_Detail_List.ToString());

                IList<Purchase_Expenses> purchase_Expenses_List = JsonConvert.DeserializeObject<IList<Purchase_Expenses>>(purchase_Master_Model.Purchase_Expenses_List.ToString());

                IList<Purchase_Terms> purchase_Terms_List = JsonConvert.DeserializeObject<IList<Purchase_Terms>>(purchase_Master_Model.Purchase_Terms_List.ToString());

                IList<Purchase_Detail_Loose> purchase_Detail_Loose_List = JsonConvert.DeserializeObject<IList<Purchase_Detail_Loose>>(purchase_Master_Model.Purchase_Detail_Loose_List.ToString());

                string dateFormat = "dd-MM-yyyy";

                DateTime Trans_Dt;

                if (!DateTime.TryParseExact(purchase_Master.Trans_Date, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Trans_Dt))
                {
                    Trans_Dt = DateTime.MinValue;
                }

                DateTime Supplier_Doc_Dt;

                if (!DateTime.TryParseExact(purchase_Master.Supplier_Doc_Date, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Supplier_Doc_Dt))

                {
                    Supplier_Doc_Dt = DateTime.MinValue;
                }

                DataTable masterDataTable = new DataTable();
                masterDataTable.Columns.Add("Trans_Id", typeof(int));
                masterDataTable.Columns.Add("Trans_Date", typeof(DateTime));
                masterDataTable.Columns.Add("Trans_Time", typeof(TimeSpan));
                masterDataTable.Columns.Add("Year_Id", typeof(int));
                masterDataTable.Columns.Add("Trans_Type", typeof(string));
                masterDataTable.Columns.Add("Doc_Type", typeof(string));
                masterDataTable.Columns.Add("Supplier_Doc_Date", typeof(DateTime));
                masterDataTable.Columns.Add("Supplier_Doc_Time", typeof(TimeSpan));
                masterDataTable.Columns.Add("Supplier_Invoice_No", typeof(string));
                masterDataTable.Columns.Add("Internal_Invoice_No", typeof(string));
                masterDataTable.Columns.Add("Supplier_Id", typeof(int));
                masterDataTable.Columns.Add("Company_Id", typeof(int));
                masterDataTable.Columns.Add("Currency_Id", typeof(int));
                masterDataTable.Columns.Add("Exchange_Id", typeof(int));
                masterDataTable.Columns.Add("Ex_Rate", typeof(float));
                masterDataTable.Columns.Add("Process_Id", typeof(int));
                masterDataTable.Columns.Add("Shipment_Type", typeof(string));
                masterDataTable.Columns.Add("ETA_Days", typeof(int));
                masterDataTable.Columns.Add("Contract", typeof(bool));
                masterDataTable.Columns.Add("Invoice_Amount", typeof(decimal));

                masterDataTable.Rows.Add(
                    purchase_Master.Trans_Id ?? 0,
                    Trans_Dt != null ? Trans_Dt : null,
                    purchase_Master.Trans_Time ?? null,
                    purchase_Master.Year_Id ?? null,
                    purchase_Master.Trans_Type ?? null,
                    purchase_Master.Doc_Type ?? null,
                    Supplier_Doc_Dt != null ? Supplier_Doc_Dt : null,
                    purchase_Master.Supplier_Doc_Time ?? null,
                    purchase_Master.Supplier_Invoice_No ?? null,
                    purchase_Master.Internal_Invoice_No ?? null,
                    purchase_Master.Supplier_Id ?? null,
                    purchase_Master.Company_Id ?? null,
                    purchase_Master.Currency_Id ?? null,
                    purchase_Master.Exchange_Id ?? null,
                    purchase_Master.Ex_Rate ?? null,
                    purchase_Master.Process_Id ?? null,
                    purchase_Master.Shipment_Type ?? null,
                    purchase_Master.ETA_Days ?? null,
                    purchase_Master.Contract ?? null,
                    SafeConvertToDouble(purchase_Master.Invoice_Amount) ?? null
                );

                DataTable detailDataTable = new DataTable();

                detailDataTable.Columns.Add("Id", typeof(int));
                detailDataTable.Columns.Add("Trans_Id", typeof(int));
                detailDataTable.Columns.Add("Lab_Entry_Detail_Id", typeof(int));
                detailDataTable.Columns.Add("Stock_Id", typeof(string));
                detailDataTable.Columns.Add("Cert_No", typeof(string));
                detailDataTable.Columns.Add("Supplier_Id", typeof(int));
                detailDataTable.Columns.Add("Supplier_Name", typeof(string));
                detailDataTable.Columns.Add("Supplier_Short_Name", typeof(string));
                detailDataTable.Columns.Add("Supplier_Ref_No", typeof(string));
                detailDataTable.Columns.Add("Status", typeof(string));
                detailDataTable.Columns.Add("Remarks", typeof(string));
                detailDataTable.Columns.Add("Buyer", typeof(int));
                detailDataTable.Columns.Add("Lab", typeof(int));
                detailDataTable.Columns.Add("Shape", typeof(int));
                detailDataTable.Columns.Add("BGM", typeof(int));
                detailDataTable.Columns.Add("Color", typeof(int));
                detailDataTable.Columns.Add("Clarity", typeof(int));
                detailDataTable.Columns.Add("Cts", typeof(float));
                detailDataTable.Columns.Add("Rap_Rate", typeof(decimal));
                detailDataTable.Columns.Add("Rap_Amt", typeof(decimal));
                detailDataTable.Columns.Add("Supplier_Base_Disc", typeof(float));
                detailDataTable.Columns.Add("Supplier_Base_Amt", typeof(decimal));
                detailDataTable.Columns.Add("Supplier_Cost_Disc", typeof(float));
                detailDataTable.Columns.Add("Supplier_Cost_Amt", typeof(decimal));
                detailDataTable.Columns.Add("Offer_Disc", typeof(float));
                detailDataTable.Columns.Add("Offer_Amt", typeof(decimal));
                detailDataTable.Columns.Add("Cut", typeof(int));
                detailDataTable.Columns.Add("Polish", typeof(int));
                detailDataTable.Columns.Add("Symm", typeof(int));
                detailDataTable.Columns.Add("Flour_Intensity", typeof(int));
                detailDataTable.Columns.Add("Length", typeof(float));
                detailDataTable.Columns.Add("Width", typeof(float));
                detailDataTable.Columns.Add("Depth", typeof(float));
                detailDataTable.Columns.Add("Depth_Per", typeof(float));
                detailDataTable.Columns.Add("Table_Per", typeof(float));
                detailDataTable.Columns.Add("Key_to_Symbol", typeof(string));
                detailDataTable.Columns.Add("Additional_Comment", typeof(string));
                detailDataTable.Columns.Add("Girdle_Per", typeof(float));
                detailDataTable.Columns.Add("Crown_Angle", typeof(float));
                detailDataTable.Columns.Add("Crown_Height", typeof(float));
                detailDataTable.Columns.Add("Pavillion_Angle", typeof(float));
                detailDataTable.Columns.Add("Pavillion_Height", typeof(float));
                detailDataTable.Columns.Add("Table_Black", typeof(int));
                detailDataTable.Columns.Add("Crown_Black", typeof(int));
                detailDataTable.Columns.Add("Table_White", typeof(int));
                detailDataTable.Columns.Add("Crown_White", typeof(int));
                detailDataTable.Columns.Add("Culet", typeof(int));
                detailDataTable.Columns.Add("Table_Open", typeof(int));
                detailDataTable.Columns.Add("Crown_Open", typeof(int));
                detailDataTable.Columns.Add("Pav_Open", typeof(int));
                detailDataTable.Columns.Add("Girdle_Open", typeof(int));
                detailDataTable.Columns.Add("Cert_Date", typeof(DateTime));
                detailDataTable.Columns.Add("Cert_Type", typeof(int));
                detailDataTable.Columns.Add("LR_Half", typeof(float));
                detailDataTable.Columns.Add("Str_Ln", typeof(float));
                detailDataTable.Columns.Add("Fancy_Color", typeof(int));
                detailDataTable.Columns.Add("Fancy_Intensity", typeof(int));
                detailDataTable.Columns.Add("Fancy_Overtone", typeof(int));
                detailDataTable.Columns.Add("Rough_Origin", typeof(int));
                detailDataTable.Columns.Add("Image", typeof(string));
                detailDataTable.Columns.Add("Video", typeof(string));
                detailDataTable.Columns.Add("Cert_Link", typeof(string));
                detailDataTable.Columns.Add("DNA", typeof(string));
                detailDataTable.Columns.Add("Cert_Type_Link", typeof(string));
                detailDataTable.Columns.Add("Lab_C", typeof(string));
                detailDataTable.Columns.Add("Shape_C", typeof(string));
                detailDataTable.Columns.Add("BGM_C", typeof(string));
                detailDataTable.Columns.Add("Color_C", typeof(string));
                detailDataTable.Columns.Add("Clarity_C", typeof(string));
                detailDataTable.Columns.Add("Cut_C", typeof(string));
                detailDataTable.Columns.Add("Polish_C", typeof(string));
                detailDataTable.Columns.Add("Symm_C", typeof(string));
                detailDataTable.Columns.Add("Flour_Intensity_C", typeof(string));
                detailDataTable.Columns.Add("Table_Black_C", typeof(string));
                detailDataTable.Columns.Add("Crown_Black_C", typeof(string));
                detailDataTable.Columns.Add("Table_White_C", typeof(string));
                detailDataTable.Columns.Add("Crown_White_C", typeof(string));
                detailDataTable.Columns.Add("Culet_C", typeof(string));
                detailDataTable.Columns.Add("Table_Open_C", typeof(string));
                detailDataTable.Columns.Add("Crown_Open_C", typeof(string));
                detailDataTable.Columns.Add("Pav_Open_C", typeof(string));
                detailDataTable.Columns.Add("Girdle_Open_C", typeof(string));
                detailDataTable.Columns.Add("Cert_Type_C", typeof(string));
                detailDataTable.Columns.Add("Fancy_Color_C", typeof(string));
                detailDataTable.Columns.Add("Fancy_Intensity_C", typeof(string));
                detailDataTable.Columns.Add("Fancy_Overtone_C", typeof(string));
                detailDataTable.Columns.Add("Rough_Origin_C", typeof(string));
                detailDataTable.Columns.Add("Laser_Insc", typeof(int));
                detailDataTable.Columns.Add("Laser_Insc_C", typeof(string));
                detailDataTable.Columns.Add("Girdle_Condition", typeof(int));
                detailDataTable.Columns.Add("Girdle_Condition_C", typeof(string));
                detailDataTable.Columns.Add("Stone_Status", typeof(string));
                detailDataTable.Columns.Add("Shipment_Type", typeof(string));
                detailDataTable.Columns.Add("Purchase_Doc_No", typeof(string));
                detailDataTable.Columns.Add("Expected_Delivery_Date", typeof(DateTime));
                detailDataTable.Columns.Add("Web_Disc", typeof(float));
                detailDataTable.Columns.Add("Web_Amount", typeof(decimal));
                detailDataTable.Columns.Add("Sunrise_Stock_Id", typeof(string));
                detailDataTable.Columns.Add("Sunrise_Status", typeof(string));
                detailDataTable.Columns.Add("RFID_No", typeof(string));
                detailDataTable.Columns.Add("Supp_Verified_Disc", typeof(float));
                detailDataTable.Columns.Add("Supp_Verified_Amount", typeof(decimal));
                detailDataTable.Columns.Add("Company", typeof(string));
                detailDataTable.Columns.Add("Sunrise_Offer_Disc", typeof(float));
                detailDataTable.Columns.Add("Sunrise_Offer_Amt", typeof(decimal));
                detailDataTable.Columns.Add("Actual_Cost_Disc", typeof(float));
                detailDataTable.Columns.Add("Actual_Cost_Amt", typeof(decimal));
                detailDataTable.Columns.Add("Type", typeof(string));
                detailDataTable.Columns.Add("Assist_By", typeof(int));
                detailDataTable.Columns.Add("Company_Name_Id", typeof(int));
                detailDataTable.Columns.Add("Company_Name", typeof(string));
                detailDataTable.Columns.Add("Milky", typeof(int));
                detailDataTable.Columns.Add("Milky_C", typeof(string));
                detailDataTable.Columns.Add("Shade", typeof(int));
                detailDataTable.Columns.Add("Shade_C", typeof(string));

                foreach (var item in purchase_Detail_List)
                {

                    DateTime Valid_Date;

                    if (!DateTime.TryParseExact(item.CertificateDate, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Valid_Date))
                    {
                        Valid_Date = DateTime.MinValue;
                    }

                    DateTime Expected_Delivery_Date;

                    if (!DateTime.TryParseExact(item.Expected_Delivery_Date, dateFormat, CultureInfo.InvariantCulture, DateTimeStyles.None, out Expected_Delivery_Date))
                    {
                        Expected_Delivery_Date = DateTime.MinValue;
                    }

                    detailDataTable.Rows.Add(
                        item.Id ?? 0,
                        item.TransId ?? 0,
                        item.Lab_Entry_Detail_Id ?? 0,
                        item.StockId,
                        item.CertificateNo,
                        item.SupplierId != null ? Convert.ToInt32(item.SupplierId) : null,
                        item.SupplierName ?? null,
                        item.SupplierShortName ?? null,
                        item.SupplierNo ?? null,
                        item.Status ?? null,
                        item.Remarks ?? null,
                        item.BuyerCode != null ? Convert.ToInt32(item.BuyerCode) : null,
                        item.LabId != null ? Convert.ToInt32(item.LabId) : null,
                        item.ShapeId != null ? Convert.ToInt32(item.ShapeId) : null,
                        item.BgmId != null ? Convert.ToInt32(item.BgmId) : null,
                        item.ColorId != null ? Convert.ToInt32(item.ColorId) : null,
                        item.ClarityId != null ? Convert.ToInt32(item.ClarityId) : null,
                        SafeConvertToDouble(item.Cts?.ToString()),
                        SafeConvertToDouble(item.RapRate?.ToString()),
                        SafeConvertToDouble(item.RapAmount?.ToString()),
                        SafeConvertToDouble(item.BaseDisc?.ToString()),
                        SafeConvertToDouble(item.BaseAmount?.ToString()),
                        SafeConvertToDouble(item.CostDisc?.ToString()),
                        SafeConvertToDouble(item.CostAmount?.ToString()),
                        SafeConvertToDouble(item.OfferDisc?.ToString()),
                        SafeConvertToDouble(item.OfferAmount?.ToString()),
                        item.CutId != null ? Convert.ToInt32(item.CutId) : null,
                        item.PolishId != null ? Convert.ToInt32(item.PolishId) : null,
                        item.SymmId != null ? Convert.ToInt32(item.SymmId) : null,
                        item.FlsintensityId != null ? Convert.ToInt32(item.FlsintensityId) : null,
                        SafeConvertToDouble(item.Length?.ToString()),
                        SafeConvertToDouble(item.Width?.ToString()),
                        SafeConvertToDouble(item.Depth?.ToString()),
                        SafeConvertToDouble(item.DepthPer?.ToString()),
                        SafeConvertToDouble(item.TablePer?.ToString()),
                        item.KeyToSymbol ?? null,
                        item.GiaComments ?? null,
                        SafeConvertToDouble(item.GirdlePer?.ToString()),
                        SafeConvertToDouble(item.CrownAngle?.ToString()),
                        SafeConvertToDouble(item.CrownHeight?.ToString()),
                        SafeConvertToDouble(item.PavilionAngle?.ToString()),
                        SafeConvertToDouble(item.PavilionHeight?.ToString()),
                        item.TableBlackId != null ? Convert.ToInt32(item.TableBlackId) : null,
                        item.CrownBlackId != null ? Convert.ToInt32(item.CrownBlackId) : null,
                        item.TableWhiteId != null ? Convert.ToInt32(item.TableWhiteId) : null,
                        item.CrownWhiteId != null ? Convert.ToInt32(item.CrownWhiteId) : null,
                        item.CuletId != null ? Convert.ToInt32(item.CuletId) : null,
                        item.TableOpenId != null ? Convert.ToInt32(item.TableOpenId) : null,
                        item.CrownOpenId != null ? Convert.ToInt32(item.CrownOpenId) : null,
                        item.PavOpenId != null ? Convert.ToInt32(item.PavOpenId) : null,
                        item.GirdleOpenId != null ? Convert.ToInt32(item.GirdleOpenId) : null,
                        Valid_Date != null ? Convert.ToDateTime(Valid_Date) : null,
                        item.CertTypeId != null ? Convert.ToInt32(item.CertTypeId) : null,
                        SafeConvertToDouble(item.LrHalf?.ToString()),
                        SafeConvertToDouble(item.StarLn?.ToString()),
                        item.FancyColorId != null ? Convert.ToInt32(item.FancyColorId) : null,
                        item.FancyintensityId != null ? Convert.ToInt32(item.FancyintensityId) : null,
                        item.FancyOvertoneId != null ? Convert.ToInt32(item.FancyOvertoneId) : null,
                        item.RoughOriginId != null ? Convert.ToInt32(item.RoughOriginId) : null,
                        item.ImageLink ?? null,
                        item.VideoLink ?? null,
                        item.CertificateLink ?? null,
                        item.Dna ?? null,
                        item.CertTypeLink ?? null,
                        item.Lab ?? null,
                        item.Shape ?? null,
                        item.Bgm ?? null,
                        item.Color ?? null,
                        item.Clarity ?? null,
                        item.Cut ?? null,
                        item.Polish ?? null,
                        item.Symm ?? null,
                        item.Flsintensity ?? null,
                        item.TableBlack ?? null,
                        item.SideBlack ?? null,
                        item.TableWhite ?? null,
                        item.SideWhite ?? null,
                        item.Culet ?? null,
                        item.TableOpen ?? null,
                        item.CrownOpen ?? null,
                        item.PavilionOpen ?? null,
                        item.GirdleOpen ?? null,
                        item.GiaType ?? null,
                        item.FancyColor ?? null,
                        item.Fancyintensity ?? null,
                        item.FancyOvertone ?? null,
                        item.RoughOrigin ?? null,
                        item.LaserInscId != null ? Convert.ToInt32(item.LaserInscId) : null,
                        item.LaserInscription ?? null,
                        item.GirdleConditionId != null ? Convert.ToInt32(item.GirdleConditionId) : null,
                        item.GirdleCondition ?? null,
                        item.Stone_Status ?? null,
                        item.Shipment_Type ?? null,
                        item.Purchase_Doc_No ?? null,
                        Expected_Delivery_Date != null ? Expected_Delivery_Date : null,
                        SafeConvertToDouble(item.Web_Disc?.ToString()),
                        SafeConvertToDouble(item.Web_Amount?.ToString()),
                        item.Sunrise_Stock_Id ?? null,
                        item.Sunrise_Status ?? null,
                        item.RFID_No ?? null,
                        SafeConvertToDouble(item.Supp_Verified_Disc?.ToString()),
                        SafeConvertToDouble(item.Supp_Verified_Amount?.ToString()),
                        item.Company ?? null,
                        SafeConvertToDouble(item.Sunrise_Offer_Disc?.ToString()),
                        SafeConvertToDouble(item.Sunrise_Offer_Amt?.ToString()),
                        (bool)(!purchase_Master.Contract) ? item.ActualCostDisc : item.CostDisc,
                        (bool)(!purchase_Master.Contract) ? item.ActualCostAmount : item.CostAmount,
                        item.Type ?? null,
                        item.Assist_By ?? null,
                        item.Company_Name_Id ?? null,
                        item.Company_Name ?? null,
                        item.Milky_Id != null ? Convert.ToInt32(item.Milky_Id) : null,
                        item.Milky ?? null,
                        item.Shade_Id != null ? Convert.ToInt32(item.Shade_Id) : null,
                        item.Shade ?? null
                    );
                }

                DataTable termsDataTable = new DataTable();
                termsDataTable.Columns.Add("Purchase_Terms_Id", typeof(int));
                termsDataTable.Columns.Add("Terms_Id", typeof(int));
                termsDataTable.Columns.Add("Amount", typeof(decimal));
                termsDataTable.Columns.Add("Purchase_Trans_Id", typeof(int));

                foreach (var item in purchase_Terms_List)
                {
                    termsDataTable.Rows.Add(
                        item.Purchase_Terms_Id ?? 0,
                        item.Terms_Id ?? 0,
                        item.Amount ?? null,
                        item.Purchase_Trans_Id ?? 0
                    );
                }

                DataTable expensesDataTable = new DataTable();
                expensesDataTable.Columns.Add("Purchase_Expenses_Id", typeof(int));
                expensesDataTable.Columns.Add("Expenses_Id", typeof(int));
                expensesDataTable.Columns.Add("Sign", typeof(string));
                expensesDataTable.Columns.Add("Percentage", typeof(decimal));
                expensesDataTable.Columns.Add("Amount", typeof(decimal));
                expensesDataTable.Columns.Add("Purchase_Trans_Id", typeof(int));

                foreach (var item in purchase_Expenses_List)
                {
                    expensesDataTable.Rows.Add(
                        item.Purchase_Expenses_Id ?? 0,
                        item.Expenses_Id ?? 0,
                        item.Sign ?? "+",
                        item.Percentage ?? null,
                        item.Amount ?? null,
                        item.Purchase_Trans_Id ?? 0
                    );
                }

                DataTable purchaseDetailLooseDataTable = new DataTable();
                purchaseDetailLooseDataTable.Columns.Add("Id", typeof(int));
                purchaseDetailLooseDataTable.Columns.Add("Trans_Id", typeof(int));
                purchaseDetailLooseDataTable.Columns.Add("Parcel_Name", typeof(int));
                purchaseDetailLooseDataTable.Columns.Add("Parcel_Type", typeof(int));
                purchaseDetailLooseDataTable.Columns.Add("Pcs", typeof(float));
                purchaseDetailLooseDataTable.Columns.Add("Cts", typeof(float));
                purchaseDetailLooseDataTable.Columns.Add("Unit", typeof(string)).MaxLength = 10;
                purchaseDetailLooseDataTable.Columns.Add("Rate_Unit", typeof(decimal));
                purchaseDetailLooseDataTable.Columns.Add("Value", typeof(decimal));

                foreach (var item in purchase_Detail_Loose_List)
                {
                    purchaseDetailLooseDataTable.Rows.Add(
                        item.Id ?? 0,
                        item.Trans_Id ?? 0,
                        item.Parcel_Name ?? 0,
                        item.Parcel_Type ?? 0,
                        item.Pcs ?? 0,
                        item.Cts ?? 0,
                        item.Unit ?? null,
                        SafeConvertToDouble(item.Rate_Unit.ToString()) ?? 0,
                        SafeConvertToDouble(item.Value.ToString()) ?? 0
                    );
                }

                var (purchase_result, Is_Exist, Exist_Certi_No) = await _supplierService.Insert_Update_Purchase(masterDataTable, detailDataTable, termsDataTable, expensesDataTable, purchaseDetailLooseDataTable, user_Id ?? 0);

                if (purchase_result == 409 && Is_Exist)
                {
                    if (Is_Exist)
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.PurchaseAlreadyExists + " Exist Certificate is " + Exist_Certi_No,
                        });
                    }
                }
                else if (purchase_result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = purchase_Master.Trans_Id > 0 ? CoreCommonMessage.Purchase_Updated : CoreCommonMessage.Purchase_Created,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });

            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Purchase", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_purchase_master")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Master(Purchase_Master_Search_Model purchase_Master_Search_Model)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Master(purchase_Master_Search_Model);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = new
                        {
                            Lab_Entry_Detail_List = result
                        }
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Master", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_purchase")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase(int? Trans_Id)
        {
            try
            {
                var result = await _supplierService.Get_Purchase(Trans_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_purchase_barcode_print")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Barcode_Print(int? Trans_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Barcode_Print(Trans_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    await _printHub.Clients.All.SendPrintCommand(user_Id ?? 0, result);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Barcode_Print", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_purchase")]
        [Authorize]
        public async Task<IActionResult> Delete_Purchase(int Trans_Id)
        {
            try
            {
                if (Trans_Id <= 0)
                {
                    return BadRequest(new
                    {
                        statusCode = HttpStatusCode.BadRequest,
                        message = CoreCommonMessage.ParameterMismatched
                    });
                }

                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var (result, isExist) = await _supplierService.Delete_Purchase(Trans_Id, user_Id ?? 0);

                if (result == 409 && isExist)
                {
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.Purchase_Cannot_Deleted
                    });
                }
                else if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Purchase_Deleted
                    });
                }

                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (SqlException ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Purchase", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_lab_entry_report_status_summary")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Entry_Report_Status_Summary(Lab_Entry_Report_Status_Model lab_Entry_Report_Status_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Lab_Entry_Report_Status_Summary(lab_Entry_Report_Status_Model.Stock_Id);
                var result_non = await _supplierService.Get_Lab_Entry_Report_Non_Status_Summary(lab_Entry_Report_Status_Model.Stock_Id);

                if ((result != null || result_non != null) && (result.Count > 0 || result_non.Count > 0))
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result.Count > 0 ? result : null,
                        data_non = result_non.Count > 0 ? "Few Stones already in shipment" : null
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Entry_Report_Status_Summary", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_lab_entry_report_status")]
        [Authorize]
        public async Task<IActionResult> Update_Lab_Entry_Report_Status(Lab_Entry_Status_List Lab_Entry_Status)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);


                IList<Lab_Entry_Status> Lab_Entry_Status_List = JsonConvert.DeserializeObject<IList<Lab_Entry_Status>>(Lab_Entry_Status.Lab_Entry_Status.ToString());

                DataTable statusDataTable = new DataTable();
                statusDataTable.Columns.Add("Id", typeof(int));
                statusDataTable.Columns.Add("Status", typeof(string));
                statusDataTable.Columns.Add("Supplier_Base_Disc", typeof(float));
                statusDataTable.Columns.Add("Supplier_Base_Amt", typeof(float));
                statusDataTable.Columns.Add("Supplier_Cost_Disc", typeof(float));
                statusDataTable.Columns.Add("Supplier_Cost_Amt", typeof(float));
                statusDataTable.Columns.Add("Offer_Disc", typeof(float));
                statusDataTable.Columns.Add("Offer_Amt", typeof(float));
                statusDataTable.Columns.Add("Supplier_Short_Name", typeof(string));
                statusDataTable.Columns.Add("BGM", typeof(int));
                statusDataTable.Columns.Add("Table_Black", typeof(int));
                statusDataTable.Columns.Add("Crown_Black", typeof(int));
                statusDataTable.Columns.Add("Table_White", typeof(int));
                statusDataTable.Columns.Add("Crown_White", typeof(int));
                statusDataTable.Columns.Add("Table_Open", typeof(int));
                statusDataTable.Columns.Add("Crown_Open", typeof(int));
                statusDataTable.Columns.Add("Pav_Open", typeof(int));
                statusDataTable.Columns.Add("Girdle_Open", typeof(int));
                statusDataTable.Columns.Add("BGM_C", typeof(string));
                statusDataTable.Columns.Add("Table_Black_C", typeof(string));
                statusDataTable.Columns.Add("Crown_Black_C", typeof(string));
                statusDataTable.Columns.Add("Table_White_C", typeof(string));
                statusDataTable.Columns.Add("Crown_White_C", typeof(string));
                statusDataTable.Columns.Add("Table_Open_C", typeof(string));
                statusDataTable.Columns.Add("Crown_Open_C", typeof(string));
                statusDataTable.Columns.Add("Pav_Open_C", typeof(string));
                statusDataTable.Columns.Add("Girdle_Open_C", typeof(string));
                statusDataTable.Columns.Add("Cert_No", typeof(string));

                foreach (var item in Lab_Entry_Status_List)
                {
                    statusDataTable.Rows.Add(
                        item.Id ?? 0,
                        item.Status,
                        SafeConvertToDouble(item.Supp_Base_Disc.ToString()),
                        SafeConvertToDouble(item.Supp_Base_Amt.ToString()),
                        SafeConvertToDouble(item.Supp_Cost_Disc.ToString()),
                        SafeConvertToDouble(item.Supp_Cost_Amt.ToString()),
                        SafeConvertToDouble(item.Final_Disc.ToString()),
                        SafeConvertToDouble(item.Final_Amt.ToString()),
                        item.Supplier_Short_Name,
                        item.BGM_Id,
                        item.Table_Black_Id,
                        item.Crown_Black_Id,
                        item.Table_White_Id,
                        item.Crown_White_Id,
                        item.Table_Open_Id,
                        item.Crown_Open_Id,
                        item.Pavilion_Open_Id,
                        item.Girdle_Open_Id,
                        item.BGM,
                        item.Table_Black,
                        item.Crown_Black,
                        item.Table_White,
                        item.Crown_White,
                        item.Table_Open,
                        item.Crown_Open,
                        item.Pavilion_Open,
                        item.Girdle_Open,
                        item.CertificateNo
                    );
                }

                var result = await _supplierService.Lab_Entry_Report_Status_Update(statusDataTable, user_Id ?? 0);
                if (result != null && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StatusChangedSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Lab_Entry_Report_Status", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_purchase_detail_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_Excel(int? Trans_Id, string Purchase_Invoice_No)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Detail_Excel(Trans_Id ?? 0);

                var pricing_result = await _supplierService.Get_Purchase_Pricing_Excel(Trans_Id ?? 0);
                Purchase_Invoice_No = Purchase_Invoice_No.Split('-')[0]; // Extracts "P00013"

                if (result != null && result.Rows.Count > 0 && pricing_result != null && pricing_result.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadShipmentVerificationExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = Purchase_Invoice_No + ".xlsx";

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in result.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }

                    List<string> pricing_columnNames = new List<string>();
                    foreach (DataColumn pricing_column in pricing_result.Columns)
                    {
                        pricing_columnNames.Add(pricing_column.ColumnName);
                    }

                    DataTable pricing_columnNamesTable = new DataTable();
                    pricing_columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string pricing_columnName in pricing_columnNames)
                    {
                        pricing_columnNamesTable.Rows.Add(pricing_columnName);
                    }

                    EpExcelExport.Create_Purchase_Detail_Excel(result, columnNamesTable, pricing_result, pricing_columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadShipmentVerificationExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                else
                {
                    return NoContent();
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_purchase_detail_contract")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_Contract(Lab_Entry_Report_Status_Model lab_Entry_Report_Status_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_Contract(lab_Entry_Report_Status_Model.Stock_Id);


                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_Contract", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_detail_contract_update")]
        [Authorize]
        public async Task<IActionResult> Purchase_Detail_Contract_Update(Purchase_Detail_Contract_List purchase_Detail_Contract_List)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Purchase_Detail_Contract> purchase_Detail_List = JsonConvert.DeserializeObject<IList<Purchase_Detail_Contract>>(purchase_Detail_Contract_List.Purchase_Detail_Contract.ToString());

                DataTable purchase_Detail_Contract_DataTable = new DataTable();
                purchase_Detail_Contract_DataTable.Columns.Add("Id", typeof(int));
                purchase_Detail_Contract_DataTable.Columns.Add("Contract", typeof(bool));

                foreach (var item in purchase_Detail_List)
                {
                    purchase_Detail_Contract_DataTable.Rows.Add(
                        item.Id,
                        item.Contract
                    );
                }

                var result = await _supplierService.Purchase_Detail_Contract_Update(purchase_Detail_Contract_DataTable, user_Id ?? 0);
                if (result != null && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.ContractChangedSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Detail_Contract_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_detail_outward_update")]
        [Authorize]
        public async Task<IActionResult> Purchase_Detail_Outward_Update(Purchase_Detail_Outward_List purchase_Detail_Outward_List)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Purchase_Detail_Outward> purchase_Detail_List = JsonConvert.DeserializeObject<IList<Purchase_Detail_Outward>>(purchase_Detail_Outward_List.Purchase_Detail_Outward.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Status", typeof(string));
                dataTable.Columns.Add("Outward_Remarks", typeof(string));

                foreach (var item in purchase_Detail_List)
                {
                    dataTable.Rows.Add(
                        item.Id,
                        item.Status,
                        item.Outward_Remarks
                    );
                }

                var result = await _supplierService.Purchase_Detail_Outward_Update(dataTable, purchase_Detail_Outward_List.Trans_Id, user_Id ?? 0);
                if (result != null && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.OutwardSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Detail_Outward_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_confirm_update")]
        [Authorize]
        public async Task<IActionResult> Purchase_Confirm_Update(int Trans_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Purchase_Confirm_Update(Trans_Id, user_Id ?? 0);
                if (result != null && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.ConfirmPurchaseMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Confirm_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("order_process_pending_fcm_token")]
        public async Task<IActionResult> Order_Process_Pending_FCM_Token()
        {
            try
            {
                var result = await _supplierService.Order_Process_Pending_FCM_Token();
                if (result != null && result.Count > 0)
                {
                    foreach (var res in result)
                    {
                        List<string> DeviceIds = new List<string>();

                        if (res.ContainsKey("FCMToken_ANDROID_E") && res["FCMToken_ANDROID_E"] != null)
                            DeviceIds.Add(res["FCMToken_ANDROID_E"].ToString());

                        if (res.ContainsKey("FCMToken_IPHONE_E") && res["FCMToken_IPHONE_E"] != null)
                            DeviceIds.Add(res["FCMToken_IPHONE_E"].ToString());

                        if (res.ContainsKey("FCMToken_ANDROID_S") && res["FCMToken_ANDROID_S"] != null)
                            DeviceIds.Add(res["FCMToken_ANDROID_S"].ToString());

                        if (res.ContainsKey("FCMToken_IPHONE_S") && res["FCMToken_IPHONE_S"] != null)
                            DeviceIds.Add(res["FCMToken_IPHONE_S"].ToString());

                        string Order_No = res["Order_No"]?.ToString();

                        if (DeviceIds.Count > 0)
                        {
                            string title = $"Order from ConnectGIA";

                            string customerName = res["Customer_Name"]?.ToString();

                            if (string.IsNullOrWhiteSpace(customerName))
                            {
                                customerName = "Sunrise Diamonds Ltd";
                            }

                            string body = $"New order #{Order_No} received from {customerName}";

                            await Firebase_Messaging_Notification(DeviceIds: DeviceIds, title: title, body: body);
                        }

                        var result_Update = await _supplierService.Order_Process_Pending_FCM_Token_Update(Order_No);
                    }
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Notification_Connect_Gia_Order_Send
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Order_Process_Pending_FCM_Token", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_master_file_status")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Master_File_Status(int Trans_Id, bool File_Status)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if (Trans_Id > 0)
                {
                    var result = await _supplierService.Update_Purchase_Master_File_Status(Trans_Id, File_Status, user_Id ?? 0);
                    if (result > 0)
                    {
                        return Ok(new
                        {

                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.Purchase_Updated
                        });
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (SqlException ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Master_File_Status", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_purchase_detail_qc_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_QC_Excel(Purchase_Search_Model purchase_Search_Model)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Detail_QC_Excel(purchase_Search_Model.Id);

                if (result != null && result.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/PurchaseQCExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = "QC_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + ".xlsx";

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in result.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }

                    EpExcelExport.Create_Purchase_Detail_QC_Excel(result, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.PurchaseQCExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                else
                {
                    return NoContent();
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_QC_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_detail_qc_update")]
        [Authorize]
        public async Task<IActionResult> Purchase_Detail_QC_Update(Purchase_Detail_QC_List purchase_Detail_QC_List)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Purchase_Detail_QC> purchase_Detail_List = JsonConvert.DeserializeObject<IList<Purchase_Detail_QC>>(purchase_Detail_QC_List.Purchase_Detail_QC.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("QC_Remarks", typeof(string));
                dataTable.Columns.Add("Sunrise_Grade", typeof(string));
                dataTable.Columns.Add("Shade", typeof(int));
                dataTable.Columns.Add("Shade_C", typeof(string));
                dataTable.Columns.Add("Milky", typeof(int));
                dataTable.Columns.Add("Milky_C", typeof(string));
                dataTable.Columns.Add("Table_Black", typeof(int));
                dataTable.Columns.Add("Table_Black_C", typeof(string));
                dataTable.Columns.Add("Crown_Black", typeof(int));
                dataTable.Columns.Add("Crown_Black_C", typeof(string));
                dataTable.Columns.Add("Table_White", typeof(int));
                dataTable.Columns.Add("Table_White_C", typeof(string));
                dataTable.Columns.Add("Crown_White", typeof(int));
                dataTable.Columns.Add("Crown_White_C", typeof(string));
                dataTable.Columns.Add("Outward_Remarks", typeof(string));
                dataTable.Columns.Add("BGM", typeof(int));
                dataTable.Columns.Add("BGM_C", typeof(string));

                foreach (var item in purchase_Detail_List)
                {
                    dataTable.Rows.Add(
                        item.Id,
                        item.QC_Remarks,
                        item.Sunrise_Grade,
                        item.Shade,
                        item.Shade_C,
                        item.Milky,
                        item.Milky_C,
                        item.Table_Black,
                        item.Table_Black_C,
                        item.Crown_Black,
                        item.Crown_Black_C,
                        item.Table_White,
                        item.Table_White_C,
                        item.Crown_White,
                        item.Crown_White_C,
                        item.Additional_Remarks,
                        item.BGM,
                        item.BGM_C
                    );
                }

                var result = await _supplierService.Purchase_Detail_QC_Update(dataTable, purchase_Detail_QC_List.Trans_Id, user_Id ?? 0);
                if (result != null && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.QCSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Detail_QC_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_purchase_pricing")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Pricing(int? Trans_Id)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Pricing(Trans_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_purchase_pricing_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Pricing_Excel(int? Trans_Id)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Pricing_Excel(Trans_Id ?? 0);

                if (result != null && result.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadShipmentVerificationExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = "Pricing_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in result.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }

                    EpExcelExport.Create_Purchase_Detail_Pricing_Excel(result, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadShipmentVerificationExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Pricing_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_detail_pricing")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Detail_Pricing(Purchase_Detail_Pricing_List purchase_Detail_Pricing)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Purchase_Detail_Pricing> purchase_Detail_Pricing_List = JsonConvert.DeserializeObject<IList<Purchase_Detail_Pricing>>(purchase_Detail_Pricing.Purchase_Detail_Pricing.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Buyer_Final_Disc", typeof(float));
                dataTable.Columns.Add("Buyer_Final_Amt", typeof(float));

                foreach (var item in purchase_Detail_Pricing_List)
                {
                    dataTable.Rows.Add(
                        item.Id ?? 0,
                        SafeConvertToDouble(item.Buyer_Final_Disc.ToString()),
                        SafeConvertToDouble(item.Buyer_Final_Value.ToString())
                    );
                }

                var result = await _supplierService.Purchase_Detail_Pricing_Update(dataTable, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Purchase_Pricing_Updated
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Detail_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_lab_entry_report_status_sunrise_summary")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_Entry_Report_Status_Sunrise_Summary(Lab_Entry_Report_Status_Model lab_Entry_Report_Status_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Lab_Entry_Report_Status_Sunrise_Summary(lab_Entry_Report_Status_Model.Stock_Id);

                if ((result != null && result.Count > 0))
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result.Count > 0 ? result : null
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_Entry_Report_Status_Sunrise_Summary", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_lab_entry_report_status_sunrise")]
        [Authorize]
        public async Task<IActionResult> Update_Lab_Entry_Report_Status_Sunrise(Lab_Entry_Status_List Lab_Entry_Status)
        {
            try
            {
                IList<Lab_Entry_Status> Lab_Entry_Status_List = JsonConvert.DeserializeObject<IList<Lab_Entry_Status>>(Lab_Entry_Status.Lab_Entry_Status.ToString());

                DataTable statusDataTable = new DataTable();
                statusDataTable.Columns.Add("Id", typeof(int));
                statusDataTable.Columns.Add("Status", typeof(string));

                foreach (var item in Lab_Entry_Status_List)
                {
                    statusDataTable.Rows.Add(
                        item.Id ?? 0,
                        item.Status
                    );
                }

                var result = await _supplierService.Lab_Entry_Report_Status_Sunrise_Update(statusDataTable);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.StatusChangedSuccessMessage
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Lab_Entry_Report_Status_Sunrise", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_purchase_master_pricing")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Master_Pricing(Purchase_Master_Search_Model purchase_Master_Search_Model)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Master_Pricing(purchase_Master_Search_Model);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Master_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_purchase_detail_pricing")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_Pricing(int? Trans_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_Pricing(Trans_Id ?? 0, user_Id ?? 0);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_pricing")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Pricing(Purchase_Pricing_List purchase_Pricing)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Purchase_Pricing> purchase_Detail_Pricing_List = JsonConvert.DeserializeObject<IList<Purchase_Pricing>>(purchase_Pricing.Purchase_Pricing.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Final_Disc", typeof(float));
                dataTable.Columns.Add("Final_Amt", typeof(float));
                dataTable.Columns.Add("Is_Repriced", typeof(bool));

                foreach (var item in purchase_Detail_Pricing_List)
                {
                    dataTable.Rows.Add(
                        item.Id ?? 0,
                        SafeConvertToDouble(item.Final_Disc.ToString()),
                        SafeConvertToDouble(item.Final_Value.ToString()),
                        item.Is_Repriced
                    );
                }

                var result = await _supplierService.Purchase_Pricing_Update(dataTable, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Purchase_Pricing_Updated
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_pricing_with_grade")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Pricing_With_Grade(Purchase_Pricing_With_Grade_List model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Purchase_Pricing_With_Grade> purchase_Detail_Pricing_List = JsonConvert.DeserializeObject<IList<Purchase_Pricing_With_Grade>>(model.Purchase_Pricing_With_Grade.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("Final_Disc", typeof(float));
                dataTable.Columns.Add("Final_Amt", typeof(float));
                dataTable.Columns.Add("Sunrise_Grade", typeof(string));
                dataTable.Columns.Add("Is_Repriced", typeof(bool));
                dataTable.Columns.Add("Is_Offer", typeof(bool));

                foreach (var item in purchase_Detail_Pricing_List)
                {
                    dataTable.Rows.Add(
                        item.Id ?? 0,
                        SafeConvertToDouble(item.Final_Disc.ToString()),
                        SafeConvertToDouble(item.Final_Value.ToString()),
                        item.Sunrise_Grade.ToString(),
                        item.Is_Repriced,
                        item.Is_Offer
                    );
                }

                var result = await _supplierService.Purchase_Pricing_With_Grade_Update(dataTable, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Purchase_Pricing_Updated
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Pricing_With_Grade", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_master_is_upcoming_approval")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Master_Is_Upcoming_Approval(Purchase_Approval purchase_Approval)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if (purchase_Approval != null)
                {
                    var result = await _supplierService.Update_Purchase_Master_Is_Upcoming_Approval(purchase_Approval, user_Id ?? 0);

                    if (result == "Update successful")
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.Purchase_Updated
                        });
                    }

                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = result
                    });
                }

                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (SqlException ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Master_Is_Upcoming_Approval", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_master_is_repricing_approval")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Master_Is_Repricing_Approval(Purchase_Approval purchase_Approval)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if (purchase_Approval != null)
                {
                    var result = await _supplierService.Update_Purchase_Master_Is_Repricing_Approval(purchase_Approval, user_Id ?? 0);

                    if (result == "Update successful")
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.Purchase_Updated
                        });
                    }

                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = result
                    });
                }

                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (SqlException ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Master_Is_Repricing_Approval", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }


        [HttpGet]
        [Route("get_purchase_detail_pricing_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_Pricing_Excel(int? Trans_Id)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Detail_Pricing_Excel(Trans_Id ?? 0);

                if (result != null && result.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadShipmentVerificationExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = "Pricing_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in result.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }

                    EpExcelExport.Create_Purchase_Pricing_Excel(result, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadShipmentVerificationExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_Pricing_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_purchase_media_upload")]
        public async Task<IActionResult> Get_Purchase_Media_Upload(Purchase_Media_Upload_Search_Model purchase_Media_Upload_Search_Model)
        {
            try
            {
                DataTable dt = await _oracleService.Get_Media_Inward();
                var result = await _supplierService.Get_Purchase_Media_Upload(purchase_Media_Upload_Search_Model, dt);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Media_Upload", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_media_upload")]
        public async Task<IActionResult> Update_Purchase_Media_Upload(Purchase_Media_Upload_Model purchase_Media_Upload_Model)
        {
            try
            {
                if (purchase_Media_Upload_Model?.Id > 0)
                {
                    var result = await _supplierService.Update_Purchase_Media_Upload(purchase_Media_Upload_Model);
                    if (result > 0)
                    {
                        if (purchase_Media_Upload_Model.IsFortune == true &&
                            ((purchase_Media_Upload_Model.Image_Status == 1 && !string.IsNullOrEmpty(purchase_Media_Upload_Model.NewImageUrl)) ||
                             (purchase_Media_Upload_Model.Video_Status == 1 && !string.IsNullOrEmpty(purchase_Media_Upload_Model.NewVideoUrl))))
                        {
                            try
                            {
                                await _oracleService.Get_Media_Upload(purchase_Media_Upload_Model);
                            }
                            catch (OracleException oex)
                            {
                                await _commonService.InsertErrorLog(oex.Message, "Oracle_SP_Get_Media_Upload", oex.StackTrace);
                            }
                        }

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.Purchase_Updated
                        });
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (OracleException oex)
            {
                await _commonService.InsertErrorLog(oex.Message, "Update_Purchase_Media_Upload", oex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = oex.Message
                });
            }
            catch (SqlException ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Media_Upload", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Media_Upload", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPut]
        [Route("update_purchase_shipment_receive")]
        public async Task<IActionResult> Update_Purchase_Shipment_Receive(string Trans_Id)
        {
            try
            {
                if (!string.IsNullOrEmpty(Trans_Id))
                {
                    var result = await _supplierService.Update_Purchase_Shipment_Receive(Trans_Id);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.Purchase_Shipment_Receive_Updated
                        });
                    }
                    return NoContent();
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Shipment_Receive", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        /*
         * Date: 2025/05/21 Get Purchase Detail for QC by Jashmin Patel
         */
        [HttpGet]
        [Route("get_purchase_detail_for_qc")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Qc(int? Trans_Id, string Doc_Type)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Detail_For_Qc(Trans_Id ?? 0, Doc_Type);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_purchase_manual_media_upload")]
        public async Task<IActionResult> Get_Purchase_Manual_Media_Upload(Purchase_Media_Upload_Search_Model purchase_Media_Upload_Search_Model)
        {
            try
            {
                DataTable dt = await _oracleService.Get_Media_Inward();
                var result = await _supplierService.Get_Purchase_Manual_Media_Upload(purchase_Media_Upload_Search_Model, dt);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Manual_Media_Upload", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Purchase QC Approval

        [HttpPost]
        [Route("get_purchase_qc_approval")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_QC_Approval(Purchase_Master_Search_Model purchase_Master_Search_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_QC_Approval(purchase_Master_Search_Model, user_Id ?? 0);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_QC_Approval", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_qc_approval_column_wise_excel_download")]
        [Authorize]
        public async Task<IActionResult> Purchase_QC_Approval_Column_Wise_Excel_Download(Report_Lab_Entry_Filter report_Lab_Entry_Filter)
        {
            try
            {
                var dt_Order = await _supplierService.Get_Purchase_QC_Approval_Data_Dynamic(report_Lab_Entry_Filter);

                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Lab_Entry_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/PurchaseQCApprovalExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = "QC_Approval_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";
                    EpExcelExport.Create_Purchase_Detail_QC_Approval_Column_Wise_Excel(dt_Order, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.PurchaseQCApprovalExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Lab_Entry_Report_Column_Wise_Excel_Download", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_qc_approval_excel_export")]
        [Authorize]
        public async Task<IActionResult> Purchase_QC_Approval_Excel_Export(Report_Lab_Entry_Filter report_Lab_Entry_Filter)
        {
            try
            {
                var dt_Order = await _supplierService.Get_Purchase_QC_Approval_Data(report_Lab_Entry_Filter);

                if (dt_Order != null && dt_Order.Rows.Count > 0)
                {
                    var excelPath = string.Empty;

                    string filename = string.Empty;

                    report_Lab_Entry_Filter.column_Name = new List<string>{
                                        "Stock Id",
                                        "Lab",
                                        "IMAGE LINK",
                                        "VIDEO LINK",
                                        "Cert No",
                                        "Status",
                                        "Additional Remarks",
                                        "QC Remarks",
                                        "Shape",
                                        "Pointer",
                                        "BGM",
                                        "Color",
                                        "Clarity",
                                        "Cts",
                                        "Rap Rate",
                                        "Rap Amount",
                                        "Final Disc%",
                                        "Final Amount",
                                        "Cut",
                                        "Polish",
                                        "Symm",
                                        "Fls",
                                        "Length",
                                        "Width",
                                        "Depth",
                                        "Depth%",
                                        "Table%",
                                        "Key To Symbol",
                                        "Comment",
                                        "Girdle%",
                                        "Crown Angle",
                                        "Crown Height",
                                        "Pavilion Angle",
                                        "Pavilion Height",
                                        "Table White",
                                        "Crown White",
                                        "Table Black",
                                        "Crown Black",
                                        "Culet",
                                        "Table Open",
                                        "Crown Open",
                                        "Pavilion Open",
                                        "Girdle Open",
                    };

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Lab_Entry_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");

                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/PurchaseQCApprovalExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }

                    filename = "D_QC_Approval_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    EpExcelExport.Create_Purchase_Detail_QC_Approval_Excel(dt_Order, columnNamesTable, filePath, filePath + filename);

                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.PurchaseQCApprovalExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_QC_Approval_Excel_Export", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_purchase_qc_reply_status")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_QC_Reply_Status(IList<Purchase_Detail_QC_Reply> purchase_Detail_QC_Reply)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("QC_Reply_Status", typeof(string));

                foreach (var item in purchase_Detail_QC_Reply)
                {
                    dataTable.Rows.Add(
                        item.Id ?? 0,
                        item.QC_Reply_Status
                    );
                }

                var result = await _supplierService.Purchase_QC_Reply_Status_Update(dataTable, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Purchase_QC_Updated
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_QC_Reply_Status", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_detail_qc_complete_update")]
        [Authorize]
        public async Task<IActionResult> Purchase_Detail_QC_Complete_Update(Purchase_Detail_QC_List purchase_Detail_QC_List)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                IList<Purchase_Detail_QC> purchase_Detail_List = JsonConvert.DeserializeObject<IList<Purchase_Detail_QC>>(purchase_Detail_QC_List.Purchase_Detail_QC.ToString());

                DataTable dataTable = new DataTable();
                dataTable.Columns.Add("Id", typeof(int));
                dataTable.Columns.Add("QC_Remarks", typeof(string));
                dataTable.Columns.Add("Sunrise_Grade", typeof(string));
                dataTable.Columns.Add("Shade", typeof(int));
                dataTable.Columns.Add("Shade_C", typeof(string));
                dataTable.Columns.Add("Milky", typeof(int));
                dataTable.Columns.Add("Milky_C", typeof(string));
                dataTable.Columns.Add("Table_Black", typeof(int));
                dataTable.Columns.Add("Table_Black_C", typeof(string));
                dataTable.Columns.Add("Crown_Black", typeof(int));
                dataTable.Columns.Add("Crown_Black_C", typeof(string));
                dataTable.Columns.Add("Table_White", typeof(int));
                dataTable.Columns.Add("Table_White_C", typeof(string));
                dataTable.Columns.Add("Crown_White", typeof(int));
                dataTable.Columns.Add("Crown_White_C", typeof(string));
                dataTable.Columns.Add("Outward_Remarks", typeof(string));
                dataTable.Columns.Add("BGM", typeof(int));
                dataTable.Columns.Add("BGM_C", typeof(string));

                foreach (var item in purchase_Detail_List)
                {
                    dataTable.Rows.Add(
                        item.Id,
                        item.QC_Remarks,
                        item.Sunrise_Grade,
                        item.Shade,
                        item.Shade_C,
                        item.Milky,
                        item.Milky_C,
                        item.Table_Black,
                        item.Table_Black_C,
                        item.Crown_Black,
                        item.Crown_Black_C,
                        item.Table_White,
                        item.Table_White_C,
                        item.Crown_White,
                        item.Crown_White_C,
                        item.Additional_Remarks,
                        item.BGM,
                        item.BGM_C
                    );
                }

                var result = await _supplierService.Purchase_Detail_QC_Complete_Update(dataTable, purchase_Detail_QC_List.Trans_Id, user_Id ?? 0);
                if (result != null && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Purchase_QC_Completed
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Detail_QC_Complete_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("purchase_detail_qc_close_update")]
        [Authorize]
        public async Task<IActionResult> Purchase_Detail_QC_Close_Update(Purchase_Detail_QC_List purchase_Detail_QC_List)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Purchase_Detail_QC_Close_Update(purchase_Detail_QC_List.Trans_Id, user_Id ?? 0);
                if (result != null && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Purchase_QC_Closed
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Detail_QC_Close_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        /*
         * Date: 2025/06/17 By Jashmin Patel
         * Aded for sending mail daily for reminder qc received but not completed.
         */
        [HttpGet]
        [Route("purchase_detail_qc_pending_mail")]
        public async Task<IActionResult> Purchase_Detail_QC_Pending_Mail()
        {
            try
            {
                var result = await _supplierService.Purchase_Detail_QC_Pending();

                if (result != null && result.Count > 0)
                {
                    List<string> to_Emails = new List<string>() { "ujjval@sunrisediam.com" };
                    List<string> cc_Emails = new List<string>() { "list@sunrisediam.com" };

                    string subject = "Action Required: Review of QC Remarks Responses Pending";

                    StringBuilder sb = new StringBuilder();

                    sb.AppendLine(@"Hi," + "<br/>");
                    sb.AppendLine($"Below Trans id's QC Remarks Responses Pending Till Date" + "<br/>" + "<br/>");

                    sb.AppendLine(@"<table border='1' cellspacing='2' cellpadding='3'>");
                    sb.AppendLine(@"<thead><tr><td>Trans Id</td><td>Supplier</td></tr></thead>");
                    sb.AppendLine(@"<tbody>");

                    foreach (var item in result)
                    {
                        sb.AppendLine($"<tr><td>{item["Trans_Id"]}</td><td>{item["Supplier"]}</td></tr>");
                    }
                    sb.AppendLine(@"</tbody>");
                    sb.AppendLine(@"</table>");

                    _emailSender.SendEmail(toEmails: to_Emails, subject: subject, body: sb.ToString(), ccEmails: cc_Emails);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Detail_QC_Pending_Mail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Transaction

        [HttpPost]
        [Route("get_transaction_master")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Master(Transaction_Master_Search_Model transaction_Master_Search_Model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Transaction_Master(transaction_Master_Search_Model, user_Id ?? 0);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = new
                        {
                            Transaction_Detail_List = result
                        }
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Master", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_transaction")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction(int? Trans_Id)
        {
            try
            {
                var result = await _supplierService.Get_Transaction(Trans_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_transaction")]
        [Authorize]
        public async Task<IActionResult> Delete_Transaction(int Trans_Id)
        {
            try
            {
                if (Trans_Id > 0)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                    var result = await _supplierService.Delete_Transaction(Trans_Id, user_Id ?? 0);

                    if (result > 0)
                    {
                        return Ok(new
                        {

                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.TransactionDeleted
                        });
                    }
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (SqlException ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Transaction", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_transaction_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Excel(int? Trans_Id, int Process_Id, string Process_Name)
        {
            try
            {
                var result = await _supplierService.Get_Transaction_Excel(Trans_Id ?? 0);

                if (result != null && result.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/TransactionExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = Process_Name + "_" + Trans_Id.ToString() + "_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in result.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }

                    EpExcelExport.Create_Transaction_Excel(result, columnNamesTable, filePath, filePath + filename, Process_Id);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.TransactionExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_sales_transaction_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Sales_Transaction_Excel(int? Trans_Id, int Process_Id, string Process_Name)
        {
            try
            {
                var result = await _supplierService.Get_Sales_Transaction_Excel(Trans_Id ?? 0);

                if (result != null && result.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/TransactionExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = Process_Name + "_" + Trans_Id.ToString() + "_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in result.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }

                    EpExcelExport.Create_Sales_Transaction_Excel(result, columnNamesTable, filePath, filePath + filename, Process_Id);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.TransactionExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Sales_Transaction_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_transaction_report_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Report_Excel(Report_Lab_Entry_Filter report_Filter)
        {
            try
            {
                var result = await _supplierService.Get_Transaction_Report_Excel(report_Filter.Stock_Id ?? null);

                if (result != null && result.Rows.Count > 0)
                {

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in report_Filter.column_Name)
                    {
                        if (columnName != "CERTIFICATE LINK")
                        {
                            columnNamesTable.Rows.Add(columnName);
                        }
                    }
                    columnNamesTable.Rows.Add("CERTIFICATE LINK");
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/TransactionReportExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }

                    string filename = report_Filter.Process_Name + "_" + DateTime.UtcNow.ToString("ddMMyyyy-HHmmss") + ".xlsx";

                    EpExcelExport.Create_Transaction_Report_Column_Wise_Excel(result, columnNamesTable, filePath, filePath + filename);
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.TransactionReportExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }

                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Report_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }


        [HttpGet]
        [Route("get_transaction_for_merge")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_For_Merge(int? Trans_Id)
        {
            try
            {
                var result = await _supplierService.Get_Transaction_For_Merge(Trans_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_For_Merge", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("transaction_merge")]
        [Authorize]
        public async Task<IActionResult> Transaction_Merge(Transaction_Merge_Model model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var (result, isExist) = await _supplierService.Transaction_Merge(model, user_Id ?? 0);

                return result switch
                {
                    409 when isExist => Conflict(new { statusCode = HttpStatusCode.Conflict, message = CoreCommonMessage.PurchaseAlreadyExists }),
                    > 0 => Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.TransactionMerged,
                    }),
                    _ => BadRequest(new { statusCode = HttpStatusCode.BadRequest, message = CoreCommonMessage.ParameterMismatched })
                };
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Master", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Purchase Return

        [HttpPost]
        [Route("create_update_purchase_return")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Purchase_Return(Transactions_Master_Model model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? userId = _jWTAuthentication.Validate_Jwt_Token(token);

                var master = JsonConvert.DeserializeObject<Transaction_Master>(model.Transaction_Master.ToString());
                var details = JsonConvert.DeserializeObject<IList<Transaction_Detail>>(model.Transaction_Detail_List.ToString());
                var expenses = JsonConvert.DeserializeObject<IList<Transaction_Expenses>>(model.Transaction_Expenses_List.ToString());
                var terms = JsonConvert.DeserializeObject<IList<Transaction_Terms>>(model.Transaction_Terms_List.ToString());
                var looseDetails = JsonConvert.DeserializeObject<IList<Transaction_Detail_Loose>>(model.Transaction_Detail_Loose_List.ToString());

                DateTime.TryParseExact(master.Trans_Date, "dd-MM-yyyy", CultureInfo.InvariantCulture, DateTimeStyles.None, out DateTime transDate);
                DateTime.TryParseExact(master.Due_Date, "dd-MM-yyyy", CultureInfo.InvariantCulture, DateTimeStyles.None, out DateTime dueDate);
                DateTime.TryParseExact(master.Invoice_Date, "dd-MM-yyyy", CultureInfo.InvariantCulture, DateTimeStyles.None, out DateTime invoiceDate);

                if (master.Process_Id == "27" && (master.Trans_Id ?? 0) == 0)
                {
                    var purchaseResult = await _supplierService.Insert_Update_Transaction(
                        Build_Transaction_Master_Table(master, transDate, dueDate, invoiceDate, true),
                        Build_Transaction_Detail_Table(details, true),
                        Build_Transaction_Terms_Table(terms),
                        Build_Transaction_Expenses_Table(expenses),
                        Build_Transaction_Loose_Detail_Table(looseDetails),
                        userId ?? 0
                    );
                }
                if (master.Process_Id == "1" && (master.Is_Consignment_Auto_Receive ?? false) == true)
                {
                    var consignmentAutoReceive = await _supplierService.Transaction_Auto_Consignment_Receive_Insert_Update(
                        Build_Transaction_Master_Table(master, transDate, dueDate, invoiceDate),
                        Build_Transaction_Detail_Table(details),
                        Build_Transaction_Terms_Table(terms),
                        Build_Transaction_Expenses_Table(expenses),
                        Build_Transaction_Loose_Detail_Table(looseDetails),
                        userId ?? 0
                    );
                }

                var (result, isExist) = await _supplierService.Insert_Update_Transaction(
                    Build_Transaction_Master_Table(master, transDate, dueDate, invoiceDate),
                    Build_Transaction_Detail_Table(details),
                    Build_Transaction_Terms_Table(terms),
                    Build_Transaction_Expenses_Table(expenses),
                    Build_Transaction_Loose_Detail_Table(looseDetails),
                    userId ?? 0
                );

                /*consignment receive time if choose auto hold then*/
                if (result > 0 && isExist == false)
                {
                    if (master.Trans_Id == 0 && master.Process_Id == "3" && (master.Is_Consignment_Receive_Hold ?? false) == true)
                    {
                        var consignmentReceiveAutoHold = await _supplierService.Transaction_Auto_Consignment_Receive_Insert_Update(
                            Build_Transaction_Master_Table(master, transDate, dueDate, invoiceDate),
                            Build_Transaction_Detail_Table(details),
                            Build_Transaction_Terms_Table(terms),
                            Build_Transaction_Expenses_Table(expenses),
                            Build_Transaction_Loose_Detail_Table(looseDetails),
                            userId ?? 0
                        );
                    }
                }
                return result switch
                {
                    409 when isExist => Conflict(new { statusCode = HttpStatusCode.Conflict, message = CoreCommonMessage.PurchaseAlreadyExists }),
                    > 0 => Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = master.Trans_Id > 0 ? CoreCommonMessage.TransactionUpdated : CoreCommonMessage.TransactionCreated,
                    }),
                    _ => BadRequest(new { statusCode = HttpStatusCode.BadRequest, message = CoreCommonMessage.ParameterMismatched })
                };
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Purchase_Return", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new { message = ex.Message });
            }
        }

        private DataTable Build_Transaction_Master_Table(Transaction_Master m, DateTime transDate, DateTime dueDate, DateTime invoiceDate, bool isConsignment = false)
        {
            var table = new DataTable();
            table.Columns.AddRange(new[]
            {
                new DataColumn("Trans_Id", typeof(int)),
                new DataColumn("Trans_Date", typeof(DateTime)),
                new DataColumn("Trans_Time", typeof(TimeSpan)),
                new DataColumn("Supplier_Id", typeof(int)),
                new DataColumn("Company_Id", typeof(int)),
                new DataColumn("Currency_Id", typeof(int)),
                new DataColumn("Ex_Rate", typeof(float)),
                new DataColumn("Process_Id", typeof(int)),
                new DataColumn("Year_Id", typeof(int)),
                new DataColumn("Transaction_Invoice_No", typeof(string)),
                new DataColumn("Contract", typeof(bool)),
                new DataColumn("Supplier_Invoice_No", typeof(string)),
                new DataColumn("Remarks", typeof(string)),
                new DataColumn("Customer_Id", typeof(int)),
                new DataColumn("Due_Date", typeof(DateTime)),
                new DataColumn("Confirm_Hold", typeof(bool)),
                new DataColumn("Reserver_Stock", typeof(bool)),
                new DataColumn("Sub_Process", typeof(string)),
                new DataColumn("Entry_Type", typeof(string)),
                new DataColumn("Release_Days", typeof(float)),
                new DataColumn("Release_Hours", typeof(float)),
                new DataColumn("Platform", typeof(string)),
                new DataColumn("Country_Of_Origin", typeof(int)),
                new DataColumn("Is_Consignment_Auto_Receive", typeof(bool)),
                new DataColumn("Pre_Carrige_By", typeof(string)),
                new DataColumn("Sales_Invoice_No", typeof(string)),
                new DataColumn("Source_Customer_Id", typeof(int)),
                new DataColumn("Invoice_Date", typeof(DateTime)),
                new DataColumn("Consignment_Type", typeof(string)),
                new DataColumn("Tracking_Number", typeof(string)),
                new DataColumn("Is_Consignment_Receive_Hold", typeof(bool)),
                new DataColumn("Sales_Invoice_Type", typeof(string)),
                new DataColumn("Is_Offer", typeof(bool)),
            });

            table.Rows.Add(
                m.Trans_Id ?? (object)DBNull.Value,
                transDate,
                m.Trans_Time ?? TimeSpan.Zero,
                m.Supplier_Id ?? (object)DBNull.Value,
                m.Company_Id ?? (object)DBNull.Value,
                m.Currency_Id ?? (object)DBNull.Value,
                m.Ex_Rate ?? (object)DBNull.Value,
                isConsignment ? 26 : m.Process_Id,
                m.Year_Id ?? (object)DBNull.Value,
                m.Transaction_Invoice_No ?? (object)DBNull.Value,
                m.Contract ?? (object)DBNull.Value,
                m.Supplier_Invoice_No ?? (object)DBNull.Value,
                m.Remarks ?? (object)DBNull.Value,
                m.Customer_Id ?? (object)DBNull.Value,
                dueDate == DateTime.MinValue ? (object)DBNull.Value : dueDate,
                m.Confirm_Hold ?? (object)DBNull.Value,
                m.Reserver_Stock ?? (object)DBNull.Value,
                m.Sub_Process ?? (object)DBNull.Value,
                m.Entry_Type ?? (object)DBNull.Value,
                m.Release_Days ?? (object)DBNull.Value,
                m.Release_Hours ?? (object)DBNull.Value,
                m.Platform ?? (object)DBNull.Value,
                m.Country_Of_Origin ?? (object)DBNull.Value,
                m.Is_Consignment_Auto_Receive ?? (object)DBNull.Value,
                m.Pre_Carrige_By ?? (object)DBNull.Value,
                m.Sales_Invoice_No ?? (object)DBNull.Value,
                m.Source_Customer_Id ?? (object)DBNull.Value,
                invoiceDate == DateTime.MinValue ? (object)DBNull.Value : invoiceDate,
                m.Consignment_Type ?? (object)DBNull.Value,
                m.Tracking_Number ?? (object)DBNull.Value,
                m.Is_Consignment_Receive_Hold ?? (object)DBNull.Value,
                m.Sales_Invoice_Type ?? (object)DBNull.Value,
                m.Is_Offer ?? (object)DBNull.Value
            );
            return table;
        }

        private DataTable Build_Transaction_Detail_Table(IList<Transaction_Detail> details, bool isConsignment = false)
        {
            var table = new DataTable();
            table.Columns.AddRange(new[]
            {
                new DataColumn("Id", typeof(int)),
                new DataColumn("Trans_Id", typeof(int)),
                new DataColumn("Purchase_Detail_Id", typeof(int)),
                new DataColumn("Rap_Rate", typeof(decimal)),
                new DataColumn("Rap_Amt", typeof(decimal)),
                new DataColumn("Actual_Cost_Disc", typeof(float)),
                new DataColumn("Actual_Cost_Amt", typeof(decimal)),
                new DataColumn("Offer_Disc", typeof(float)),
                new DataColumn("Offer_Amt", typeof(decimal)),
                new DataColumn("Web_Disc", typeof(float)),
                new DataColumn("Web_Amt", typeof(decimal)),
                new DataColumn("Final_Disc", typeof(float)),
                new DataColumn("Final_Amt", typeof(decimal))
            });

            foreach (var d in details)
            {
                table.Rows.Add(
                    d.Id ?? 0,
                    d.Trans_Id ?? 0,
                    d.Purchase_Detail_Id ?? 0,
                    SafeConvertToDouble(d.Rap_Rate),
                    SafeConvertToDouble(d.Rap_Amount),
                    SafeConvertToDouble(isConsignment ? d.Consignment_Cost_Disc : d.Actual_Cost_Disc),
                    SafeConvertToDouble(isConsignment ? d.Consignment_Cost_Amt : d.Actual_Cost_Amt),
                    isConsignment ? (object)DBNull.Value : SafeConvertToDouble(d.Offer_Disc),
                    isConsignment ? (object)DBNull.Value : SafeConvertToDouble(d.Offer_Amt),
                    isConsignment ? (object)DBNull.Value : SafeConvertToDouble(d.Web_Disc),
                    isConsignment ? (object)DBNull.Value : SafeConvertToDouble(d.Web_Amt),
                    isConsignment ? (object)DBNull.Value : SafeConvertToDouble(d.Final_Disc),
                    isConsignment ? (object)DBNull.Value : SafeConvertToDouble(d.Final_Amt)
                );
            }
            return table;
        }

        private DataTable Build_Transaction_Terms_Table(IList<Transaction_Terms> terms)
        {
            var table = new DataTable();
            table.Columns.AddRange(new[]
            {
                new DataColumn("Transaction_Terms_Id", typeof(int)),
                new DataColumn("Terms_Id", typeof(int)),
                new DataColumn("Amount", typeof(decimal)),
                new DataColumn("Trans_Id", typeof(int))
            });

            foreach (var t in terms)
            {
                table.Rows.Add(
                    t.Transaction_Terms_Id ?? 0,
                    t.Terms_Id ?? 0,
                    t.Amount ?? 0,
                    t.Trans_Id ?? 0
                );
            }
            return table;
        }

        private DataTable Build_Transaction_Expenses_Table(IList<Transaction_Expenses> expenses)
        {
            var table = new DataTable();
            table.Columns.AddRange(new[]
            {
                new DataColumn("Transaction_Expenses_Id", typeof(int)),
                new DataColumn("Expenses_Id", typeof(int)),
                new DataColumn("Sign", typeof(string)),
                new DataColumn("Percentage", typeof(decimal)),
                new DataColumn("Amount", typeof(decimal)),
                new DataColumn("Transaction_Trans_Id", typeof(int))
            });

            foreach (var e in expenses)
            {
                table.Rows.Add(
                    e.Transaction_Expenses_Id ?? 0,
                    e.Expenses_Id ?? 0,
                    e.Sign ?? "+",
                    e.Percentage ?? 0,
                    e.Amount ?? 0,
                    e.Trans_Id ?? 0
                );
            }

            return table;
        }

        private DataTable Build_Transaction_Loose_Detail_Table(IList<Transaction_Detail_Loose> looseDetails)
        {
            var table = new DataTable();
            table.Columns.AddRange(new[]
            {
                new DataColumn("Id", typeof(int)),
                new DataColumn("Trans_Id", typeof(int)),
                new DataColumn("Parcel_Name", typeof(int)),
                new DataColumn("Parcel_Type", typeof(int)),
                new DataColumn("Pcs", typeof(float)),
                new DataColumn("Cts", typeof(float)),
                new DataColumn("Unit", typeof(string)),
                new DataColumn("Rate_Unit", typeof(decimal)),
                new DataColumn("Value", typeof(decimal))
            });

            foreach (var l in looseDetails)
            {
                table.Rows.Add(
                    l.Id ?? 0,
                    l.Trans_Id ?? 0,
                    l.Parcel_Name ?? 0,
                    l.Parcel_Type ?? 0,
                    l.Pcs ?? 0,
                    l.Cts ?? 0,
                    l.Unit ?? "",
                    SafeConvertToDouble(l.Rate_Unit.ToString()),
                    SafeConvertToDouble(l.Value.ToString())
                );
            }

            return table;
        }

        [HttpPost]
        [Route("get_purchase_detail_for_purchase_return")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Purchase_Return(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Purchase_Return(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Purchase_Return(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Purchase_Return", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("transaction_auto_release")]
        public async Task<IActionResult> Transaction_Auto_Release()
        {
            try
            {
                var result = await _supplierService.Transaction_Auto_Release_Insert_Update();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Transaction_Auto_Release", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Consignment Return

        [HttpPost]
        [Route("get_purchase_detail_for_consignment_return")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Consignment_Return(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Consignment_Return(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Consignment_Return(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Consignment_Return", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Purchase from Consignment

        [HttpPost]
        [Route("get_purchase_detail_for_consignment_purchase")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Consignment_Purchase(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Consignment_Purchase(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Consignment_Purchase(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Consignment_Purchase", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Hold

        [HttpPost]
        [Route("get_purchase_detail_for_hold")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Hold(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Hold(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Hold(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Hold", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Release

        [HttpPost]
        [Route("get_purchase_detail_for_release")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Release(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Release(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Release(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Release", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Hold Customer DropDown

        [HttpGet]
        [Route("get_transaction_hold_customer_dropdown")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Hold_Customer_DropDown()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Transaction_Hold_Customer_DropDown(user_Id ?? 0);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Hold_Customer_DropDown", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Consignment Issue

        [HttpPost]
        [Route("get_purchase_detail_for_consignment_issue")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Consignment_Issue(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Consignment_Issue(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Consignment_Issue(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }

            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Consignment_Issue", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Consignment Receive

        [HttpPost]
        [Route("get_purchase_detail_for_consignment_receive")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Consignment_Receive(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Consignment_Receive(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Consignment_Receive(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Consignment_Receive", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Consignment Issue Customer DropDown

        [HttpGet]
        [Route("get_transaction_consignment_issue_customer_dropdown")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Consignment_Issue_Customer_DropDown()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Transaction_Consignment_Issue_Customer_DropDown(user_Id ?? 0);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Consignment_Issue_Customer_DropDown", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Internal Issue

        [HttpPost]
        [Route("get_purchase_detail_for_internal_issue")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Internal_Issue(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Internal_Issue(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Internal_Issue(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }

            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Internal_Issue", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Internal Receive

        [HttpPost]
        [Route("get_purchase_detail_for_internal_receive")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Internal_Receive(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Internal_Receive(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Internal_Receive(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Internal_Receive", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Internal Issue Customer DropDown

        [HttpGet]
        [Route("get_transaction_internal_issue_customer_dropdown")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Internal_Issue_Customer_DropDown()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Transaction_Internal_Issue_Customer_DropDown(user_Id ?? 0);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Internal_Issue_Customer_DropDown", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Sales

        [HttpPost]
        [Route("get_purchase_detail_for_sales")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Sales(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Sales(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Sales(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Sales", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Sales Return

        [HttpPost]
        [Route("get_purchase_detail_for_sales_return")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Sales_Return(Purchase_Detail_For_Purchase_Return purchase_Detail_For_Purchase_Return)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Purchase_Detail_For_Sales_Return(purchase_Detail_For_Purchase_Return);

                var result_Message = await _supplierService.Get_Unavailable_Purchase_Detail_For_Sales_Return(purchase_Detail_For_Purchase_Return);

                return Ok(new
                {
                    statusCode = HttpStatusCode.OK,
                    message = CoreCommonMessage.DataSuccessfullyFound,
                    unavailable_message = result_Message,
                    data = result
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Sales_Return", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Sales Customer DropDown

        [HttpGet]
        [Route("get_transaction_sales_customer_dropdown")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Sales_Customer_DropDown()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _supplierService.Get_Transaction_Sales_Customer_DropDown(user_Id ?? 0);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Sales_Customer_DropDown", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Sales Invoice DropDown

        [HttpGet]
        [Route("get_transaction_sales_invoice_dropdown")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Sales_Invoice_DropDown(int Customer_Id)
        {
            try
            {
                var result = await _supplierService.Get_Transaction_Sales_Invoice_DropDown(Customer_Id);

                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Sales_Invoice_DropDown", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Lab User Activity

        [HttpGet]
        [Route("get_lab_user_login_activity")]
        [Authorize]
        public async Task<IActionResult> Get_Lab_User_Login_Activity(string? From_Date, string? To_Date, string? Common_Search)
        {
            try
            {

                if (!string.IsNullOrEmpty(From_Date) && !string.IsNullOrEmpty(To_Date))
                {
                    if (DateTime.TryParse(From_Date, out DateTime fromDate) && DateTime.TryParse(To_Date, out DateTime toDate))
                    {
                        if (fromDate > toDate)
                        {
                            return BadRequest(new
                            {
                                statusCode = HttpStatusCode.BadRequest,
                                message = CoreCommonMessage.InvalidDate
                            });
                        }
                    }
                }

                var result = await _lab_User_Login_Activity_Services.Get_Lab_User_Login_Activity(From_Date, To_Date, Common_Search);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Lab_User_Login_Activity", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_stock_user_activity")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Stock_User_Activity(string? From_Date, string? To_Date, string? Common_Search)
        {
            try
            {

                if (!string.IsNullOrEmpty(From_Date) && !string.IsNullOrEmpty(To_Date))
                {
                    if (DateTime.TryParse(From_Date, out DateTime fromDate) && DateTime.TryParse(To_Date, out DateTime toDate))
                    {
                        if (fromDate > toDate)
                        {
                            return BadRequest(new
                            {
                                statusCode = HttpStatusCode.BadRequest,
                                message = CoreCommonMessage.InvalidDate
                            });
                        }
                    }
                }

                var result = await _lab_User_Login_Activity_Services.Get_Supplier_Stock_User_Activity(From_Date, To_Date, Common_Search);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Stock_User_Activity", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_supplier_stock_lab_user_activity")]
        [Authorize]
        public async Task<IActionResult> Get_Supplier_Stock_Lab_User_Activity(string? From_Date, string? To_Date)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                var result = await _lab_User_Login_Activity_Services.Get_Supplier_Stock_Lab_User_Activity(From_Date, To_Date, user_Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Stock_Lab_User_Activity", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Sunrise Api

        [HttpGet]
        [Route("get_sunrise_stock")]
        public async Task<IActionResult> Get_Sunrise_Stock()
        {
            try
            {
                string json;
                string token = string.Empty;
                try
                {
                    var sun_l = new Sunrise_LoginRequest
                    {
                        UserName = "samit_gandhi",
                        Password = "missme@hk",
                        grant_type = "password"
                    };

                    string inputLRJson = string.Join("&", sun_l.GetType()
                        .GetProperties(BindingFlags.Instance | BindingFlags.Public)
                        .Where(p => p.GetValue(sun_l) != null)
                        .Select(p => $"{p.Name}={Uri.EscapeDataString(p.GetValue(sun_l).ToString())}"));

                    WebRequest request = WebRequest.Create("https://sunrisediamonds.com.hk:8122/api/User/Login");
                    request.Method = "POST";
                    request.Timeout = 7200000;
                    byte[] byteArray = Encoding.UTF8.GetBytes(inputLRJson);
                    request.ContentType = "application/x-www-form-urlencoded";
                    request.ContentLength = byteArray.Length;

                    using (var dataStream = request.GetRequestStream())
                    {
                        dataStream.Write(byteArray, 0, byteArray.Length);
                    }

                    using (var response = request.GetResponse())
                    {
                        using (var dataStream = response.GetResponseStream())
                        {
                            using (var reader = new StreamReader(dataStream))
                            {
                                json = reader.ReadToEnd();
                            }
                        }
                    }

                    Sunrise_LoginResponse sglr = JsonConvert.DeserializeObject<Sunrise_LoginResponse>(json);
                    token = sglr.access_token;
                }
                catch (Exception ex)
                {
                    await _commonService.InsertErrorLog(ex.Message, "Get_Sunrise_Stock", ex.StackTrace);
                    return StatusCode((int)HttpStatusCode.InternalServerError, new
                    {
                        statusCode = HttpStatusCode.InternalServerError,
                        message = ex.Message,
                        error = ex.StackTrace
                    });
                }

                if (string.IsNullOrEmpty(token))
                {
                    return StatusCode((int)HttpStatusCode.InternalServerError, new
                    {
                        statusCode = HttpStatusCode.InternalServerError,
                        message = CoreCommonMessage.ApiError,
                        error = "Token does not exist"
                    });
                }

                try
                {
                    WebRequest request = WebRequest.Create("https://sunrisediamonds.com.hk:8122/api/Stock/Stock_GET");
                    request.Method = "POST";
                    request.Timeout = 7200000;
                    request.Headers.Add("Authorization", "Bearer " + token);

                    using (var response = request.GetResponse())
                    {
                        using (var dataStream = response.GetResponseStream())
                        {
                            using (var reader = new StreamReader(dataStream))
                            {
                                var json1 = await reader.ReadToEndAsync();
                                if (string.IsNullOrEmpty(json1))
                                {
                                    await _commonService.InsertErrorLog("Data not Found", "Get_Sunrise_Stock", CoreCommonMessage.ApiError);
                                    return StatusCode((int)HttpStatusCode.InternalServerError, new
                                    {
                                        statusCode = HttpStatusCode.InternalServerError,
                                        message = CoreCommonMessage.ApiError,
                                        error = "Data not Found"
                                    });
                                }
                                var stockResponse = JsonConvert.DeserializeObject<StockResponse>(json1);

                                SunriseStockResponse stock = new SunriseStockResponse
                                {
                                    data = stockResponse.Data,
                                };
                                return Ok(stock);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    await _commonService.InsertErrorLog(ex.Message, "Get_Sunrise_Stock", ex.StackTrace);
                    return StatusCode((int)HttpStatusCode.InternalServerError, new
                    {
                        statusCode = HttpStatusCode.InternalServerError,
                        message = ex.Message,
                        error = ex.StackTrace
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Sunrise_Stock", httpEx.StackTrace);

                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Sunrise_Stock", ex.StackTrace);

                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        [HttpGet]
        [Route("get_sunrise_stock_old")]
        public async Task<IActionResult> Get_Sunrise_Stock_Old()
        {
            try
            {
                var url = "https://sunrisediamonds.com.hk:8122/api/ApiSettings/BasicAuthLog?TransId=126";

                using (var handler = new HttpClientHandler())
                {
                    using (HttpClient client = new HttpClient(handler))
                    {
                        var credentials = "solar:astute";
                        var base64Credentials = Convert.ToBase64String(Encoding.ASCII.GetBytes(credentials));
                        client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Basic", base64Credentials);

                        HttpResponseMessage response = await client.PostAsync(url, null);

                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();

                            string cleanedJson = json.Replace("\\\"", "\"").Trim('"');

                            List<Sunrise_Model> diamondInfos = JsonConvert.DeserializeObject<List<Sunrise_Model>>(cleanedJson);

                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                data = diamondInfos
                            });
                        }
                        else
                        {
                            var errorDetails = await response.Content.ReadAsStringAsync();

                            await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Sunrise_Stock", errorDetails);
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = CoreCommonMessage.ApiFailed,
                                error = errorDetails
                            });
                        }
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Sunrise_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Sunrise_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Notification
        [HttpGet]
        [Route("get_notification")]
        public async Task<IActionResult> Get_Notification()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if (user_Id > 0)
                {
                    var (result, totalRecordr) = await _partyService.Get_Notification(user_Id ?? 0);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            total_Records = totalRecordr,
                            data = result
                        });
                    }
                    return NoContent();
                }

                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Notification", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("update_notification_read_by")]
        [Authorize]
        public async Task<IActionResult> Update_Notification_Read_By(int? Notification_Id, bool? Is_Read)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                var result = await _partyService.Notification_Master_Update_Read_By(Notification_Id, Is_Read, user_Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Notification_Updated_Read_By
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Notification", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/04/25 By Jashmin Patel
         * Aded for notification of new purchase(shipment) - with counts
         * Pricing notification
         */
        [HttpGet]
        [Route("get_notification_menu")]
        public async Task<IActionResult> Get_Notification_Menu()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if (user_Id > 0)
                {
                    var (result, totalRecordr) = await _partyService.Get_Notification_Menu(user_Id ?? 0);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            total_Records = totalRecordr,
                            data = result
                        });
                    }
                    return NoContent();
                }

                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Notification_Menu", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/06/23 By Jashmin Patel
         * Aded for notification of new qc reply pending - with counts
         * qc remarks should have, presold stone(company name require), and selection/rejection not entered such stones should sent notification to assist by
         * Pricing notification
         */
        [HttpGet]
        [Route("get_notification_menu_qc_reply_pending")]
        public async Task<IActionResult> Get_Notification_Menu_QC_Reply_Pending()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if (user_Id > 0)
                {
                    var result = await _partyService.Get_Notification_Menu_QC_Reply_Pending(user_Id ?? 0);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result
                        });
                    }
                    return NoContent();
                }

                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Notification_Menu", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/04/30 By Jashmin Patel
         * notification menu list
         */
        [HttpGet]
        [Route("get_notification_menu_select")]
        public async Task<IActionResult> Get_Notification_Menu_Select()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if (user_Id > 0)
                {
                    var result = await _partyService.Get_Notification_Menu_Select(user_Id ?? 0);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result
                        });
                    }
                    return NoContent();
                }

                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Notification_Menu_Select", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/04/30 By Jashmin Patel
         * notification menu list
         */
        [HttpPut]
        [Route("update_notification_menu")]
        public async Task<IActionResult> Update_Notification_Menu(Notification_Menu_List model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if (user_Id > 0)
                {
                    IList<Notification_Menu> notification_Menu_List = JsonConvert.DeserializeObject<IList<Notification_Menu>>(model.Notification_Menu.ToString());

                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Notification_Id", typeof(int));
                    dataTable.Columns.Add("Notification_Title", typeof(string));
                    dataTable.Columns.Add("Employee", typeof(string));

                    foreach (var item in notification_Menu_List)
                    {
                        dataTable.Rows.Add(
                            item.Notification_Id ?? 0,
                            item.Notification_Title,
                            item.Employee
                        );
                    }
                    var result = await _partyService.Set_Notification_Menu(dataTable);
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.UpdatedSuccessfully,
                    });
                }

                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Notification_Menu", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Job transfer user pricing

        [HttpPost]
        [Route("job_transfer_user_pricing")]
        [Authorize]
        public async Task<IActionResult> Job_Transfer_User_Pricing()
        {
            try
            {
                var result = await _labUserService.Job_Transfer_User_Pricing();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.JobExc
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Transfer_User_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("job_transfer_supplier_pricing_cal")]
        [Authorize]
        public async Task<IActionResult> Job_Transfer_Supplier_Pricing_Cal(int party_Id)
        {
            try
            {
                var result = await _labUserService.Job_Transfer_Supplier_Pricing_Cal(party_Id);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataTransfer
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Transfer_Supplier_Pricing_Cal", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("job_transfer_auto_supplier_stock")]
        [Authorize]
        public async Task<IActionResult> Job_Transfer_Auto_Supplier_Stock()
        {
            try
            {
                var result = await _labUserService.Job_Transfer_Auto_Supplier_Stock();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataTransfer
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Transfer_Auto_Supplier_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("job_transfer_auto_category_value")]
        [Authorize]
        public async Task<IActionResult> Job_Transfer_Auto_Category_Value()
        {
            try
            {
                var result = await _labUserService.Job_Transfer_Auto_Category_Value();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataTransfer
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Transfer_Auto_Category_Value", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("job_transfer_auto_stock_pricing")]
        [Authorize]
        public async Task<IActionResult> Job_Transfer_Auto_Stock_Pricing(string? Upload_From)
        {
            try
            {
                var result = await _labUserService.Job_Transfer_Auto_Stock_Pricing(Upload_From);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataTransfer
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Transfer_Auto_Stock_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("job_transfer_auto_party_url_format")]
        [Authorize]
        public async Task<IActionResult> Job_Transfer_Auto_Party_Url_Format()
        {
            try
            {
                var result = await _labUserService.Job_Transfer_Auto_Party_Url_Format();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataTransfer
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Transfer_Auto_Party_Url_Format", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("job_transfer_auto_party_account_master")]
        [Authorize]
        public async Task<IActionResult> Job_Transfer_Auto_Party_Account_Master()
        {
            try
            {
                var result = await _labUserService.Job_Transfer_Auto_Party_Account_Master();
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataTransfer
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Job_Transfer_Auto_Party_Account_Master", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Create Update Manual Upload Falguni

        [HttpPost]
        [Route("create_update_manual_upload")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Manual_Upload([FromForm] Party_File party_File, IFormFile File_Location)
        {
            string startTime = DateTime.Now.TimeOfDay.ToString(@"hh\:mm\:ss");
            var message = string.Empty;
            var stock_Data_Id = 0;
            string party_name = string.Empty;
            string Stock_Type = "L";
            try
            {
                if (ModelState.IsValid)
                {
                    if (party_File.Party_Id > 0)
                    {
                        #region Update Party File
                        var party_file_obj = await _partyService.Get_Party_File_Detail(party_File.Party_Id ?? 0);
                        party_name = party_file_obj.Party_Name;
                        if (party_file_obj != null)
                        {
                            if (party_file_obj.Lab == false && party_file_obj.Overseas == false)
                            {
                                return Conflict(new
                                {
                                    statusCode = HttpStatusCode.Conflict,
                                    Supplier_Id = party_File.Party_Id,
                                    Party_Name = party_name,
                                    message = "Kindly check status on supplier api."
                                });
                            }

                            Stock_Data_Master_Schedular stock_Data_Master_Schedular = new Stock_Data_Master_Schedular();
                            stock_Data_Master_Schedular.Stock_Data_Id = 0;
                            stock_Data_Master_Schedular.Supplier_Id = party_File.Party_Id;
                            stock_Data_Master_Schedular.Upload_Method = "FILE";
                            stock_Data_Master_Schedular.Upload_Type = "O";
                            stock_Data_Master_Schedular.Upload_From = "M";
                            stock_Data_Master_Schedular.Stock_Type = Stock_Type;

                            (message, stock_Data_Id) = await _supplierService.Stock_Data_Custom_Insert_Update(stock_Data_Master_Schedular);
                            if (message == "success" && stock_Data_Id > 0)
                            {
                                party_file_obj.Sheet_Name = party_File.Sheet_Name;
                                party_file_obj.Validity_Days = party_File.Validity_Days;
                                party_file_obj.API_Flag = party_File.API_Flag;
                                party_file_obj.Exclude = party_File.Exclude;
                                party_file_obj.Overseas_Same_Id = party_File.Overseas_Same_Id;

                                DataTable supplier_column_Mapping = await _supplierService.Get_Supplier_Column_Mapping_In_Datatable(party_File.Party_Id ?? 0, "C", "FILE");

                                if (supplier_column_Mapping != null && supplier_column_Mapping.Rows.Count > 0)
                                {
                                    Party_File party_File1 = new Party_File()
                                    {
                                        API_Flag = party_file_obj.API_Flag,
                                        Exclude = party_file_obj.Exclude,
                                        File_Id = party_file_obj.File_Id,
                                        File_Location = party_file_obj.File_Location,
                                        File_Status = party_file_obj.File_Status,
                                        Is_Overwrite = party_file_obj.Is_Overwrite,
                                        Is_Same_Id = party_file_obj.Is_Same_Id,
                                        Lab = party_file_obj.Lab,
                                        Overseas = party_file_obj.Overseas,
                                        Overseas_Same_Id = party_file_obj.Overseas_Same_Id,
                                        Party_Id = party_file_obj.Party_Id,
                                        Sheet_Name = party_file_obj.Sheet_Name,
                                        Short_Code = party_file_obj.Short_Code,
                                        Upload_Type = party_file_obj.Upload_Type,
                                        Validity_Days = party_file_obj.Validity_Days,
                                        Priority = party_file_obj.Priority
                                    };

                                    var result = await _partyService.Add_Update_Party_File(party_File1, 0);

                                    if (result > 0)
                                    {
                                        var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/ManualUploadFiles");
                                        if (!(Directory.Exists(filePath)))
                                        {
                                            Directory.CreateDirectory(filePath);
                                        }

                                        string fileName = Path.GetFileNameWithoutExtension(File_Location.FileName);
                                        string fileExt = Path.GetExtension(File_Location.FileName);
                                        string strFile = fileName + "_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + fileExt;
                                        string fileLocation = Path.Combine(filePath, strFile);

                                        using (var fileStream = new FileStream(fileLocation, FileMode.Create))
                                        {
                                            await File_Location.CopyToAsync(fileStream);
                                        }

                                        party_File.File_Location = strFile;

                                        DataTable excel_dataTable = new DataTable();

                                        var sheet_list = party_File.Sheet_Name.Split(",").ToList();

                                        if (fileExt == ".xls")
                                        {
                                            try
                                            {
                                                await Task.Delay(1000);

                                                if (sheet_list != null && sheet_list.Count > 0)
                                                {
                                                    foreach (var sheet_name in sheet_list)
                                                    {
                                                        using (FileStream file = new FileStream(fileLocation, FileMode.Open, FileAccess.Read))
                                                        {
                                                            HSSFWorkbook workbook = new HSSFWorkbook(file);
                                                            HSSFSheet sheet = (HSSFSheet)workbook.GetSheet(sheet_name);
                                                            #region Start Remove above unused rows and columns
                                                            var (hasDataInFirstTenRowsAndColumns, rowcnt) = CoreService.CheckDataInFirstTenRowsAndColumns(sheet);

                                                            if (hasDataInFirstTenRowsAndColumns && rowcnt > 1)
                                                            {
                                                                sheet.ShiftRows(1, rowcnt - 1, 0);
                                                                using (FileStream outputFile = new FileStream(fileLocation, FileMode.Create))
                                                                {
                                                                    workbook.Write(outputFile);
                                                                }
                                                            }
                                                            #endregion

                                                            #region Start Remove belowe unused rows and columns
                                                            int rowCount = sheet.LastRowNum + 1;
                                                            int colCount = sheet.GetRow(0).LastCellNum;

                                                            int rowsToCheck = Math.Max(rowCount - (rowCount - 1), 1);
                                                            bool is_Removed = false;

                                                            for (int row = rowCount - 1; row >= rowsToCheck; row--)
                                                            {
                                                                bool hasData = false;

                                                                IRow currentRow = sheet.GetRow(row);
                                                                if (currentRow != null)
                                                                {
                                                                    for (int col = colCount - 1; col >= colCount - 20; col--)
                                                                    {
                                                                        ICell cell = currentRow.GetCell(col);
                                                                        if (cell != null && !string.IsNullOrEmpty(cell.ToString()))
                                                                        {
                                                                            hasData = true;
                                                                            break;
                                                                        }
                                                                    }
                                                                }

                                                                if (!hasData)
                                                                {
                                                                    sheet.RemoveRow(currentRow);
                                                                    rowCount--;
                                                                    is_Removed = true;
                                                                }
                                                            }

                                                            if (is_Removed)
                                                            {
                                                                try
                                                                {
                                                                    using (FileStream outputFile = new FileStream(fileLocation, FileMode.Create))
                                                                    {
                                                                        workbook.Write(outputFile);
                                                                    }
                                                                }
                                                                catch (Exception ex)
                                                                {
                                                                    message = ex.Message;
                                                                    await _commonService.InsertErrorLog(message, "Create_Update_Manual_Upload", ex.StackTrace);

                                                                    return Conflict(new
                                                                    {
                                                                        statusCode = HttpStatusCode.Conflict,
                                                                        Supplier_Id = party_File.Party_Id,
                                                                        Party_Name = party_name,
                                                                        message = message,

                                                                    });
                                                                }
                                                            }
                                                            #endregion

                                                            #region Start Update URL
                                                            List<string> columnNames = new List<string>();
                                                            List<Dictionary<string, object>> rowsData = new List<Dictionary<string, object>>();

                                                            int totalColumns = sheet.GetRow(0).LastCellNum;
                                                            IRow headerRow = sheet.GetRow(0);

                                                            for (int col = 0; col < totalColumns; col++)
                                                            {
                                                                var cellValue = headerRow.GetCell(col)?.ToString();
                                                                if (!string.IsNullOrEmpty(cellValue))
                                                                {
                                                                    columnNames.Add(cellValue);
                                                                }
                                                            }
                                                            int _rowCount = sheet.PhysicalNumberOfRows;
                                                            for (int row = 1; row < _rowCount; row++)
                                                            {
                                                                IRow currentRow = sheet.GetRow(row);
                                                                Dictionary<string, object> rowData = new Dictionary<string, object>();

                                                                for (int col = 0; col < totalColumns; col++)
                                                                {
                                                                    string columnName = columnNames[col];
                                                                    var cell = currentRow.GetCell(col);
                                                                    var cellValue = cell?.ToString();
                                                                    string formula = string.Empty;
                                                                    if (cell.CellType == CellType.Formula)
                                                                    {
                                                                        formula = cell?.CellFormula;
                                                                    }
                                                                    if (!string.IsNullOrEmpty(cell.Hyperlink?.Address))
                                                                    {
                                                                        string linkUrl = cell.Hyperlink.Address;
                                                                        rowData.Add(columnName, linkUrl);
                                                                    }
                                                                    else if (cell.CellType == CellType.Formula && !string.IsNullOrEmpty(formula))
                                                                    {
                                                                        var urlMatch = Regex.Match(formula, "\"(.*?)\"");
                                                                        if (urlMatch.Success)
                                                                        {
                                                                            string url = urlMatch.Groups[1].Value;
                                                                            string text = Regex.Match(formula, ",\"(.*?)\"").Groups[1].Value;
                                                                            bool containsOnlyNumbers = Regex.IsMatch(text, @"^[0-9]+$");
                                                                            if (containsOnlyNumbers)
                                                                            {
                                                                                rowData.Add(columnName, url + "," + text);
                                                                            }
                                                                            else
                                                                            {
                                                                                rowData.Add(columnName, url);
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        rowData.Add(columnName, cellValue);
                                                                    }
                                                                }

                                                                rowsData.Add(rowData);
                                                            }

                                                            for (int colIndex = 0; colIndex < columnNames.Count; colIndex++)
                                                            {
                                                                headerRow.GetCell(colIndex).SetCellValue(columnNames[colIndex]);
                                                            }

                                                            for (int rowIndex = 0; rowIndex < rowsData.Count; rowIndex++)
                                                            {
                                                                IRow currentRow = sheet.GetRow(rowIndex + 1);
                                                                for (int colIndex = 0; colIndex < columnNames.Count; colIndex++)
                                                                {
                                                                    currentRow.GetCell(colIndex)?.SetCellValue(rowsData[rowIndex][columnNames[colIndex]].ToString());
                                                                }
                                                            }

                                                            using (FileStream outputFile = new FileStream(fileLocation, FileMode.Create))
                                                            {
                                                                workbook.Write(outputFile);
                                                            }
                                                            #endregion
                                                        }
                                                    }
                                                }
                                            }
                                            catch (Exception ex)
                                            {
                                                message = ex.Message;
                                                await _commonService.InsertErrorLog(message, "Create_Update_Manual_Upload", ex.StackTrace);

                                                return Conflict(new
                                                {
                                                    statusCode = HttpStatusCode.Conflict,
                                                    Supplier_Id = party_File.Party_Id,
                                                    Party_Name = party_name,
                                                    message = message,

                                                });
                                            }
                                        }
                                        else if (fileExt == ".xlsx")
                                        {
                                            List<Dictionary<string, object>> rowsData = new List<Dictionary<string, object>>();
                                            if (sheet_list != null && sheet_list.Count > 0)
                                            {
                                                foreach (var sheet_name in sheet_list)
                                                {
                                                    using (var package = new ExcelPackage(new FileInfo(fileLocation)))
                                                    {
                                                        ExcelWorksheet worksheet = package.Workbook.Worksheets[sheet_name];
                                                        worksheet.Calculate();
                                                        #region Start Remove above unused rows and columns
                                                        var (hasDataInFirstTenRowsAndColumns, row_count) = CoreService.CheckDataInFirstTenRowsAndColumns(worksheet);
                                                        if (hasDataInFirstTenRowsAndColumns && row_count > 1)
                                                        {
                                                            worksheet.DeleteRow(1, row_count - 1);
                                                            package.SaveAs(new FileInfo(fileLocation));
                                                        }
                                                        #endregion

                                                        #region Start Remove belowe unused rows and columns
                                                        var rowCount = worksheet.Dimension.End.Row;
                                                        var colCount = worksheet.Dimension.End.Column;

                                                        int rowsToCheck = Math.Max(rowCount - (rowCount - 1), 1);
                                                        bool is_Removed = false;
                                                        for (int row = rowCount; row >= rowsToCheck; row--)
                                                        {
                                                            bool hasData = false;

                                                            for (int col = colCount; col > colCount - 20; col--)
                                                            {
                                                                var cell = worksheet.Cells[row, col];

                                                                if (!string.IsNullOrEmpty(cell.Text))
                                                                {
                                                                    hasData = true;
                                                                    break;
                                                                }
                                                            }

                                                            if (!hasData)
                                                            {
                                                                worksheet.DeleteRow(row);
                                                                rowCount--;
                                                                is_Removed = true;
                                                            }
                                                        }
                                                        if (is_Removed)
                                                        {
                                                            try
                                                            {
                                                                package.SaveAs(new FileInfo(fileLocation));
                                                            }
                                                            catch (Exception ex)
                                                            {

                                                            }
                                                        }
                                                        #endregion

                                                        List<string> columnNames = new List<string>();
                                                        if (worksheet != null)
                                                        {
                                                            // Get column names
                                                            int totalColumns = worksheet.Dimension.End.Column;
                                                            int headerRow = 1;

                                                            for (int col = 1; col <= totalColumns; col++)
                                                            {
                                                                var cellValue = worksheet.Cells[headerRow, col].Value;
                                                                if (cellValue != null)
                                                                {
                                                                    columnNames.Add(cellValue.ToString().Trim());
                                                                }
                                                            }

                                                            // Get row values
                                                            int totalRows = worksheet.Dimension.End.Row;

                                                            for (int row = headerRow + 1; row <= totalRows; row++)
                                                            {
                                                                Dictionary<string, object> rowData = new Dictionary<string, object>();

                                                                for (int col = 1; col <= totalColumns; col++)
                                                                {
                                                                    var _cellValue = worksheet.Cells[headerRow, col].Value;
                                                                    if (_cellValue != null)
                                                                    {
                                                                        string columnName = columnNames[col - 1];
                                                                        var cell = worksheet.Cells[row, col];
                                                                        var cellValue = cell.Value;
                                                                        var formula = cell.Formula;

                                                                        if (cell.Hyperlink != null)
                                                                        {
                                                                            string url = cell.Hyperlink.OriginalString.Replace("%22", "");

                                                                            if (url.Length > 0)
                                                                            {
                                                                                string linkUrl = url;
                                                                                rowData.Add(columnName, linkUrl + ", " + cellValue);
                                                                            }
                                                                            else
                                                                            {
                                                                                rowData.Add(columnName, cellValue);
                                                                            }
                                                                        }
                                                                        else if (!string.IsNullOrEmpty(formula) && formula.Contains("HYPERLINK"))
                                                                        {
                                                                            int urlStartIndex = formula.IndexOf("\"") + 1;
                                                                            int urlEndIndex = formula.IndexOf("\",\"");

                                                                            if (urlStartIndex > 0 && urlEndIndex > urlStartIndex)
                                                                            {
                                                                                string url = formula.Substring(urlStartIndex, urlEndIndex - urlStartIndex);

                                                                                int textStartIndex = urlEndIndex + 3;
                                                                                int textEndIndex = formula.LastIndexOf("\"");

                                                                                if (textStartIndex > 0 && textEndIndex > textStartIndex)
                                                                                {
                                                                                    string text = formula.Substring(textStartIndex, textEndIndex - textStartIndex);
                                                                                    cell.Value = String.Format("{0},{1}", url, text);
                                                                                    rowData.Add(columnName, cell.Value);
                                                                                }
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            rowData.Add(columnName, cellValue != null ? cellValue : DBNull.Value);
                                                                        }
                                                                    }
                                                                }

                                                                foreach (DataRow mappingRow in supplier_column_Mapping.Rows)
                                                                {
                                                                    string supplierColumnName = mappingRow.Field<string>("Supp_Col_Name");
                                                                    string supplierSynonymColumnName = mappingRow.Field<string>("Column_Synonym");

                                                                    if (!string.IsNullOrEmpty(supplierColumnName))
                                                                    {
                                                                        if (!rowData.ContainsKey(supplierColumnName))
                                                                        {
                                                                            if (!string.IsNullOrEmpty(supplierSynonymColumnName))
                                                                            {
                                                                                if (!rowData.ContainsKey(supplierSynonymColumnName))
                                                                                {
                                                                                    Supplier_Stock_Update supplier_Stock_Update = new Supplier_Stock_Update()
                                                                                    {
                                                                                        Supplier_Id = party_File.Party_Id ?? 0,
                                                                                        Stock_Data_Id = stock_Data_Id,
                                                                                        Start_Time = startTime,
                                                                                        Upload_Status = "Column not mapped",
                                                                                        Stock_Type = Stock_Type

                                                                                    };
                                                                                    await _supplierService.Supplier_Stock_Start_End_Time_Update(supplier_Stock_Update);

                                                                                    return Conflict(new
                                                                                    {
                                                                                        statusCode = HttpStatusCode.Conflict,
                                                                                        Supplier_Id = party_File.Party_Id,
                                                                                        Party_Name = party_name,
                                                                                        message = "Column not mapped"
                                                                                    });
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                rowsData.Add(rowData);
                                                            }
                                                        }
                                                    }
                                                }
                                                excel_dataTable = CoreService.ConvertToDataTable(rowsData);
                                                goto dataExist;
                                            }
                                        }

                                        if (fileExt == ".xls")
                                        {
                                            var modifiedRows = supplier_column_Mapping.AsEnumerable()
                                                               .Select(row =>
                                                               {
                                                                   string originalValue = Convert.ToString(row["Supp_Col_Name"]);
                                                                   if (originalValue.Contains("."))
                                                                   {
                                                                       string modifiedValue = originalValue.Replace(".", "#");
                                                                       row.SetField("Supp_Col_Name", modifiedValue);
                                                                   }
                                                                   return row;
                                                               }).CopyToDataTable();
                                            string connString = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + fileLocation + ";Extended Properties=\"Excel 12.0;HDR=YES;\"";
                                            excel_dataTable = CoreService.Convert_File_To_DataTable(".xls", connString, party_File.Sheet_Name);
                                        }
                                        else if (fileExt == ".xlsx")
                                        {
                                            var modifiedRows = supplier_column_Mapping.AsEnumerable()
                                                               .Select(row =>
                                                               {
                                                                   string originalValue = Convert.ToString(row["Supp_Col_Name"]);
                                                                   if (originalValue.Contains("."))
                                                                   {
                                                                       string modifiedValue = originalValue.Replace(".", "#");
                                                                       row.SetField("Supp_Col_Name", modifiedValue);
                                                                   }
                                                                   return row;
                                                               }).CopyToDataTable();
                                            string connString = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + fileLocation + ";Extended Properties='Excel 12.0 Xml;HDR=YES;IMEX=1;'";
                                            excel_dataTable = CoreService.Convert_File_To_DataTable(".xlsx", connString, party_File.Sheet_Name);
                                        }
                                        else if (fileExt == ".csv")
                                        {
                                            excel_dataTable = CoreService.Convert_File_To_DataTable(".csv", fileLocation, "");
                                        }

                                    dataExist:
                                        if (excel_dataTable != null && excel_dataTable.Rows.Count > 0)
                                        {
                                            #region Add column to datatable
                                            DataTable dt_stock_data = new DataTable();
                                            dt_stock_data.Columns.Add("SUPPLIER_NO", typeof(string));
                                            dt_stock_data.Columns.Add("CERTIFICATE_NO", typeof(string));
                                            dt_stock_data.Columns.Add("LAB", typeof(string));
                                            dt_stock_data.Columns.Add("SHAPE", typeof(string));
                                            dt_stock_data.Columns.Add("CTS", typeof(string));
                                            dt_stock_data.Columns.Add("BASE_DISC", typeof(string));
                                            dt_stock_data.Columns.Add("BASE_RATE", typeof(string));
                                            dt_stock_data.Columns.Add("BASE_AMOUNT", typeof(string));
                                            dt_stock_data.Columns.Add("COLOR", typeof(string));
                                            dt_stock_data.Columns.Add("CLARITY", typeof(string));
                                            dt_stock_data.Columns.Add("CUT", typeof(string));
                                            dt_stock_data.Columns.Add("POLISH", typeof(string));
                                            dt_stock_data.Columns.Add("SYMM", typeof(string));
                                            dt_stock_data.Columns.Add("FLS_COLOR", typeof(string));
                                            dt_stock_data.Columns.Add("FLS_INTENSITY", typeof(string));
                                            dt_stock_data.Columns.Add("LENGTH", typeof(string));
                                            dt_stock_data.Columns.Add("WIDTH", typeof(string));
                                            dt_stock_data.Columns.Add("DEPTH", typeof(string));
                                            dt_stock_data.Columns.Add("MEASUREMENT", typeof(string));
                                            dt_stock_data.Columns.Add("DEPTH_PER", typeof(string));
                                            dt_stock_data.Columns.Add("TABLE_PER", typeof(string));
                                            dt_stock_data.Columns.Add("CULET", typeof(string));
                                            dt_stock_data.Columns.Add("SHADE", typeof(string));
                                            dt_stock_data.Columns.Add("LUSTER", typeof(string));
                                            dt_stock_data.Columns.Add("MILKY", typeof(string));
                                            dt_stock_data.Columns.Add("BGM", typeof(string));
                                            dt_stock_data.Columns.Add("LOCATION", typeof(string));
                                            dt_stock_data.Columns.Add("STATUS", typeof(string));
                                            dt_stock_data.Columns.Add("TABLE_BLACK", typeof(string));
                                            dt_stock_data.Columns.Add("SIDE_BLACK", typeof(string));
                                            dt_stock_data.Columns.Add("TABLE_WHITE", typeof(string));
                                            dt_stock_data.Columns.Add("SIDE_WHITE", typeof(string));
                                            dt_stock_data.Columns.Add("TABLE_OPEN", typeof(string));
                                            dt_stock_data.Columns.Add("CROWN_OPEN", typeof(string));
                                            dt_stock_data.Columns.Add("PAVILION_OPEN", typeof(string));
                                            dt_stock_data.Columns.Add("GIRDLE_OPEN", typeof(string));
                                            dt_stock_data.Columns.Add("GIRDLE_FROM", typeof(string));
                                            dt_stock_data.Columns.Add("GIRDLE_TO", typeof(string));
                                            dt_stock_data.Columns.Add("GIRDLE_CONDITION", typeof(string));
                                            dt_stock_data.Columns.Add("GIRDLE_TYPE", typeof(string));
                                            dt_stock_data.Columns.Add("LASER_INSCRIPTION", typeof(string));
                                            dt_stock_data.Columns.Add("CERTIFICATE_DATE", typeof(string));
                                            dt_stock_data.Columns.Add("CROWN_ANGLE", typeof(string));
                                            dt_stock_data.Columns.Add("CROWN_HEIGHT", typeof(string));
                                            dt_stock_data.Columns.Add("PAVILION_ANGLE", typeof(string));
                                            dt_stock_data.Columns.Add("PAVILION_HEIGHT", typeof(string));
                                            dt_stock_data.Columns.Add("GIRDLE_PER", typeof(string));
                                            dt_stock_data.Columns.Add("LR_HALF", typeof(string));
                                            dt_stock_data.Columns.Add("STAR_LN", typeof(string));
                                            dt_stock_data.Columns.Add("CERT_TYPE", typeof(string));
                                            dt_stock_data.Columns.Add("FANCY_COLOR", typeof(string));
                                            dt_stock_data.Columns.Add("FANCY_INTENSITY", typeof(string));
                                            dt_stock_data.Columns.Add("FANCY_OVERTONE", typeof(string));
                                            dt_stock_data.Columns.Add("IMAGE_LINK", typeof(string));
                                            dt_stock_data.Columns.Add("Image2", typeof(string));
                                            dt_stock_data.Columns.Add("VIDEO_LINK", typeof(string));
                                            dt_stock_data.Columns.Add("Video2", typeof(string));
                                            dt_stock_data.Columns.Add("CERTIFICATE_LINK", typeof(string));
                                            dt_stock_data.Columns.Add("DNA", typeof(string));
                                            dt_stock_data.Columns.Add("IMAGE_HEART_LINK", typeof(string));
                                            dt_stock_data.Columns.Add("IMAGE_ARROW_LINK", typeof(string));
                                            dt_stock_data.Columns.Add("H_A_LINK", typeof(string));
                                            dt_stock_data.Columns.Add("CERTIFICATE_TYPE_LINK", typeof(string));
                                            dt_stock_data.Columns.Add("KEY_TO_SYMBOL", typeof(string));
                                            dt_stock_data.Columns.Add("LAB_COMMENTS", typeof(string));
                                            dt_stock_data.Columns.Add("SUPPLIER_COMMENTS", typeof(string));
                                            dt_stock_data.Columns.Add("ORIGIN", typeof(string));
                                            dt_stock_data.Columns.Add("BOW_TIE", typeof(string));
                                            dt_stock_data.Columns.Add("EXTRA_FACET_TABLE", typeof(string));
                                            dt_stock_data.Columns.Add("EXTRA_FACET_CROWN", typeof(string));
                                            dt_stock_data.Columns.Add("EXTRA_FACET_PAVILION", typeof(string));
                                            dt_stock_data.Columns.Add("INTERNAL_GRAINING", typeof(string));
                                            dt_stock_data.Columns.Add("H_A", typeof(string));
                                            dt_stock_data.Columns.Add("SUPPLIER_DISC", typeof(string));
                                            dt_stock_data.Columns.Add("SUPPLIER_AMOUNT", typeof(string));
                                            dt_stock_data.Columns.Add("OFFER_DISC", typeof(string));
                                            dt_stock_data.Columns.Add("OFFER_VALUE", typeof(string));
                                            dt_stock_data.Columns.Add("MAX_SLAB_BASE_DISC", typeof(string));
                                            dt_stock_data.Columns.Add("MAX_SLAB_BASE_VALUE", typeof(string));
                                            dt_stock_data.Columns.Add("EYE_CLEAN", typeof(string));
                                            dt_stock_data.Columns.Add("GOOD_TYPE", typeof(string));
                                            dt_stock_data.Columns.Add("Short_Code", typeof(string));
                                            dt_stock_data.Columns.Add("IS_NATURAL", typeof(string));

                                            #endregion
                                            var mappedRows = excel_dataTable.AsEnumerable()
                                             .Select(row =>
                                             {
                                                 var finalRow = dt_stock_data.NewRow();

                                                 supplier_column_Mapping.AsEnumerable().ToList().ForEach(suppColRow =>
                                                 {
                                                     string displayColName = Convert.ToString(suppColRow["Display_Name"]);
                                                     string suppColName = Convert.ToString(suppColRow["Supp_Col_Name"]);
                                                     string suppColNameSyn = Convert.ToString(suppColRow["Column_Synonym"]);
                                                     bool Is_Split = suppColRow["Is_Split"] != null ? Convert.ToBoolean(suppColRow["Is_Split"]) : false;
                                                     bool Is_Sequence = suppColRow["Is_Sequence"] != null ? Convert.ToBoolean(suppColRow["Is_Sequence"]) : false;
                                                     string Separator = Convert.ToString(suppColRow["Separator"]);
                                                     string Sequence1 = Convert.ToString(suppColRow["Sequence"]);

                                                     int Sequence = !string.IsNullOrEmpty(Convert.ToString(suppColRow["Sequence"])) ? Convert.ToInt32(Convert.ToString(suppColRow["Sequence"])) : 0;

                                                     if (displayColName != "" && suppColName != "")
                                                     {

                                                         if (displayColName != "SHADE")
                                                         {
                                                             if (ColumnExists(row, suppColName) && row[suppColName] != DBNull.Value && !string.IsNullOrEmpty(row[suppColName].ToString()))
                                                             {
                                                                 finalRow[displayColName] = row[suppColName];
                                                             }
                                                             else if (ColumnExists(row, suppColNameSyn) && !string.IsNullOrEmpty(suppColNameSyn))
                                                             {
                                                                 finalRow[displayColName] = row[suppColNameSyn];
                                                             }
                                                             else
                                                             {
                                                                 finalRow[displayColName] = DBNull.Value; // Or handle the case as needed
                                                             }
                                                         }
                                                         else
                                                         {
                                                             if (ColumnExists(row, suppColName) && row[suppColName] != DBNull.Value && !string.IsNullOrEmpty(row[suppColName].ToString()) && suppColName.Contains(","))
                                                             {
                                                                 string[] colNames = Convert.ToString(suppColRow["Supp_Col_Name"]).Split(',');

                                                                 string supp_Col_Name1 = colNames.Length > 0 ? colNames[0] : "";
                                                                 string supp_Col_Name2 = colNames.Length > 1 ? colNames[1] : "";
                                                                 string supp_Col_Name3 = colNames.Length > 2 ? colNames[2] : "";

                                                                 string shade_Value_1 = !string.IsNullOrEmpty(supp_Col_Name1) ? row[supp_Col_Name1].ToString() : "";
                                                                 string shade_Value_2 = !string.IsNullOrEmpty(supp_Col_Name2) ? row[supp_Col_Name2].ToString() : "";
                                                                 string shade_Value_3 = !string.IsNullOrEmpty(supp_Col_Name3) ? row[supp_Col_Name3].ToString() : "";

                                                                 var nonEmptyValues = new List<string>();

                                                                 if (!string.IsNullOrEmpty(shade_Value_1)) nonEmptyValues.Add(shade_Value_1);
                                                                 if (!string.IsNullOrEmpty(shade_Value_2)) nonEmptyValues.Add(shade_Value_2);
                                                                 if (!string.IsNullOrEmpty(shade_Value_3)) nonEmptyValues.Add(shade_Value_3);

                                                                 finalRow[displayColName] = string.Join("; ", nonEmptyValues);
                                                             }
                                                             else if (ColumnExists(row, suppColNameSyn) && row[suppColNameSyn] != DBNull.Value && !string.IsNullOrEmpty(row[suppColNameSyn].ToString()) && suppColNameSyn.Contains(","))
                                                             {
                                                                 string[] colNames = Convert.ToString(suppColRow["Column_Synonym"]).Split(',');

                                                                 string supp_Col_Name1 = colNames.Length > 0 ? colNames[0] : "";
                                                                 string supp_Col_Name2 = colNames.Length > 1 ? colNames[1] : "";
                                                                 string supp_Col_Name3 = colNames.Length > 2 ? colNames[2] : "";

                                                                 string shade_Value_1 = !string.IsNullOrEmpty(supp_Col_Name1) ? row[supp_Col_Name1].ToString() : "";
                                                                 string shade_Value_2 = !string.IsNullOrEmpty(supp_Col_Name2) ? row[supp_Col_Name2].ToString() : "";
                                                                 string shade_Value_3 = !string.IsNullOrEmpty(supp_Col_Name3) ? row[supp_Col_Name3].ToString() : "";

                                                                 var nonEmptyValues = new List<string>();

                                                                 if (!string.IsNullOrEmpty(shade_Value_1)) nonEmptyValues.Add(shade_Value_1);
                                                                 if (!string.IsNullOrEmpty(shade_Value_2)) nonEmptyValues.Add(shade_Value_2);
                                                                 if (!string.IsNullOrEmpty(shade_Value_3)) nonEmptyValues.Add(shade_Value_3);

                                                                 finalRow[displayColName] = string.Join("; ", nonEmptyValues);
                                                             }
                                                             else if (ColumnExists(row, suppColName) && row[suppColName] != DBNull.Value && !string.IsNullOrEmpty(row[suppColName].ToString()))
                                                             {
                                                                 finalRow[displayColName] = row[suppColName];
                                                             }
                                                             else if (ColumnExists(row, suppColNameSyn) && row[suppColNameSyn] != DBNull.Value && !string.IsNullOrEmpty(row[suppColNameSyn].ToString()))
                                                             {
                                                                 finalRow[displayColName] = row[suppColNameSyn];
                                                             }
                                                             else
                                                             {
                                                                 finalRow[displayColName] = DBNull.Value; // Or handle the case as needed
                                                             }
                                                         }

                                                         if (displayColName == "CTS" || displayColName == "BASE_DISC" || displayColName == "BASE_RATE" ||
                                                                 displayColName == "LENGTH" || displayColName == "WIDTH" || displayColName == "DEPTH" ||
                                                                 displayColName == "DEPTH_PER" || displayColName == "TABLE_PER" || displayColName == "CROWN_ANGLE" ||
                                                                 displayColName == "CROWN_HEIGHT" || displayColName == "PAVILION_ANGLE" ||
                                                                 displayColName == "PAVILION_HEIGHT" || displayColName == "GIRDLE_PER" ||
                                                                 displayColName == "SUPPLIER_DISC" || displayColName == "SUPPLIER_AMOUNT" ||
                                                                 displayColName == "OFFER_DISC" || displayColName == "OFFER_VALUE" ||
                                                                 displayColName == "MAX_SLAB_BASE_DISC" || displayColName == "MAX_SLAB_BASE_VALUE")
                                                         {
                                                             finalRow[displayColName] = CoreService.RemoveNonNumericAndDotAndNegativeCharacters(
                                                                 Convert.ToString(finalRow[displayColName]));
                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "GIRDLE_TO")
                                                         {
                                                             finalRow[displayColName] = !string.IsNullOrEmpty(Convert.ToString(finalRow[displayColName])) ? (Convert.ToString(finalRow[displayColName]).Contains("-") ? (Convert.ToString(finalRow[displayColName]).Split(" - ").Length == 2 ? Convert.ToString(finalRow[displayColName]).Split(" - ")[1] : Convert.ToString(finalRow[displayColName])) : (Convert.ToString(finalRow[displayColName]).ToUpper().Contains(" TO ") ? (Convert.ToString(finalRow[displayColName]).ToUpper().Split(" TO ").Length == 2 ? Convert.ToString(finalRow[displayColName]).ToUpper().Split(" TO ")[1] : Convert.ToString(finalRow[displayColName])) : Convert.ToString(finalRow[displayColName]))) : null;

                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "BASE_AMOUNT")
                                                         {
                                                             var base_amt = !string.IsNullOrEmpty(finalRow[displayColName].ToString()) ? (finalRow[displayColName].ToString().Contains("$") ? Convert.ToDecimal(finalRow[displayColName].ToString().Replace("$", "")) : Convert.ToDecimal(finalRow[displayColName].ToString())) : 0;
                                                             finalRow[displayColName] = base_amt.ToString("0.00");
                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "DNA")
                                                         {
                                                             finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                                Convert.ToString(finalRow[displayColName]), false);
                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "IMAGE_LINK")
                                                         {
                                                             finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                                Convert.ToString(finalRow[displayColName]), false);
                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "VIDEO_LINK")
                                                         {
                                                             finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                                Convert.ToString(finalRow[displayColName]), false);
                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "LAB")
                                                         {
                                                             finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                                Convert.ToString(finalRow[displayColName]), true);
                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "CERTIFICATE_NO")
                                                         {
                                                             finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                                Convert.ToString(finalRow[displayColName]), true);
                                                         }
                                                         else if (!string.IsNullOrEmpty(displayColName) && displayColName == "CERTIFICATE_LINK")
                                                         {
                                                             finalRow[displayColName] = CoreService.GetCertificateNoOrUrl(
                                                                Convert.ToString(finalRow[displayColName]), false);
                                                         }
                                                         else
                                                         {
                                                             finalRow[displayColName] = string.IsNullOrEmpty(Convert.ToString(finalRow[displayColName]))
                                                                 ? null : Convert.ToString(finalRow[displayColName]);
                                                         }

                                                         if (Is_Split == true && Is_Sequence == true)
                                                         {
                                                             string col_Val = finalRow[displayColName] != null ? finalRow[displayColName].ToString() : "";
                                                             finalRow[displayColName] = CoreService.GetSupplierSplitSequenceVal(col_Val, Separator, Sequence);
                                                         }
                                                     }
                                                 });

                                                 if (!string.IsNullOrEmpty(finalRow["SUPPLIER_NO"]?.ToString()))
                                                 {
                                                     dt_stock_data.Rows.Add(finalRow);
                                                 }
                                                 return finalRow;
                                             })
                                             .ToList();
                                            dt_stock_data.AsEnumerable().ToList().ForEach(stockDataRow =>
                                            {
                                                var lakhi_Party_Code = _configuration["Lakhi_Party_Code"];
                                                var table_white = string.Empty;
                                                var table_Black = string.Empty;
                                                var side_White = string.Empty;
                                                var side_Black = string.Empty;
                                                if (party_file_obj.Party_Code == lakhi_Party_Code)
                                                {
                                                    (table_white, _) = CoreService.Table_And_Side_White(Convert.ToString(stockDataRow["TABLE_WHITE"]));
                                                    (_, side_White) = CoreService.Table_And_Side_White(Convert.ToString(stockDataRow["SIDE_WHITE"]));

                                                    (table_Black, _) = CoreService.Table_And_Side_Black(Convert.ToString(stockDataRow["TABLE_BLACK"]));
                                                    (_, side_Black) = CoreService.Table_And_Side_Black(Convert.ToString(stockDataRow["SIDE_BLACK"]));
                                                }
                                                else
                                                {
                                                    table_white = Convert.ToString(stockDataRow["TABLE_WHITE"]);
                                                    table_Black = Convert.ToString(stockDataRow["SIDE_WHITE"]);
                                                    side_White = Convert.ToString(stockDataRow["TABLE_BLACK"]);
                                                    side_Black = Convert.ToString(stockDataRow["SIDE_BLACK"]);
                                                }
                                                stockDataRow["TABLE_WHITE"] = table_white;
                                                stockDataRow["SIDE_WHITE"] = table_Black;
                                                stockDataRow["TABLE_BLACK"] = side_White;
                                                stockDataRow["SIDE_BLACK"] = side_Black;
                                                stockDataRow["Short_Code"] = party_file_obj.Short_Code;
                                                //END Center Inclusion AND Black Inclusion

                                                // Check if all three columns are currently null or empty
                                                if ((string.IsNullOrEmpty(Convert.ToString(stockDataRow["LENGTH"]))
                                                    && string.IsNullOrEmpty(Convert.ToString(stockDataRow["WIDTH"]))
                                                    && string.IsNullOrEmpty(Convert.ToString(stockDataRow["DEPTH"]))))
                                                {
                                                    string measurementValue = Convert.ToString(stockDataRow["MEASUREMENT"]).Replace("-", "*").Replace("x", "*");

                                                    // Call the function and handle possible null values
                                                    string lengthValue = CoreService.Split_Supplier_Stock_Measurement(measurementValue, "LENGTH");
                                                    string widthValue = CoreService.Split_Supplier_Stock_Measurement(measurementValue, "WIDTH");
                                                    string depthValue = CoreService.Split_Supplier_Stock_Measurement(measurementValue, "DEPTH");

                                                    // Set the values in the DataRow, handling nulls or empty strings
                                                    stockDataRow["LENGTH"] = !string.IsNullOrEmpty(lengthValue) ? lengthValue : stockDataRow["LENGTH"];
                                                    stockDataRow["WIDTH"] = !string.IsNullOrEmpty(widthValue) ? widthValue : stockDataRow["WIDTH"];
                                                    stockDataRow["DEPTH"] = !string.IsNullOrEmpty(depthValue) ? depthValue : stockDataRow["DEPTH"];
                                                }
                                            });

                                            if (dt_stock_data.Rows.Count > 0)
                                            {
                                                var response = await _supplierService.Stock_Data_Detail_Insert_Update(dt_stock_data, stock_Data_Id);
                                                if (response > 0)
                                                {
                                                    if (stock_Data_Master_Schedular.Upload_Type == "O")
                                                    {
                                                        await _supplierService.Supplier_Stock_Manual_File_Insert_Update((int)stock_Data_Master_Schedular.Supplier_Id, stock_Data_Id, party_File.Is_Overwrite ?? false, party_File.Priority ?? false);
                                                        string endTime = DateTime.Now.TimeOfDay.ToString(@"hh\:mm\:ss");

                                                        Supplier_Stock_Update supplier_Stock_Update = new Supplier_Stock_Update()
                                                        {
                                                            Supplier_Id = party_File.Party_Id ?? 0,
                                                            Stock_Data_Id = stock_Data_Id,
                                                            Start_Time = startTime,
                                                            Supplier_Response_Time = null,
                                                            End_Time = endTime,
                                                            Upload_Status = "Stock uploaded successfully",
                                                            Stock_Type = Stock_Type
                                                        };
                                                        await _supplierService.Supplier_Stock_Start_End_Time_Update(supplier_Stock_Update);
                                                    }
                                                }
                                                return Ok(new
                                                {
                                                    statusCode = HttpStatusCode.OK,
                                                    message = "File uploaded successfully.",
                                                    Party_Name = party_name,
                                                    Stock_Data_Id = stock_Data_Id
                                                });
                                            }
                                            else
                                            {
                                                return Ok(new
                                                {
                                                    statusCode = HttpStatusCode.Conflict,
                                                    Supplier_Id = party_File.Party_Id,
                                                    Party_Name = party_name,
                                                    message = "No column mapping found!"
                                                });
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    Supplier_Stock_Update supplier_Stock_Update = new Supplier_Stock_Update()
                                    {
                                        Supplier_Id = party_File.Party_Id ?? 0,
                                        Stock_Data_Id = stock_Data_Id,
                                        Start_Time = startTime,
                                        Upload_Status = "No column mapping found!",
                                        Stock_Type = Stock_Type
                                    };
                                    await _supplierService.Supplier_Stock_Start_End_Time_Update(supplier_Stock_Update);

                                    return Conflict(new
                                    {
                                        statusCode = HttpStatusCode.Conflict,
                                        Supplier_Id = party_File.Party_Id,
                                        Party_Name = party_name,
                                        message = "No column mapping found!"
                                    });
                                }
                            }
                        }
                        #endregion
                    }

                }

                Supplier_Stock_Update supplier_Stock = new Supplier_Stock_Update()
                {
                    Supplier_Id = party_File.Party_Id ?? 0,
                    Stock_Data_Id = stock_Data_Id,
                    Start_Time = startTime,
                    Upload_Status = CoreCommonMessage.SupplierPriceUpdateCheck,
                    Stock_Type = Stock_Type
                };
                await _supplierService.Supplier_Stock_Start_End_Time_Update(supplier_Stock);

                return Conflict(new
                {
                    statusCode = HttpStatusCode.Conflict,
                    Supplier_Id = party_File.Party_Id,
                    Party_Name = party_name,
                    message = CoreCommonMessage.SupplierPriceUpdateCheck
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Manual_Upload", ex.StackTrace);
                if (ex.Message.Contains("An item with the same key has already been added"))
                {
                    message = "Some column name is missing";
                }
                else
                {
                    //message = "Either column or value mapping is wrong";
                    message = ex.Message;
                }

                Supplier_Stock_Update supplier_Stock_Update = new Supplier_Stock_Update()
                {
                    Supplier_Id = party_File.Party_Id ?? 0,
                    Stock_Data_Id = stock_Data_Id,
                    Start_Time = startTime,
                    Upload_Status = message,
                    Stock_Type = Stock_Type
                };

                await _supplierService.Supplier_Stock_Start_End_Time_Update(supplier_Stock_Update);

                return Conflict(new
                {
                    statusCode = HttpStatusCode.Conflict,
                    Supplier_Id = party_File.Party_Id,
                    Party_Name = party_name,
                    message = message,

                });
            }
        }

        public bool ColumnExists(DataRow row, string columnName)
        {
            return row.Table.Columns.Contains(columnName);
        }
        #endregion

        #region Hold

        [HttpGet]
        [Route("get_party")]
        [Authorize]

        public async Task<IActionResult> Get_Party()
        {
            try
            {
                var result = await _partyService.Get_Party();
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_party_assist")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Assist(int Party_Code)
        {
            try
            {
                var result = await _partyService.Get_Party_Assist(Party_Code);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Assist", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Party Url Format

        [HttpGet]
        [Route("get_party_url_format")]
        [Authorize]
        public async Task<IActionResult> Get_Party_Url_Format(int? Id)
        {
            try
            {
                var result = await _supplierService.Get_Party_Url_Format(Id ?? 0);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Party_Url_Format", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_party_url_format")]
        [Authorize]
        public virtual async Task<IActionResult> Create_Update_Party_Url_Format(Party_Url_Format party_Url_Format)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    if (party_Url_Format != null)
                    {
                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Id", typeof(int));
                        dataTable.Columns.Add("Supplier_Id", typeof(int));
                        dataTable.Columns.Add("Sort_Code", typeof(string));
                        dataTable.Columns.Add("Image_Link", typeof(string));
                        dataTable.Columns.Add("Video_Link", typeof(string));
                        dataTable.Columns.Add("Cert_Link", typeof(string));
                        dataTable.Columns.Add("Is_Ref_Split_W", typeof(bool));
                        dataTable.Columns.Add("Is_Img_Cert", typeof(int));
                        dataTable.Columns.Add("Is_Video_Cert", typeof(int));
                        dataTable.Columns.Add("Is_Cert_Cert", typeof(int));
                        dataTable.Columns.Add("Is_Video_Iframe", typeof(bool));
                        dataTable.Columns.Add("Image_Caption", typeof(string));
                        dataTable.Columns.Add("Video_Caption", typeof(string));
                        dataTable.Columns.Add("Cert_Caption", typeof(string));
                        dataTable.Columns.Add("Image_Link_1", typeof(string));
                        dataTable.Columns.Add("Video_Link_1", typeof(string));
                        dataTable.Columns.Add("Cert_Link_1", typeof(string));
                        dataTable.Columns.Add("Similar_Image_Link_1", typeof(string));
                        dataTable.Columns.Add("Similar_Image_Link_2", typeof(string));
                        dataTable.Columns.Add("Similar_Video_Link_1", typeof(string));
                        dataTable.Columns.Add("Similar_Video_Link_2", typeof(string));
                        dataTable.Columns.Add("Similar_Cert_Link_1", typeof(string));
                        dataTable.Columns.Add("Similar_Cert_Link_2", typeof(string));

                        dataTable.Rows.Add(
                            party_Url_Format.Id,
                            party_Url_Format.Supplier_Id,
                            party_Url_Format.Sort_Code,
                            party_Url_Format.Image_Link,
                            party_Url_Format.Video_Link,
                            party_Url_Format.Cert_Link,
                            party_Url_Format.Is_Ref_Split_W,
                            party_Url_Format.Is_Img_Cert,
                            party_Url_Format.Is_Video_Cert,
                            party_Url_Format.Is_Cert_Cert,
                            party_Url_Format.Is_Video_Iframe,
                            party_Url_Format.Image_Caption,
                            party_Url_Format.Video_Caption,
                            party_Url_Format.Cert_Caption,
                            party_Url_Format.Image_Link_1,
                            party_Url_Format.Video_Link_1,
                            party_Url_Format.Cert_Link_1,
                            party_Url_Format.Similar_Image_Link_1,
                            party_Url_Format.Similar_Image_Link_2,
                            party_Url_Format.Similar_Video_Link_1,
                            party_Url_Format.Similar_Video_Link_2,
                            party_Url_Format.Similar_Cert_Link_1,
                            party_Url_Format.Similar_Cert_Link_2
                            );

                        var result = await _supplierService.Create_Update_Party_Url_Format(dataTable);
                        if (result > 0)
                        {
                            if (party_Url_Format.Id > 0)
                            {
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.Party_Url_Format_Updated
                                });
                            }
                            else
                            {
                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.Party_Url_Format_Created
                                });
                            }
                        }
                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Party_Url_Format", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_party_url_format")]
        [Authorize]
        public async Task<IActionResult> Delete_Party_Url_Format(int? Id)
        {
            try
            {
                var result = await _supplierService.Delete_Party_Url_Format(Id ?? 0);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Party_Url_Format_Deleted,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Party_Url_Format", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Get Lastest Supplier Stock

        [HttpPost]
        [Route("get_latest_supplier_stock_excel_download")]
        [Authorize]
        public async Task<IActionResult> Get_Latest_Supplier_Stock_Excel_Download(int supplier_Id)
        {
            try
            {
                if (supplier_Id > 0)
                {
                    var dt_stock = await _supplierService.Get_Latest_Supplier_Stock_Excel_Download(supplier_Id);
                    if (dt_stock != null && dt_stock.Rows.Count > 0)
                    {
                        var excelPath = string.Empty;
                        var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/DownloadLatestSupplierStockExcelFiles/");
                        if (!(Directory.Exists(filePath)))
                        {
                            Directory.CreateDirectory(filePath);
                        }
                        string filename = string.Empty;

                        filename = "Supplier_Stock_" + DateTime.UtcNow.ToString("ddMMyyyy_HHmmss") + ".xlsx";
                        EpExcelExport.Create_Latest_Supplier_Stock_Excel(dt_stock, filePath, filePath + filename);
                        excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.DownloadLatestSupplierStockExcelFiles + filename;

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            result = excelPath,
                            file_name = filename
                        });
                    }
                    else
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.No_stock_uploaded_in_last,
                        });
                    }
                }
                else
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.Supplier_Id_Less_Than_0,
                    });
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Latest_Supplier_Stock_Excel_Download", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Suzy Api

        [HttpGet]
        [Route("get_suzy_stock")]
        public async Task<IActionResult> Get_Suzy_Stock(string login_url, string stock_url, string key, string value)
        {
            try
            {
                var client = new HttpClient();
                var request = new HttpRequestMessage(HttpMethod.Get, login_url);
                request.Headers.Add(key, value);
                var response = await client.SendAsync(request);

                if (response.IsSuccessStatusCode)
                {
                    var json = await response.Content.ReadAsStringAsync();
                    string cleanedJson = json.Replace("\\\"", "\"").Trim('"');

                    var jsonObject = JsonConvert.DeserializeObject<JObject>(cleanedJson);

                    var token = jsonObject["Token"]?.ToString();
                    if (token != null)
                    {
                        var client1 = new HttpClient();
                        var request1 = new HttpRequestMessage(HttpMethod.Get, stock_url);
                        request1.Headers.Add("token", token.ToString());
                        var response1 = await client1.SendAsync(request1);

                        if (response1.IsSuccessStatusCode)
                        {
                            var json1 = await response1.Content.ReadAsStringAsync();

                            var diamondInfos = new List<Suzy_Model>();
                            var items = JArray.Parse(json1);
                            int index = 0;

                            foreach (var item in items)
                            {
                                var model = item.ToObject<Suzy_Model>();
                                diamondInfos.Add(model);

                                index++;
                            }

                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = CoreCommonMessage.DataSuccessfullyFound,
                                data = diamondInfos
                            });
                        }
                        else
                        {
                            var errorDetails = await response1.Content.ReadAsStringAsync();
                            string cleanedJson1 = errorDetails.Replace("\\\"", "\"").Trim('"');
                            Suzy_Error_Model errordiamondInfos = JsonConvert.DeserializeObject<Suzy_Error_Model>(cleanedJson1);

                            await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Suzy_Stock", errorDetails);
                            return Conflict(new
                            {
                                statusCode = errordiamondInfos.Status,
                                message = errordiamondInfos.Message
                            });
                        }
                    }
                    else
                    {
                        var errorDetails = await response.Content.ReadAsStringAsync();
                        string cleanedJson1 = errorDetails.Replace("\\\"", "\"").Trim('"');
                        Suzy_Error_Model errordiamondInfos = JsonConvert.DeserializeObject<Suzy_Error_Model>(cleanedJson1);

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Suzy_Stock", errorDetails);
                        return Conflict(new
                        {
                            statusCode = errordiamondInfos.Status,
                            message = errordiamondInfos.Message
                        });
                    }
                }
                else
                {
                    var errorDetails = await response.Content.ReadAsStringAsync();
                    string cleanedJson1 = errorDetails.Replace("\\\"", "\"").Trim('"');
                    Suzy_Error_Model errordiamondInfos = JsonConvert.DeserializeObject<Suzy_Error_Model>(cleanedJson1);

                    await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Suzy_Stock", errorDetails);
                    return Conflict(new
                    {
                        statusCode = errordiamondInfos.Status,
                        message = errordiamondInfos.Message
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Suzy_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Suzy_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Send Mail for Supplier Upload Stock

        [HttpGet]
        [Route("get_supplier_stock_upload_status_email")]
        public async Task<IActionResult> Get_Supplier_Stock_Upload_Status_Email()
        {
            try
            {
                var dtSupplier = await _partyService.Get_Supplier_Stock_Upload_Status();
                if (dtSupplier != null && dtSupplier.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/SupplierStockUploadStatusExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = "Supplier_Stock_Upload_Status_" + DateTime.UtcNow.ToString("ddMMyyyy_HHmmss") + ".xlsx";
                    EpExcelExport.Create_Supplier_Stock_Upload_Status_Excel(dtSupplier, filePath, filePath + filename);
                    excelPath = Directory.GetCurrentDirectory() + CoreCommonFilePath.SupplierStockUploadStatusExcelFiles + filename;

                    byte[] fileBytes = System.IO.File.ReadAllBytes(excelPath);
                    using (MemoryStream memoryStream = new MemoryStream(fileBytes))
                    {
                        IFormFile formFile = new FormFile(memoryStream, 0, fileBytes.Length, "excelFile", Path.GetFileName(excelPath));
                        _emailSender.SendEmail(toEmail: "tejash@brainwaves.co.in, jignesh@sunrisediam.com, list@sunrisediam.com", externalLink: "", subject: CoreCommonMessage.Supplier_Stock_Upload_Status_Email, formFile: formFile, strBody: CoreCommonMessage.Supplier_Stock_Upload_Status_Email);

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.EmailSendSuccessMessage
                        });
                    }

                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Stock_Upload_Status_Email", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Jodhani Api

        [HttpPost]
        [Route("get_jodhani_stock")]
        public async Task<IActionResult> Get_Jodhani_Stock(string url, [FromForm] string payload)
        {
            try
            {
                using (var client = new HttpClient())
                {
                    var content = new StringContent(payload, Encoding.UTF8, "text/xml");
                    content.Headers.Add("SOAPAction", "http://tempuri.org/Stock_API");

                    HttpResponseMessage response = await client.PostAsync(url, content);

                    if (response.IsSuccessStatusCode)
                    {
                        var responseString = await response.Content.ReadAsStringAsync();

                        return StatusCode((int)response.StatusCode, responseString);
                    }
                    else
                    {
                        var errorDetails = await response.Content.ReadAsStringAsync();

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Jodhani_Stock", errorDetails);
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ApiFailed,
                            error = errorDetails
                        });
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Jodhani_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Jodhani_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region KBS Api

        [HttpPost]
        [Route("get_kbs_stock")]
        public async Task<IActionResult> Get_KBS_Stock(KBS_Model kbs_Model)
        {
            try
            {
                var _client = new HttpClient();

                var _request = new HttpRequestMessage(HttpMethod.Post, kbs_Model.Login_URL);

                var collection = new List<KeyValuePair<string, string>>();
                collection.Add(new(kbs_Model.Action_Caption, kbs_Model.Action_Value));
                collection.Add(new(kbs_Model.User_Caption, kbs_Model.User_Name));
                collection.Add(new(kbs_Model.Password_Caption, kbs_Model.Password));

                var content = new FormUrlEncodedContent(collection);

                _request.Content = content;

                var _response = await _client.SendAsync(_request);

                if (_response.IsSuccessStatusCode)
                {
                    var json = await _response.Content.ReadAsStringAsync();
                    string cleanedJson = json.Replace("\\\"", "\"").Trim('"');

                    var jsonObject = JsonConvert.DeserializeObject<JObject>(cleanedJson);

                    var token = jsonObject["access_token"]?.ToString();

                    using (var client = new HttpClient())
                    {
                        var request = new HttpRequestMessage(HttpMethod.Get, kbs_Model.Stock_Url);
                        request.Headers.Add("Authorization", "Bearer " + token);
                        var response = await client.SendAsync(request);

                        if (response.IsSuccessStatusCode)
                        {
                            var responseString = await response.Content.ReadAsStringAsync();

                            return StatusCode((int)response.StatusCode, responseString);
                        }
                        else
                        {
                            var errorDetails = await response.Content.ReadAsStringAsync();

                            await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_KBS_Stock", errorDetails);
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = CoreCommonMessage.ApiFailed,
                                error = errorDetails
                            });
                        }
                    }
                }
                else
                {
                    var errorDetails = await _response.Content.ReadAsStringAsync();

                    await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_KBS_Stock", errorDetails);
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ApiFailed,
                        error = errorDetails
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_KBS_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_KBS_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Jewel Paradise Api

        [HttpPost]
        [Route("get_jewel_paradise_stock")]
        public async Task<IActionResult> Get_Jewel_Paradise_Stock(Jewel_Paradise_Model jewel_Paradise_Model)
        {
            try
            {
                var _client = new HttpClient();

                var _request = new HttpRequestMessage(HttpMethod.Get, jewel_Paradise_Model.Login_URL);

                var _content = new MultipartFormDataContent();
                _content.Add(new StringContent(jewel_Paradise_Model.User_Name), jewel_Paradise_Model.User_Caption);
                _content.Add(new StringContent(jewel_Paradise_Model.Password), jewel_Paradise_Model.Password_Caption);
                _content.Add(new StringContent(jewel_Paradise_Model.Action_Value), jewel_Paradise_Model.Action_Caption);

                _request.Content = _content;

                var _response = await _client.SendAsync(_request);

                if (_response.IsSuccessStatusCode)
                {
                    var json = await _response.Content.ReadAsStringAsync();
                    string cleanedJson = json.Replace("\\\"", "\"").Trim('"');

                    var jsonObject = JsonConvert.DeserializeObject<JObject>(cleanedJson);

                    var token = jsonObject["msgdata"]?["token"]?.ToString();

                    using (var client = new HttpClient())
                    {
                        var request = new HttpRequestMessage(HttpMethod.Get, jewel_Paradise_Model.Login_URL);

                        var content = new MultipartFormDataContent();
                        content.Add(new StringContent(token), "token");
                        content.Add(new StringContent(jewel_Paradise_Model.Action_Value1), jewel_Paradise_Model.Action_Caption1);

                        request.Content = content;

                        var response = await client.SendAsync(request);

                        if (response.IsSuccessStatusCode)
                        {
                            var responseString = await response.Content.ReadAsStringAsync();

                            return StatusCode((int)response.StatusCode, responseString);
                        }
                        else
                        {
                            var errorDetails = await response.Content.ReadAsStringAsync();

                            await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Jewel_Paradise_Stock", errorDetails);
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = CoreCommonMessage.ApiFailed,
                                error = errorDetails
                            });
                        }
                    }
                }
                else
                {
                    var errorDetails = await _response.Content.ReadAsStringAsync();

                    await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Jewel_Paradise_Stock", errorDetails);
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ApiFailed,
                        error = errorDetails
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Jewel_Paradise_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Jewel_Paradise_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region EXCEL SUCCESS LIMITED - (S) Api

        [HttpPost]
        [Route("get_excel_success_limited_stock")]
        public async Task<IActionResult> Get_Excel_Success_Limited_Stock(string stock_URL)
        {
            try
            {
                var _client = new HttpClient();

                var _request = new HttpRequestMessage(HttpMethod.Get, stock_URL);

                var _response = await _client.SendAsync(_request);

                if (_response.IsSuccessStatusCode)
                {
                    var responseString = await _response.Content.ReadAsStringAsync();

                    return StatusCode((int)_response.StatusCode, responseString);
                }
                else
                {
                    var errorDetails = await _response.Content.ReadAsStringAsync();

                    await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Excel_Success_Limited_Stock", errorDetails);
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ApiFailed,
                        error = errorDetails
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Excel_Success_Limited_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Excel_Success_Limited_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Kapu Api

        [HttpPost]
        [Route("get_kapu_stock")]
        public async Task<IActionResult> Get_Kapu_Stock()
        {
            try
            {
                var _client = new HttpClient();
                var _request = new HttpRequestMessage(HttpMethod.Post, "https://api.kapugems.com/marketing/apiAuth");
                _request.Headers.Add("clientkey", "7tRvkp#UUxy1sXx0GZhTQX5GmY4@k5pr");
                _request.Headers.Add("method", "authenticate");
                var _content = new StringContent("{\n\"username\":\"samit_gandhi\",\n\"password\":\"sam007\"\n}", null, "application/json");
                _request.Content = _content;
                var _response = await _client.SendAsync(_request);

                if (_response.IsSuccessStatusCode)
                {
                    var json = await _response.Content.ReadAsStringAsync();
                    string cleanedJson = json.Replace("\\\"", "\"").Trim('"');

                    var jsonObject = JsonConvert.DeserializeObject<JObject>(cleanedJson);

                    var token = jsonObject["result"]?["authToken"]?.ToString();

                    if (token != null)
                    {
                        using (var client = new HttpClient())
                        {
                            var request = new HttpRequestMessage(HttpMethod.Post, "https://api.kapugems.com/marketing/apiStock");
                            request.Headers.Add("method", "stockDownloadJson");
                            var content = new StringContent($"{{\n\"authToken\":\"{token}\"\n}}", null, "application/json");

                            request.Content = content;

                            var response = await client.SendAsync(request);

                            if (response.IsSuccessStatusCode)
                            {
                                var responseString = await response.Content.ReadAsStringAsync();

                                return StatusCode((int)response.StatusCode, responseString);
                            }
                            else
                            {
                                var errorDetails = await response.Content.ReadAsStringAsync();

                                await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Kapu_Stock", errorDetails);
                                return Conflict(new
                                {
                                    statusCode = HttpStatusCode.Conflict,
                                    message = CoreCommonMessage.ApiFailed,
                                    error = errorDetails
                                });
                            }
                        }
                    }
                    else
                    {
                        var errorDetails = await _response.Content.ReadAsStringAsync();

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Kapu_Stock", errorDetails);
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ApiFailed,
                            error = errorDetails
                        });
                    }
                }
                else
                {
                    var errorDetails = await _response.Content.ReadAsStringAsync();

                    await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Kapu_Stock", errorDetails);
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ApiFailed,
                        error = errorDetails
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Kapu_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Kapu_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region DIANCO (HK) LTD - S Api

        [HttpPost]
        [Route("get_dianco_stock")]
        public async Task<IActionResult> Get_Dianco_Stock(Dianco_Model dianco_Model)
        {
            try
            {
                var _client = new HttpClient();

                var _request = new HttpRequestMessage(HttpMethod.Post, dianco_Model.Login_URL);

                var collection = new List<KeyValuePair<string, string>>();
                collection.Add(new(dianco_Model.Action_Caption, dianco_Model.Action_Value));
                collection.Add(new(dianco_Model.User_Caption, dianco_Model.User_Name));
                collection.Add(new(dianco_Model.Password_Caption, dianco_Model.Password));

                var content = new FormUrlEncodedContent(collection);

                _request.Content = content;

                var _response = await _client.SendAsync(_request);

                if (_response.IsSuccessStatusCode)
                {
                    var json = await _response.Content.ReadAsStringAsync();
                    string cleanedJson = json.Replace("\\\"", "\"").Trim('"');

                    var jsonObject = JsonConvert.DeserializeObject<JObject>(cleanedJson);

                    var token = jsonObject["access_token"]?.ToString();

                    using (var client = new HttpClient())
                    {
                        var request = new HttpRequestMessage(HttpMethod.Get, dianco_Model.Stock_Url);
                        request.Headers.Add("Authorization", "Bearer " + token);
                        var response = await client.SendAsync(request);

                        if (response.IsSuccessStatusCode)
                        {
                            var responseString = await response.Content.ReadAsStringAsync();

                            return StatusCode((int)response.StatusCode, responseString);
                        }
                        else
                        {
                            var errorDetails = await response.Content.ReadAsStringAsync();

                            await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Dianco_Stock", errorDetails);
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = CoreCommonMessage.ApiFailed,
                                error = errorDetails
                            });
                        }
                    }
                }
                else
                {
                    var errorDetails = await _response.Content.ReadAsStringAsync();

                    await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Dianco_Stock", errorDetails);
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ApiFailed,
                        error = errorDetails
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Dianco_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Dianco_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Krisha Api

        [HttpPost]
        [Route("get_krisha_stock")]
        public async Task<IActionResult> Get_Krisha_Stock(string url)
        {
            try
            {
                using (var client = new HttpClient())
                {
                    var request = new HttpRequestMessage(HttpMethod.Get, url);
                    var response = await client.SendAsync(request);

                    if (response.IsSuccessStatusCode)
                    {
                        var responseString = await response.Content.ReadAsStringAsync();

                        return StatusCode((int)response.StatusCode, responseString);
                    }
                    else
                    {
                        var errorDetails = await response.Content.ReadAsStringAsync();

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Krisha_Stock", errorDetails);
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ApiFailed,
                            error = errorDetails
                        });
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Krisha_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Krisha_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Get Supplier Stock Get Post

        [HttpPost]
        [Route("get_supplier_stock_get_post")]
        public async Task<IActionResult> Get_Supplier_Stock_Get_Post(Supplier_Stock_Get_Post_Model supplier_Stock_Get_Post_Model)
        {
            try
            {
                using (var client = new HttpClient())
                {
                    var request = new HttpRequestMessage(supplier_Stock_Get_Post_Model.Stock_Method.Equals("GET", StringComparison.OrdinalIgnoreCase) ? HttpMethod.Get : HttpMethod.Post, supplier_Stock_Get_Post_Model.Stock_Url);

                    var response = await client.SendAsync(request);

                    if (response.IsSuccessStatusCode)
                    {
                        var responseString = await response.Content.ReadAsStringAsync();

                        return StatusCode((int)response.StatusCode, responseString);
                    }
                    else
                    {
                        var errorDetails = await response.Content.ReadAsStringAsync();

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Supplier_Stock_Get_Post", errorDetails);
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ApiFailed,
                            error = errorDetails
                        });
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Supplier_Stock_Get_Post", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Stock_Get_Post", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Shree Krishna Api

        [HttpPost]
        [Route("get_skrishna_stock")]
        public async Task<IActionResult> Get_SKrishna_Stock(string url, string token)
        {
            try
            {
                using (var client = new HttpClient())
                {
                    var request = new HttpRequestMessage(HttpMethod.Post, url);

                    var collection = new List<KeyValuePair<string, string>>();
                    collection.Add(new("Shape", ""));
                    collection.Add(new("Color", ""));
                    collection.Add(new("Clarity", ""));
                    collection.Add(new("Cut", ""));
                    collection.Add(new("Polish", ""));
                    collection.Add(new("Symm", ""));
                    collection.Add(new("Flour", ""));
                    collection.Add(new("Lab", ""));
                    collection.Add(new("FromSize", ""));
                    collection.Add(new("ToSize", ""));
                    collection.Add(new("FromLength", ""));
                    collection.Add(new("ToLength", ""));
                    collection.Add(new("FromWidth", ""));
                    collection.Add(new("ToWidth", ""));
                    collection.Add(new("FromHeight", ""));
                    collection.Add(new("ToHeight", ""));
                    collection.Add(new("FromTablePer", ""));
                    collection.Add(new("ToTablePer", ""));
                    collection.Add(new("FromDepthPer", ""));
                    collection.Add(new("ToDepthPer", ""));
                    collection.Add(new("Token", token));
                    var content = new FormUrlEncodedContent(collection);

                    request.Content = content;

                    var response = await client.SendAsync(request);

                    if (response.IsSuccessStatusCode)
                    {
                        var responseString = await response.Content.ReadAsStringAsync();

                        return StatusCode((int)response.StatusCode, responseString);
                    }
                    else
                    {
                        var errorDetails = await response.Content.ReadAsStringAsync();

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_SKrishna_Stock", errorDetails);
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ApiFailed,
                            error = errorDetails
                        });
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_SKrishna_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_SKrishna_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Excellent Diamonds Api

        [HttpPost]
        [Route("get_excellent_diamonds_stock")]
        public async Task<IActionResult> Get_Excellent_Diamonds_Stock(Excellent_DIamonds_Model excellent_DIamonds_Model)
        {
            try
            {
                using (var client = new HttpClient())
                {
                    HttpResponseMessage response = await client.GetAsync(excellent_DIamonds_Model.Stock_Url);

                    if (response.IsSuccessStatusCode)
                    {
                        var responseString = await response.Content.ReadAsStringAsync();

                        return StatusCode((int)response.StatusCode, responseString);
                    }
                    else
                    {
                        var errorDetails = await response.Content.ReadAsStringAsync();

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Excellent_Diamonds_Stock", errorDetails);
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ApiFailed,
                            error = errorDetails
                        });
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Excellent_Diamonds_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Excellent_Diamonds_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Diarough Api
        /*
         * Added By Jashmin Patel(2025/05/13)
         * For Diarough API.
         */
        [HttpPost]
        [Route("get_diarough_stock")]
        public async Task<IActionResult> Get_Diarough_Stock(Diarough_Model model)
        {
            try
            {
                var _client = new HttpClient();

                var _request = new HttpRequestMessage(HttpMethod.Post, model.Login_URL);

                var _credentials = new Dictionary<string, string>
                {
                    { model.User_Caption , model.User_Name},
                    { model.Password_Caption, model.Password }
                };

                var _content = new StringContent(JsonConvert.SerializeObject(_credentials), Encoding.UTF8, "application/json");

                _request.Content = _content;

                var _response = await _client.SendAsync(_request);

                if (_response.IsSuccessStatusCode)
                {
                    var json = await _response.Content.ReadAsStringAsync();
                    string cleanedJson = json.Replace("\\\"", "\"").Trim('"');

                    var jsonObject = JsonConvert.DeserializeObject<JObject>(cleanedJson);

                    var partyId = jsonObject["Data"]?["Party_Id"]?.ToString();
                    var token = jsonObject["Data"]?["Token"]?.ToString();

                    using (var client = new HttpClient())
                    {
                        var stockUrl = $"{model.Stock_Url}?{model.Action_Caption}={partyId}&{model.Action_Caption1}={token}";
                        var request = new HttpRequestMessage(HttpMethod.Get, stockUrl);
                        var response = await client.SendAsync(request);

                        if (response.IsSuccessStatusCode)
                        {
                            var responseString = await response.Content.ReadAsStringAsync();

                            return StatusCode((int)response.StatusCode, responseString);
                        }
                        else
                        {
                            var errorDetails = await response.Content.ReadAsStringAsync();

                            await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Diarough_Stock", errorDetails);
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = CoreCommonMessage.ApiFailed,
                                error = errorDetails
                            });
                        }
                    }
                }
                else
                {
                    var errorDetails = await _response.Content.ReadAsStringAsync();

                    await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_Diarough_Stock", errorDetails);
                    return Conflict(new
                    {
                        statusCode = HttpStatusCode.Conflict,
                        message = CoreCommonMessage.ApiFailed,
                        error = errorDetails
                    });
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_Diarough_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Diarough_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region StarRays Api
        /*
         * Added By Jashmin Patel(2025/07/23)
         * For STARRAYS API.
         */
        [HttpPost]
        [Route("get_starrays_stock")]
        public async Task<IActionResult> Get_StarRays_Stock(StarRays_Model model)
        {
            try
            {
                using (var client = new HttpClient())
                {
                    string credentials = Convert.ToBase64String(Encoding.ASCII.GetBytes($"{model.User_Name}:{model.Password}"));
                    client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Basic", credentials);

                    HttpResponseMessage response = await client.PostAsync(model.Stock_Url, null);

                    if (response.IsSuccessStatusCode)
                    {
                        var responseString = await response.Content.ReadAsStringAsync();

                        return StatusCode((int)response.StatusCode, responseString);
                    }
                    else
                    {
                        var errorDetails = await response.Content.ReadAsStringAsync();

                        await _commonService.InsertErrorLog(CoreCommonMessage.ApiFailed, "Get_StarRays_Stock", errorDetails);
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ApiFailed,
                            error = errorDetails
                        });
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                await _commonService.InsertErrorLog(httpEx.Message, "Get_StarRays_Stock", httpEx.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = CoreCommonMessage.ApiError,
                    error = httpEx.Message
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_StarRays_Stock", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Supplier Special Price Validity
        [HttpPost]
        [Route("get_supplier_special_price_validity")]
        public async Task<IActionResult> Get_Supplier_Special_Price_Validity(int Party_Id)
        {
            try
            {
                var SupplierPrice = await _partyService.Get_Supplier_Special_Price_Validity(Party_Id);
                if (SupplierPrice != null && SupplierPrice.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = "Special prices are going to expire on " + SupplierPrice[0].Values.FirstOrDefault()?.ToString() + ". Please change the validity days accordingly."
                    });
                }
                else
                {
                    return NoContent();
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_Special_Price_Validity", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    statusCode = HttpStatusCode.InternalServerError,
                    message = ex.Message,
                    error = ex.StackTrace
                });
            }
        }

        #endregion

        #region Firebase Messaging Notification
        public async Task Firebase_Messaging_Notification(List<string> DeviceIds, string title, string body)
        {
            try
            {
                string sound = "default";

                var firebaseConfig = _configuration.GetSection("FirebaseConfig");

                string projectId = firebaseConfig["ProjectId"];

                var serviceAccountJson = firebaseConfig.GetSection("ServiceAccount").Get<Dictionary<string, string>>();

                if (string.IsNullOrEmpty(projectId) || serviceAccountJson == null)
                {
                    throw new Exception("Firebase configuration is missing in appsettings.json.");
                }

                string serviceAccountJsonString = JsonConvert.SerializeObject(serviceAccountJson);

                var credential = GoogleCredential.FromJson(serviceAccountJsonString)
                    .CreateScoped("https://www.googleapis.com/auth/firebase.messaging");

                string url = $"https://fcm.googleapis.com/v1/projects/{projectId}/messages:send";

                string accessToken = await credential.UnderlyingCredential.GetAccessTokenForRequestAsync();

                foreach (var token in DeviceIds)
                {
                    var message = new
                    {
                        message = new
                        {
                            token = token.Trim(),
                            notification = new
                            {
                                body = body,
                                title = title
                            },
                            android = new
                            {
                                notification = new
                                {
                                    sound = sound
                                }
                            },
                            apns = new
                            {
                                payload = new
                                {
                                    aps = new
                                    {
                                        sound = sound
                                    }
                                }
                            }
                        }
                    };

                    string jsonMessage = JsonConvert.SerializeObject(message);

                    using (var client = new HttpClient())
                    {
                        client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = await client.PostAsync(url, new StringContent(jsonMessage, Encoding.UTF8, "application/json"));
                        string responseString = await response.Content.ReadAsStringAsync();

                        Console.WriteLine("Response: " + responseString);
                    }
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Firebase_Messaging_Notification", ex.StackTrace);
            }
        }

        #endregion

        #region Connect GIA Report Layout Save

        [HttpGet]
        [Route("get_connect_gia_result_layout_detail")]
        [Authorize]
        public async Task<IActionResult> Get_Connect_GIA_Result_Layout_Detail(int user_pricing_id, int Rm_Id)
        {
            try
            {
                List<Report_Layout_Save> report_Layout_Saves = new List<Report_Layout_Save>();

                report_Layout_Saves = await _partyService.Get_Connect_GIA_Result_Layout(user_pricing_id, Rm_Id);

                var customer_Column_Captions = await _partyService.Get_Connect_GIA_Result_Column_Caption(user_pricing_id);

                if (report_Layout_Saves == null || report_Layout_Saves.Count == 0)
                {
                    report_Layout_Saves = new List<Report_Layout_Save>
                    {
                        new Report_Layout_Save
                        {
                            Id = 0,
                            User_Id = user_pricing_id,
                            Rm_Id = Rm_Id,
                            Name = "DEFAULT",
                            Status = false,
                            Report_Layout_Save_Detail_List = customer_Column_Captions
                        }
                    };
                }
                else
                {
                    report_Layout_Saves[0].User_Id = user_pricing_id;
                    report_Layout_Saves[0].Rm_Id = Rm_Id;
                    report_Layout_Saves[0].Report_Layout_Save_Detail_List = customer_Column_Captions;
                }

                if (report_Layout_Saves != null && (customer_Column_Captions != null))
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        report_Layout_Saves = report_Layout_Saves
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Connect_GIA_Result_Layout_Detail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_connect_gia_report_layout_save")]
        [Authorize]
        public async Task<IActionResult> Create_Update_Connect_GIA_Report_Layout_Save(Report_Layout_Save report_Layout_Save)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var (message, report_layout_save_Id) = await _supplierService.Create_Update_Connect_GIA_Report_Layout_Save(report_Layout_Save);

                    if (message == "success" && report_layout_save_Id > 0)
                    {
                        if (report_Layout_Save.Report_Layout_Save_Detail_List != null && report_Layout_Save.Report_Layout_Save_Detail_List.Count > 0)
                        {
                            DataTable dataTable = new DataTable();
                            dataTable.Columns.Add("Id", typeof(int));
                            dataTable.Columns.Add("Report_Layout_Id", typeof(int));
                            dataTable.Columns.Add("colId", typeof(string));
                            dataTable.Columns.Add("width", typeof(int));
                            dataTable.Columns.Add("hide", typeof(bool));
                            dataTable.Columns.Add("pinned", typeof(string));
                            dataTable.Columns.Add("sort", typeof(string));
                            dataTable.Columns.Add("sortIndex", typeof(int));
                            dataTable.Columns.Add("aggFunc", typeof(string));
                            dataTable.Columns.Add("rowGroup", typeof(bool));
                            dataTable.Columns.Add("rowGroupIndex", typeof(int));
                            dataTable.Columns.Add("pivot", typeof(bool));
                            dataTable.Columns.Add("pivotIndex", typeof(int));
                            dataTable.Columns.Add("flex", typeof(int));

                            foreach (var item in report_Layout_Save.Report_Layout_Save_Detail_List)
                            {
                                dataTable.Rows.Add(item.Id, report_layout_save_Id, item.colId, item.width, item.hide, item.pinned, item.sort, item.sortIndex, item.aggFunc, item.rowGroup, item.rowGroupIndex, item.pivot, item.pivotIndex, item.flex);
                            }
                            await _supplierService.Insert_Update_Connect_GIA_Report_Layout_Save_Detail(dataTable);
                        }
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = report_Layout_Save.Id > 0 ? CoreCommonMessage.LayoutReportUpdated : CoreCommonMessage.LayoutReportCreated
                        });
                    }
                    else if (message == "exist")
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.LayoutReportNameExist,
                        });

                    }
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_Connect_GIA_Report_Layout_Save", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_connect_gia_report_users_role")]
        [Authorize]
        public async Task<IActionResult> Get_Connect_GIA_Report_Users_Role(int id, int user_Id)
        {
            try
            {
                var result = await _supplierService.Get_Connect_GIA_Report_Users_Role(id, user_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Connect_GIA_Report_Users_Role", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_connect_gia_report_layout_save")]
        [Authorize]
        public async Task<IActionResult> Get_Connect_GIA_Report_Layout_Save(int User_Id, int Rm_Id)
        {
            try
            {
                var result = await _supplierService.Get_Connect_GIA_Report_Layout_Save(User_Id, Rm_Id);
                if (result != null && result.Count > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        data = result
                    });
                }
                return NoContent();
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Connect_GIA_Report_Layout_Save", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Purchase Detail Manual Discount
        /*
         * Date: 2025/04/28 By Jashmin Patel
         * get list of purchase details by cert_no or stock_id
         */
        [HttpPost]
        [Route("purchase_detail_manual_discount")]
        [Authorize]
        public async Task<IActionResult> Purchase_Detail_Manual_Discount([FromForm] Purchase_Detail_Manual_Discount_Model model, IFormFile manualDiscountFile)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Purchase_Detail_Id", typeof(int));
                    dataTable.Columns.Add("Manual_Discount_Detail_Id", typeof(int));
                    dataTable.Columns.Add("Stock_Id", typeof(string));
                    dataTable.Columns.Add("Cert_No", typeof(string));
                    dataTable.Columns.Add("Prev_Disc", typeof(decimal));
                    dataTable.Columns.Add("New_Disc", typeof(decimal));

                    if (model.Stock_Id != null)
                    {
                        string[] stock_ids = model.Stock_Id.Split(",");

                        foreach (var item in stock_ids)
                        {
                            dataTable.Rows.Add(DBNull.Value, DBNull.Value, string.IsNullOrEmpty(item) ? DBNull.Value : item, DBNull.Value, DBNull.Value, DBNull.Value);
                        }
                    }
                    if (manualDiscountFile != null && manualDiscountFile.Length > 0)
                    {
                        var filePath = Path.GetTempFileName();
                        using (var stream = new FileStream(filePath, FileMode.Create))
                        {
                            await manualDiscountFile.CopyToAsync(stream);
                        }
                        using (var package = new ExcelPackage(new FileInfo(filePath)))
                        {
                            var worksheet = package.Workbook.Worksheets[0];
                            int startRow = 2;

                            HashSet<string> uniqueValues = new HashSet<string>();
                            for (int row = startRow; row <= worksheet.Dimension.End.Row; row++)
                            {
                                string stock_id = worksheet.Cells[row, 1].GetValue<string>();
                                string new_discount = worksheet.Cells[row, 2].GetValue<string>();

                                dataTable.Rows.Add(DBNull.Value, DBNull.Value, string.IsNullOrEmpty(stock_id) ? DBNull.Value : stock_id, DBNull.Value, DBNull.Value, new_discount);
                            }
                        }
                    }
                    if (dataTable != null || dataTable.Rows.Count > 0)
                    {
                        var result = await _supplierService.Get_Purchase_Detail_Manual_Discount(dataTable, 1);
                        var result_Message = await _supplierService.Get_Purchase_Detail_Manual_Discount(dataTable, 2);

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            unavailable_message = result_Message,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Purchase_Detail_Manual_Discount", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        /*
         * Date: 2025/04/28 By Jashmin Patel
         * get list of purchase details by cert_no or stock_id
         */
        [HttpPost]
        [Route("update_purchase_detail_manual_discount")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Detail_Manual_Discount(Purchase_Detail_Manual_Discount_List purchase_Detail_Manual_Discount)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                    IList<Purchase_Detail_Manual_Discount> purchase_Detail_Discount_List = JsonConvert.DeserializeObject<IList<Purchase_Detail_Manual_Discount>>(purchase_Detail_Manual_Discount.Purchase_Detail_Manual_Discount.ToString());

                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Purchase_Detail_Id", typeof(int));
                    dataTable.Columns.Add("Manual_Discount_Detail_Id", typeof(int));
                    dataTable.Columns.Add("Stock_Id", typeof(string));
                    dataTable.Columns.Add("Cert_No", typeof(string));
                    dataTable.Columns.Add("Prev_Disc", typeof(decimal));
                    dataTable.Columns.Add("New_Disc", typeof(decimal));

                    foreach (var item in purchase_Detail_Discount_List)
                    {
                        dataTable.Rows.Add(
                            item.Id ?? 0,
                            item.Manual_Discount_Detail_Id ?? 0,
                            item.Stock_Id,
                            item.Cert_No,
                            item.Prev_Disc,
                            item.New_Disc
                        );
                    }

                    var result = await _supplierService.Set_Purchase_Detail_Manual_Discount(dataTable, user_Id ?? 0);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.UpdatedSuccessfully,
                        data = result,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "update_purchase_detail_manual_discount", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        #endregion

        #region Quotation Master From Lab Detail
        /*
         * Date: 2025/05/05 By Jashmin Patel
         * quotation master...
         */
        [HttpPost]
        [Route("quotation_master_insert_update")]
        [Authorize]
        public async Task<IActionResult> Quotation_Master_Insert_Update(Quotation_Master model)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                    if ((user_Id ?? 0) > 0)
                    {
                        IList<Quotation_Master_Lab_Entry_Detail> lab_Entry_Detail_List = JsonConvert.DeserializeObject<IList<Quotation_Master_Lab_Entry_Detail>>(model.Quotation_Master_Lab_Entry_Detail.ToString());
                        IList<Quotation_Expense_Detail> quotation_Expense_Detail_List = JsonConvert.DeserializeObject<IList<Quotation_Expense_Detail>>(model.Quotation_Expense_Detail.ToString());

                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Trans_Id", typeof(int));
                        dataTable.Columns.Add("Order_No", typeof(string));
                        dataTable.Columns.Add("Stock_Id", typeof(string));
                        foreach (var item in lab_Entry_Detail_List)
                        {
                            dataTable.Rows.Add(item.Trans_Id ?? 0, item.Order_No?.ToString(), item.Stock_Id?.ToString());
                        }
                        DataTable quotation_Expense = new DataTable();
                        quotation_Expense.Columns.Add("Expense_Id", typeof(int));
                        quotation_Expense.Columns.Add("Expense_Value", typeof(decimal));
                        foreach (var item in quotation_Expense_Detail_List)
                        {
                            quotation_Expense.Rows.Add(item.Expense_Id ?? 0, item.Expense_Value ?? 0);
                        }

                        if (dataTable != null || dataTable.Rows.Count > 0)
                        {
                            var quotation_Id = await _supplierService.Set_Quotation_Master(dataTable, quotation_Expense, model, user_Id ?? 0);
                            if (quotation_Id > 0)
                            {
                                var quotation_master_data = await _supplierService.Get_Quotation_Master(quotation_Id);
                                var quotation_detail_data = await _supplierService.Get_Quotation_Detail(quotation_Id, model.Is_Summary);
                                var company_data = await _companyService.Get_Company_Details_By_Id(model.Company_Id ?? 0);
                                var party_data = await _partyService.Get_Quotation_BillParty_Detail(model.Bill_To_Id ?? 0);
                                var ship_to_data = await _partyService.Get_Quotation_BillParty_Detail(model.Ship_To_Id ?? 0);
                                var term_data = await _supplierService.Get_Quotation_Other_Detail(model.Trans_Date);
                                var quotation_expense_data = await _supplierService.Get_Quotation_Expense_Detail(quotation_Id);

                                var data = new
                                {
                                    Quotation_Master = quotation_master_data,
                                    Quotation_Detail = quotation_detail_data,
                                    Quotation_Expense_Detail = quotation_expense_data,
                                };
                                var report_icons_data = new
                                {
                                    SHAIRU_Group_LOGO = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "SHAIRU_Group_LOGO.png",
                                    sightholder = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "sightholder.png",
                                    chop = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "chop.png",
                                    sign = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "sign.png",
                                };

                                return Ok(new
                                {
                                    statusCode = HttpStatusCode.OK,
                                    message = CoreCommonMessage.DataSuccessfullyFound,
                                    data = data,
                                    company_detail = company_data,
                                    party_detail = party_data,
                                    shipping_party_detail = ship_to_data,
                                    term_detail = term_data,
                                    report_icons = report_icons_data,
                                });
                            }
                        }
                        return NoContent();
                    }
                    return StatusCode((int)HttpStatusCode.Unauthorized, new
                    {
                        message = "Unauthorized Access",
                        statusCode = (int)HttpStatusCode.Unauthorized
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Quotation_Master_Insert_Update", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpGet]
        [Route("quotation_master_remark_list")]
        [Authorize]
        public async Task<IActionResult> Quotation_Master_Remark_List()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_Quotation_Remarks_List();
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Quotation_Master_Remark_List", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpGet]
        [Route("quotation_master_company_bank_list")]
        [Authorize]
        public async Task<IActionResult> Quotation_Master_Company_Bank_List(int Company_Id, int Currency_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var (result, selectedId) = await _supplierService.Get_Quotation_Company_Bank_List(Company_Id, Currency_Id);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            selected_id = selectedId,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Quotation_Master_Company_Bank_List", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Grade Master
        /*
         * Date: 2025/05/07 By Jashmin Patel
         * Grade master...
         */
        [HttpGet]
        [Route("get_grade_master")]
        [Authorize]
        public async Task<IActionResult> Get_Grade_Master(int Grade_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var (result, totalRecord) = await _supplierService.Get_Grade_Master(Grade_Id);
                    if (result != null && result.Count > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            total_Records = totalRecord,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Grade_Master_Select", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpGet]
        [Route("get_grade_detail")]
        [Authorize]
        public async Task<IActionResult> Get_Grade_Detail(int Grade_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_Grade_Detail(Grade_Id);
                    if (result != null)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Grade_Detail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("set_grade_master")]
        [Authorize]
        public async Task<IActionResult> Set_Grade_Master(Grade_Master model)
        {
            try
            {
                if (ModelState.IsValid)
                {
                    var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                    int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                    if ((user_Id ?? 0) > 0)
                    {
                        DataTable dataTable = new DataTable();
                        dataTable.Columns.Add("Id", typeof(int));
                        dataTable.Columns.Add("Trans_Id", typeof(int));
                        dataTable.Columns.Add("Lab", typeof(string));
                        dataTable.Columns.Add("Shape", typeof(string));
                        dataTable.Columns.Add("Color", typeof(string));
                        dataTable.Columns.Add("Clarity", typeof(string));
                        dataTable.Columns.Add("Cut", typeof(string));
                        dataTable.Columns.Add("Polish", typeof(string));
                        dataTable.Columns.Add("Symm", typeof(string));
                        dataTable.Columns.Add("FLS", typeof(string));
                        dataTable.Columns.Add("Shade", typeof(string));
                        dataTable.Columns.Add("Milky", typeof(string));
                        dataTable.Columns.Add("Include_Key_To_Symbol", typeof(string));
                        dataTable.Columns.Add("Kts_Count", typeof(decimal));
                        dataTable.Columns.Add("Exclude_Key_To_Symbol", typeof(string));
                        dataTable.Columns.Add("Include_Comment", typeof(string));
                        dataTable.Columns.Add("Exclude_Comment", typeof(string));
                        dataTable.Columns.Add("From_Cts", typeof(decimal));
                        dataTable.Columns.Add("To_Cts", typeof(decimal));
                        dataTable.Columns.Add("From_Table", typeof(decimal));
                        dataTable.Columns.Add("To_Table", typeof(decimal));
                        dataTable.Columns.Add("From_Dept", typeof(decimal));
                        dataTable.Columns.Add("To_Dept", typeof(decimal));
                        dataTable.Columns.Add("From_CA", typeof(decimal));
                        dataTable.Columns.Add("To_CA", typeof(decimal));
                        dataTable.Columns.Add("From_PA", typeof(decimal));
                        dataTable.Columns.Add("To_PA", typeof(decimal));
                        dataTable.Columns.Add("From_Chgt", typeof(decimal));
                        dataTable.Columns.Add("To_Chgt", typeof(decimal));
                        dataTable.Columns.Add("From_Phgt", typeof(decimal));
                        dataTable.Columns.Add("To_Phgt", typeof(decimal));
                        dataTable.Columns.Add("From_Len", typeof(decimal));
                        dataTable.Columns.Add("To_Len", typeof(decimal));
                        dataTable.Columns.Add("From_Width", typeof(decimal));
                        dataTable.Columns.Add("To_Width", typeof(decimal));
                        dataTable.Columns.Add("Culet", typeof(string));
                        dataTable.Columns.Add("From_Girdle", typeof(decimal));
                        dataTable.Columns.Add("To_Girdle", typeof(decimal));
                        dataTable.Columns.Add("From_Str_Ln", typeof(decimal));
                        dataTable.Columns.Add("To_Str_Ln", typeof(decimal));
                        dataTable.Columns.Add("From_Lower", typeof(decimal));
                        dataTable.Columns.Add("To_Lower", typeof(decimal));
                        dataTable.Columns.Add("Grade", typeof(string));
                        dataTable.Columns.Add("Avg_Last_Month", typeof(int));
                        dataTable.Columns.Add("Avg_Type", typeof(string));
                        dataTable.Columns.Add("Avg_Is_Pcs", typeof(bool));
                        dataTable.Columns.Add("Avg_Is_Disc", typeof(bool));
                        dataTable.Columns.Add("Avg_Is_Value", typeof(bool));

                        if (model.Grade_Detail_List != null && model.Grade_Detail_List.Count > 0)
                        {
                            foreach (var item in model.Grade_Detail_List)
                            {
                                dataTable.Rows.Add(
                                    item.Id,
                                    item.Trans_Id,
                                    item.Lab?.ToString(),
                                    item.Shape?.ToString(),
                                    item.Color?.ToString(),
                                    item.Clarity?.ToString(),
                                    item.Cut?.ToString(),
                                    item.Polish?.ToString(),
                                    item.Symm?.ToString(),
                                    item.FLS?.ToString(),
                                    item.Shade?.ToString(),
                                    item.Milky?.ToString(),
                                    item.Include_Key_To_Symbol?.ToString(),
                                    item.Kts_Count,
                                    item.Exclude_Key_To_Symbol?.ToString(),
                                    item.Include_Comment?.ToString(),
                                    item.Exclude_Comment?.ToString(),
                                    item.From_Cts,
                                    item.To_Cts,
                                    item.From_Table,
                                    item.To_Table,
                                    item.From_Dept,
                                    item.To_Dept,
                                    item.From_CA,
                                    item.To_CA,
                                    item.From_PA,
                                    item.To_PA,
                                    item.From_Chgt,
                                    item.To_Chgt,
                                    item.From_Phgt,
                                    item.To_Phgt,
                                    item.From_Len,
                                    item.To_Len,
                                    item.From_Width,
                                    item.To_Width,
                                    item.Culet?.ToString(),
                                    item.From_Girdle,
                                    item.To_Girdle,
                                    item.From_Str_Ln,
                                    item.To_Str_Ln,
                                    item.From_Lower,
                                    item.To_Lower,
                                    item.Grade?.ToString(),
                                    item.Avg_Last_Month,
                                    item.Avg_Type?.ToString(),
                                    item.Avg_Is_Pcs,
                                    item.Avg_Is_Disc,
                                    item.Avg_Is_Value
                                );
                            }
                        }
                        var (message, trans_id) = await _supplierService.Set_Grade_Master(model, dataTable, user_Id ?? 0);
                        if (message == "success" && trans_id > 0)
                        {
                            return Ok(new
                            {
                                statusCode = HttpStatusCode.OK,
                                message = model.Trans_Id > 0 ? CoreCommonMessage.GradeMasterUpdated : CoreCommonMessage.GradeMasterCreated
                            });
                        }
                        else if (message == "_grade_exists" && trans_id == 0)
                        {
                            return Conflict(new
                            {
                                statusCode = HttpStatusCode.Conflict,
                                message = CoreCommonMessage.GradeAlreadyExist
                            });
                        }
                        else
                        {
                            return NoContent();
                        }
                    }
                    return StatusCode((int)HttpStatusCode.Unauthorized, new
                    {
                        message = "Unauthorized Access",
                        statusCode = (int)HttpStatusCode.Unauthorized
                    });
                }
                return BadRequest(ModelState);
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Set_Grade_Master", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_grade_master")]
        [Authorize]
        public async Task<IActionResult> Delete_Grade_Master(int Grade_Id)
        {
            try
            {
                var (message, result) = await _supplierService.Delete_Grade_Master(Grade_Id);
                if (message == "success" && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.GradeMasterDeleted
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = "parameter mismatched."
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Grade_Master", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region QC Master / Detail
        /*
         * Date: 2025/05/16 By Jashmin Patel
         * Grade master...
         */
        [HttpGet]
        [Route("get_qc_master")]
        [Authorize]
        public async Task<IActionResult> Get_QC_Master()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_QC_Master();
                    if (result != null)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_QC_Master", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("create_update_qc_master")]
        [Authorize]
        public async Task<IActionResult> Create_Update_QC_Master(IList<QC_Master_Model> model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Trans_Id", typeof(int));
                    dataTable.Columns.Add("Criteria_Name", typeof(string));
                    dataTable.Columns.Add("Status", typeof(bool));
                    dataTable.Columns.Add("QC_Type", typeof(string));
                    dataTable.Columns.Add("Query_Flag", typeof(string));

                    if (model != null && model.Count > 0)
                    {
                        foreach (var item in model)
                        {
                            dataTable.Rows.Add(item.Trans_Id, item.Criteria_Name, item.Status, item.QC_Type, item.Query_Flag);
                        }
                    }
                    var result = await _supplierService.Create_Update_QC_Master(dataTable, user_Id ?? 0);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.QCMasterUpdated
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_QC_Master", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("create_update_qc_detail")]
        [Authorize]
        public async Task<IActionResult> Create_Update_QC_Detail(IList<QC_Detail> model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("Trans_Id", typeof(int));
                    dataTable.Columns.Add("QC_Name", typeof(string));
                    dataTable.Columns.Add("Status", typeof(bool));

                    if (model != null && model.Count > 0)
                    {
                        foreach (var item in model)
                        {
                            dataTable.Rows.Add(item.Id, item.Trans_Id, item.QC_Name, item.Status);
                        }
                    }
                    var result = await _supplierService.Create_Update_QC_Detail(dataTable, user_Id ?? 0);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.QCMasterUpdated
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Create_Update_QC_Detail", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpDelete]
        [Route("delete_qc_master")]
        [Authorize]
        public async Task<IActionResult> Delete_QC_Master(int Trans_Id)
        {
            try
            {
                var (message, result) = await _supplierService.Delete_QC_Master(Trans_Id);
                if (message == "success" && result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.QCMasterDeleted
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = "parameter mismatched."
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_QC_Master", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region QC Pricing Skip
        /*
         * Date: 2025/05/27 By Jashmin Patel
         * QC Pricing Skip...
         */
        [HttpPost]
        [Route("get_purchase_master_with_pending_upcoming_qc_pricing")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Master_With_Pending_Upcoming_QC_Pricing(QC_Skip_Model model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_Purchase_Master_With_Pending_Upcoming_QC_Pricing(model.Trans_Id, model.CertORStockId);
                    if (result != null)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Master_With_Pending_Upcoming_QC_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpGet]
        [Route("get_purchase_detail_with_pending_upcoming_qc_pricing")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_With_Pending_Upcoming_QC_Pricing(int Trans_Id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);
                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_Purchase_Detail_With_Pending_Upcoming_QC_Pricing(Trans_Id);
                    if (result != null)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_With_Pending_Upcoming_QC_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }

        [HttpPost]
        [Route("get_purchase_detail_with_pending_upcoming_qc_pricing_excel")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_With_Pending_Upcoming_QC_Pricing_Excel(QC_Skip_Excel_Model model)
        {
            try
            {
                var result = await _supplierService.Get_Purchase_Detail_With_Pending_Upcoming_QC_Pricing_Excel(model.Id, model.ExcelType);

                if (result != null && result.Rows.Count > 0)
                {
                    var excelPath = string.Empty;
                    var filePath = Path.Combine(Directory.GetCurrentDirectory(), "Files/PurchaseQCSkipExcelFiles/");
                    if (!(Directory.Exists(filePath)))
                    {
                        Directory.CreateDirectory(filePath);
                    }
                    string filename = string.Empty;

                    filename = "QC_Skip_" + model.ExcelType + "_" + DateTime.UtcNow.ToString("ddMMyyyyHHmmss") + ".xlsx";

                    List<string> columnNames = new List<string>();
                    foreach (DataColumn column in result.Columns)
                    {
                        columnNames.Add(column.ColumnName);
                    }

                    DataTable columnNamesTable = new DataTable();
                    columnNamesTable.Columns.Add("Column_Name", typeof(string));

                    foreach (string columnName in columnNames)
                    {
                        columnNamesTable.Rows.Add(columnName);
                    }
                    if (model.ExcelType.ToUpper() == "UPCOMING")
                    {
                        EpExcelExport.Create_Purchase_Detail_With_Pending_Upcoming_Excel(result, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (model.ExcelType.ToUpper() == "QC")
                    {
                        EpExcelExport.Create_Purchase_Detail_With_Pending_Upcoming_QC_Pricing_Excel(result, columnNamesTable, filePath, filePath + filename);
                    }
                    else if (model.ExcelType.ToUpper() == "REPRICING")
                    {
                        EpExcelExport.Create_Purchase_Detail_With_Pending_Repricing_Excel(result, columnNamesTable, filePath, filePath + filename);
                    }
                    excelPath = _configuration["BaseUrl"] + CoreCommonFilePath.PurchaseQCSkipExcelFiles + filename;

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        result = excelPath,
                        file_name = filename
                    });
                }
                else
                {
                    return NoContent();
                }
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_With_Pending_Upcoming_QC_Pricing_Excel", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Stone Trace Report
        [HttpGet]
        [Route("get_stone_trace_report")]
        [Authorize]
        public async Task<IActionResult> Get_Stone_Trace_Report(string id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var summary = await _supplierService.Get_Stone_Trace_Master_Report(id);
                    if (summary != null)
                    {
                        var transaction = await _supplierService.Get_Stone_Trace_Detail_Report(id);

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = new { summary, transaction },
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Stone_Trace_Report", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Process Margin Master
        /*
         * Date: 2025/06/05 By Jashmin Patel
         * Process Margin Master...
        */
        [HttpGet]
        [Route("get_process_margin_master")]
        [Authorize]
        public async Task<IActionResult> Get_Process_Margin_Master()
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var result = await _partyService.Process_Margin_Master();
                    if (result != null)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Supplier_With_Pending_Upcoming_QC_Pricing", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("insert_update_process_margin_master")]
        [Authorize]
        public async Task<IActionResult> Insert_Update_Process_Margin_Master(IList<Process_Margin_Master> model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("Process_Id", typeof(int));
                    dataTable.Columns.Add("Assist_Person_Id", typeof(int));
                    dataTable.Columns.Add("Shape_Group", typeof(string));
                    dataTable.Columns.Add("From_Cts", typeof(float));
                    dataTable.Columns.Add("To_Cts", typeof(float));
                    dataTable.Columns.Add("Discount", typeof(float));

                    dataTable.Columns.Add("Sub_Process_Id", typeof(int));
                    dataTable.Columns.Add("From_Days", typeof(int));
                    dataTable.Columns.Add("To_Days", typeof(int));
                    dataTable.Columns.Add("Amount", typeof(float));
                    foreach (var item in model)
                    {
                        dataTable.Rows.Add(item.Id, item.Process_Id, item.Assist_Person_Id, item.Shape_Group, item.From_Cts, item.To_Cts, item.Discount,
                            item.Sub_Process_Id, item.From_Days, item.To_Days, item.Amount);
                    }
                    var (message, id) = await _partyService.Insert_Update_Process_Margin_Master(dataTable, user_Id ?? 0);
                    if (message == "success" && id > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = model.Any(x => x.Id > 0) ? CoreCommonMessage.ProcessMarginMasterUpdated : CoreCommonMessage.ProcessMarginMasterCreated
                        });
                    }
                    else if (message == "_process_exists" && id == 0)
                    {
                        return Conflict(new
                        {
                            statusCode = HttpStatusCode.Conflict,
                            message = CoreCommonMessage.ProcessMarginMasterAlreadyExist
                        });
                    }
                    else
                    {
                        return BadRequest(new
                        {
                            statusCode = HttpStatusCode.BadRequest,
                            message = "parameter mismatched."
                        });
                    }
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Insert_Update_Process_Margin_Master", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        [HttpDelete]
        [Route("delete_process_margin_master")]
        [Authorize]
        public async Task<IActionResult> Delete_Process_Margin_Master(int id)
        {
            try
            {
                var result = await _partyService.Delete_Process_Margin_Master(id);
                if (result > 0)
                {
                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.ProcessMarginMasterDeleted,
                    });
                }
                return BadRequest(new
                {
                    statusCode = HttpStatusCode.BadRequest,
                    message = CoreCommonMessage.ParameterMismatched
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Delete_Process_Margin_Master", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Manual Url Transfer
        /*
         * Date: 2025/06/09 By Jashmin Patel
         * Process Margin Master...
        */
        [HttpPost]
        [Route("get_purchase_detail_for_manual_url_transfer")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_Manual_Url_Transfer(IList<Manual_Url_Transfer_Model> model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("Sunrise_Stock_Id", typeof(string));
                    dataTable.Columns.Add("Image_URL", typeof(string));
                    dataTable.Columns.Add("Video_URL", typeof(string));
                    foreach (var item in model)
                    {
                        dataTable.Rows.Add(0, item.Sunrise_Stock_Id, item.Image_URL, item.Video_URL);
                    }

                    var data = await _partyService.Get_Purchase_Detail_For_Manual_Url_Transfer(dataTable, user_Id ?? 0);

                    var unavailable_message = await _partyService.Get_Unavailable_Purchase_Detail_For_Manual_Url_Transfer(dataTable);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        unavailable_message,
                        data
                    });
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_Manual_Url_Transfer", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("insert_update_manual_url_transfer")]
        [Authorize]
        public async Task<IActionResult> Insert_Update_Manual_Url_Transfer(IList<Manual_Url_Transfer> model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Id", typeof(int));
                    dataTable.Columns.Add("Sunrise_Stock_Id", typeof(string));
                    dataTable.Columns.Add("Image_URL", typeof(string));
                    dataTable.Columns.Add("Video_URL", typeof(string));
                    foreach (var item in model)
                    {
                        dataTable.Rows.Add(item.Id, item.Sunrise_Stock_Id, item.Image_URL, item.Video_URL);
                    }
                    var result = await _partyService.Insert_Update_Manual_Url_Transfer(dataTable, user_Id ?? 0);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = model.Any(x => x.Id > 0) ? CoreCommonMessage.ManualUrlTransferUpdated : CoreCommonMessage.ManualUrlTransferCreated,
                        });
                    }
                    return BadRequest(ModelState);
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Insert_Update_Manual_Url_Transfer", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region RFID_No
        [HttpPost]
        [Route("get_purchase_detail_for_rfid_no")]
        [Authorize]
        public async Task<IActionResult> Get_Purchase_Detail_For_RFId_No(IList<RFID_No_Link_Delink_Model> model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Barcode_Id", typeof(int));
                    dataTable.Columns.Add("Sunrise_Stock_Id", typeof(string));
                    dataTable.Columns.Add("Cert_No", typeof(string));
                    dataTable.Columns.Add("RFID_No", typeof(string));
                    foreach (var item in model)
                    {
                        dataTable.Rows.Add(item.Barcode_Id, item.Sunrise_Stock_Id, item.Cert_No, item.RFID_No);
                    }

                    var data = await _partyService.Get_Purchase_Detail_For_RFID_No(dataTable, user_Id ?? 0);

                    var unavailable_message = await _partyService.Get_Unavailable_Purchase_Detail_For_RFID_No(dataTable);

                    return Ok(new
                    {
                        statusCode = HttpStatusCode.OK,
                        message = CoreCommonMessage.DataSuccessfullyFound,
                        unavailable_message,
                        data
                    });
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Purchase_Detail_For_RFId_No", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        [HttpPost]
        [Route("update_purchase_detail_rfid_no")]
        [Authorize]
        public async Task<IActionResult> Update_Purchase_Detail_RFId_No(IList<RFID_No_Link_Delink_Model> model)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    DataTable dataTable = new DataTable();
                    dataTable.Columns.Add("Barcode_Id", typeof(int));
                    dataTable.Columns.Add("Sunrise_Stock_Id", typeof(string));
                    dataTable.Columns.Add("Cert_No", typeof(string));
                    dataTable.Columns.Add("RFID_No", typeof(string));
                    foreach (var item in model)
                    {
                        dataTable.Rows.Add(item.Barcode_Id, item.Sunrise_Stock_Id, item.Cert_No, item.RFID_No);
                    }
                    var result = await _partyService.Update_Purchase_Detail_RFID_No(dataTable, user_Id ?? 0);
                    if (result > 0)
                    {
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.RFIDSuccessMessage,
                        });
                    }
                    return BadRequest(ModelState);
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Update_Purchase_Detail_RFId_No", ex.StackTrace);
                return Conflict(new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Consignment Note Report
        [HttpGet]
        [Route("consignment_note")]
        [Authorize]
        public async Task<IActionResult> Get_Consignment_Note(int trans_id, bool is_summary, int? company_id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var summary = await _supplierService.Get_Consignment_Note_Master_Report(trans_id);
                    if (summary != null)
                    {
                        string trans_date = "";
                        if (summary.TryGetValue("Trans_Date", out object value) && value is string _trans_date)
                        {
                            trans_date = _trans_date;
                        }
                        var terms_condition = await _termsAndConditionService.Get_TermsAndCondition_By_Process(2, trans_date);
                        var transaction = new List<Dictionary<string, object>>();
                        if (is_summary)
                        {
                            transaction = await _supplierService.Get_Consignment_Note_Transaction_Summary_Report(trans_id);
                        }
                        else
                        {
                            transaction = await _supplierService.Get_Consignment_Note_Transaction_Report(trans_id);
                        }

                        var company_data = await _companyService.Get_Company_Details_By_Id(company_id ?? 0);

                        var report_icons_data = new
                        {
                            SHAIRU_Group_LOGO = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "SHAIRU_Group_LOGO.png",
                            sightholder = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "sightholder.png",
                            chop = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "chop.png",
                            sign = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "sign.png",
                        };
                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = new { summary, transaction },
                            company_detail = company_data,
                            term_detail = terms_condition,
                            report_icons = report_icons_data,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Consignment_Note", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion

        #region Transaction Report
        [HttpGet]
        [Route("get_transaction_report")]
        [Authorize]
        public async Task<IActionResult> Get_Transaction_Report(int trans_id, int? company_id)
        {
            try
            {
                var token = CoreService.Get_Authorization_Token(_httpContextAccessor);
                int? user_Id = _jWTAuthentication.Validate_Jwt_Token(token);

                if ((user_Id ?? 0) > 0)
                {
                    var result = await _supplierService.Get_Transaction_Report(trans_id);

                    if (result != null)
                    {
                        var terms_condition = await _termsAndConditionService.Get_TermsAndCondition_By_Trans_Id(trans_id);

                        var company_data = await _companyService.Get_Company_Details_By_Id(company_id ?? 0);

                        var report_icons_data = new
                        {
                            SHAIRU_Group_LOGO = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "SHAIRU_Group_LOGO.png",
                            sightholder = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "sightholder.png",
                            chop = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "chop.png",
                            sign = _configuration["BaseUrl"] + CoreCommonFilePath.RepostIconFilePath + "sign.png",
                        };

                        return Ok(new
                        {
                            statusCode = HttpStatusCode.OK,
                            message = CoreCommonMessage.DataSuccessfullyFound,
                            data = result,
                            Company_Detail = company_data,
                            Term_And_Condition = terms_condition,
                            Report_Icons = report_icons_data,
                        });
                    }
                    return NoContent();
                }
                return StatusCode((int)HttpStatusCode.Unauthorized, new
                {
                    message = "Unauthorized Access",
                    statusCode = (int)HttpStatusCode.Unauthorized
                });
            }
            catch (Exception ex)
            {
                await _commonService.InsertErrorLog(ex.Message, "Get_Transaction_Report", ex.StackTrace);
                return StatusCode((int)HttpStatusCode.InternalServerError, new
                {
                    message = ex.Message
                });
            }
        }
        #endregion
    }
}